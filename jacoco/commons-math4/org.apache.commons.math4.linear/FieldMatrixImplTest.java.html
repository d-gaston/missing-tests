<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FieldMatrixImplTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">commons_math4$All_in_commons_math4.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.math4.linear</a> &gt; <span class="el_source">FieldMatrixImplTest.java</span></div><h1>FieldMatrixImplTest.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.math4.linear;

import org.junit.Test;
import org.junit.Assert;
import org.apache.commons.math4.TestUtils;
import org.apache.commons.math4.exception.DimensionMismatchException;
import org.apache.commons.math4.exception.MathIllegalArgumentException;
import org.apache.commons.math4.exception.MathIllegalStateException;
import org.apache.commons.math4.exception.NoDataException;
import org.apache.commons.math4.exception.NotStrictlyPositiveException;
import org.apache.commons.math4.exception.NullArgumentException;
import org.apache.commons.math4.exception.NumberIsTooSmallException;
import org.apache.commons.math4.exception.OutOfRangeException;
import org.apache.commons.math4.fraction.Fraction;
import org.apache.commons.math4.fraction.FractionField;
import org.apache.commons.math4.linear.Array2DRowFieldMatrix;
import org.apache.commons.math4.linear.ArrayFieldVector;
import org.apache.commons.math4.linear.DefaultFieldMatrixChangingVisitor;
import org.apache.commons.math4.linear.DefaultFieldMatrixPreservingVisitor;
import org.apache.commons.math4.linear.FieldLUDecomposition;
import org.apache.commons.math4.linear.FieldMatrix;
import org.apache.commons.math4.linear.FieldVector;
import org.apache.commons.math4.linear.MatrixDimensionMismatchException;
import org.apache.commons.math4.linear.NonSquareMatrixException;

/**
 * Test cases for the {@link Array2DRowFieldMatrix} class.
 *
 */

<span class="fc" id="L47">public final class FieldMatrixImplTest {</span>

    // 3 x 3 identity matrix
<span class="fc" id="L50">    protected Fraction[][] id = { {new Fraction(1),new Fraction(0),new Fraction(0)}, {new Fraction(0),new Fraction(1),new Fraction(0)}, {new Fraction(0),new Fraction(0),new Fraction(1)} };</span>

    // Test data for group operations
<span class="fc" id="L53">    protected Fraction[][] testData = { {new Fraction(1),new Fraction(2),new Fraction(3)}, {new Fraction(2),new Fraction(5),new Fraction(3)}, {new Fraction(1),new Fraction(0),new Fraction(8)} };</span>
<span class="fc" id="L54">    protected Fraction[][] testDataLU = {{new Fraction(2), new Fraction(5), new Fraction(3)}, {new Fraction(1, 2), new Fraction(-5, 2), new Fraction(13, 2)}, {new Fraction(1, 2), new Fraction(1, 5), new Fraction(1, 5)}};</span>
<span class="fc" id="L55">    protected Fraction[][] testDataPlus2 = { {new Fraction(3),new Fraction(4),new Fraction(5)}, {new Fraction(4),new Fraction(7),new Fraction(5)}, {new Fraction(3),new Fraction(2),new Fraction(10)} };</span>
<span class="fc" id="L56">    protected Fraction[][] testDataMinus = { {new Fraction(-1),new Fraction(-2),new Fraction(-3)}, {new Fraction(-2),new Fraction(-5),new Fraction(-3)},</span>
       {new Fraction(-1),new Fraction(0),new Fraction(-8)} };
<span class="fc" id="L58">    protected Fraction[] testDataRow1 = {new Fraction(1),new Fraction(2),new Fraction(3)};</span>
<span class="fc" id="L59">    protected Fraction[] testDataCol3 = {new Fraction(3),new Fraction(3),new Fraction(8)};</span>
<span class="fc" id="L60">    protected Fraction[][] testDataInv =</span>
        { {new Fraction(-40),new Fraction(16),new Fraction(9)}, {new Fraction(13),new Fraction(-5),new Fraction(-3)}, {new Fraction(5),new Fraction(-2),new Fraction(-1)} };
<span class="fc" id="L62">    protected Fraction[] preMultTest = {new Fraction(8),new Fraction(12),new Fraction(33)};</span>
<span class="fc" id="L63">    protected Fraction[][] testData2 ={ {new Fraction(1),new Fraction(2),new Fraction(3)}, {new Fraction(2),new Fraction(5),new Fraction(3)}};</span>
<span class="fc" id="L64">    protected Fraction[][] testData2T = { {new Fraction(1),new Fraction(2)}, {new Fraction(2),new Fraction(5)}, {new Fraction(3),new Fraction(3)}};</span>
<span class="fc" id="L65">    protected Fraction[][] testDataPlusInv =</span>
        { {new Fraction(-39),new Fraction(18),new Fraction(12)}, {new Fraction(15),new Fraction(0),new Fraction(0)}, {new Fraction(6),new Fraction(-2),new Fraction(7)} };

    // lu decomposition tests
<span class="fc" id="L69">    protected Fraction[][] luData = { {new Fraction(2),new Fraction(3),new Fraction(3)}, {new Fraction(0),new Fraction(5),new Fraction(7)}, {new Fraction(6),new Fraction(9),new Fraction(8)} };</span>
<span class="fc" id="L70">    protected Fraction[][] luDataLUDecomposition = { {new Fraction(6),new Fraction(9),new Fraction(8)}, {new Fraction(0),new Fraction(5),new Fraction(7)},</span>
            {new Fraction(1, 3),new Fraction(0),new Fraction(1, 3)} };

    // singular matrices
<span class="fc" id="L74">    protected Fraction[][] singular = { {new Fraction(2),new Fraction(3)}, {new Fraction(2),new Fraction(3)} };</span>
<span class="fc" id="L75">    protected Fraction[][] bigSingular = {{new Fraction(1),new Fraction(2),new Fraction(3),new Fraction(4)}, {new Fraction(2),new Fraction(5),new Fraction(3),new Fraction(4)},</span>
        {new Fraction(7),new Fraction(3),new Fraction(256),new Fraction(1930)}, {new Fraction(3),new Fraction(7),new Fraction(6),new Fraction(8)}}; // 4th row = 1st + 2nd
<span class="fc" id="L77">    protected Fraction[][] detData = { {new Fraction(1),new Fraction(2),new Fraction(3)}, {new Fraction(4),new Fraction(5),new Fraction(6)}, {new Fraction(7),new Fraction(8),new Fraction(10)} };</span>
<span class="fc" id="L78">    protected Fraction[][] detData2 = { {new Fraction(1), new Fraction(3)}, {new Fraction(2), new Fraction(4)}};</span>

    // vectors
<span class="fc" id="L81">    protected Fraction[] testVector = {new Fraction(1),new Fraction(2),new Fraction(3)};</span>
<span class="fc" id="L82">    protected Fraction[] testVector2 = {new Fraction(1),new Fraction(2),new Fraction(3),new Fraction(4)};</span>

    // submatrix accessor tests
<span class="fc" id="L85">    protected Fraction[][] subTestData = {{new Fraction(1), new Fraction(2), new Fraction(3), new Fraction(4)}, {new Fraction(3, 2), new Fraction(5, 2), new Fraction(7, 2), new Fraction(9, 2)},</span>
            {new Fraction(2), new Fraction(4), new Fraction(6), new Fraction(8)}, {new Fraction(4), new Fraction(5), new Fraction(6), new Fraction(7)}};
    // array selections
<span class="fc" id="L88">    protected Fraction[][] subRows02Cols13 = { {new Fraction(2), new Fraction(4)}, {new Fraction(4), new Fraction(8)}};</span>
<span class="fc" id="L89">    protected Fraction[][] subRows03Cols12 = { {new Fraction(2), new Fraction(3)}, {new Fraction(5), new Fraction(6)}};</span>
<span class="fc" id="L90">    protected Fraction[][] subRows03Cols123 = { {new Fraction(2), new Fraction(3), new Fraction(4)} , {new Fraction(5), new Fraction(6), new Fraction(7)}};</span>
    // effective permutations
<span class="fc" id="L92">    protected Fraction[][] subRows20Cols123 = { {new Fraction(4), new Fraction(6), new Fraction(8)} , {new Fraction(2), new Fraction(3), new Fraction(4)}};</span>
<span class="fc" id="L93">    protected Fraction[][] subRows31Cols31 = {{new Fraction(7), new Fraction(5)}, {new Fraction(9, 2), new Fraction(5, 2)}};</span>
    // contiguous ranges
<span class="fc" id="L95">    protected Fraction[][] subRows01Cols23 = {{new Fraction(3),new Fraction(4)} , {new Fraction(7, 2), new Fraction(9, 2)}};</span>
<span class="fc" id="L96">    protected Fraction[][] subRows23Cols00 = {{new Fraction(2)} , {new Fraction(4)}};</span>
<span class="fc" id="L97">    protected Fraction[][] subRows00Cols33 = {{new Fraction(4)}};</span>
    // row matrices
<span class="fc" id="L99">    protected Fraction[][] subRow0 = {{new Fraction(1),new Fraction(2),new Fraction(3),new Fraction(4)}};</span>
<span class="fc" id="L100">    protected Fraction[][] subRow3 = {{new Fraction(4),new Fraction(5),new Fraction(6),new Fraction(7)}};</span>
    // column matrices
<span class="fc" id="L102">    protected Fraction[][] subColumn1 = {{new Fraction(2)}, {new Fraction(5, 2)}, {new Fraction(4)}, {new Fraction(5)}};</span>
<span class="fc" id="L103">    protected Fraction[][] subColumn3 = {{new Fraction(4)}, {new Fraction(9, 2)}, {new Fraction(8)}, {new Fraction(7)}};</span>

    // tolerances
<span class="fc" id="L106">    protected double entryTolerance = 10E-16;</span>
<span class="fc" id="L107">    protected double normTolerance = 10E-14;</span>

    /** test dimensions */
    @Test
    public void testDimensions() {
<span class="fc" id="L112">        Array2DRowFieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L113">        Array2DRowFieldMatrix&lt;Fraction&gt; m2 = new Array2DRowFieldMatrix&lt;&gt;(testData2);</span>
<span class="fc" id="L114">        Assert.assertEquals(&quot;testData row dimension&quot;,3,m.getRowDimension());</span>
<span class="fc" id="L115">        Assert.assertEquals(&quot;testData column dimension&quot;,3,m.getColumnDimension());</span>
<span class="fc" id="L116">        Assert.assertTrue(&quot;testData is square&quot;,m.isSquare());</span>
<span class="fc" id="L117">        Assert.assertEquals(&quot;testData2 row dimension&quot;,m2.getRowDimension(),2);</span>
<span class="fc" id="L118">        Assert.assertEquals(&quot;testData2 column dimension&quot;,m2.getColumnDimension(),3);</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">        Assert.assertTrue(&quot;testData2 is not square&quot;,!m2.isSquare());</span>
<span class="fc" id="L120">    }</span>

    /** test copy functions */
    @Test
    public void testCopyFunctions() {
<span class="fc" id="L125">        Array2DRowFieldMatrix&lt;Fraction&gt; m1 = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L126">        Array2DRowFieldMatrix&lt;Fraction&gt; m2 = new Array2DRowFieldMatrix&lt;&gt;(m1.getData());</span>
<span class="fc" id="L127">        Assert.assertEquals(m2,m1);</span>
<span class="fc" id="L128">        Array2DRowFieldMatrix&lt;Fraction&gt; m3 = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L129">        Array2DRowFieldMatrix&lt;Fraction&gt; m4 = new Array2DRowFieldMatrix&lt;&gt;(m3.getData(), false);</span>
<span class="fc" id="L130">        Assert.assertEquals(m4,m3);</span>
<span class="fc" id="L131">    }</span>

    /** test add */
    @Test
    public void testAdd() {
<span class="fc" id="L136">        Array2DRowFieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L137">        Array2DRowFieldMatrix&lt;Fraction&gt; mInv = new Array2DRowFieldMatrix&lt;&gt;(testDataInv);</span>
<span class="fc" id="L138">        FieldMatrix&lt;Fraction&gt; mPlusMInv = m.add(mInv);</span>
<span class="fc" id="L139">        Fraction[][] sumEntries = mPlusMInv.getData();</span>
<span class="fc bfc" id="L140" title="All 2 branches covered.">        for (int row = 0; row &lt; m.getRowDimension(); row++) {</span>
<span class="fc bfc" id="L141" title="All 2 branches covered.">            for (int col = 0; col &lt; m.getColumnDimension(); col++) {</span>
<span class="fc" id="L142">                Assert.assertEquals(testDataPlusInv[row][col],sumEntries[row][col]);</span>
            }
        }
<span class="fc" id="L145">    }</span>

    /** test add failure */
    @Test
    public void testAddFail() {
<span class="fc" id="L150">        Array2DRowFieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L151">        Array2DRowFieldMatrix&lt;Fraction&gt; m2 = new Array2DRowFieldMatrix&lt;&gt;(testData2);</span>
        try {
<span class="nc" id="L153">            m.add(m2);</span>
<span class="nc" id="L154">            Assert.fail(&quot;MathIllegalArgumentException expected&quot;);</span>
<span class="fc" id="L155">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L157">        }</span>
<span class="fc" id="L158">    }</span>

     /** test m-n = m + -n */
    @Test
    public void testPlusMinus() {
<span class="fc" id="L163">        Array2DRowFieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L164">        Array2DRowFieldMatrix&lt;Fraction&gt; m2 = new Array2DRowFieldMatrix&lt;&gt;(testDataInv);</span>
<span class="fc" id="L165">        TestUtils.assertEquals(m.subtract(m2),m2.scalarMultiply(new Fraction(-1)).add(m));</span>
        try {
<span class="nc" id="L167">            m.subtract(new Array2DRowFieldMatrix&lt;&gt;(testData2));</span>
<span class="nc" id="L168">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L169">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L171">        }</span>
<span class="fc" id="L172">    }</span>

    /** test multiply */
    @Test
     public void testMultiply() {
<span class="fc" id="L177">        Array2DRowFieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L178">        Array2DRowFieldMatrix&lt;Fraction&gt; mInv = new Array2DRowFieldMatrix&lt;&gt;(testDataInv);</span>
<span class="fc" id="L179">        Array2DRowFieldMatrix&lt;Fraction&gt; identity = new Array2DRowFieldMatrix&lt;&gt;(id);</span>
<span class="fc" id="L180">        Array2DRowFieldMatrix&lt;Fraction&gt; m2 = new Array2DRowFieldMatrix&lt;&gt;(testData2);</span>
<span class="fc" id="L181">        TestUtils.assertEquals(m.multiply(mInv), identity);</span>
<span class="fc" id="L182">        TestUtils.assertEquals(mInv.multiply(m), identity);</span>
<span class="fc" id="L183">        TestUtils.assertEquals(m.multiply(identity), m);</span>
<span class="fc" id="L184">        TestUtils.assertEquals(identity.multiply(mInv), mInv);</span>
<span class="fc" id="L185">        TestUtils.assertEquals(m2.multiply(identity), m2);</span>
        try {
<span class="nc" id="L187">            m.multiply(new Array2DRowFieldMatrix&lt;&gt;(bigSingular));</span>
<span class="nc" id="L188">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L189">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L191">        }</span>
<span class="fc" id="L192">    }</span>

    //Additional Test for Array2DRowFieldMatrix&lt;Fraction&gt;Test.testMultiply

<span class="fc" id="L196">    private final Fraction[][] d3 = new Fraction[][] {{new Fraction(1),new Fraction(2),new Fraction(3),new Fraction(4)},{new Fraction(5),new Fraction(6),new Fraction(7),new Fraction(8)}};</span>
<span class="fc" id="L197">    private final Fraction[][] d4 = new Fraction[][] {{new Fraction(1)},{new Fraction(2)},{new Fraction(3)},{new Fraction(4)}};</span>
<span class="fc" id="L198">    private final Fraction[][] d5 = new Fraction[][] {{new Fraction(30)},{new Fraction(70)}};</span>

    @Test
    public void testMultiply2() {
<span class="fc" id="L202">       FieldMatrix&lt;Fraction&gt; m3 = new Array2DRowFieldMatrix&lt;&gt;(d3);</span>
<span class="fc" id="L203">       FieldMatrix&lt;Fraction&gt; m4 = new Array2DRowFieldMatrix&lt;&gt;(d4);</span>
<span class="fc" id="L204">       FieldMatrix&lt;Fraction&gt; m5 = new Array2DRowFieldMatrix&lt;&gt;(d5);</span>
<span class="fc" id="L205">       TestUtils.assertEquals(m3.multiply(m4), m5);</span>
<span class="fc" id="L206">   }</span>

    @Test
    public void testPower() {
<span class="fc" id="L210">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L211">        FieldMatrix&lt;Fraction&gt; mInv = new Array2DRowFieldMatrix&lt;&gt;(testDataInv);</span>
<span class="fc" id="L212">        FieldMatrix&lt;Fraction&gt; mPlusInv = new Array2DRowFieldMatrix&lt;&gt;(testDataPlusInv);</span>
<span class="fc" id="L213">        FieldMatrix&lt;Fraction&gt; identity = new Array2DRowFieldMatrix&lt;&gt;(id);</span>

<span class="fc" id="L215">        TestUtils.assertEquals(m.power(0), identity);</span>
<span class="fc" id="L216">        TestUtils.assertEquals(mInv.power(0), identity);</span>
<span class="fc" id="L217">        TestUtils.assertEquals(mPlusInv.power(0), identity);</span>

<span class="fc" id="L219">        TestUtils.assertEquals(m.power(1), m);</span>
<span class="fc" id="L220">        TestUtils.assertEquals(mInv.power(1), mInv);</span>
<span class="fc" id="L221">        TestUtils.assertEquals(mPlusInv.power(1), mPlusInv);</span>

<span class="fc" id="L223">        FieldMatrix&lt;Fraction&gt; C1 = m.copy();</span>
<span class="fc" id="L224">        FieldMatrix&lt;Fraction&gt; C2 = mInv.copy();</span>
<span class="fc" id="L225">        FieldMatrix&lt;Fraction&gt; C3 = mPlusInv.copy();</span>

        // stop at 5 to avoid overflow
<span class="fc bfc" id="L228" title="All 2 branches covered.">        for (int i = 2; i &lt;= 5; ++i) {</span>
<span class="fc" id="L229">            C1 = C1.multiply(m);</span>
<span class="fc" id="L230">            C2 = C2.multiply(mInv);</span>
<span class="fc" id="L231">            C3 = C3.multiply(mPlusInv);</span>

<span class="fc" id="L233">            TestUtils.assertEquals(m.power(i), C1);</span>
<span class="fc" id="L234">            TestUtils.assertEquals(mInv.power(i), C2);</span>
<span class="fc" id="L235">            TestUtils.assertEquals(mPlusInv.power(i), C3);</span>
        }

        try {
<span class="fc" id="L239">            FieldMatrix&lt;Fraction&gt; mNotSquare = new Array2DRowFieldMatrix&lt;&gt;(testData2T);</span>
<span class="nc" id="L240">            mNotSquare.power(2);</span>
<span class="nc" id="L241">            Assert.fail(&quot;Expecting NonSquareMatrixException&quot;);</span>
<span class="fc" id="L242">        } catch (NonSquareMatrixException ex) {</span>
            // ignored
<span class="nc" id="L244">        }</span>

        try {
<span class="nc" id="L247">            m.power(-1);</span>
<span class="nc" id="L248">            Assert.fail(&quot;Expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L249">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L251">        }</span>
<span class="fc" id="L252">    }</span>

    /** test trace */
    @Test
    public void testTrace() {
<span class="fc" id="L257">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(id);</span>
<span class="fc" id="L258">        Assert.assertEquals(&quot;identity trace&quot;,new Fraction(3),m.getTrace());</span>
<span class="fc" id="L259">        m = new Array2DRowFieldMatrix&lt;&gt;(testData2);</span>
        try {
<span class="nc" id="L261">            m.getTrace();</span>
<span class="nc" id="L262">            Assert.fail(&quot;Expecting NonSquareMatrixException&quot;);</span>
<span class="fc" id="L263">        } catch (NonSquareMatrixException ex) {</span>
            // ignored
<span class="nc" id="L265">        }</span>
<span class="fc" id="L266">    }</span>

    /** test sclarAdd */
    @Test
    public void testScalarAdd() {
<span class="fc" id="L271">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L272">        TestUtils.assertEquals(new Array2DRowFieldMatrix&lt;&gt;(testDataPlus2), m.scalarAdd(new Fraction(2)));</span>
<span class="fc" id="L273">    }</span>

    /** test operate */
    @Test
    public void testOperate() {
<span class="fc" id="L278">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(id);</span>
<span class="fc" id="L279">        TestUtils.assertEquals(testVector, m.operate(testVector));</span>
<span class="fc" id="L280">        TestUtils.assertEquals(testVector, m.operate(new ArrayFieldVector&lt;&gt;(testVector)).toArray());</span>
<span class="fc" id="L281">        m = new Array2DRowFieldMatrix&lt;&gt;(bigSingular);</span>
        try {
<span class="nc" id="L283">            m.operate(testVector);</span>
<span class="nc" id="L284">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L285">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L287">        }</span>
<span class="fc" id="L288">    }</span>

    /** test issue MATH-209 */
    @Test
    public void testMath209() {
<span class="fc" id="L293">        FieldMatrix&lt;Fraction&gt; a = new Array2DRowFieldMatrix&lt;&gt;(new Fraction[][] {</span>
                { new Fraction(1), new Fraction(2) }, { new Fraction(3), new Fraction(4) }, { new Fraction(5), new Fraction(6) }
        }, false);
<span class="fc" id="L296">        Fraction[] b = a.operate(new Fraction[] { new Fraction(1), new Fraction(1) });</span>
<span class="fc" id="L297">        Assert.assertEquals(a.getRowDimension(), b.length);</span>
<span class="fc" id="L298">        Assert.assertEquals( new Fraction(3), b[0]);</span>
<span class="fc" id="L299">        Assert.assertEquals( new Fraction(7), b[1]);</span>
<span class="fc" id="L300">        Assert.assertEquals(new Fraction(11), b[2]);</span>
<span class="fc" id="L301">    }</span>

    /** test transpose */
    @Test
    public void testTranspose() {
<span class="fc" id="L306">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L307">        FieldMatrix&lt;Fraction&gt; mIT = new FieldLUDecomposition&lt;&gt;(m).getSolver().getInverse().transpose();</span>
<span class="fc" id="L308">        FieldMatrix&lt;Fraction&gt; mTI = new FieldLUDecomposition&lt;&gt;(m.transpose()).getSolver().getInverse();</span>
<span class="fc" id="L309">        TestUtils.assertEquals(mIT, mTI);</span>
<span class="fc" id="L310">        m = new Array2DRowFieldMatrix&lt;&gt;(testData2);</span>
<span class="fc" id="L311">        FieldMatrix&lt;Fraction&gt; mt = new Array2DRowFieldMatrix&lt;&gt;(testData2T);</span>
<span class="fc" id="L312">        TestUtils.assertEquals(mt, m.transpose());</span>
<span class="fc" id="L313">    }</span>

    /** test preMultiply by vector */
    @Test
    public void testPremultiplyVector() {
<span class="fc" id="L318">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L319">        TestUtils.assertEquals(m.preMultiply(testVector), preMultTest);</span>
<span class="fc" id="L320">        TestUtils.assertEquals(m.preMultiply(new ArrayFieldVector&lt;&gt;(testVector).toArray()),</span>
                               preMultTest);
<span class="fc" id="L322">        m = new Array2DRowFieldMatrix&lt;&gt;(bigSingular);</span>
        try {
<span class="nc" id="L324">            m.preMultiply(testVector);</span>
<span class="nc" id="L325">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L326">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L328">        }</span>
<span class="fc" id="L329">    }</span>

    @Test
    public void testPremultiply() {
<span class="fc" id="L333">        FieldMatrix&lt;Fraction&gt; m3 = new Array2DRowFieldMatrix&lt;&gt;(d3);</span>
<span class="fc" id="L334">        FieldMatrix&lt;Fraction&gt; m4 = new Array2DRowFieldMatrix&lt;&gt;(d4);</span>
<span class="fc" id="L335">        FieldMatrix&lt;Fraction&gt; m5 = new Array2DRowFieldMatrix&lt;&gt;(d5);</span>
<span class="fc" id="L336">        TestUtils.assertEquals(m4.preMultiply(m3), m5);</span>

<span class="fc" id="L338">        Array2DRowFieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L339">        Array2DRowFieldMatrix&lt;Fraction&gt; mInv = new Array2DRowFieldMatrix&lt;&gt;(testDataInv);</span>
<span class="fc" id="L340">        Array2DRowFieldMatrix&lt;Fraction&gt; identity = new Array2DRowFieldMatrix&lt;&gt;(id);</span>
<span class="fc" id="L341">        TestUtils.assertEquals(m.preMultiply(mInv), identity);</span>
<span class="fc" id="L342">        TestUtils.assertEquals(mInv.preMultiply(m), identity);</span>
<span class="fc" id="L343">        TestUtils.assertEquals(m.preMultiply(identity), m);</span>
<span class="fc" id="L344">        TestUtils.assertEquals(identity.preMultiply(mInv), mInv);</span>
        try {
<span class="nc" id="L346">            m.preMultiply(new Array2DRowFieldMatrix&lt;&gt;(bigSingular));</span>
<span class="nc" id="L347">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L348">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L350">        }</span>
<span class="fc" id="L351">    }</span>

    @Test
    public void testGetVectors() {
<span class="fc" id="L355">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L356">        TestUtils.assertEquals(m.getRow(0), testDataRow1);</span>
<span class="fc" id="L357">        TestUtils.assertEquals(m.getColumn(2), testDataCol3);</span>
        try {
<span class="nc" id="L359">            m.getRow(10);</span>
<span class="nc" id="L360">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L361">        } catch (OutOfRangeException ex) {</span>
            // ignored
<span class="nc" id="L363">        }</span>
        try {
<span class="nc" id="L365">            m.getColumn(-1);</span>
<span class="nc" id="L366">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L367">        } catch (OutOfRangeException ex) {</span>
            // ignored
<span class="nc" id="L369">        }</span>
<span class="fc" id="L370">    }</span>

    @Test
    public void testGetEntry() {
<span class="fc" id="L374">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L375">        Assert.assertEquals(&quot;get entry&quot;, m.getEntry(0,1), new Fraction(2));</span>
        try {
<span class="nc" id="L377">            m.getEntry(10, 4);</span>
<span class="nc" id="L378">            Assert.fail (&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L379">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L381">        }</span>
<span class="fc" id="L382">    }</span>

    /** test examples in user guide */
    @Test
    public void testExamples() {
        // Create a real matrix with two rows and three columns
<span class="fc" id="L388">        Fraction[][] matrixData = {</span>
                {new Fraction(1),new Fraction(2),new Fraction(3)},
                {new Fraction(2),new Fraction(5),new Fraction(3)}
        };
<span class="fc" id="L392">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(matrixData);</span>
        // One more with three rows, two columns
<span class="fc" id="L394">        Fraction[][] matrixData2 = {</span>
                {new Fraction(1),new Fraction(2)},
                {new Fraction(2),new Fraction(5)},
                {new Fraction(1), new Fraction(7)}
        };
<span class="fc" id="L399">        FieldMatrix&lt;Fraction&gt; n = new Array2DRowFieldMatrix&lt;&gt;(matrixData2);</span>
        // Now multiply m by n
<span class="fc" id="L401">        FieldMatrix&lt;Fraction&gt; p = m.multiply(n);</span>
<span class="fc" id="L402">        Assert.assertEquals(2, p.getRowDimension());</span>
<span class="fc" id="L403">        Assert.assertEquals(2, p.getColumnDimension());</span>
        // Invert p
<span class="fc" id="L405">        FieldMatrix&lt;Fraction&gt; pInverse = new FieldLUDecomposition&lt;&gt;(p).getSolver().getInverse();</span>
<span class="fc" id="L406">        Assert.assertEquals(2, pInverse.getRowDimension());</span>
<span class="fc" id="L407">        Assert.assertEquals(2, pInverse.getColumnDimension());</span>

        // Solve example
<span class="fc" id="L410">        Fraction[][] coefficientsData = {</span>
                {new Fraction(2), new Fraction(3), new Fraction(-2)},
                {new Fraction(-1), new Fraction(7), new Fraction(6)},
                {new Fraction(4), new Fraction(-3), new Fraction(-5)}
        };
<span class="fc" id="L415">        FieldMatrix&lt;Fraction&gt; coefficients = new Array2DRowFieldMatrix&lt;&gt;(coefficientsData);</span>
<span class="fc" id="L416">        Fraction[] constants = {</span>
            new Fraction(1), new Fraction(-2), new Fraction(1)
        };
        Fraction[] solution;
<span class="fc" id="L420">        solution = new FieldLUDecomposition&lt;&gt;(coefficients)</span>
<span class="fc" id="L421">            .getSolver()</span>
<span class="fc" id="L422">            .solve(new ArrayFieldVector&lt;&gt;(constants, false)).toArray();</span>
<span class="fc" id="L423">        Assert.assertEquals(new Fraction(2).multiply(solution[0]).</span>
<span class="fc" id="L424">                     add(new Fraction(3).multiply(solution[1])).</span>
<span class="fc" id="L425">                     subtract(new Fraction(2).multiply(solution[2])), constants[0]);</span>
<span class="fc" id="L426">        Assert.assertEquals(new Fraction(-1).multiply(solution[0]).</span>
<span class="fc" id="L427">                     add(new Fraction(7).multiply(solution[1])).</span>
<span class="fc" id="L428">                     add(new Fraction(6).multiply(solution[2])), constants[1]);</span>
<span class="fc" id="L429">        Assert.assertEquals(new Fraction(4).multiply(solution[0]).</span>
<span class="fc" id="L430">                     subtract(new Fraction(3).multiply(solution[1])).</span>
<span class="fc" id="L431">                     subtract(new Fraction(5).multiply(solution[2])), constants[2]);</span>

<span class="fc" id="L433">    }</span>

    // test submatrix accessors
    @Test
    public void testGetSubMatrix() {
<span class="fc" id="L438">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L439">        checkGetSubMatrix(m, subRows23Cols00,  2 , 3 , 0, 0);</span>
<span class="fc" id="L440">        checkGetSubMatrix(m, subRows00Cols33,  0 , 0 , 3, 3);</span>
<span class="fc" id="L441">        checkGetSubMatrix(m, subRows01Cols23,  0 , 1 , 2, 3);</span>
<span class="fc" id="L442">        checkGetSubMatrix(m, subRows02Cols13,  new int[] { 0, 2 }, new int[] { 1, 3 });</span>
<span class="fc" id="L443">        checkGetSubMatrix(m, subRows03Cols12,  new int[] { 0, 3 }, new int[] { 1, 2 });</span>
<span class="fc" id="L444">        checkGetSubMatrix(m, subRows03Cols123, new int[] { 0, 3 }, new int[] { 1, 2, 3 });</span>
<span class="fc" id="L445">        checkGetSubMatrix(m, subRows20Cols123, new int[] { 2, 0 }, new int[] { 1, 2, 3 });</span>
<span class="fc" id="L446">        checkGetSubMatrix(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 });</span>
<span class="fc" id="L447">        checkGetSubMatrix(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 });</span>
<span class="fc" id="L448">        checkGetSubMatrix(m, null,  1, 0, 2, 4);</span>
<span class="fc" id="L449">        checkGetSubMatrix(m, null, -1, 1, 2, 2);</span>
<span class="fc" id="L450">        checkGetSubMatrix(m, null,  1, 0, 2, 2);</span>
<span class="fc" id="L451">        checkGetSubMatrix(m, null,  1, 0, 2, 4);</span>
<span class="fc" id="L452">        checkGetSubMatrix(m, null, new int[] {},    new int[] { 0 });</span>
<span class="fc" id="L453">        checkGetSubMatrix(m, null, new int[] { 0 }, new int[] { 4 });</span>
<span class="fc" id="L454">    }</span>

    private void checkGetSubMatrix(FieldMatrix&lt;Fraction&gt; m, Fraction[][] reference,
                                   int startRow, int endRow, int startColumn, int endColumn) {
        try {
<span class="fc" id="L459">            FieldMatrix&lt;Fraction&gt; sub = m.getSubMatrix(startRow, endRow, startColumn, endColumn);</span>
<span class="pc bpc" id="L460" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="fc" id="L461">                Assert.assertEquals(new Array2DRowFieldMatrix&lt;&gt;(reference), sub);</span>
            } else {
<span class="nc" id="L463">                Assert.fail(&quot;Expecting OutOfRangeException or NotStrictlyPositiveException&quot;</span>
                     + &quot; or NumberIsTooSmallException or NoDataException&quot;);
            }
<span class="fc" id="L466">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L467" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L468">                throw e;</span>
            }
<span class="nc" id="L470">        } catch (NotStrictlyPositiveException e) {</span>
<span class="nc bnc" id="L471" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L472">                throw e;</span>
            }
<span class="fc" id="L474">        } catch (NumberIsTooSmallException e) {</span>
<span class="pc bpc" id="L475" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L476">                throw e;</span>
            }
<span class="nc" id="L478">        } catch (NoDataException e) {</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L480">                throw e;</span>
            }
<span class="pc" id="L482">        }</span>
<span class="fc" id="L483">    }</span>

    private void checkGetSubMatrix(FieldMatrix&lt;Fraction&gt; m, Fraction[][] reference,
                                   int[] selectedRows, int[] selectedColumns) {
        try {
<span class="fc" id="L488">            FieldMatrix&lt;Fraction&gt; sub = m.getSubMatrix(selectedRows, selectedColumns);</span>
<span class="pc bpc" id="L489" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="fc" id="L490">                Assert.assertEquals(new Array2DRowFieldMatrix&lt;&gt;(reference), sub);</span>
            } else {
<span class="nc" id="L492">                Assert.fail(&quot;Expecting OutOfRangeException or NotStrictlyPositiveException&quot;</span>
                     + &quot; or NumberIsTooSmallException or NoDataException&quot;);
            }
<span class="fc" id="L495">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L496" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L497">                throw e;</span>
            }
<span class="nc" id="L499">        } catch (NotStrictlyPositiveException e) {</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L501">                throw e;</span>
            }
<span class="nc" id="L503">        } catch (NumberIsTooSmallException e) {</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L505">                throw e;</span>
            }
<span class="fc" id="L507">        } catch (NoDataException e) {</span>
<span class="pc bpc" id="L508" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L509">                throw e;</span>
            }
<span class="pc" id="L511">        }</span>
<span class="fc" id="L512">    }</span>

    @Test
    public void testCopySubMatrix() {
<span class="fc" id="L516">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L517">        checkCopy(m, subRows23Cols00,  2 , 3 , 0, 0);</span>
<span class="fc" id="L518">        checkCopy(m, subRows00Cols33,  0 , 0 , 3, 3);</span>
<span class="fc" id="L519">        checkCopy(m, subRows01Cols23,  0 , 1 , 2, 3);</span>
<span class="fc" id="L520">        checkCopy(m, subRows02Cols13,  new int[] { 0, 2 }, new int[] { 1, 3 });</span>
<span class="fc" id="L521">        checkCopy(m, subRows03Cols12,  new int[] { 0, 3 }, new int[] { 1, 2 });</span>
<span class="fc" id="L522">        checkCopy(m, subRows03Cols123, new int[] { 0, 3 }, new int[] { 1, 2, 3 });</span>
<span class="fc" id="L523">        checkCopy(m, subRows20Cols123, new int[] { 2, 0 }, new int[] { 1, 2, 3 });</span>
<span class="fc" id="L524">        checkCopy(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 });</span>
<span class="fc" id="L525">        checkCopy(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 });</span>

<span class="fc" id="L527">        checkCopy(m, null,  1, 0, 2, 4);</span>
<span class="fc" id="L528">        checkCopy(m, null, -1, 1, 2, 2);</span>
<span class="fc" id="L529">        checkCopy(m, null,  1, 0, 2, 2);</span>
<span class="fc" id="L530">        checkCopy(m, null,  1, 0, 2, 4);</span>
<span class="fc" id="L531">        checkCopy(m, null, new int[] {},    new int[] { 0 });</span>
<span class="fc" id="L532">        checkCopy(m, null, new int[] { 0 }, new int[] { 4 });</span>
<span class="fc" id="L533">    }</span>

    private void checkCopy(FieldMatrix&lt;Fraction&gt; m, Fraction[][] reference,
                           int startRow, int endRow, int startColumn, int endColumn) {
        try {
<span class="fc bfc" id="L538" title="All 2 branches covered.">            Fraction[][] sub = (reference == null) ?</span>
                             new Fraction[1][1] :
                             new Fraction[reference.length][reference[0].length];
<span class="fc" id="L541">            m.copySubMatrix(startRow, endRow, startColumn, endColumn, sub);</span>
<span class="pc bpc" id="L542" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="fc" id="L543">                Assert.assertEquals(new Array2DRowFieldMatrix&lt;&gt;(reference), new Array2DRowFieldMatrix&lt;&gt;(sub));</span>
            } else {
<span class="nc" id="L545">                Assert.fail(&quot;Expecting OutOfRangeException or NumberIsTooSmallException or NoDataException&quot;);</span>
            }
<span class="fc" id="L547">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L548" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L549">                throw e;</span>
            }
<span class="fc" id="L551">        } catch (NumberIsTooSmallException e) {</span>
<span class="pc bpc" id="L552" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L553">                throw e;</span>
            }
<span class="nc" id="L555">        } catch (NoDataException e) {</span>
<span class="nc bnc" id="L556" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L557">                throw e;</span>
            }
<span class="fc" id="L559">        }</span>
<span class="fc" id="L560">    }</span>

    private void checkCopy(FieldMatrix&lt;Fraction&gt; m, Fraction[][] reference,
                           int[] selectedRows, int[] selectedColumns) {
        try {
<span class="fc bfc" id="L565" title="All 2 branches covered.">            Fraction[][] sub = (reference == null) ?</span>
                    new Fraction[1][1] :
                    new Fraction[reference.length][reference[0].length];
<span class="fc" id="L568">            m.copySubMatrix(selectedRows, selectedColumns, sub);</span>
<span class="pc bpc" id="L569" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="fc" id="L570">                Assert.assertEquals(new Array2DRowFieldMatrix&lt;&gt;(reference), new Array2DRowFieldMatrix&lt;&gt;(sub));</span>
            } else {
<span class="nc" id="L572">                Assert.fail(&quot;Expecting OutOfRangeException or NumberIsTooSmallException or NoDataException&quot;);</span>
            }
<span class="fc" id="L574">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L575" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L576">                throw e;</span>
            }
<span class="nc" id="L578">        } catch (NumberIsTooSmallException e) {</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L580">                throw e;</span>
            }
<span class="fc" id="L582">        } catch (NoDataException e) {</span>
<span class="pc bpc" id="L583" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L584">                throw e;</span>
            }
<span class="pc" id="L586">        }</span>
<span class="fc" id="L587">    }</span>

    @Test
    public void testGetRowMatrix() {
<span class="fc" id="L591">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L592">        FieldMatrix&lt;Fraction&gt; mRow0 = new Array2DRowFieldMatrix&lt;&gt;(subRow0);</span>
<span class="fc" id="L593">        FieldMatrix&lt;Fraction&gt; mRow3 = new Array2DRowFieldMatrix&lt;&gt;(subRow3);</span>
<span class="fc" id="L594">        Assert.assertEquals(&quot;Row0&quot;, mRow0,</span>
<span class="fc" id="L595">                m.getRowMatrix(0));</span>
<span class="fc" id="L596">        Assert.assertEquals(&quot;Row3&quot;, mRow3,</span>
<span class="fc" id="L597">                m.getRowMatrix(3));</span>
        try {
<span class="nc" id="L599">            m.getRowMatrix(-1);</span>
<span class="nc" id="L600">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L601">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L603">        }</span>
        try {
<span class="nc" id="L605">            m.getRowMatrix(4);</span>
<span class="nc" id="L606">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L607">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L609">        }</span>
<span class="fc" id="L610">    }</span>

    @Test
    public void testSetRowMatrix() {
<span class="fc" id="L614">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L615">        FieldMatrix&lt;Fraction&gt; mRow3 = new Array2DRowFieldMatrix&lt;&gt;(subRow3);</span>
<span class="fc" id="L616">        Assert.assertNotSame(mRow3, m.getRowMatrix(0));</span>
<span class="fc" id="L617">        m.setRowMatrix(0, mRow3);</span>
<span class="fc" id="L618">        Assert.assertEquals(mRow3, m.getRowMatrix(0));</span>
        try {
<span class="nc" id="L620">            m.setRowMatrix(-1, mRow3);</span>
<span class="nc" id="L621">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L622">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L624">        }</span>
        try {
<span class="nc" id="L626">            m.setRowMatrix(0, m);</span>
<span class="nc" id="L627">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L628">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L630">        }</span>
<span class="fc" id="L631">    }</span>

    @Test
    public void testGetColumnMatrix() {
<span class="fc" id="L635">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L636">        FieldMatrix&lt;Fraction&gt; mColumn1 = new Array2DRowFieldMatrix&lt;&gt;(subColumn1);</span>
<span class="fc" id="L637">        FieldMatrix&lt;Fraction&gt; mColumn3 = new Array2DRowFieldMatrix&lt;&gt;(subColumn3);</span>
<span class="fc" id="L638">        Assert.assertEquals(&quot;Column1&quot;, mColumn1,</span>
<span class="fc" id="L639">                m.getColumnMatrix(1));</span>
<span class="fc" id="L640">        Assert.assertEquals(&quot;Column3&quot;, mColumn3,</span>
<span class="fc" id="L641">                m.getColumnMatrix(3));</span>
        try {
<span class="nc" id="L643">            m.getColumnMatrix(-1);</span>
<span class="nc" id="L644">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L645">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L647">        }</span>
        try {
<span class="nc" id="L649">            m.getColumnMatrix(4);</span>
<span class="nc" id="L650">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L651">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L653">        }</span>
<span class="fc" id="L654">    }</span>

    @Test
    public void testSetColumnMatrix() {
<span class="fc" id="L658">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L659">        FieldMatrix&lt;Fraction&gt; mColumn3 = new Array2DRowFieldMatrix&lt;&gt;(subColumn3);</span>
<span class="fc" id="L660">        Assert.assertNotSame(mColumn3, m.getColumnMatrix(1));</span>
<span class="fc" id="L661">        m.setColumnMatrix(1, mColumn3);</span>
<span class="fc" id="L662">        Assert.assertEquals(mColumn3, m.getColumnMatrix(1));</span>
        try {
<span class="nc" id="L664">            m.setColumnMatrix(-1, mColumn3);</span>
<span class="nc" id="L665">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L666">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L668">        }</span>
        try {
<span class="nc" id="L670">            m.setColumnMatrix(0, m);</span>
<span class="nc" id="L671">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L672">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L674">        }</span>
<span class="fc" id="L675">    }</span>

    @Test
    public void testGetRowVector() {
<span class="fc" id="L679">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L680">        FieldVector&lt;Fraction&gt; mRow0 = new ArrayFieldVector&lt;&gt;(subRow0[0]);</span>
<span class="fc" id="L681">        FieldVector&lt;Fraction&gt; mRow3 = new ArrayFieldVector&lt;&gt;(subRow3[0]);</span>
<span class="fc" id="L682">        Assert.assertEquals(&quot;Row0&quot;, mRow0, m.getRowVector(0));</span>
<span class="fc" id="L683">        Assert.assertEquals(&quot;Row3&quot;, mRow3, m.getRowVector(3));</span>
        try {
<span class="nc" id="L685">            m.getRowVector(-1);</span>
<span class="nc" id="L686">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L687">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L689">        }</span>
        try {
<span class="nc" id="L691">            m.getRowVector(4);</span>
<span class="nc" id="L692">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L693">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L695">        }</span>
<span class="fc" id="L696">    }</span>

    @Test
    public void testSetRowVector() {
<span class="fc" id="L700">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L701">        FieldVector&lt;Fraction&gt; mRow3 = new ArrayFieldVector&lt;&gt;(subRow3[0]);</span>
<span class="fc" id="L702">        Assert.assertNotSame(mRow3, m.getRowMatrix(0));</span>
<span class="fc" id="L703">        m.setRowVector(0, mRow3);</span>
<span class="fc" id="L704">        Assert.assertEquals(mRow3, m.getRowVector(0));</span>
        try {
<span class="nc" id="L706">            m.setRowVector(-1, mRow3);</span>
<span class="nc" id="L707">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L708">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L710">        }</span>
        try {
<span class="nc" id="L712">            m.setRowVector(0, new ArrayFieldVector&lt;&gt;(FractionField.getInstance(), 5));</span>
<span class="nc" id="L713">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L714">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L716">        }</span>
<span class="fc" id="L717">    }</span>

    @Test
    public void testGetColumnVector() {
<span class="fc" id="L721">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L722">        FieldVector&lt;Fraction&gt; mColumn1 = columnToVector(subColumn1);</span>
<span class="fc" id="L723">        FieldVector&lt;Fraction&gt; mColumn3 = columnToVector(subColumn3);</span>
<span class="fc" id="L724">        Assert.assertEquals(&quot;Column1&quot;, mColumn1, m.getColumnVector(1));</span>
<span class="fc" id="L725">        Assert.assertEquals(&quot;Column3&quot;, mColumn3, m.getColumnVector(3));</span>
        try {
<span class="nc" id="L727">            m.getColumnVector(-1);</span>
<span class="nc" id="L728">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L729">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L731">        }</span>
        try {
<span class="nc" id="L733">            m.getColumnVector(4);</span>
<span class="nc" id="L734">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L735">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L737">        }</span>
<span class="fc" id="L738">    }</span>

    @Test
    public void testSetColumnVector() {
<span class="fc" id="L742">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L743">        FieldVector&lt;Fraction&gt; mColumn3 = columnToVector(subColumn3);</span>
<span class="fc" id="L744">        Assert.assertNotSame(mColumn3, m.getColumnVector(1));</span>
<span class="fc" id="L745">        m.setColumnVector(1, mColumn3);</span>
<span class="fc" id="L746">        Assert.assertEquals(mColumn3, m.getColumnVector(1));</span>
        try {
<span class="nc" id="L748">            m.setColumnVector(-1, mColumn3);</span>
<span class="nc" id="L749">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L750">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L752">        }</span>
        try {
<span class="nc" id="L754">            m.setColumnVector(0, new ArrayFieldVector&lt;&gt;(FractionField.getInstance(), 5));</span>
<span class="nc" id="L755">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L756">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L758">        }</span>
<span class="fc" id="L759">    }</span>

    private FieldVector&lt;Fraction&gt; columnToVector(Fraction[][] column) {
<span class="fc" id="L762">        Fraction[] data = new Fraction[column.length];</span>
<span class="fc bfc" id="L763" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc" id="L764">            data[i] = column[i][0];</span>
        }
<span class="fc" id="L766">        return new ArrayFieldVector&lt;&gt;(data, false);</span>
    }

    @Test
    public void testGetRow() {
<span class="fc" id="L771">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L772">        checkArrays(subRow0[0], m.getRow(0));</span>
<span class="fc" id="L773">        checkArrays(subRow3[0], m.getRow(3));</span>
        try {
<span class="nc" id="L775">            m.getRow(-1);</span>
<span class="nc" id="L776">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L777">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L779">        }</span>
        try {
<span class="nc" id="L781">            m.getRow(4);</span>
<span class="nc" id="L782">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L783">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L785">        }</span>
<span class="fc" id="L786">    }</span>

    @Test
    public void testSetRow() {
<span class="fc" id="L790">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="pc bpc" id="L791" title="1 of 2 branches missed.">        Assert.assertTrue(subRow3[0][0] != m.getRow(0)[0]);</span>
<span class="fc" id="L792">        m.setRow(0, subRow3[0]);</span>
<span class="fc" id="L793">        checkArrays(subRow3[0], m.getRow(0));</span>
        try {
<span class="nc" id="L795">            m.setRow(-1, subRow3[0]);</span>
<span class="nc" id="L796">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L797">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L799">        }</span>
        try {
<span class="nc" id="L801">            m.setRow(0, new Fraction[5]);</span>
<span class="nc" id="L802">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L803">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L805">        }</span>
<span class="fc" id="L806">    }</span>

    @Test
    public void testGetColumn() {
<span class="fc" id="L810">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L811">        Fraction[] mColumn1 = columnToArray(subColumn1);</span>
<span class="fc" id="L812">        Fraction[] mColumn3 = columnToArray(subColumn3);</span>
<span class="fc" id="L813">        checkArrays(mColumn1, m.getColumn(1));</span>
<span class="fc" id="L814">        checkArrays(mColumn3, m.getColumn(3));</span>
        try {
<span class="nc" id="L816">            m.getColumn(-1);</span>
<span class="nc" id="L817">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L818">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L820">        }</span>
        try {
<span class="nc" id="L822">            m.getColumn(4);</span>
<span class="nc" id="L823">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L824">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L826">        }</span>
<span class="fc" id="L827">    }</span>

    @Test
    public void testSetColumn() {
<span class="fc" id="L831">        FieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L832">        Fraction[] mColumn3 = columnToArray(subColumn3);</span>
<span class="pc bpc" id="L833" title="1 of 2 branches missed.">        Assert.assertTrue(mColumn3[0] != m.getColumn(1)[0]);</span>
<span class="fc" id="L834">        m.setColumn(1, mColumn3);</span>
<span class="fc" id="L835">        checkArrays(mColumn3, m.getColumn(1));</span>
        try {
<span class="nc" id="L837">            m.setColumn(-1, mColumn3);</span>
<span class="nc" id="L838">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L839">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L841">        }</span>
        try {
<span class="nc" id="L843">            m.setColumn(0, new Fraction[5]);</span>
<span class="nc" id="L844">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L845">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L847">        }</span>
<span class="fc" id="L848">    }</span>

    private Fraction[] columnToArray(Fraction[][] column) {
<span class="fc" id="L851">        Fraction[] data = new Fraction[column.length];</span>
<span class="fc bfc" id="L852" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc" id="L853">            data[i] = column[i][0];</span>
        }
<span class="fc" id="L855">        return data;</span>
    }

    private void checkArrays(Fraction[] expected, Fraction[] actual) {
<span class="fc" id="L859">        Assert.assertEquals(expected.length, actual.length);</span>
<span class="fc bfc" id="L860" title="All 2 branches covered.">        for (int i = 0; i &lt; expected.length; ++i) {</span>
<span class="fc" id="L861">            Assert.assertEquals(expected[i], actual[i]);</span>
        }
<span class="fc" id="L863">    }</span>

    @Test
    public void testEqualsAndHashCode() {
<span class="fc" id="L867">        Array2DRowFieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L868">        Array2DRowFieldMatrix&lt;Fraction&gt; m1 = (Array2DRowFieldMatrix&lt;Fraction&gt;) m.copy();</span>
<span class="fc" id="L869">        Array2DRowFieldMatrix&lt;Fraction&gt; mt = (Array2DRowFieldMatrix&lt;Fraction&gt;) m.transpose();</span>
<span class="pc bpc" id="L870" title="1 of 2 branches missed.">        Assert.assertTrue(m.hashCode() != mt.hashCode());</span>
<span class="fc" id="L871">        Assert.assertEquals(m.hashCode(), m1.hashCode());</span>
<span class="fc" id="L872">        Assert.assertEquals(m, m);</span>
<span class="fc" id="L873">        Assert.assertEquals(m, m1);</span>
<span class="fc" id="L874">        Assert.assertFalse(m.equals(null));</span>
<span class="fc" id="L875">        Assert.assertFalse(m.equals(mt));</span>
<span class="fc" id="L876">        Assert.assertFalse(m.equals(new Array2DRowFieldMatrix&lt;&gt;(bigSingular)));</span>
<span class="fc" id="L877">    }</span>

    @Test
    public void testToString() {
<span class="fc" id="L881">        Array2DRowFieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L882">        Assert.assertEquals(&quot;Array2DRowFieldMatrix{{1,2,3},{2,5,3},{1,0,8}}&quot;, m.toString());</span>
<span class="fc" id="L883">        m = new Array2DRowFieldMatrix&lt;&gt;(FractionField.getInstance());</span>
<span class="fc" id="L884">        Assert.assertEquals(&quot;Array2DRowFieldMatrix{}&quot;, m.toString());</span>
<span class="fc" id="L885">    }</span>

    @Test
    public void testSetSubMatrix() {
<span class="fc" id="L889">        Array2DRowFieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L890">        m.setSubMatrix(detData2,1,1);</span>
<span class="fc" id="L891">        FieldMatrix&lt;Fraction&gt; expected = new Array2DRowFieldMatrix&lt;&gt;</span>
            (new Fraction[][] {
                    {new Fraction(1),new Fraction(2),new Fraction(3)},
                    {new Fraction(2),new Fraction(1),new Fraction(3)},
                    {new Fraction(1),new Fraction(2),new Fraction(4)}
             });
<span class="fc" id="L897">        Assert.assertEquals(expected, m);</span>

<span class="fc" id="L899">        m.setSubMatrix(detData2,0,0);</span>
<span class="fc" id="L900">        expected = new Array2DRowFieldMatrix&lt;&gt;</span>
            (new Fraction[][] {
                    {new Fraction(1),new Fraction(3),new Fraction(3)},
                    {new Fraction(2),new Fraction(4),new Fraction(3)},
                    {new Fraction(1),new Fraction(2),new Fraction(4)}
             });
<span class="fc" id="L906">        Assert.assertEquals(expected, m);</span>

<span class="fc" id="L908">        m.setSubMatrix(testDataPlus2,0,0);</span>
<span class="fc" id="L909">        expected = new Array2DRowFieldMatrix&lt;&gt;</span>
            (new Fraction[][] {
                    {new Fraction(3),new Fraction(4),new Fraction(5)},
                    {new Fraction(4),new Fraction(7),new Fraction(5)},
                    {new Fraction(3),new Fraction(2),new Fraction(10)}
             });
<span class="fc" id="L915">        Assert.assertEquals(expected, m);</span>

        // dimension overflow
        try {
<span class="nc" id="L919">            m.setSubMatrix(testData,1,1);</span>
<span class="nc" id="L920">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L921">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L923">        }</span>
        // dimension underflow
        try {
<span class="nc" id="L926">            m.setSubMatrix(testData,-1,1);</span>
<span class="nc" id="L927">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L928">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L930">        }</span>
        try {
<span class="nc" id="L932">            m.setSubMatrix(testData,1,-1);</span>
<span class="nc" id="L933">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L934">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L936">        }</span>

        // null
        try {
<span class="nc" id="L940">            m.setSubMatrix(null, 1, 1);</span>
<span class="nc" id="L941">            Assert.fail(&quot;expecting NullArgumentException&quot;);</span>
<span class="fc" id="L942">        } catch (NullArgumentException e) {</span>
            // expected
<span class="nc" id="L944">        }</span>
<span class="fc" id="L945">        Array2DRowFieldMatrix&lt;Fraction&gt; m2 = new Array2DRowFieldMatrix&lt;&gt;(FractionField.getInstance());</span>
        try {
<span class="nc" id="L947">            m2.setSubMatrix(testData,0,1);</span>
<span class="nc" id="L948">            Assert.fail(&quot;expecting MathIllegalStateException&quot;);</span>
<span class="fc" id="L949">        } catch (MathIllegalStateException e) {</span>
            // expected
<span class="nc" id="L951">        }</span>
        try {
<span class="nc" id="L953">            m2.setSubMatrix(testData,1,0);</span>
<span class="nc" id="L954">            Assert.fail(&quot;expecting MathIllegalStateException&quot;);</span>
<span class="fc" id="L955">        } catch (MathIllegalStateException e) {</span>
            // expected
<span class="nc" id="L957">        }</span>

        // ragged
        try {
<span class="nc" id="L961">            m.setSubMatrix(new Fraction[][] {{new Fraction(1)}, {new Fraction(2), new Fraction(3)}}, 0, 0);</span>
<span class="nc" id="L962">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L963">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L965">        }</span>

        // empty
        try {
<span class="nc" id="L969">            m.setSubMatrix(new Fraction[][] {{}}, 0, 0);</span>
<span class="nc" id="L970">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L971">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L973">        }</span>

<span class="fc" id="L975">    }</span>

    @Test
    public void testWalk() {
<span class="fc" id="L979">        int rows    = 150;</span>
<span class="fc" id="L980">        int columns = 75;</span>

<span class="fc" id="L982">        FieldMatrix&lt;Fraction&gt; m =</span>
<span class="fc" id="L983">            new Array2DRowFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L984">        m.walkInRowOrder(new SetVisitor());</span>
<span class="fc" id="L985">        GetVisitor getVisitor = new GetVisitor();</span>
<span class="fc" id="L986">        m.walkInOptimizedOrder(getVisitor);</span>
<span class="fc" id="L987">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L989">        m = new Array2DRowFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L990">        m.walkInRowOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L991">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L992">        m.walkInOptimizedOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L993">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L994" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L995">            Assert.assertEquals(new Fraction(0), m.getEntry(i, 0));</span>
<span class="fc" id="L996">            Assert.assertEquals(new Fraction(0), m.getEntry(i, columns - 1));</span>
        }
<span class="fc bfc" id="L998" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L999">            Assert.assertEquals(new Fraction(0), m.getEntry(0, j));</span>
<span class="fc" id="L1000">            Assert.assertEquals(new Fraction(0), m.getEntry(rows - 1, j));</span>
        }

<span class="fc" id="L1003">        m = new Array2DRowFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1004">        m.walkInColumnOrder(new SetVisitor());</span>
<span class="fc" id="L1005">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1006">        m.walkInOptimizedOrder(getVisitor);</span>
<span class="fc" id="L1007">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1009">        m = new Array2DRowFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1010">        m.walkInColumnOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1011">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1012">        m.walkInOptimizedOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1013">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1014" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1015">            Assert.assertEquals(new Fraction(0), m.getEntry(i, 0));</span>
<span class="fc" id="L1016">            Assert.assertEquals(new Fraction(0), m.getEntry(i, columns - 1));</span>
        }
<span class="fc bfc" id="L1018" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1019">            Assert.assertEquals(new Fraction(0), m.getEntry(0, j));</span>
<span class="fc" id="L1020">            Assert.assertEquals(new Fraction(0), m.getEntry(rows - 1, j));</span>
        }

<span class="fc" id="L1023">        m = new Array2DRowFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1024">        m.walkInOptimizedOrder(new SetVisitor());</span>
<span class="fc" id="L1025">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1026">        m.walkInRowOrder(getVisitor);</span>
<span class="fc" id="L1027">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1029">        m = new Array2DRowFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1030">        m.walkInOptimizedOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1031">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1032">        m.walkInRowOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1033">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1034" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1035">            Assert.assertEquals(new Fraction(0), m.getEntry(i, 0));</span>
<span class="fc" id="L1036">            Assert.assertEquals(new Fraction(0), m.getEntry(i, columns - 1));</span>
        }
<span class="fc bfc" id="L1038" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1039">            Assert.assertEquals(new Fraction(0), m.getEntry(0, j));</span>
<span class="fc" id="L1040">            Assert.assertEquals(new Fraction(0), m.getEntry(rows - 1, j));</span>
        }

<span class="fc" id="L1043">        m = new Array2DRowFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1044">        m.walkInOptimizedOrder(new SetVisitor());</span>
<span class="fc" id="L1045">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1046">        m.walkInColumnOrder(getVisitor);</span>
<span class="fc" id="L1047">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1049">        m = new Array2DRowFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1050">        m.walkInOptimizedOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1051">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1052">        m.walkInColumnOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1053">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1054" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1055">            Assert.assertEquals(new Fraction(0), m.getEntry(i, 0));</span>
<span class="fc" id="L1056">            Assert.assertEquals(new Fraction(0), m.getEntry(i, columns - 1));</span>
        }
<span class="fc bfc" id="L1058" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1059">            Assert.assertEquals(new Fraction(0), m.getEntry(0, j));</span>
<span class="fc" id="L1060">            Assert.assertEquals(new Fraction(0), m.getEntry(rows - 1, j));</span>
        }
<span class="fc" id="L1062">    }</span>

    @Test
    public void testSerial()  {
<span class="fc" id="L1066">        Array2DRowFieldMatrix&lt;Fraction&gt; m = new Array2DRowFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L1067">        Assert.assertEquals(m,TestUtils.serializeAndRecover(m));</span>
<span class="fc" id="L1068">    }</span>

    private static class SetVisitor extends DefaultFieldMatrixChangingVisitor&lt;Fraction&gt; {
        public SetVisitor() {
<span class="fc" id="L1072">            super(Fraction.ZERO);</span>
<span class="fc" id="L1073">        }</span>
        @Override
        public Fraction visit(int i, int j, Fraction value) {
<span class="fc" id="L1076">            return new Fraction(i * 1024 + j, 1024);</span>
        }
    }

    private static class GetVisitor extends DefaultFieldMatrixPreservingVisitor&lt;Fraction&gt; {
        private int count;
        public GetVisitor() {
<span class="fc" id="L1083">            super(Fraction.ZERO);</span>
<span class="fc" id="L1084">            count = 0;</span>
<span class="fc" id="L1085">        }</span>
        @Override
        public void visit(int i, int j, Fraction value) {
<span class="fc" id="L1088">            ++count;</span>
<span class="fc" id="L1089">            Assert.assertEquals(new Fraction(i * 1024 + j, 1024), value);</span>
<span class="fc" id="L1090">        }</span>
        public int getCount() {
<span class="fc" id="L1092">            return count;</span>
        }
    }

    //--------------- -----------------Protected methods

    /** extracts the l  and u matrices from compact lu representation */
    protected void splitLU(FieldMatrix&lt;Fraction&gt; lu,
                           Fraction[][] lowerData,
                           Fraction[][] upperData) {
<span class="nc bnc" id="L1102" title="All 2 branches missed.">        if (!lu.isSquare()) {</span>
<span class="nc" id="L1103">            throw new NonSquareMatrixException(lu.getRowDimension(), lu.getColumnDimension());</span>
        }
<span class="nc bnc" id="L1105" title="All 2 branches missed.">        if (lowerData.length != lowerData[0].length) {</span>
<span class="nc" id="L1106">            throw new DimensionMismatchException(lowerData.length, lowerData[0].length);</span>
        }
<span class="nc bnc" id="L1108" title="All 2 branches missed.">        if (upperData.length != upperData[0].length) {</span>
<span class="nc" id="L1109">            throw new DimensionMismatchException(upperData.length, upperData[0].length);</span>
        }
<span class="nc bnc" id="L1111" title="All 2 branches missed.">        if (lowerData.length != upperData.length) {</span>
<span class="nc" id="L1112">            throw new DimensionMismatchException(lowerData.length, upperData.length);</span>
        }
<span class="nc bnc" id="L1114" title="All 2 branches missed.">        if (lowerData.length != lu.getRowDimension()) {</span>
<span class="nc" id="L1115">            throw new DimensionMismatchException(lowerData.length, lu.getRowDimension());</span>
        }
<span class="nc" id="L1117">        int n = lu.getRowDimension();</span>
<span class="nc bnc" id="L1118" title="All 2 branches missed.">        for (int i = 0; i &lt; n; i++) {</span>
<span class="nc bnc" id="L1119" title="All 2 branches missed.">            for (int j = 0; j &lt; n; j++) {</span>
<span class="nc bnc" id="L1120" title="All 2 branches missed.">                if (j &lt; i) {</span>
<span class="nc" id="L1121">                    lowerData[i][j] = lu.getEntry(i, j);</span>
<span class="nc" id="L1122">                    upperData[i][j] = Fraction.ZERO;</span>
<span class="nc bnc" id="L1123" title="All 2 branches missed.">                } else if (i == j) {</span>
<span class="nc" id="L1124">                    lowerData[i][j] = Fraction.ONE;</span>
<span class="nc" id="L1125">                    upperData[i][j] = lu.getEntry(i, j);</span>
                } else {
<span class="nc" id="L1127">                    lowerData[i][j] = Fraction.ZERO;</span>
<span class="nc" id="L1128">                    upperData[i][j] = lu.getEntry(i, j);</span>
                }
            }
        }
<span class="nc" id="L1132">    }</span>

    /** Returns the result of applying the given row permutation to the matrix */
    protected FieldMatrix&lt;Fraction&gt; permuteRows(FieldMatrix&lt;Fraction&gt; matrix, int[] permutation) {
<span class="nc bnc" id="L1136" title="All 2 branches missed.">        if (!matrix.isSquare()) {</span>
<span class="nc" id="L1137">            throw new NonSquareMatrixException(matrix.getRowDimension(),</span>
<span class="nc" id="L1138">                                               matrix.getColumnDimension());</span>
        }
<span class="nc bnc" id="L1140" title="All 2 branches missed.">        if (matrix.getRowDimension() != permutation.length) {</span>
<span class="nc" id="L1141">            throw new DimensionMismatchException(matrix.getRowDimension(), permutation.length);</span>
        }
<span class="nc" id="L1143">        int n = matrix.getRowDimension();</span>
<span class="nc" id="L1144">        int m = matrix.getColumnDimension();</span>
<span class="nc" id="L1145">        Fraction out[][] = new Fraction[m][n];</span>
<span class="nc bnc" id="L1146" title="All 2 branches missed.">        for (int i = 0; i &lt; n; i++) {</span>
<span class="nc bnc" id="L1147" title="All 2 branches missed.">            for (int j = 0; j &lt; m; j++) {</span>
<span class="nc" id="L1148">                out[i][j] = matrix.getEntry(permutation[i], j);</span>
            }
        }
<span class="nc" id="L1151">        return new Array2DRowFieldMatrix&lt;&gt;(out);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>