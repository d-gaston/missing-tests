<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BlockFieldMatrixTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">commons_math4$All_in_commons_math4.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.math4.linear</a> &gt; <span class="el_source">BlockFieldMatrixTest.java</span></div><h1>BlockFieldMatrixTest.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.math4.linear;

import java.util.Arrays;
import java.util.Random;

import org.junit.Test;
import org.junit.Assert;
import org.apache.commons.math4.TestUtils;
import org.apache.commons.math4.exception.MathIllegalArgumentException;
import org.apache.commons.math4.exception.NoDataException;
import org.apache.commons.math4.exception.NotStrictlyPositiveException;
import org.apache.commons.math4.exception.NullArgumentException;
import org.apache.commons.math4.exception.NumberIsTooSmallException;
import org.apache.commons.math4.exception.OutOfRangeException;
import org.apache.commons.math4.fraction.Fraction;
import org.apache.commons.math4.fraction.FractionField;
import org.apache.commons.math4.linear.ArrayFieldVector;
import org.apache.commons.math4.linear.BlockFieldMatrix;
import org.apache.commons.math4.linear.DefaultFieldMatrixChangingVisitor;
import org.apache.commons.math4.linear.DefaultFieldMatrixPreservingVisitor;
import org.apache.commons.math4.linear.FieldLUDecomposition;
import org.apache.commons.math4.linear.FieldMatrix;
import org.apache.commons.math4.linear.FieldVector;
import org.apache.commons.math4.linear.MatrixDimensionMismatchException;
import org.apache.commons.math4.linear.NonSquareMatrixException;

/**
 * Test cases for the {@link BlockFieldMatrix} class.
 *
 */

<span class="fc" id="L48">public final class BlockFieldMatrixTest {</span>

    // 3 x 3 identity matrix
<span class="fc" id="L51">    protected Fraction[][] id = {</span>
            {new Fraction(1),new Fraction(0),new Fraction(0)},
            {new Fraction(0),new Fraction(1),new Fraction(0)},
            {new Fraction(0),new Fraction(0),new Fraction(1)}
    };

    // Test data for group operations
<span class="fc" id="L58">    protected Fraction[][] testData = {</span>
            {new Fraction(1),new Fraction(2),new Fraction(3)},
            {new Fraction(2),new Fraction(5),new Fraction(3)},
            {new Fraction(1),new Fraction(0),new Fraction(8)}
    };
<span class="fc" id="L63">    protected Fraction[][] testDataLU = {</span>
            {new Fraction(2), new Fraction(5), new Fraction(3)},
            {new Fraction(1, 2), new Fraction(-5, 2), new Fraction(13, 2)},
            {new Fraction(1, 2), new Fraction(1, 5), new Fraction(1, 5)}
    };
<span class="fc" id="L68">    protected Fraction[][] testDataPlus2 = {</span>
            {new Fraction(3),new Fraction(4),new Fraction(5)},
            {new Fraction(4),new Fraction(7),new Fraction(5)},
            {new Fraction(3),new Fraction(2),new Fraction(10)}
    };
<span class="fc" id="L73">    protected Fraction[][] testDataMinus = {</span>
            {new Fraction(-1),new Fraction(-2),new Fraction(-3)},
            {new Fraction(-2),new Fraction(-5),new Fraction(-3)},
            {new Fraction(-1),new Fraction(0),new Fraction(-8)}
    };
<span class="fc" id="L78">    protected Fraction[] testDataRow1 = {new Fraction(1),new Fraction(2),new Fraction(3)};</span>
<span class="fc" id="L79">    protected Fraction[] testDataCol3 = {new Fraction(3),new Fraction(3),new Fraction(8)};</span>
<span class="fc" id="L80">    protected Fraction[][] testDataInv = {</span>
            {new Fraction(-40),new Fraction(16),new Fraction(9)},
            {new Fraction(13),new Fraction(-5),new Fraction(-3)},
            {new Fraction(5),new Fraction(-2),new Fraction(-1)}
    };
<span class="fc" id="L85">    protected Fraction[] preMultTest = {new Fraction(8), new Fraction(12), new Fraction(33)};</span>
<span class="fc" id="L86">    protected Fraction[][] testData2 = {</span>
            {new Fraction(1),new Fraction(2),new Fraction(3)},
            {new Fraction(2),new Fraction(5),new Fraction(3)}
    };
<span class="fc" id="L90">    protected Fraction[][] testData2T = {</span>
            {new Fraction(1),new Fraction(2)},
            {new Fraction(2),new Fraction(5)},
            {new Fraction(3),new Fraction(3)}
    };
<span class="fc" id="L95">    protected Fraction[][] testDataPlusInv = {</span>
            {new Fraction(-39),new Fraction(18),new Fraction(12)},
            {new Fraction(15),new Fraction(0),new Fraction(0)},
            {new Fraction(6),new Fraction(-2),new Fraction(7)}
    };

    // lu decomposition tests
<span class="fc" id="L102">    protected Fraction[][] luData = {</span>
            {new Fraction(2),new Fraction(3),new Fraction(3)},
            {new Fraction(0),new Fraction(5),new Fraction(7)},
            {new Fraction(6),new Fraction(9),new Fraction(8)}
    };
<span class="fc" id="L107">    protected Fraction[][] luDataLUDecomposition = {</span>
            {new Fraction(6),new Fraction(9),new Fraction(8)},
            {new Fraction(0),new Fraction(5),new Fraction(7)},
            {new Fraction(1, 3),new Fraction(0),new Fraction(1, 3)}
    };

    // singular matrices
<span class="fc" id="L114">    protected Fraction[][] singular = { {new Fraction(2),new Fraction(3)}, {new Fraction(2),new Fraction(3)} };</span>
<span class="fc" id="L115">    protected Fraction[][] bigSingular = {</span>
            {new Fraction(1),new Fraction(2),new Fraction(3),new Fraction(4)},
            {new Fraction(2),new Fraction(5),new Fraction(3),new Fraction(4)},
            {new Fraction(7),new Fraction(3),new Fraction(256),new Fraction(1930)},
            {new Fraction(3),new Fraction(7),new Fraction(6),new Fraction(8)}
    }; // 4th row = 1st + 2nd
<span class="fc" id="L121">    protected Fraction[][] detData = {</span>
            {new Fraction(1),new Fraction(2),new Fraction(3)},
            {new Fraction(4),new Fraction(5),new Fraction(6)},
            {new Fraction(7),new Fraction(8),new Fraction(10)}
    };
<span class="fc" id="L126">    protected Fraction[][] detData2 = { {new Fraction(1), new Fraction(3)}, {new Fraction(2), new Fraction(4)}};</span>

    // vectors
<span class="fc" id="L129">    protected Fraction[] testVector = {new Fraction(1),new Fraction(2),new Fraction(3)};</span>
<span class="fc" id="L130">    protected Fraction[] testVector2 = {new Fraction(1),new Fraction(2),new Fraction(3),new Fraction(4)};</span>

    // submatrix accessor tests
<span class="fc" id="L133">    protected Fraction[][] subTestData = {</span>
            {new Fraction(1), new Fraction(2), new Fraction(3), new Fraction(4)},
            {new Fraction(3, 2), new Fraction(5, 2), new Fraction(7, 2), new Fraction(9, 2)},
            {new Fraction(2), new Fraction(4), new Fraction(6), new Fraction(8)},
            {new Fraction(4), new Fraction(5), new Fraction(6), new Fraction(7)}
    };
    // array selections
<span class="fc" id="L140">    protected Fraction[][] subRows02Cols13 = { {new Fraction(2), new Fraction(4)}, {new Fraction(4), new Fraction(8)}};</span>
<span class="fc" id="L141">    protected Fraction[][] subRows03Cols12 = { {new Fraction(2), new Fraction(3)}, {new Fraction(5), new Fraction(6)}};</span>
<span class="fc" id="L142">    protected Fraction[][] subRows03Cols123 = {</span>
            {new Fraction(2), new Fraction(3), new Fraction(4)},
            {new Fraction(5), new Fraction(6), new Fraction(7)}
    };
    // effective permutations
<span class="fc" id="L147">    protected Fraction[][] subRows20Cols123 = {</span>
            {new Fraction(4), new Fraction(6), new Fraction(8)},
            {new Fraction(2), new Fraction(3), new Fraction(4)}
    };
<span class="fc" id="L151">    protected Fraction[][] subRows31Cols31 = {{new Fraction(7), new Fraction(5)}, {new Fraction(9, 2), new Fraction(5, 2)}};</span>
    // contiguous ranges
<span class="fc" id="L153">    protected Fraction[][] subRows01Cols23 = {{new Fraction(3),new Fraction(4)} , {new Fraction(7, 2), new Fraction(9, 2)}};</span>
<span class="fc" id="L154">    protected Fraction[][] subRows23Cols00 = {{new Fraction(2)} , {new Fraction(4)}};</span>
<span class="fc" id="L155">    protected Fraction[][] subRows00Cols33 = {{new Fraction(4)}};</span>
    // row matrices
<span class="fc" id="L157">    protected Fraction[][] subRow0 = {{new Fraction(1),new Fraction(2),new Fraction(3),new Fraction(4)}};</span>
<span class="fc" id="L158">    protected Fraction[][] subRow3 = {{new Fraction(4),new Fraction(5),new Fraction(6),new Fraction(7)}};</span>
    // column matrices
<span class="fc" id="L160">    protected Fraction[][] subColumn1 = {{new Fraction(2)}, {new Fraction(5, 2)}, {new Fraction(4)}, {new Fraction(5)}};</span>
<span class="fc" id="L161">    protected Fraction[][] subColumn3 = {{new Fraction(4)}, {new Fraction(9, 2)}, {new Fraction(8)}, {new Fraction(7)}};</span>

    // tolerances
<span class="fc" id="L164">    protected double entryTolerance = 10E-16;</span>
<span class="fc" id="L165">    protected double normTolerance = 10E-14;</span>

    /** test dimensions */
    @Test
    public void testDimensions() {
<span class="fc" id="L170">        BlockFieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L171">        BlockFieldMatrix&lt;Fraction&gt; m2 = new BlockFieldMatrix&lt;&gt;(testData2);</span>
<span class="fc" id="L172">        Assert.assertEquals(&quot;testData row dimension&quot;,3,m.getRowDimension());</span>
<span class="fc" id="L173">        Assert.assertEquals(&quot;testData column dimension&quot;,3,m.getColumnDimension());</span>
<span class="fc" id="L174">        Assert.assertTrue(&quot;testData is square&quot;,m.isSquare());</span>
<span class="fc" id="L175">        Assert.assertEquals(&quot;testData2 row dimension&quot;,m2.getRowDimension(),2);</span>
<span class="fc" id="L176">        Assert.assertEquals(&quot;testData2 column dimension&quot;,m2.getColumnDimension(),3);</span>
<span class="pc bpc" id="L177" title="1 of 2 branches missed.">        Assert.assertTrue(&quot;testData2 is not square&quot;,!m2.isSquare());</span>
<span class="fc" id="L178">    }</span>

    /** test copy functions */
    @Test
    public void testCopyFunctions() {
<span class="fc" id="L183">        Random r = new Random(66636328996002l);</span>
<span class="fc" id="L184">        BlockFieldMatrix&lt;Fraction&gt; m1 = createRandomMatrix(r, 47, 83);</span>
<span class="fc" id="L185">        BlockFieldMatrix&lt;Fraction&gt; m2 = new BlockFieldMatrix&lt;&gt;(m1.getData());</span>
<span class="fc" id="L186">        Assert.assertEquals(m1, m2);</span>
<span class="fc" id="L187">        BlockFieldMatrix&lt;Fraction&gt; m3 = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L188">        BlockFieldMatrix&lt;Fraction&gt; m4 = new BlockFieldMatrix&lt;&gt;(m3.getData());</span>
<span class="fc" id="L189">        Assert.assertEquals(m3, m4);</span>
<span class="fc" id="L190">    }</span>

    /** test add */
    @Test
    public void testAdd() {
<span class="fc" id="L195">        BlockFieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L196">        BlockFieldMatrix&lt;Fraction&gt; mInv = new BlockFieldMatrix&lt;&gt;(testDataInv);</span>
<span class="fc" id="L197">        FieldMatrix&lt;Fraction&gt; mPlusMInv = m.add(mInv);</span>
<span class="fc" id="L198">        Fraction[][] sumEntries = mPlusMInv.getData();</span>
<span class="fc bfc" id="L199" title="All 2 branches covered.">        for (int row = 0; row &lt; m.getRowDimension(); row++) {</span>
<span class="fc bfc" id="L200" title="All 2 branches covered.">            for (int col = 0; col &lt; m.getColumnDimension(); col++) {</span>
<span class="fc" id="L201">                Assert.assertEquals(testDataPlusInv[row][col],sumEntries[row][col]);</span>
            }
        }
<span class="fc" id="L204">    }</span>

    /** test add failure */
    @Test
    public void testAddFail() {
<span class="fc" id="L209">        BlockFieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L210">        BlockFieldMatrix&lt;Fraction&gt; m2 = new BlockFieldMatrix&lt;&gt;(testData2);</span>
        try {
<span class="nc" id="L212">            m.add(m2);</span>
<span class="nc" id="L213">            Assert.fail(&quot;MathIllegalArgumentException expected&quot;);</span>
<span class="fc" id="L214">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L216">        }</span>
<span class="fc" id="L217">    }</span>

     /** test m-n = m + -n */
    @Test
    public void testPlusMinus() {
<span class="fc" id="L222">        BlockFieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L223">        BlockFieldMatrix&lt;Fraction&gt; m2 = new BlockFieldMatrix&lt;&gt;(testDataInv);</span>
<span class="fc" id="L224">        TestUtils.assertEquals(m.subtract(m2), m2.scalarMultiply(new Fraction(-1)).add(m));</span>
        try {
<span class="nc" id="L226">            m.subtract(new BlockFieldMatrix&lt;&gt;(testData2));</span>
<span class="nc" id="L227">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L228">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L230">        }</span>
<span class="fc" id="L231">    }</span>

    /** test multiply */
    @Test
    public void testMultiply() {
<span class="fc" id="L236">        BlockFieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L237">        BlockFieldMatrix&lt;Fraction&gt; mInv = new BlockFieldMatrix&lt;&gt;(testDataInv);</span>
<span class="fc" id="L238">        BlockFieldMatrix&lt;Fraction&gt; identity = new BlockFieldMatrix&lt;&gt;(id);</span>
<span class="fc" id="L239">        BlockFieldMatrix&lt;Fraction&gt; m2 = new BlockFieldMatrix&lt;&gt;(testData2);</span>
<span class="fc" id="L240">        TestUtils.assertEquals(m.multiply(mInv), identity);</span>
<span class="fc" id="L241">        TestUtils.assertEquals(mInv.multiply(m), identity);</span>
<span class="fc" id="L242">        TestUtils.assertEquals(m.multiply(identity), m);</span>
<span class="fc" id="L243">        TestUtils.assertEquals(identity.multiply(mInv), mInv);</span>
<span class="fc" id="L244">        TestUtils.assertEquals(m2.multiply(identity), m2);</span>
        try {
<span class="nc" id="L246">            m.multiply(new BlockFieldMatrix&lt;&gt;(bigSingular));</span>
<span class="nc" id="L247">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L248">        } catch (MathIllegalArgumentException ex) {</span>
            // expected
<span class="nc" id="L250">        }</span>
<span class="fc" id="L251">    }</span>

    @Test
    public void testSeveralBlocks() {
<span class="fc" id="L255">        FieldMatrix&lt;Fraction&gt; m =</span>
<span class="fc" id="L256">            new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), 37, 41);</span>
<span class="fc bfc" id="L257" title="All 2 branches covered.">        for (int i = 0; i &lt; m.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L258" title="All 2 branches covered.">            for (int j = 0; j &lt; m.getColumnDimension(); ++j) {</span>
<span class="fc" id="L259">                m.setEntry(i, j, new Fraction(i * 11 + j, 11));</span>
            }
        }

<span class="fc" id="L263">        FieldMatrix&lt;Fraction&gt; mT = m.transpose();</span>
<span class="fc" id="L264">        Assert.assertEquals(m.getRowDimension(), mT.getColumnDimension());</span>
<span class="fc" id="L265">        Assert.assertEquals(m.getColumnDimension(), mT.getRowDimension());</span>
<span class="fc bfc" id="L266" title="All 2 branches covered.">        for (int i = 0; i &lt; mT.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L267" title="All 2 branches covered.">            for (int j = 0; j &lt; mT.getColumnDimension(); ++j) {</span>
<span class="fc" id="L268">                Assert.assertEquals(m.getEntry(j, i), mT.getEntry(i, j));</span>
            }
        }

<span class="fc" id="L272">        FieldMatrix&lt;Fraction&gt; mPm = m.add(m);</span>
<span class="fc bfc" id="L273" title="All 2 branches covered.">        for (int i = 0; i &lt; mPm.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L274" title="All 2 branches covered.">            for (int j = 0; j &lt; mPm.getColumnDimension(); ++j) {</span>
<span class="fc" id="L275">                Assert.assertEquals(m.getEntry(i, j).multiply(new Fraction(2)), mPm.getEntry(i, j));</span>
            }
        }

<span class="fc" id="L279">        FieldMatrix&lt;Fraction&gt; mPmMm = mPm.subtract(m);</span>
<span class="fc bfc" id="L280" title="All 2 branches covered.">        for (int i = 0; i &lt; mPmMm.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L281" title="All 2 branches covered.">            for (int j = 0; j &lt; mPmMm.getColumnDimension(); ++j) {</span>
<span class="fc" id="L282">                Assert.assertEquals(m.getEntry(i, j), mPmMm.getEntry(i, j));</span>
            }
        }

<span class="fc" id="L286">        FieldMatrix&lt;Fraction&gt; mTm = mT.multiply(m);</span>
<span class="fc bfc" id="L287" title="All 2 branches covered.">        for (int i = 0; i &lt; mTm.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L288" title="All 2 branches covered.">            for (int j = 0; j &lt; mTm.getColumnDimension(); ++j) {</span>
<span class="fc" id="L289">                Fraction sum = Fraction.ZERO;</span>
<span class="fc bfc" id="L290" title="All 2 branches covered.">                for (int k = 0; k &lt; mT.getColumnDimension(); ++k) {</span>
<span class="fc" id="L291">                    sum = sum.add(new Fraction(k * 11 + i, 11).multiply(new Fraction(k * 11 + j, 11)));</span>
                }
<span class="fc" id="L293">                Assert.assertEquals(sum, mTm.getEntry(i, j));</span>
            }
        }

<span class="fc" id="L297">        FieldMatrix&lt;Fraction&gt; mmT = m.multiply(mT);</span>
<span class="fc bfc" id="L298" title="All 2 branches covered.">        for (int i = 0; i &lt; mmT.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L299" title="All 2 branches covered.">            for (int j = 0; j &lt; mmT.getColumnDimension(); ++j) {</span>
<span class="fc" id="L300">                Fraction sum = Fraction.ZERO;</span>
<span class="fc bfc" id="L301" title="All 2 branches covered.">                for (int k = 0; k &lt; m.getColumnDimension(); ++k) {</span>
<span class="fc" id="L302">                    sum = sum.add(new Fraction(i * 11 + k, 11).multiply(new Fraction(j * 11 + k, 11)));</span>
                }
<span class="fc" id="L304">                Assert.assertEquals(sum, mmT.getEntry(i, j));</span>
            }
        }

<span class="fc" id="L308">        FieldMatrix&lt;Fraction&gt; sub1 = m.getSubMatrix(2, 9, 5, 20);</span>
<span class="fc bfc" id="L309" title="All 2 branches covered.">        for (int i = 0; i &lt; sub1.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L310" title="All 2 branches covered.">            for (int j = 0; j &lt; sub1.getColumnDimension(); ++j) {</span>
<span class="fc" id="L311">                Assert.assertEquals(new Fraction((i + 2) * 11 + (j + 5), 11), sub1.getEntry(i, j));</span>
            }
        }

<span class="fc" id="L315">        FieldMatrix&lt;Fraction&gt; sub2 = m.getSubMatrix(10, 12, 3, 40);</span>
<span class="fc bfc" id="L316" title="All 2 branches covered.">        for (int i = 0; i &lt; sub2.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L317" title="All 2 branches covered.">            for (int j = 0; j &lt; sub2.getColumnDimension(); ++j) {</span>
<span class="fc" id="L318">                Assert.assertEquals(new Fraction((i + 10) * 11 + (j + 3), 11), sub2.getEntry(i, j));</span>
            }
        }

<span class="fc" id="L322">        FieldMatrix&lt;Fraction&gt; sub3 = m.getSubMatrix(30, 34, 0, 5);</span>
<span class="fc bfc" id="L323" title="All 2 branches covered.">        for (int i = 0; i &lt; sub3.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L324" title="All 2 branches covered.">            for (int j = 0; j &lt; sub3.getColumnDimension(); ++j) {</span>
<span class="fc" id="L325">                Assert.assertEquals(new Fraction((i + 30) * 11 + (j + 0), 11), sub3.getEntry(i, j));</span>
            }
        }

<span class="fc" id="L329">        FieldMatrix&lt;Fraction&gt; sub4 = m.getSubMatrix(30, 32, 32, 35);</span>
<span class="fc bfc" id="L330" title="All 2 branches covered.">        for (int i = 0; i &lt; sub4.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L331" title="All 2 branches covered.">            for (int j = 0; j &lt; sub4.getColumnDimension(); ++j) {</span>
<span class="fc" id="L332">                Assert.assertEquals(new Fraction((i + 30) * 11 + (j + 32), 11), sub4.getEntry(i, j));</span>
            }
        }

<span class="fc" id="L336">    }</span>

    //Additional Test for BlockFieldMatrix&lt;Fraction&gt;Test.testMultiply

<span class="fc" id="L340">    private Fraction[][] d3 = new Fraction[][] {</span>
            {new Fraction(1),new Fraction(2),new Fraction(3),new Fraction(4)},
            {new Fraction(5),new Fraction(6),new Fraction(7),new Fraction(8)}
    };
<span class="fc" id="L344">    private Fraction[][] d4 = new Fraction[][] {</span>
            {new Fraction(1)},
            {new Fraction(2)},
            {new Fraction(3)},
            {new Fraction(4)}
    };
<span class="fc" id="L350">    private Fraction[][] d5 = new Fraction[][] {{new Fraction(30)},{new Fraction(70)}};</span>

    @Test
    public void testMultiply2() {
<span class="fc" id="L354">       FieldMatrix&lt;Fraction&gt; m3 = new BlockFieldMatrix&lt;&gt;(d3);</span>
<span class="fc" id="L355">       FieldMatrix&lt;Fraction&gt; m4 = new BlockFieldMatrix&lt;&gt;(d4);</span>
<span class="fc" id="L356">       FieldMatrix&lt;Fraction&gt; m5 = new BlockFieldMatrix&lt;&gt;(d5);</span>
<span class="fc" id="L357">       TestUtils.assertEquals(m3.multiply(m4), m5);</span>
<span class="fc" id="L358">   }</span>

    /** test trace */
    @Test
    public void testTrace() {
<span class="fc" id="L363">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(id);</span>
<span class="fc" id="L364">        Assert.assertEquals(new Fraction(3),m.getTrace());</span>
<span class="fc" id="L365">        m = new BlockFieldMatrix&lt;&gt;(testData2);</span>
        try {
<span class="nc" id="L367">            m.getTrace();</span>
<span class="nc" id="L368">            Assert.fail(&quot;Expecting NonSquareMatrixException&quot;);</span>
<span class="fc" id="L369">        } catch (NonSquareMatrixException ex) {</span>
            // ignored
<span class="nc" id="L371">        }</span>
<span class="fc" id="L372">    }</span>

    /** test scalarAdd */
    @Test
    public void testScalarAdd() {
<span class="fc" id="L377">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L378">        TestUtils.assertEquals(new BlockFieldMatrix&lt;&gt;(testDataPlus2),</span>
<span class="fc" id="L379">                               m.scalarAdd(new Fraction(2)));</span>
<span class="fc" id="L380">    }</span>

    /** test operate */
    @Test
    public void testOperate() {
<span class="fc" id="L385">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(id);</span>
<span class="fc" id="L386">        TestUtils.assertEquals(testVector, m.operate(testVector));</span>
<span class="fc" id="L387">        TestUtils.assertEquals(testVector, m.operate(new ArrayFieldVector&lt;&gt;(testVector)).toArray());</span>
<span class="fc" id="L388">        m = new BlockFieldMatrix&lt;&gt;(bigSingular);</span>
        try {
<span class="nc" id="L390">            m.operate(testVector);</span>
<span class="nc" id="L391">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L392">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L394">        }</span>
<span class="fc" id="L395">    }</span>

    @Test
    public void testOperateLarge() {
<span class="fc" id="L399">        int p = (11 * BlockFieldMatrix.BLOCK_SIZE) / 10;</span>
<span class="fc" id="L400">        int q = (11 * BlockFieldMatrix.BLOCK_SIZE) / 10;</span>
<span class="fc" id="L401">        int r =  BlockFieldMatrix.BLOCK_SIZE / 2;</span>
<span class="fc" id="L402">        Random random = new Random(111007463902334l);</span>
<span class="fc" id="L403">        FieldMatrix&lt;Fraction&gt; m1 = createRandomMatrix(random, p, q);</span>
<span class="fc" id="L404">        FieldMatrix&lt;Fraction&gt; m2 = createRandomMatrix(random, q, r);</span>
<span class="fc" id="L405">        FieldMatrix&lt;Fraction&gt; m1m2 = m1.multiply(m2);</span>
<span class="fc bfc" id="L406" title="All 2 branches covered.">        for (int i = 0; i &lt; r; ++i) {</span>
<span class="fc" id="L407">            TestUtils.assertEquals(m1m2.getColumn(i), m1.operate(m2.getColumn(i)));</span>
        }
<span class="fc" id="L409">    }</span>

    @Test
    public void testOperatePremultiplyLarge() {
<span class="fc" id="L413">        int p = (11 * BlockFieldMatrix.BLOCK_SIZE) / 10;</span>
<span class="fc" id="L414">        int q = (11 * BlockFieldMatrix.BLOCK_SIZE) / 10;</span>
<span class="fc" id="L415">        int r =  BlockFieldMatrix.BLOCK_SIZE / 2;</span>
<span class="fc" id="L416">        Random random = new Random(111007463902334l);</span>
<span class="fc" id="L417">        FieldMatrix&lt;Fraction&gt; m1 = createRandomMatrix(random, p, q);</span>
<span class="fc" id="L418">        FieldMatrix&lt;Fraction&gt; m2 = createRandomMatrix(random, q, r);</span>
<span class="fc" id="L419">        FieldMatrix&lt;Fraction&gt; m1m2 = m1.multiply(m2);</span>
<span class="fc bfc" id="L420" title="All 2 branches covered.">        for (int i = 0; i &lt; p; ++i) {</span>
<span class="fc" id="L421">            TestUtils.assertEquals(m1m2.getRow(i), m2.preMultiply(m1.getRow(i)));</span>
        }
<span class="fc" id="L423">    }</span>

    /** test issue MATH-209 */
    @Test
    public void testMath209() {
<span class="fc" id="L428">        FieldMatrix&lt;Fraction&gt; a = new BlockFieldMatrix&lt;&gt;(new Fraction[][] {</span>
                { new Fraction(1), new Fraction(2) },
                { new Fraction(3), new Fraction(4) },
                { new Fraction(5), new Fraction(6) }
        });
<span class="fc" id="L433">        Fraction[] b = a.operate(new Fraction[] { new Fraction(1), new Fraction(1) });</span>
<span class="fc" id="L434">        Assert.assertEquals(a.getRowDimension(), b.length);</span>
<span class="fc" id="L435">        Assert.assertEquals( new Fraction(3), b[0]);</span>
<span class="fc" id="L436">        Assert.assertEquals( new Fraction(7), b[1]);</span>
<span class="fc" id="L437">        Assert.assertEquals(new Fraction(11), b[2]);</span>
<span class="fc" id="L438">    }</span>

    /** test transpose */
    @Test
    public void testTranspose() {
<span class="fc" id="L443">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L444">        FieldMatrix&lt;Fraction&gt; mIT = new FieldLUDecomposition&lt;&gt;(m).getSolver().getInverse().transpose();</span>
<span class="fc" id="L445">        FieldMatrix&lt;Fraction&gt; mTI = new FieldLUDecomposition&lt;&gt;(m.transpose()).getSolver().getInverse();</span>
<span class="fc" id="L446">        TestUtils.assertEquals(mIT, mTI);</span>
<span class="fc" id="L447">        m = new BlockFieldMatrix&lt;&gt;(testData2);</span>
<span class="fc" id="L448">        FieldMatrix&lt;Fraction&gt; mt = new BlockFieldMatrix&lt;&gt;(testData2T);</span>
<span class="fc" id="L449">        TestUtils.assertEquals(mt, m.transpose());</span>
<span class="fc" id="L450">    }</span>

    /** test preMultiply by vector */
    @Test
    public void testPremultiplyVector() {
<span class="fc" id="L455">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L456">        TestUtils.assertEquals(m.preMultiply(testVector), preMultTest);</span>
<span class="fc" id="L457">        TestUtils.assertEquals(m.preMultiply(new ArrayFieldVector&lt;&gt;(testVector).toArray()),</span>
                               preMultTest);
<span class="fc" id="L459">        m = new BlockFieldMatrix&lt;&gt;(bigSingular);</span>
        try {
<span class="nc" id="L461">            m.preMultiply(testVector);</span>
<span class="nc" id="L462">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L463">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L465">        }</span>
<span class="fc" id="L466">    }</span>

    @Test
    public void testPremultiply() {
<span class="fc" id="L470">        FieldMatrix&lt;Fraction&gt; m3 = new BlockFieldMatrix&lt;&gt;(d3);</span>
<span class="fc" id="L471">        FieldMatrix&lt;Fraction&gt; m4 = new BlockFieldMatrix&lt;&gt;(d4);</span>
<span class="fc" id="L472">        FieldMatrix&lt;Fraction&gt; m5 = new BlockFieldMatrix&lt;&gt;(d5);</span>
<span class="fc" id="L473">        TestUtils.assertEquals(m4.preMultiply(m3), m5);</span>

<span class="fc" id="L475">        BlockFieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L476">        BlockFieldMatrix&lt;Fraction&gt; mInv = new BlockFieldMatrix&lt;&gt;(testDataInv);</span>
<span class="fc" id="L477">        BlockFieldMatrix&lt;Fraction&gt; identity = new BlockFieldMatrix&lt;&gt;(id);</span>
<span class="fc" id="L478">        TestUtils.assertEquals(m.preMultiply(mInv), identity);</span>
<span class="fc" id="L479">        TestUtils.assertEquals(mInv.preMultiply(m), identity);</span>
<span class="fc" id="L480">        TestUtils.assertEquals(m.preMultiply(identity), m);</span>
<span class="fc" id="L481">        TestUtils.assertEquals(identity.preMultiply(mInv), mInv);</span>
        try {
<span class="nc" id="L483">            m.preMultiply(new BlockFieldMatrix&lt;&gt;(bigSingular));</span>
<span class="nc" id="L484">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L485">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L487">        }</span>
<span class="fc" id="L488">    }</span>

    @Test
    public void testGetVectors() {
<span class="fc" id="L492">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L493">        TestUtils.assertEquals(m.getRow(0), testDataRow1);</span>
<span class="fc" id="L494">        TestUtils.assertEquals(m.getColumn(2), testDataCol3);</span>
        try {
<span class="nc" id="L496">            m.getRow(10);</span>
<span class="nc" id="L497">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L498">        } catch (OutOfRangeException ex) {</span>
            // ignored
<span class="nc" id="L500">        }</span>
        try {
<span class="nc" id="L502">            m.getColumn(-1);</span>
<span class="nc" id="L503">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L504">        } catch (OutOfRangeException ex) {</span>
            // ignored
<span class="nc" id="L506">        }</span>
<span class="fc" id="L507">    }</span>

    @Test
    public void testGetEntry() {
<span class="fc" id="L511">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L512">        Assert.assertEquals(m.getEntry(0,1),new Fraction(2));</span>
        try {
<span class="nc" id="L514">            m.getEntry(10, 4);</span>
<span class="nc" id="L515">            Assert.fail (&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L516">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L518">        }</span>
<span class="fc" id="L519">    }</span>

    /** test examples in user guide */
    @Test
    public void testExamples() {
        // Create a real matrix with two rows and three columns
<span class="fc" id="L525">        Fraction[][] matrixData = {</span>
                {new Fraction(1),new Fraction(2),new Fraction(3)},
                {new Fraction(2),new Fraction(5),new Fraction(3)}
        };
<span class="fc" id="L529">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(matrixData);</span>
        // One more with three rows, two columns
<span class="fc" id="L531">        Fraction[][] matrixData2 = {</span>
                {new Fraction(1),new Fraction(2)},
                {new Fraction(2),new Fraction(5)},
                {new Fraction(1), new Fraction(7)}
        };
<span class="fc" id="L536">        FieldMatrix&lt;Fraction&gt; n = new BlockFieldMatrix&lt;&gt;(matrixData2);</span>
        // Now multiply m by n
<span class="fc" id="L538">        FieldMatrix&lt;Fraction&gt; p = m.multiply(n);</span>
<span class="fc" id="L539">        Assert.assertEquals(2, p.getRowDimension());</span>
<span class="fc" id="L540">        Assert.assertEquals(2, p.getColumnDimension());</span>
        // Invert p
<span class="fc" id="L542">        FieldMatrix&lt;Fraction&gt; pInverse = new FieldLUDecomposition&lt;&gt;(p).getSolver().getInverse();</span>
<span class="fc" id="L543">        Assert.assertEquals(2, pInverse.getRowDimension());</span>
<span class="fc" id="L544">        Assert.assertEquals(2, pInverse.getColumnDimension());</span>

        // Solve example
<span class="fc" id="L547">        Fraction[][] coefficientsData = {</span>
                {new Fraction(2), new Fraction(3), new Fraction(-2)},
                {new Fraction(-1), new Fraction(7), new Fraction(6)},
                {new Fraction(4), new Fraction(-3), new Fraction(-5)}
        };
<span class="fc" id="L552">        FieldMatrix&lt;Fraction&gt; coefficients = new BlockFieldMatrix&lt;&gt;(coefficientsData);</span>
<span class="fc" id="L553">        Fraction[] constants = {</span>
            new Fraction(1), new Fraction(-2), new Fraction(1)
        };
        Fraction[] solution;
<span class="fc" id="L557">        solution = new FieldLUDecomposition&lt;&gt;(coefficients)</span>
<span class="fc" id="L558">            .getSolver()</span>
<span class="fc" id="L559">            .solve(new ArrayFieldVector&lt;&gt;(constants, false)).toArray();</span>
<span class="fc" id="L560">        Assert.assertEquals(new Fraction(2).multiply(solution[0]).</span>
<span class="fc" id="L561">                     add(new Fraction(3).multiply(solution[1])).</span>
<span class="fc" id="L562">                     subtract(new Fraction(2).multiply(solution[2])),</span>
                     constants[0]);
<span class="fc" id="L564">        Assert.assertEquals(new Fraction(-1).multiply(solution[0]).</span>
<span class="fc" id="L565">                     add(new Fraction(7).multiply(solution[1])).</span>
<span class="fc" id="L566">                     add(new Fraction(6).multiply(solution[2])),</span>
                     constants[1]);
<span class="fc" id="L568">        Assert.assertEquals(new Fraction(4).multiply(solution[0]).</span>
<span class="fc" id="L569">                     subtract(new Fraction(3).multiply(solution[1])).</span>
<span class="fc" id="L570">                     subtract(new Fraction(5).multiply(solution[2])),</span>
                     constants[2]);

<span class="fc" id="L573">    }</span>

    // test submatrix accessors
    @Test
    public void testGetSubMatrix() {
<span class="fc" id="L578">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L579">        checkGetSubMatrix(m, subRows23Cols00,  2 , 3 , 0, 0);</span>
<span class="fc" id="L580">        checkGetSubMatrix(m, subRows00Cols33,  0 , 0 , 3, 3);</span>
<span class="fc" id="L581">        checkGetSubMatrix(m, subRows01Cols23,  0 , 1 , 2, 3);</span>
<span class="fc" id="L582">        checkGetSubMatrix(m, subRows02Cols13,  new int[] { 0, 2 }, new int[] { 1, 3 });</span>
<span class="fc" id="L583">        checkGetSubMatrix(m, subRows03Cols12,  new int[] { 0, 3 }, new int[] { 1, 2 });</span>
<span class="fc" id="L584">        checkGetSubMatrix(m, subRows03Cols123, new int[] { 0, 3 }, new int[] { 1, 2, 3 });</span>
<span class="fc" id="L585">        checkGetSubMatrix(m, subRows20Cols123, new int[] { 2, 0 }, new int[] { 1, 2, 3 });</span>
<span class="fc" id="L586">        checkGetSubMatrix(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 });</span>
<span class="fc" id="L587">        checkGetSubMatrix(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 });</span>
<span class="fc" id="L588">        checkGetSubMatrix(m, null,  1, 0, 2, 4);</span>
<span class="fc" id="L589">        checkGetSubMatrix(m, null, -1, 1, 2, 2);</span>
<span class="fc" id="L590">        checkGetSubMatrix(m, null,  1, 0, 2, 2);</span>
<span class="fc" id="L591">        checkGetSubMatrix(m, null,  1, 0, 2, 4);</span>
<span class="fc" id="L592">        checkGetSubMatrix(m, null, new int[] {},    new int[] { 0 });</span>
<span class="fc" id="L593">        checkGetSubMatrix(m, null, new int[] { 0 }, new int[] { 4 });</span>
<span class="fc" id="L594">    }</span>

    private void checkGetSubMatrix(FieldMatrix&lt;Fraction&gt; m, Fraction[][] reference,
                                   int startRow, int endRow, int startColumn, int endColumn) {
        try {
<span class="fc" id="L599">            FieldMatrix&lt;Fraction&gt; sub = m.getSubMatrix(startRow, endRow, startColumn, endColumn);</span>
<span class="pc bpc" id="L600" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="fc" id="L601">                Assert.assertEquals(new BlockFieldMatrix&lt;&gt;(reference), sub);</span>
            } else {
<span class="nc" id="L603">                Assert.fail(&quot;Expecting OutOfRangeException or NotStrictlyPositiveException&quot;</span>
                     + &quot; or NumberIsTooSmallException or NoDataException&quot;);
            }
<span class="fc" id="L606">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L607" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L608">                throw e;</span>
            }
<span class="nc" id="L610">        } catch (NotStrictlyPositiveException e) {</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L612">                throw e;</span>
            }
<span class="fc" id="L614">        } catch (NumberIsTooSmallException e) {</span>
<span class="pc bpc" id="L615" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L616">                throw e;</span>
            }
<span class="nc" id="L618">        } catch (NoDataException e) {</span>
<span class="nc bnc" id="L619" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L620">                throw e;</span>
            }
<span class="pc" id="L622">        }</span>
<span class="fc" id="L623">    }</span>

    private void checkGetSubMatrix(FieldMatrix&lt;Fraction&gt; m, Fraction[][] reference,
                                   int[] selectedRows, int[] selectedColumns) {
        try {
<span class="fc" id="L628">            FieldMatrix&lt;Fraction&gt; sub = m.getSubMatrix(selectedRows, selectedColumns);</span>
<span class="pc bpc" id="L629" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="fc" id="L630">                Assert.assertEquals(new BlockFieldMatrix&lt;&gt;(reference), sub);</span>
            } else {
<span class="nc" id="L632">                Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
            }
<span class="fc" id="L634">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L635" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L636">                throw e;</span>
            }
<span class="nc" id="L638">        } catch (NotStrictlyPositiveException e) {</span>
<span class="nc bnc" id="L639" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L640">                throw e;</span>
            }
<span class="nc" id="L642">        } catch (NumberIsTooSmallException e) {</span>
<span class="nc bnc" id="L643" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L644">                throw e;</span>
            }
<span class="fc" id="L646">        } catch (NoDataException e) {</span>
<span class="pc bpc" id="L647" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L648">                throw e;</span>
            }
<span class="pc" id="L650">        }</span>
<span class="fc" id="L651">    }</span>

    @Test
    public void testGetSetMatrixLarge() {
<span class="fc" id="L655">        int n = 3 * BlockFieldMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L656">        FieldMatrix&lt;Fraction&gt; m =</span>
<span class="fc" id="L657">            new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), n, n);</span>
<span class="fc" id="L658">        FieldMatrix&lt;Fraction&gt; sub =</span>
<span class="fc" id="L659">            new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), n - 4, n - 4).scalarAdd(new Fraction(1));</span>

<span class="fc" id="L661">        m.setSubMatrix(sub.getData(), 2, 2);</span>
<span class="fc bfc" id="L662" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L663" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L664" title="All 8 branches covered.">                if ((i &lt; 2) || (i &gt; n - 3) || (j &lt; 2) || (j &gt; n - 3)) {</span>
<span class="fc" id="L665">                    Assert.assertEquals(new Fraction(0), m.getEntry(i, j));</span>
                } else {
<span class="fc" id="L667">                    Assert.assertEquals(new Fraction(1), m.getEntry(i, j));</span>
                }
            }
        }
<span class="fc" id="L671">        Assert.assertEquals(sub, m.getSubMatrix(2, n - 3, 2, n - 3));</span>
<span class="fc" id="L672">    }</span>

    @Test
    public void testCopySubMatrix() {
<span class="fc" id="L676">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L677">        checkCopy(m, subRows23Cols00,  2 , 3 , 0, 0);</span>
<span class="fc" id="L678">        checkCopy(m, subRows00Cols33,  0 , 0 , 3, 3);</span>
<span class="fc" id="L679">        checkCopy(m, subRows01Cols23,  0 , 1 , 2, 3);</span>
<span class="fc" id="L680">        checkCopy(m, subRows02Cols13,  new int[] { 0, 2 }, new int[] { 1, 3 });</span>
<span class="fc" id="L681">        checkCopy(m, subRows03Cols12,  new int[] { 0, 3 }, new int[] { 1, 2 });</span>
<span class="fc" id="L682">        checkCopy(m, subRows03Cols123, new int[] { 0, 3 }, new int[] { 1, 2, 3 });</span>
<span class="fc" id="L683">        checkCopy(m, subRows20Cols123, new int[] { 2, 0 }, new int[] { 1, 2, 3 });</span>
<span class="fc" id="L684">        checkCopy(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 });</span>
<span class="fc" id="L685">        checkCopy(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 });</span>

<span class="fc" id="L687">        checkCopy(m, null,  1, 0, 2, 4);</span>
<span class="fc" id="L688">        checkCopy(m, null, -1, 1, 2, 2);</span>
<span class="fc" id="L689">        checkCopy(m, null,  1, 0, 2, 2);</span>
<span class="fc" id="L690">        checkCopy(m, null,  1, 0, 2, 4);</span>
<span class="fc" id="L691">        checkCopy(m, null, new int[] {}, new int[] { 0 });</span>
<span class="fc" id="L692">        checkCopy(m, null, new int[] { 0 }, new int[] { 4 });</span>
<span class="fc" id="L693">    }</span>

    private void checkCopy(FieldMatrix&lt;Fraction&gt; m, Fraction[][] reference,
                           int startRow, int endRow, int startColumn, int endColumn) {
        try {
<span class="fc bfc" id="L698" title="All 2 branches covered.">            Fraction[][] sub = (reference == null) ?</span>
                             new Fraction[1][1] :
                             new Fraction[reference.length][reference[0].length];
<span class="fc" id="L701">            m.copySubMatrix(startRow, endRow, startColumn, endColumn, sub);</span>
<span class="pc bpc" id="L702" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="fc" id="L703">                Assert.assertEquals(new BlockFieldMatrix&lt;&gt;(reference), new BlockFieldMatrix&lt;&gt;(sub));</span>
            } else {
<span class="nc" id="L705">                Assert.fail(&quot;Expecting OutOfRangeException or NumberIsTooSmallException or NoDataException&quot;);</span>
            }
<span class="fc" id="L707">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L708" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L709">                throw e;</span>
            }
<span class="fc" id="L711">        } catch (NumberIsTooSmallException e) {</span>
<span class="pc bpc" id="L712" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L713">                throw e;</span>
            }
<span class="nc" id="L715">        } catch (NoDataException e) {</span>
<span class="nc bnc" id="L716" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L717">                throw e;</span>
            }
<span class="fc" id="L719">        }</span>
<span class="fc" id="L720">    }</span>

    private void checkCopy(FieldMatrix&lt;Fraction&gt; m, Fraction[][] reference,
                           int[] selectedRows, int[] selectedColumns) {
        try {
<span class="fc bfc" id="L725" title="All 2 branches covered.">            Fraction[][] sub = (reference == null) ?</span>
                    new Fraction[1][1] :
                    new Fraction[reference.length][reference[0].length];
<span class="fc" id="L728">            m.copySubMatrix(selectedRows, selectedColumns, sub);</span>
<span class="pc bpc" id="L729" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="fc" id="L730">                Assert.assertEquals(new BlockFieldMatrix&lt;&gt;(reference), new BlockFieldMatrix&lt;&gt;(sub));</span>
            } else {
<span class="nc" id="L732">                Assert.fail(&quot;Expecting OutOfRangeException or NumberIsTooSmallException or NoDataException&quot;);</span>
            }
<span class="fc" id="L734">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L735" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L736">                throw e;</span>
            }
<span class="nc" id="L738">        } catch (NumberIsTooSmallException e) {</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L740">                throw e;</span>
            }
<span class="fc" id="L742">        } catch (NoDataException e) {</span>
<span class="pc bpc" id="L743" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L744">                throw e;</span>
            }
<span class="pc" id="L746">        }</span>
<span class="fc" id="L747">    }</span>

    @Test
    public void testGetRowMatrix() {
<span class="fc" id="L751">        FieldMatrix&lt;Fraction&gt; m     = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L752">        FieldMatrix&lt;Fraction&gt; mRow0 = new BlockFieldMatrix&lt;&gt;(subRow0);</span>
<span class="fc" id="L753">        FieldMatrix&lt;Fraction&gt; mRow3 = new BlockFieldMatrix&lt;&gt;(subRow3);</span>
<span class="fc" id="L754">        Assert.assertEquals(&quot;Row0&quot;, mRow0, m.getRowMatrix(0));</span>
<span class="fc" id="L755">        Assert.assertEquals(&quot;Row3&quot;, mRow3, m.getRowMatrix(3));</span>
        try {
<span class="nc" id="L757">            m.getRowMatrix(-1);</span>
<span class="nc" id="L758">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L759">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L761">        }</span>
        try {
<span class="nc" id="L763">            m.getRowMatrix(4);</span>
<span class="nc" id="L764">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L765">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L767">        }</span>
<span class="fc" id="L768">    }</span>

    @Test
    public void testSetRowMatrix() {
<span class="fc" id="L772">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L773">        FieldMatrix&lt;Fraction&gt; mRow3 = new BlockFieldMatrix&lt;&gt;(subRow3);</span>
<span class="fc" id="L774">        Assert.assertNotSame(mRow3, m.getRowMatrix(0));</span>
<span class="fc" id="L775">        m.setRowMatrix(0, mRow3);</span>
<span class="fc" id="L776">        Assert.assertEquals(mRow3, m.getRowMatrix(0));</span>
        try {
<span class="nc" id="L778">            m.setRowMatrix(-1, mRow3);</span>
<span class="nc" id="L779">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L780">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L782">        }</span>
        try {
<span class="nc" id="L784">            m.setRowMatrix(0, m);</span>
<span class="nc" id="L785">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L786">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L788">        }</span>
<span class="fc" id="L789">    }</span>

    @Test
    public void testGetSetRowMatrixLarge() {
<span class="fc" id="L793">        int n = 3 * BlockFieldMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L794">        FieldMatrix&lt;Fraction&gt; m =</span>
<span class="fc" id="L795">            new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), n, n);</span>
<span class="fc" id="L796">        FieldMatrix&lt;Fraction&gt; sub =</span>
<span class="fc" id="L797">            new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), 1, n).scalarAdd(new Fraction(1));</span>

<span class="fc" id="L799">        m.setRowMatrix(2, sub);</span>
<span class="fc bfc" id="L800" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L801" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L802" title="All 2 branches covered.">                if (i != 2) {</span>
<span class="fc" id="L803">                    Assert.assertEquals(new Fraction(0), m.getEntry(i, j));</span>
                } else {
<span class="fc" id="L805">                    Assert.assertEquals(new Fraction(1), m.getEntry(i, j));</span>
                }
            }
        }
<span class="fc" id="L809">        Assert.assertEquals(sub, m.getRowMatrix(2));</span>

<span class="fc" id="L811">    }</span>

    @Test
    public void testGetColumnMatrix() {
<span class="fc" id="L815">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L816">        FieldMatrix&lt;Fraction&gt; mColumn1 = new BlockFieldMatrix&lt;&gt;(subColumn1);</span>
<span class="fc" id="L817">        FieldMatrix&lt;Fraction&gt; mColumn3 = new BlockFieldMatrix&lt;&gt;(subColumn3);</span>
<span class="fc" id="L818">        Assert.assertEquals(mColumn1, m.getColumnMatrix(1));</span>
<span class="fc" id="L819">        Assert.assertEquals(mColumn3, m.getColumnMatrix(3));</span>
        try {
<span class="nc" id="L821">            m.getColumnMatrix(-1);</span>
<span class="nc" id="L822">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L823">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L825">        }</span>
        try {
<span class="nc" id="L827">            m.getColumnMatrix(4);</span>
<span class="nc" id="L828">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L829">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L831">        }</span>
<span class="fc" id="L832">    }</span>

    @Test
    public void testSetColumnMatrix() {
<span class="fc" id="L836">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L837">        FieldMatrix&lt;Fraction&gt; mColumn3 = new BlockFieldMatrix&lt;&gt;(subColumn3);</span>
<span class="fc" id="L838">        Assert.assertNotSame(mColumn3, m.getColumnMatrix(1));</span>
<span class="fc" id="L839">        m.setColumnMatrix(1, mColumn3);</span>
<span class="fc" id="L840">        Assert.assertEquals(mColumn3, m.getColumnMatrix(1));</span>
        try {
<span class="nc" id="L842">            m.setColumnMatrix(-1, mColumn3);</span>
<span class="nc" id="L843">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L844">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L846">        }</span>
        try {
<span class="nc" id="L848">            m.setColumnMatrix(0, m);</span>
<span class="nc" id="L849">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L850">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L852">        }</span>
<span class="fc" id="L853">    }</span>

    @Test
    public void testGetSetColumnMatrixLarge() {
<span class="fc" id="L857">        int n = 3 * BlockFieldMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L858">        FieldMatrix&lt;Fraction&gt; m =</span>
<span class="fc" id="L859">            new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), n, n);</span>
<span class="fc" id="L860">        FieldMatrix&lt;Fraction&gt; sub =</span>
<span class="fc" id="L861">            new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), n, 1).scalarAdd(new Fraction(1));</span>

<span class="fc" id="L863">        m.setColumnMatrix(2, sub);</span>
<span class="fc bfc" id="L864" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L865" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L866" title="All 2 branches covered.">                if (j != 2) {</span>
<span class="fc" id="L867">                    Assert.assertEquals(new Fraction(0), m.getEntry(i, j));</span>
                } else {
<span class="fc" id="L869">                    Assert.assertEquals(new Fraction(1), m.getEntry(i, j));</span>
                }
            }
        }
<span class="fc" id="L873">        Assert.assertEquals(sub, m.getColumnMatrix(2));</span>

<span class="fc" id="L875">    }</span>

    @Test
    public void testGetRowVector() {
<span class="fc" id="L879">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L880">        FieldVector&lt;Fraction&gt; mRow0 = new ArrayFieldVector&lt;&gt;(subRow0[0]);</span>
<span class="fc" id="L881">        FieldVector&lt;Fraction&gt; mRow3 = new ArrayFieldVector&lt;&gt;(subRow3[0]);</span>
<span class="fc" id="L882">        Assert.assertEquals(mRow0, m.getRowVector(0));</span>
<span class="fc" id="L883">        Assert.assertEquals(mRow3, m.getRowVector(3));</span>
        try {
<span class="nc" id="L885">            m.getRowVector(-1);</span>
<span class="nc" id="L886">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L887">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L889">        }</span>
        try {
<span class="nc" id="L891">            m.getRowVector(4);</span>
<span class="nc" id="L892">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L893">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L895">        }</span>
<span class="fc" id="L896">    }</span>

    @Test
    public void testSetRowVector() {
<span class="fc" id="L900">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L901">        FieldVector&lt;Fraction&gt; mRow3 = new ArrayFieldVector&lt;&gt;(subRow3[0]);</span>
<span class="fc" id="L902">        Assert.assertNotSame(mRow3, m.getRowMatrix(0));</span>
<span class="fc" id="L903">        m.setRowVector(0, mRow3);</span>
<span class="fc" id="L904">        Assert.assertEquals(mRow3, m.getRowVector(0));</span>
        try {
<span class="nc" id="L906">            m.setRowVector(-1, mRow3);</span>
<span class="nc" id="L907">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L908">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L910">        }</span>
        try {
<span class="nc" id="L912">            m.setRowVector(0, new ArrayFieldVector&lt;&gt;(FractionField.getInstance(), 5));</span>
<span class="nc" id="L913">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L914">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L916">        }</span>
<span class="fc" id="L917">    }</span>

    @Test
    public void testGetSetRowVectorLarge() {
<span class="fc" id="L921">        int n = 3 * BlockFieldMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L922">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), n, n);</span>
<span class="fc" id="L923">        FieldVector&lt;Fraction&gt; sub = new ArrayFieldVector&lt;&gt;(n, new Fraction(1));</span>

<span class="fc" id="L925">        m.setRowVector(2, sub);</span>
<span class="fc bfc" id="L926" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L927" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L928" title="All 2 branches covered.">                if (i != 2) {</span>
<span class="fc" id="L929">                    Assert.assertEquals(new Fraction(0), m.getEntry(i, j));</span>
                } else {
<span class="fc" id="L931">                    Assert.assertEquals(new Fraction(1), m.getEntry(i, j));</span>
                }
            }
        }
<span class="fc" id="L935">        Assert.assertEquals(sub, m.getRowVector(2));</span>

<span class="fc" id="L937">    }</span>

    @Test
    public void testGetColumnVector() {
<span class="fc" id="L941">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L942">        FieldVector&lt;Fraction&gt; mColumn1 = columnToVector(subColumn1);</span>
<span class="fc" id="L943">        FieldVector&lt;Fraction&gt; mColumn3 = columnToVector(subColumn3);</span>
<span class="fc" id="L944">        Assert.assertEquals(mColumn1, m.getColumnVector(1));</span>
<span class="fc" id="L945">        Assert.assertEquals(mColumn3, m.getColumnVector(3));</span>
        try {
<span class="nc" id="L947">            m.getColumnVector(-1);</span>
<span class="nc" id="L948">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L949">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L951">        }</span>
        try {
<span class="nc" id="L953">            m.getColumnVector(4);</span>
<span class="nc" id="L954">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L955">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L957">        }</span>
<span class="fc" id="L958">    }</span>

    @Test
    public void testSetColumnVector() {
<span class="fc" id="L962">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L963">        FieldVector&lt;Fraction&gt; mColumn3 = columnToVector(subColumn3);</span>
<span class="fc" id="L964">        Assert.assertNotSame(mColumn3, m.getColumnVector(1));</span>
<span class="fc" id="L965">        m.setColumnVector(1, mColumn3);</span>
<span class="fc" id="L966">        Assert.assertEquals(mColumn3, m.getColumnVector(1));</span>
        try {
<span class="nc" id="L968">            m.setColumnVector(-1, mColumn3);</span>
<span class="nc" id="L969">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L970">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L972">        }</span>
        try {
<span class="nc" id="L974">            m.setColumnVector(0, new ArrayFieldVector&lt;&gt;(FractionField.getInstance(), 5));</span>
<span class="nc" id="L975">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L976">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L978">        }</span>
<span class="fc" id="L979">    }</span>

    @Test
    public void testGetSetColumnVectorLarge() {
<span class="fc" id="L983">        int n = 3 * BlockFieldMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L984">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), n, n);</span>
<span class="fc" id="L985">        FieldVector&lt;Fraction&gt; sub = new ArrayFieldVector&lt;&gt;(n, new Fraction(1));</span>

<span class="fc" id="L987">        m.setColumnVector(2, sub);</span>
<span class="fc bfc" id="L988" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L989" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L990" title="All 2 branches covered.">                if (j != 2) {</span>
<span class="fc" id="L991">                    Assert.assertEquals(new Fraction(0), m.getEntry(i, j));</span>
                } else {
<span class="fc" id="L993">                    Assert.assertEquals(new Fraction(1), m.getEntry(i, j));</span>
                }
            }
        }
<span class="fc" id="L997">        Assert.assertEquals(sub, m.getColumnVector(2));</span>

<span class="fc" id="L999">    }</span>

    private FieldVector&lt;Fraction&gt; columnToVector(Fraction[][] column) {
<span class="fc" id="L1002">        Fraction[] data = new Fraction[column.length];</span>
<span class="fc bfc" id="L1003" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc" id="L1004">            data[i] = column[i][0];</span>
        }
<span class="fc" id="L1006">        return new ArrayFieldVector&lt;&gt;(data, false);</span>
    }

    @Test
    public void testGetRow() {
<span class="fc" id="L1011">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L1012">        checkArrays(subRow0[0], m.getRow(0));</span>
<span class="fc" id="L1013">        checkArrays(subRow3[0], m.getRow(3));</span>
        try {
<span class="nc" id="L1015">            m.getRow(-1);</span>
<span class="nc" id="L1016">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1017">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L1019">        }</span>
        try {
<span class="nc" id="L1021">            m.getRow(4);</span>
<span class="nc" id="L1022">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1023">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L1025">        }</span>
<span class="fc" id="L1026">    }</span>

    @Test
    public void testSetRow() {
<span class="fc" id="L1030">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="pc bpc" id="L1031" title="1 of 2 branches missed.">        Assert.assertTrue(subRow3[0][0] != m.getRow(0)[0]);</span>
<span class="fc" id="L1032">        m.setRow(0, subRow3[0]);</span>
<span class="fc" id="L1033">        checkArrays(subRow3[0], m.getRow(0));</span>
        try {
<span class="nc" id="L1035">            m.setRow(-1, subRow3[0]);</span>
<span class="nc" id="L1036">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1037">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L1039">        }</span>
        try {
<span class="nc" id="L1041">            m.setRow(0, new Fraction[5]);</span>
<span class="nc" id="L1042">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L1043">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L1045">        }</span>
<span class="fc" id="L1046">    }</span>

    @Test
    public void testGetSetRowLarge() {
<span class="fc" id="L1050">        int n = 3 * BlockFieldMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L1051">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), n, n);</span>
<span class="fc" id="L1052">        Fraction[] sub = new Fraction[n];</span>
<span class="fc" id="L1053">        Arrays.fill(sub, new Fraction(1));</span>

<span class="fc" id="L1055">        m.setRow(2, sub);</span>
<span class="fc bfc" id="L1056" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L1057" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L1058" title="All 2 branches covered.">                if (i != 2) {</span>
<span class="fc" id="L1059">                    Assert.assertEquals(new Fraction(0), m.getEntry(i, j));</span>
                } else {
<span class="fc" id="L1061">                    Assert.assertEquals(new Fraction(1), m.getEntry(i, j));</span>
                }
            }
        }
<span class="fc" id="L1065">        checkArrays(sub, m.getRow(2));</span>

<span class="fc" id="L1067">    }</span>

    @Test
    public void testGetColumn() {
<span class="fc" id="L1071">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L1072">        Fraction[] mColumn1 = columnToArray(subColumn1);</span>
<span class="fc" id="L1073">        Fraction[] mColumn3 = columnToArray(subColumn3);</span>
<span class="fc" id="L1074">        checkArrays(mColumn1, m.getColumn(1));</span>
<span class="fc" id="L1075">        checkArrays(mColumn3, m.getColumn(3));</span>
        try {
<span class="nc" id="L1077">            m.getColumn(-1);</span>
<span class="nc" id="L1078">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1079">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L1081">        }</span>
        try {
<span class="nc" id="L1083">            m.getColumn(4);</span>
<span class="nc" id="L1084">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1085">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L1087">        }</span>
<span class="fc" id="L1088">    }</span>

    @Test
    public void testSetColumn() {
<span class="fc" id="L1092">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(subTestData);</span>
<span class="fc" id="L1093">        Fraction[] mColumn3 = columnToArray(subColumn3);</span>
<span class="pc bpc" id="L1094" title="1 of 2 branches missed.">        Assert.assertTrue(mColumn3[0] != m.getColumn(1)[0]);</span>
<span class="fc" id="L1095">        m.setColumn(1, mColumn3);</span>
<span class="fc" id="L1096">        checkArrays(mColumn3, m.getColumn(1));</span>
        try {
<span class="nc" id="L1098">            m.setColumn(-1, mColumn3);</span>
<span class="nc" id="L1099">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1100">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L1102">        }</span>
        try {
<span class="nc" id="L1104">            m.setColumn(0, new Fraction[5]);</span>
<span class="nc" id="L1105">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L1106">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L1108">        }</span>
<span class="fc" id="L1109">    }</span>

    @Test
    public void testGetSetColumnLarge() {
<span class="fc" id="L1113">        int n = 3 * BlockFieldMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L1114">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), n, n);</span>
<span class="fc" id="L1115">        Fraction[] sub = new Fraction[n];</span>
<span class="fc" id="L1116">        Arrays.fill(sub, new Fraction(1));</span>

<span class="fc" id="L1118">        m.setColumn(2, sub);</span>
<span class="fc bfc" id="L1119" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L1120" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L1121" title="All 2 branches covered.">                if (j != 2) {</span>
<span class="fc" id="L1122">                    Assert.assertEquals(new Fraction(0), m.getEntry(i, j));</span>
                } else {
<span class="fc" id="L1124">                    Assert.assertEquals(new Fraction(1), m.getEntry(i, j));</span>
                }
            }
        }
<span class="fc" id="L1128">        checkArrays(sub, m.getColumn(2));</span>

<span class="fc" id="L1130">    }</span>

    private Fraction[] columnToArray(Fraction[][] column) {
<span class="fc" id="L1133">        Fraction[] data = new Fraction[column.length];</span>
<span class="fc bfc" id="L1134" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc" id="L1135">            data[i] = column[i][0];</span>
        }
<span class="fc" id="L1137">        return data;</span>
    }

    private void checkArrays(Fraction[] expected, Fraction[] actual) {
<span class="fc" id="L1141">        Assert.assertEquals(expected.length, actual.length);</span>
<span class="fc bfc" id="L1142" title="All 2 branches covered.">        for (int i = 0; i &lt; expected.length; ++i) {</span>
<span class="fc" id="L1143">            Assert.assertEquals(expected[i], actual[i]);</span>
        }
<span class="fc" id="L1145">    }</span>

    @Test
    public void testEqualsAndHashCode() {
<span class="fc" id="L1149">        BlockFieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L1150">        BlockFieldMatrix&lt;Fraction&gt; m1 = (BlockFieldMatrix&lt;Fraction&gt;) m.copy();</span>
<span class="fc" id="L1151">        BlockFieldMatrix&lt;Fraction&gt; mt = (BlockFieldMatrix&lt;Fraction&gt;) m.transpose();</span>
<span class="pc bpc" id="L1152" title="1 of 2 branches missed.">        Assert.assertTrue(m.hashCode() != mt.hashCode());</span>
<span class="fc" id="L1153">        Assert.assertEquals(m.hashCode(), m1.hashCode());</span>
<span class="fc" id="L1154">        Assert.assertEquals(m, m);</span>
<span class="fc" id="L1155">        Assert.assertEquals(m, m1);</span>
<span class="fc" id="L1156">        Assert.assertFalse(m.equals(null));</span>
<span class="fc" id="L1157">        Assert.assertFalse(m.equals(mt));</span>
<span class="fc" id="L1158">        Assert.assertFalse(m.equals(new BlockFieldMatrix&lt;&gt;(bigSingular)));</span>
<span class="fc" id="L1159">    }</span>

    @Test
    public void testToString() {
<span class="fc" id="L1163">        BlockFieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L1164">        Assert.assertEquals(&quot;BlockFieldMatrix{{1,2,3},{2,5,3},{1,0,8}}&quot;, m.toString());</span>
<span class="fc" id="L1165">    }</span>

    @Test
    public void testSetSubMatrix() {
<span class="fc" id="L1169">        BlockFieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L1170">        m.setSubMatrix(detData2,1,1);</span>
<span class="fc" id="L1171">        FieldMatrix&lt;Fraction&gt; expected = new BlockFieldMatrix&lt;&gt;</span>
            (new Fraction[][] {{new Fraction(1),new Fraction(2),new Fraction(3)},{new Fraction(2),new Fraction(1),new Fraction(3)},{new Fraction(1),new Fraction(2),new Fraction(4)}});
<span class="fc" id="L1173">        Assert.assertEquals(expected, m);</span>

<span class="fc" id="L1175">        m.setSubMatrix(detData2,0,0);</span>
<span class="fc" id="L1176">        expected = new BlockFieldMatrix&lt;&gt;</span>
            (new Fraction[][] {{new Fraction(1),new Fraction(3),new Fraction(3)},{new Fraction(2),new Fraction(4),new Fraction(3)},{new Fraction(1),new Fraction(2),new Fraction(4)}});
<span class="fc" id="L1178">        Assert.assertEquals(expected, m);</span>

<span class="fc" id="L1180">        m.setSubMatrix(testDataPlus2,0,0);</span>
<span class="fc" id="L1181">        expected = new BlockFieldMatrix&lt;&gt;</span>
            (new Fraction[][] {{new Fraction(3),new Fraction(4),new Fraction(5)},{new Fraction(4),new Fraction(7),new Fraction(5)},{new Fraction(3),new Fraction(2),new Fraction(10)}});
<span class="fc" id="L1183">        Assert.assertEquals(expected, m);</span>

        // javadoc example
<span class="fc" id="L1186">        BlockFieldMatrix&lt;Fraction&gt; matrix =</span>
            new BlockFieldMatrix&lt;&gt;(new Fraction[][] {
                    {new Fraction(1), new Fraction(2), new Fraction(3), new Fraction(4)},
                    {new Fraction(5), new Fraction(6), new Fraction(7), new Fraction(8)},
                    {new Fraction(9), new Fraction(0), new Fraction(1) , new Fraction(2)}
            });
<span class="fc" id="L1192">        matrix.setSubMatrix(new Fraction[][] {</span>
                {new Fraction(3), new Fraction(4)},
                {new Fraction(5), new Fraction(6)}
        }, 1, 1);
<span class="fc" id="L1196">        expected =</span>
            new BlockFieldMatrix&lt;&gt;(new Fraction[][] {
                    {new Fraction(1), new Fraction(2), new Fraction(3),new Fraction(4)},
                    {new Fraction(5), new Fraction(3), new Fraction(4), new Fraction(8)},
                    {new Fraction(9), new Fraction(5) ,new Fraction(6), new Fraction(2)}
            });
<span class="fc" id="L1202">        Assert.assertEquals(expected, matrix);</span>

        // dimension overflow
        try {
<span class="nc" id="L1206">            m.setSubMatrix(testData,1,1);</span>
<span class="nc" id="L1207">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1208">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L1210">        }</span>
        // dimension underflow
        try {
<span class="nc" id="L1213">            m.setSubMatrix(testData,-1,1);</span>
<span class="nc" id="L1214">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1215">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L1217">        }</span>
        try {
<span class="nc" id="L1219">            m.setSubMatrix(testData,1,-1);</span>
<span class="nc" id="L1220">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1221">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L1223">        }</span>

        // null
        try {
<span class="nc" id="L1227">            m.setSubMatrix(null,1,1);</span>
<span class="nc" id="L1228">            Assert.fail(&quot;expecting NullArgumentException&quot;);</span>
<span class="fc" id="L1229">        } catch (NullArgumentException e) {</span>
            // expected
<span class="nc" id="L1231">        }</span>

        // ragged
        try {
<span class="nc" id="L1235">            m.setSubMatrix(new Fraction[][] {{new Fraction(1)}, {new Fraction(2), new Fraction(3)}}, 0, 0);</span>
<span class="nc" id="L1236">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L1237">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L1239">        }</span>

        // empty
        try {
<span class="nc" id="L1243">            m.setSubMatrix(new Fraction[][] {{}}, 0, 0);</span>
<span class="nc" id="L1244">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L1245">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L1247">        }</span>
<span class="fc" id="L1248">    }</span>

    @Test
    public void testWalk() {
<span class="fc" id="L1252">        int rows    = 150;</span>
<span class="fc" id="L1253">        int columns = 75;</span>

<span class="fc" id="L1255">        FieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1256">        m.walkInRowOrder(new SetVisitor());</span>
<span class="fc" id="L1257">        GetVisitor getVisitor = new GetVisitor();</span>
<span class="fc" id="L1258">        m.walkInOptimizedOrder(getVisitor);</span>
<span class="fc" id="L1259">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1261">        m = new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1262">        m.walkInRowOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1263">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1264">        m.walkInOptimizedOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1265">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1266" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1267">            Assert.assertEquals(new Fraction(0), m.getEntry(i, 0));</span>
<span class="fc" id="L1268">            Assert.assertEquals(new Fraction(0), m.getEntry(i, columns - 1));</span>
        }
<span class="fc bfc" id="L1270" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1271">            Assert.assertEquals(new Fraction(0), m.getEntry(0, j));</span>
<span class="fc" id="L1272">            Assert.assertEquals(new Fraction(0), m.getEntry(rows - 1, j));</span>
        }

<span class="fc" id="L1275">        m = new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1276">        m.walkInColumnOrder(new SetVisitor());</span>
<span class="fc" id="L1277">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1278">        m.walkInOptimizedOrder(getVisitor);</span>
<span class="fc" id="L1279">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1281">        m = new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1282">        m.walkInColumnOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1283">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1284">        m.walkInOptimizedOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1285">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1286" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1287">            Assert.assertEquals(new Fraction(0), m.getEntry(i, 0));</span>
<span class="fc" id="L1288">            Assert.assertEquals(new Fraction(0), m.getEntry(i, columns - 1));</span>
        }
<span class="fc bfc" id="L1290" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1291">            Assert.assertEquals(new Fraction(0), m.getEntry(0, j));</span>
<span class="fc" id="L1292">            Assert.assertEquals(new Fraction(0), m.getEntry(rows - 1, j));</span>
        }

<span class="fc" id="L1295">        m = new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1296">        m.walkInOptimizedOrder(new SetVisitor());</span>
<span class="fc" id="L1297">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1298">        m.walkInRowOrder(getVisitor);</span>
<span class="fc" id="L1299">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1301">        m = new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1302">        m.walkInOptimizedOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1303">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1304">        m.walkInRowOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1305">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1306" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1307">            Assert.assertEquals(new Fraction(0), m.getEntry(i, 0));</span>
<span class="fc" id="L1308">            Assert.assertEquals(new Fraction(0), m.getEntry(i, columns - 1));</span>
        }
<span class="fc bfc" id="L1310" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1311">            Assert.assertEquals(new Fraction(0), m.getEntry(0, j));</span>
<span class="fc" id="L1312">            Assert.assertEquals(new Fraction(0), m.getEntry(rows - 1, j));</span>
        }

<span class="fc" id="L1315">        m = new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1316">        m.walkInOptimizedOrder(new SetVisitor());</span>
<span class="fc" id="L1317">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1318">        m.walkInColumnOrder(getVisitor);</span>
<span class="fc" id="L1319">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1321">        m = new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc" id="L1322">        m.walkInOptimizedOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1323">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1324">        m.walkInColumnOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1325">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1326" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1327">            Assert.assertEquals(new Fraction(0), m.getEntry(i, 0));</span>
<span class="fc" id="L1328">            Assert.assertEquals(new Fraction(0), m.getEntry(i, columns - 1));</span>
        }
<span class="fc bfc" id="L1330" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1331">            Assert.assertEquals(new Fraction(0), m.getEntry(0, j));</span>
<span class="fc" id="L1332">            Assert.assertEquals(new Fraction(0), m.getEntry(rows - 1, j));</span>
        }

<span class="fc" id="L1335">    }</span>

    @Test
    public void testSerial()  {
<span class="fc" id="L1339">        BlockFieldMatrix&lt;Fraction&gt; m = new BlockFieldMatrix&lt;&gt;(testData);</span>
<span class="fc" id="L1340">        Assert.assertEquals(m,TestUtils.serializeAndRecover(m));</span>
<span class="fc" id="L1341">    }</span>

    private static class SetVisitor extends DefaultFieldMatrixChangingVisitor&lt;Fraction&gt; {
        public SetVisitor() {
<span class="fc" id="L1345">            super(Fraction.ZERO);</span>
<span class="fc" id="L1346">        }</span>
        @Override
        public Fraction visit(int i, int j, Fraction value) {
<span class="fc" id="L1349">            return new Fraction(i * 11 + j, 11);</span>
        }
    }

    private static class GetVisitor extends DefaultFieldMatrixPreservingVisitor&lt;Fraction&gt; {
        private int count;
        public GetVisitor() {
<span class="fc" id="L1356">            super(Fraction.ZERO);</span>
<span class="fc" id="L1357">            count = 0;</span>
<span class="fc" id="L1358">        }</span>
        @Override
        public void visit(int i, int j, Fraction value) {
<span class="fc" id="L1361">            ++count;</span>
<span class="fc" id="L1362">            Assert.assertEquals(new Fraction(i * 11 + j, 11), value);</span>
<span class="fc" id="L1363">        }</span>
        public int getCount() {
<span class="fc" id="L1365">            return count;</span>
        }
    }

    private BlockFieldMatrix&lt;Fraction&gt; createRandomMatrix(Random r, int rows, int columns) {
<span class="fc" id="L1370">        BlockFieldMatrix&lt;Fraction&gt; m =</span>
<span class="fc" id="L1371">            new BlockFieldMatrix&lt;&gt;(FractionField.getInstance(), rows, columns);</span>
<span class="fc bfc" id="L1372" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc bfc" id="L1373" title="All 2 branches covered.">            for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1374">                int p = r.nextInt(20) - 10;</span>
<span class="fc" id="L1375">                int q = r.nextInt(20) - 10;</span>
<span class="fc bfc" id="L1376" title="All 2 branches covered.">                if (q == 0) {</span>
<span class="fc" id="L1377">                    q = 1;</span>
                }
<span class="fc" id="L1379">                m.setEntry(i, j, new Fraction(p, q));</span>
            }
        }
<span class="fc" id="L1382">        return m;</span>
    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>