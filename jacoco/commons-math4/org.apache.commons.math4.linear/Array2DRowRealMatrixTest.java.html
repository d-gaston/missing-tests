<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Array2DRowRealMatrixTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">commons_math4$All_in_commons_math4.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.math4.linear</a> &gt; <span class="el_source">Array2DRowRealMatrixTest.java</span></div><h1>Array2DRowRealMatrixTest.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.math4.linear;

import org.junit.Test;
import org.junit.Assert;
import org.apache.commons.math4.TestUtils;
import org.apache.commons.math4.exception.DimensionMismatchException;
import org.apache.commons.math4.exception.MathIllegalArgumentException;
import org.apache.commons.math4.exception.MathIllegalStateException;
import org.apache.commons.math4.exception.NoDataException;
import org.apache.commons.math4.exception.NullArgumentException;
import org.apache.commons.math4.exception.NumberIsTooSmallException;
import org.apache.commons.math4.exception.OutOfRangeException;
import org.apache.commons.math4.linear.Array2DRowRealMatrix;
import org.apache.commons.math4.linear.ArrayRealVector;
import org.apache.commons.math4.linear.DefaultRealMatrixChangingVisitor;
import org.apache.commons.math4.linear.DefaultRealMatrixPreservingVisitor;
import org.apache.commons.math4.linear.LUDecomposition;
import org.apache.commons.math4.linear.MatrixDimensionMismatchException;
import org.apache.commons.math4.linear.MatrixUtils;
import org.apache.commons.math4.linear.NonSquareMatrixException;
import org.apache.commons.math4.linear.RealMatrix;
import org.apache.commons.math4.linear.RealVector;
import org.apache.commons.math4.util.FastMath;

/**
 * Test cases for the {@link Array2DRowRealMatrix} class.
 *
 */

<span class="fc" id="L46">public final class Array2DRowRealMatrixTest {</span>

    // 3 x 3 identity matrix
<span class="fc" id="L49">    protected double[][] id = { {1d,0d,0d}, {0d,1d,0d}, {0d,0d,1d} };</span>

    // Test data for group operations
<span class="fc" id="L52">    protected double[][] testData = { {1d,2d,3d}, {2d,5d,3d}, {1d,0d,8d} };</span>
<span class="fc" id="L53">    protected double[][] testDataLU = {{2d, 5d, 3d}, {.5d, -2.5d, 6.5d}, {0.5d, 0.2d, .2d}};</span>
<span class="fc" id="L54">    protected double[][] testDataPlus2 = { {3d,4d,5d}, {4d,7d,5d}, {3d,2d,10d} };</span>
<span class="fc" id="L55">    protected double[][] testDataMinus = { {-1d,-2d,-3d}, {-2d,-5d,-3d},</span>
       {-1d,0d,-8d} };
<span class="fc" id="L57">    protected double[] testDataRow1 = {1d,2d,3d};</span>
<span class="fc" id="L58">    protected double[] testDataCol3 = {3d,3d,8d};</span>
<span class="fc" id="L59">    protected double[][] testDataInv =</span>
        { {-40d,16d,9d}, {13d,-5d,-3d}, {5d,-2d,-1d} };
<span class="fc" id="L61">    protected double[] preMultTest = {8,12,33};</span>
<span class="fc" id="L62">    protected double[][] testData2 ={ {1d,2d,3d}, {2d,5d,3d}};</span>
<span class="fc" id="L63">    protected double[][] testData2T = { {1d,2d}, {2d,5d}, {3d,3d}};</span>
<span class="fc" id="L64">    protected double[][] testDataPlusInv =</span>
        { {-39d,18d,12d}, {15d,0d,0d}, {6d,-2d,7d} };

    // lu decomposition tests
<span class="fc" id="L68">    protected double[][] luData = { {2d,3d,3d}, {0d,5d,7d}, {6d,9d,8d} };</span>
<span class="fc" id="L69">    protected double[][] luDataLUDecomposition = { {6d,9d,8d}, {0d,5d,7d},</span>
            {0.33333333333333,0d,0.33333333333333} };

    // singular matrices
<span class="fc" id="L73">    protected double[][] singular = { {2d,3d}, {2d,3d} };</span>
<span class="fc" id="L74">    protected double[][] bigSingular = {{1d,2d,3d,4d}, {2d,5d,3d,4d},</span>
        {7d,3d,256d,1930d}, {3d,7d,6d,8d}}; // 4th row = 1st + 2nd
<span class="fc" id="L76">    protected double[][] detData = { {1d,2d,3d}, {4d,5d,6d}, {7d,8d,10d} };</span>
<span class="fc" id="L77">    protected double[][] detData2 = { {1d, 3d}, {2d, 4d}};</span>

    // vectors
<span class="fc" id="L80">    protected double[] testVector = {1,2,3};</span>
<span class="fc" id="L81">    protected double[] testVector2 = {1,2,3,4};</span>

    // submatrix accessor tests
<span class="fc" id="L84">    protected double[][] subTestData = {{1, 2, 3, 4}, {1.5, 2.5, 3.5, 4.5},</span>
            {2, 4, 6, 8}, {4, 5, 6, 7}};
    // array selections
<span class="fc" id="L87">    protected double[][] subRows02Cols13 = { {2, 4}, {4, 8}};</span>
<span class="fc" id="L88">    protected double[][] subRows03Cols12 = { {2, 3}, {5, 6}};</span>
<span class="fc" id="L89">    protected double[][] subRows03Cols123 = { {2, 3, 4} , {5, 6, 7}};</span>
    // effective permutations
<span class="fc" id="L91">    protected double[][] subRows20Cols123 = { {4, 6, 8} , {2, 3, 4}};</span>
<span class="fc" id="L92">    protected double[][] subRows31Cols31 = {{7, 5}, {4.5, 2.5}};</span>
    // contiguous ranges
<span class="fc" id="L94">    protected double[][] subRows01Cols23 = {{3,4} , {3.5, 4.5}};</span>
<span class="fc" id="L95">    protected double[][] subRows23Cols00 = {{2} , {4}};</span>
<span class="fc" id="L96">    protected double[][] subRows00Cols33 = {{4}};</span>
    // row matrices
<span class="fc" id="L98">    protected double[][] subRow0 = {{1,2,3,4}};</span>
<span class="fc" id="L99">    protected double[][] subRow3 = {{4,5,6,7}};</span>
    // column matrices
<span class="fc" id="L101">    protected double[][] subColumn1 = {{2}, {2.5}, {4}, {5}};</span>
<span class="fc" id="L102">    protected double[][] subColumn3 = {{4}, {4.5}, {8}, {7}};</span>

    // tolerances
<span class="fc" id="L105">    protected double entryTolerance = 10E-16;</span>
<span class="fc" id="L106">    protected double normTolerance = 10E-14;</span>
<span class="fc" id="L107">    protected double powerTolerance = 10E-16;</span>

    /** test dimensions */
    @Test
    public void testDimensions() {
<span class="fc" id="L112">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L113">        Array2DRowRealMatrix m2 = new Array2DRowRealMatrix(testData2);</span>
<span class="fc" id="L114">        Assert.assertEquals(&quot;testData row dimension&quot;,3,m.getRowDimension());</span>
<span class="fc" id="L115">        Assert.assertEquals(&quot;testData column dimension&quot;,3,m.getColumnDimension());</span>
<span class="fc" id="L116">        Assert.assertTrue(&quot;testData is square&quot;,m.isSquare());</span>
<span class="fc" id="L117">        Assert.assertEquals(&quot;testData2 row dimension&quot;,m2.getRowDimension(),2);</span>
<span class="fc" id="L118">        Assert.assertEquals(&quot;testData2 column dimension&quot;,m2.getColumnDimension(),3);</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">        Assert.assertTrue(&quot;testData2 is not square&quot;,!m2.isSquare());</span>
<span class="fc" id="L120">    }</span>

    /** test copy functions */
    @Test
    public void testCopyFunctions() {
<span class="fc" id="L125">        Array2DRowRealMatrix m1 = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L126">        Array2DRowRealMatrix m2 = new Array2DRowRealMatrix(m1.getData());</span>
<span class="fc" id="L127">        Assert.assertEquals(m2,m1);</span>
<span class="fc" id="L128">        Array2DRowRealMatrix m3 = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L129">        Array2DRowRealMatrix m4 = new Array2DRowRealMatrix(m3.getData(), false);</span>
<span class="fc" id="L130">        Assert.assertEquals(m4,m3);</span>
<span class="fc" id="L131">    }</span>

    /** test add */
    @Test
    public void testAdd() {
<span class="fc" id="L136">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L137">        Array2DRowRealMatrix mInv = new Array2DRowRealMatrix(testDataInv);</span>
<span class="fc" id="L138">        RealMatrix mPlusMInv = m.add(mInv);</span>
<span class="fc" id="L139">        double[][] sumEntries = mPlusMInv.getData();</span>
<span class="fc bfc" id="L140" title="All 2 branches covered.">        for (int row = 0; row &lt; m.getRowDimension(); row++) {</span>
<span class="fc bfc" id="L141" title="All 2 branches covered.">            for (int col = 0; col &lt; m.getColumnDimension(); col++) {</span>
<span class="fc" id="L142">                Assert.assertEquals(&quot;sum entry entry&quot;,</span>
                    testDataPlusInv[row][col],sumEntries[row][col],
                        entryTolerance);
            }
        }
<span class="fc" id="L147">    }</span>

    /** test add failure */
    @Test
    public void testAddFail() {
<span class="fc" id="L152">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L153">        Array2DRowRealMatrix m2 = new Array2DRowRealMatrix(testData2);</span>
        try {
<span class="nc" id="L155">            m.add(m2);</span>
<span class="nc" id="L156">            Assert.fail(&quot;MathIllegalArgumentException expected&quot;);</span>
<span class="fc" id="L157">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L159">        }</span>
<span class="fc" id="L160">    }</span>

    /** test norm */
    @Test
    public void testNorm() {
<span class="fc" id="L165">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L166">        Array2DRowRealMatrix m2 = new Array2DRowRealMatrix(testData2);</span>
<span class="fc" id="L167">        Assert.assertEquals(&quot;testData norm&quot;,14d,m.getNorm(),entryTolerance);</span>
<span class="fc" id="L168">        Assert.assertEquals(&quot;testData2 norm&quot;,7d,m2.getNorm(),entryTolerance);</span>
<span class="fc" id="L169">    }</span>

    /** test Frobenius norm */
    @Test
    public void testFrobeniusNorm() {
<span class="fc" id="L174">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L175">        Array2DRowRealMatrix m2 = new Array2DRowRealMatrix(testData2);</span>
<span class="fc" id="L176">        Assert.assertEquals(&quot;testData Frobenius norm&quot;, FastMath.sqrt(117.0), m.getFrobeniusNorm(), entryTolerance);</span>
<span class="fc" id="L177">        Assert.assertEquals(&quot;testData2 Frobenius norm&quot;, FastMath.sqrt(52.0), m2.getFrobeniusNorm(), entryTolerance);</span>
<span class="fc" id="L178">    }</span>

     /** test m-n = m + -n */
    @Test
    public void testPlusMinus() {
<span class="fc" id="L183">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L184">        Array2DRowRealMatrix m2 = new Array2DRowRealMatrix(testDataInv);</span>
<span class="fc" id="L185">        TestUtils.assertEquals(&quot;m-n = m + -n&quot;,m.subtract(m2),</span>
<span class="fc" id="L186">            m2.scalarMultiply(-1d).add(m),entryTolerance);</span>
        try {
<span class="nc" id="L188">            m.subtract(new Array2DRowRealMatrix(testData2));</span>
<span class="nc" id="L189">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L190">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L192">        }</span>
<span class="fc" id="L193">    }</span>

    /** test multiply */
    @Test
    public void testMultiply() {
<span class="fc" id="L198">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L199">        Array2DRowRealMatrix mInv = new Array2DRowRealMatrix(testDataInv);</span>
<span class="fc" id="L200">        Array2DRowRealMatrix identity = new Array2DRowRealMatrix(id);</span>
<span class="fc" id="L201">        Array2DRowRealMatrix m2 = new Array2DRowRealMatrix(testData2);</span>
<span class="fc" id="L202">        TestUtils.assertEquals(&quot;inverse multiply&quot;,m.multiply(mInv),</span>
            identity,entryTolerance);
<span class="fc" id="L204">        TestUtils.assertEquals(&quot;inverse multiply&quot;,mInv.multiply(m),</span>
            identity,entryTolerance);
<span class="fc" id="L206">        TestUtils.assertEquals(&quot;identity multiply&quot;,m.multiply(identity),</span>
            m,entryTolerance);
<span class="fc" id="L208">        TestUtils.assertEquals(&quot;identity multiply&quot;,identity.multiply(mInv),</span>
            mInv,entryTolerance);
<span class="fc" id="L210">        TestUtils.assertEquals(&quot;identity multiply&quot;,m2.multiply(identity),</span>
            m2,entryTolerance);
        try {
<span class="nc" id="L213">            m.multiply(new Array2DRowRealMatrix(bigSingular));</span>
<span class="nc" id="L214">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L215">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L217">        }</span>
<span class="fc" id="L218">    }</span>

    //Additional Test for Array2DRowRealMatrixTest.testMultiply

<span class="fc" id="L222">    private final double[][] d3 = new double[][] {{1,2,3,4},{5,6,7,8}};</span>
<span class="fc" id="L223">    private final double[][] d4 = new double[][] {{1},{2},{3},{4}};</span>
<span class="fc" id="L224">    private final double[][] d5 = new double[][] {{30},{70}};</span>

    @Test
    public void testMultiply2() {
<span class="fc" id="L228">       RealMatrix m3 = new Array2DRowRealMatrix(d3);</span>
<span class="fc" id="L229">       RealMatrix m4 = new Array2DRowRealMatrix(d4);</span>
<span class="fc" id="L230">       RealMatrix m5 = new Array2DRowRealMatrix(d5);</span>
<span class="fc" id="L231">       TestUtils.assertEquals(&quot;m3*m4=m5&quot;, m3.multiply(m4), m5, entryTolerance);</span>
<span class="fc" id="L232">   }</span>

    @Test
    public void testPower() {
<span class="fc" id="L236">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L237">        Array2DRowRealMatrix mInv = new Array2DRowRealMatrix(testDataInv);</span>
<span class="fc" id="L238">        Array2DRowRealMatrix mPlusInv = new Array2DRowRealMatrix(testDataPlusInv);</span>
<span class="fc" id="L239">        Array2DRowRealMatrix identity = new Array2DRowRealMatrix(id);</span>

<span class="fc" id="L241">        TestUtils.assertEquals(&quot;m^0&quot;, m.power(0),</span>
            identity, entryTolerance);
<span class="fc" id="L243">        TestUtils.assertEquals(&quot;mInv^0&quot;, mInv.power(0),</span>
                identity, entryTolerance);
<span class="fc" id="L245">        TestUtils.assertEquals(&quot;mPlusInv^0&quot;, mPlusInv.power(0),</span>
                identity, entryTolerance);

<span class="fc" id="L248">        TestUtils.assertEquals(&quot;m^1&quot;, m.power(1),</span>
                m, entryTolerance);
<span class="fc" id="L250">        TestUtils.assertEquals(&quot;mInv^1&quot;, mInv.power(1),</span>
                mInv, entryTolerance);
<span class="fc" id="L252">        TestUtils.assertEquals(&quot;mPlusInv^1&quot;, mPlusInv.power(1),</span>
                mPlusInv, entryTolerance);

<span class="fc" id="L255">        RealMatrix C1 = m.copy();</span>
<span class="fc" id="L256">        RealMatrix C2 = mInv.copy();</span>
<span class="fc" id="L257">        RealMatrix C3 = mPlusInv.copy();</span>

<span class="fc bfc" id="L259" title="All 2 branches covered.">        for (int i = 2; i &lt;= 10; ++i) {</span>
<span class="fc" id="L260">            C1 = C1.multiply(m);</span>
<span class="fc" id="L261">            C2 = C2.multiply(mInv);</span>
<span class="fc" id="L262">            C3 = C3.multiply(mPlusInv);</span>

<span class="fc" id="L264">            TestUtils.assertEquals(&quot;m^&quot; + i, m.power(i),</span>
                    C1, entryTolerance);
<span class="fc" id="L266">            TestUtils.assertEquals(&quot;mInv^&quot; + i, mInv.power(i),</span>
                    C2, entryTolerance);
<span class="fc" id="L268">            TestUtils.assertEquals(&quot;mPlusInv^&quot; + i, mPlusInv.power(i),</span>
                    C3, entryTolerance);
        }

        try {
<span class="fc" id="L273">            Array2DRowRealMatrix mNotSquare = new Array2DRowRealMatrix(testData2T);</span>
<span class="nc" id="L274">            mNotSquare.power(2);</span>
<span class="nc" id="L275">            Assert.fail(&quot;Expecting NonSquareMatrixException&quot;);</span>
<span class="fc" id="L276">        } catch (NonSquareMatrixException ex) {</span>
            // ignored
<span class="nc" id="L278">        }</span>

        try {
<span class="nc" id="L281">            m.power(-1);</span>
<span class="nc" id="L282">            Assert.fail(&quot;Expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L283">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L285">        }</span>
<span class="fc" id="L286">    }</span>

    /** test trace */
    @Test
    public void testTrace() {
<span class="fc" id="L291">        RealMatrix m = new Array2DRowRealMatrix(id);</span>
<span class="fc" id="L292">        Assert.assertEquals(&quot;identity trace&quot;,3d,m.getTrace(),entryTolerance);</span>
<span class="fc" id="L293">        m = new Array2DRowRealMatrix(testData2);</span>
        try {
<span class="nc" id="L295">            m.getTrace();</span>
<span class="nc" id="L296">            Assert.fail(&quot;Expecting NonSquareMatrixException&quot;);</span>
<span class="fc" id="L297">        } catch (NonSquareMatrixException ex) {</span>
            // ignored
<span class="nc" id="L299">        }</span>
<span class="fc" id="L300">    }</span>

    /** test sclarAdd */
    @Test
    public void testScalarAdd() {
<span class="fc" id="L305">        RealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L306">        TestUtils.assertEquals(&quot;scalar add&quot;,new Array2DRowRealMatrix(testDataPlus2),</span>
<span class="fc" id="L307">            m.scalarAdd(2d),entryTolerance);</span>
<span class="fc" id="L308">    }</span>

    /** test operate */
    @Test
    public void testOperate() {
<span class="fc" id="L313">        RealMatrix m = new Array2DRowRealMatrix(id);</span>
<span class="fc" id="L314">        TestUtils.assertEquals(&quot;identity operate&quot;, testVector,</span>
<span class="fc" id="L315">                    m.operate(testVector), entryTolerance);</span>
<span class="fc" id="L316">        TestUtils.assertEquals(&quot;identity operate&quot;, testVector,</span>
<span class="fc" id="L317">                    m.operate(new ArrayRealVector(testVector)).toArray(), entryTolerance);</span>
<span class="fc" id="L318">        m = new Array2DRowRealMatrix(bigSingular);</span>
        try {
<span class="nc" id="L320">            m.operate(testVector);</span>
<span class="nc" id="L321">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L322">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L324">        }</span>
<span class="fc" id="L325">    }</span>

    /** test issue MATH-209 */
    @Test
    public void testMath209() {
<span class="fc" id="L330">        RealMatrix a = new Array2DRowRealMatrix(new double[][] {</span>
                { 1, 2 }, { 3, 4 }, { 5, 6 }
        }, false);
<span class="fc" id="L333">        double[] b = a.operate(new double[] { 1, 1 });</span>
<span class="fc" id="L334">        Assert.assertEquals(a.getRowDimension(), b.length);</span>
<span class="fc" id="L335">        Assert.assertEquals( 3.0, b[0], 1.0e-12);</span>
<span class="fc" id="L336">        Assert.assertEquals( 7.0, b[1], 1.0e-12);</span>
<span class="fc" id="L337">        Assert.assertEquals(11.0, b[2], 1.0e-12);</span>
<span class="fc" id="L338">    }</span>

    /** test transpose */
    @Test
    public void testTranspose() {
<span class="fc" id="L343">        RealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L344">        RealMatrix mIT = new LUDecomposition(m).getSolver().getInverse().transpose();</span>
<span class="fc" id="L345">        RealMatrix mTI = new LUDecomposition(m.transpose()).getSolver().getInverse();</span>
<span class="fc" id="L346">        TestUtils.assertEquals(&quot;inverse-transpose&quot;, mIT, mTI, normTolerance);</span>
<span class="fc" id="L347">        m = new Array2DRowRealMatrix(testData2);</span>
<span class="fc" id="L348">        RealMatrix mt = new Array2DRowRealMatrix(testData2T);</span>
<span class="fc" id="L349">        TestUtils.assertEquals(&quot;transpose&quot;,mt,m.transpose(),normTolerance);</span>
<span class="fc" id="L350">    }</span>

    /** test preMultiply by vector */
    @Test
    public void testPremultiplyVector() {
<span class="fc" id="L355">        RealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L356">        TestUtils.assertEquals(&quot;premultiply&quot;, m.preMultiply(testVector),</span>
                    preMultTest, normTolerance);
<span class="fc" id="L358">        TestUtils.assertEquals(&quot;premultiply&quot;, m.preMultiply(new ArrayRealVector(testVector).toArray()),</span>
                    preMultTest, normTolerance);
<span class="fc" id="L360">        m = new Array2DRowRealMatrix(bigSingular);</span>
        try {
<span class="nc" id="L362">            m.preMultiply(testVector);</span>
<span class="nc" id="L363">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L364">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L366">        }</span>
<span class="fc" id="L367">    }</span>

    @Test
    public void testPremultiply() {
<span class="fc" id="L371">        RealMatrix m3 = new Array2DRowRealMatrix(d3);</span>
<span class="fc" id="L372">        RealMatrix m4 = new Array2DRowRealMatrix(d4);</span>
<span class="fc" id="L373">        RealMatrix m5 = new Array2DRowRealMatrix(d5);</span>
<span class="fc" id="L374">        TestUtils.assertEquals(&quot;m3*m4=m5&quot;, m4.preMultiply(m3), m5, entryTolerance);</span>

<span class="fc" id="L376">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L377">        Array2DRowRealMatrix mInv = new Array2DRowRealMatrix(testDataInv);</span>
<span class="fc" id="L378">        Array2DRowRealMatrix identity = new Array2DRowRealMatrix(id);</span>
<span class="fc" id="L379">        TestUtils.assertEquals(&quot;inverse multiply&quot;,m.preMultiply(mInv),</span>
                identity,entryTolerance);
<span class="fc" id="L381">        TestUtils.assertEquals(&quot;inverse multiply&quot;,mInv.preMultiply(m),</span>
                identity,entryTolerance);
<span class="fc" id="L383">        TestUtils.assertEquals(&quot;identity multiply&quot;,m.preMultiply(identity),</span>
                m,entryTolerance);
<span class="fc" id="L385">        TestUtils.assertEquals(&quot;identity multiply&quot;,identity.preMultiply(mInv),</span>
                mInv,entryTolerance);
        try {
<span class="nc" id="L388">            m.preMultiply(new Array2DRowRealMatrix(bigSingular));</span>
<span class="nc" id="L389">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L390">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L392">        }</span>
<span class="fc" id="L393">    }</span>

    @Test
    public void testGetVectors() {
<span class="fc" id="L397">        RealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L398">        TestUtils.assertEquals(&quot;get row&quot;,m.getRow(0),testDataRow1,entryTolerance);</span>
<span class="fc" id="L399">        TestUtils.assertEquals(&quot;get col&quot;,m.getColumn(2),testDataCol3,entryTolerance);</span>
        try {
<span class="nc" id="L401">            m.getRow(10);</span>
<span class="nc" id="L402">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L403">        } catch (OutOfRangeException ex) {</span>
            // ignored
<span class="nc" id="L405">        }</span>
        try {
<span class="nc" id="L407">            m.getColumn(-1);</span>
<span class="nc" id="L408">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L409">        } catch (OutOfRangeException ex) {</span>
            // ignored
<span class="nc" id="L411">        }</span>
<span class="fc" id="L412">    }</span>

    @Test
    public void testGetEntry() {
<span class="fc" id="L416">        RealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L417">        Assert.assertEquals(&quot;get entry&quot;,m.getEntry(0,1),2d,entryTolerance);</span>
        try {
<span class="nc" id="L419">            m.getEntry(10, 4);</span>
<span class="nc" id="L420">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L421">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L423">        }</span>
<span class="fc" id="L424">    }</span>

    /** test examples in user guide */
    @Test
    public void testExamples() {
        // Create a real matrix with two rows and three columns
<span class="fc" id="L430">        double[][] matrixData = { {1d,2d,3d}, {2d,5d,3d}};</span>
<span class="fc" id="L431">        RealMatrix m = new Array2DRowRealMatrix(matrixData);</span>
        // One more with three rows, two columns
<span class="fc" id="L433">        double[][] matrixData2 = { {1d,2d}, {2d,5d}, {1d, 7d}};</span>
<span class="fc" id="L434">        RealMatrix n = new Array2DRowRealMatrix(matrixData2);</span>
        // Now multiply m by n
<span class="fc" id="L436">        RealMatrix p = m.multiply(n);</span>
<span class="fc" id="L437">        Assert.assertEquals(2, p.getRowDimension());</span>
<span class="fc" id="L438">        Assert.assertEquals(2, p.getColumnDimension());</span>
        // Invert p
<span class="fc" id="L440">        RealMatrix pInverse = new LUDecomposition(p).getSolver().getInverse();</span>
<span class="fc" id="L441">        Assert.assertEquals(2, pInverse.getRowDimension());</span>
<span class="fc" id="L442">        Assert.assertEquals(2, pInverse.getColumnDimension());</span>

        // Solve example
<span class="fc" id="L445">        double[][] coefficientsData = {{2, 3, -2}, {-1, 7, 6}, {4, -3, -5}};</span>
<span class="fc" id="L446">        RealMatrix coefficients = new Array2DRowRealMatrix(coefficientsData);</span>
<span class="fc" id="L447">        RealVector constants = new ArrayRealVector(new double[]{1, -2, 1}, false);</span>
<span class="fc" id="L448">        RealVector solution = new LUDecomposition(coefficients).getSolver().solve(constants);</span>
<span class="fc" id="L449">        final double cst0 = constants.getEntry(0);</span>
<span class="fc" id="L450">        final double cst1 = constants.getEntry(1);</span>
<span class="fc" id="L451">        final double cst2 = constants.getEntry(2);</span>
<span class="fc" id="L452">        final double sol0 = solution.getEntry(0);</span>
<span class="fc" id="L453">        final double sol1 = solution.getEntry(1);</span>
<span class="fc" id="L454">        final double sol2 = solution.getEntry(2);</span>
<span class="fc" id="L455">        Assert.assertEquals(2 * sol0 + 3 * sol1 -2 * sol2, cst0, 1E-12);</span>
<span class="fc" id="L456">        Assert.assertEquals(-1 * sol0 + 7 * sol1 + 6 * sol2, cst1, 1E-12);</span>
<span class="fc" id="L457">        Assert.assertEquals(4 * sol0 - 3 * sol1 -5 * sol2, cst2, 1E-12);</span>
<span class="fc" id="L458">    }</span>

    // test submatrix accessors
    @Test
    public void testGetSubMatrix() {
<span class="fc" id="L463">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L464">        checkGetSubMatrix(m, subRows23Cols00,  2 , 3 , 0, 0, false);</span>
<span class="fc" id="L465">        checkGetSubMatrix(m, subRows00Cols33,  0 , 0 , 3, 3, false);</span>
<span class="fc" id="L466">        checkGetSubMatrix(m, subRows01Cols23,  0 , 1 , 2, 3, false);</span>
<span class="fc" id="L467">        checkGetSubMatrix(m, subRows02Cols13,  new int[] { 0, 2 }, new int[] { 1, 3 },    false);</span>
<span class="fc" id="L468">        checkGetSubMatrix(m, subRows03Cols12,  new int[] { 0, 3 }, new int[] { 1, 2 },    false);</span>
<span class="fc" id="L469">        checkGetSubMatrix(m, subRows03Cols123, new int[] { 0, 3 }, new int[] { 1, 2, 3 }, false);</span>
<span class="fc" id="L470">        checkGetSubMatrix(m, subRows20Cols123, new int[] { 2, 0 }, new int[] { 1, 2, 3 }, false);</span>
<span class="fc" id="L471">        checkGetSubMatrix(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 },    false);</span>
<span class="fc" id="L472">        checkGetSubMatrix(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 },    false);</span>
<span class="fc" id="L473">        checkGetSubMatrix(m, null,  1, 0, 2, 4, true);</span>
<span class="fc" id="L474">        checkGetSubMatrix(m, null, -1, 1, 2, 2, true);</span>
<span class="fc" id="L475">        checkGetSubMatrix(m, null,  1, 0, 2, 2, true);</span>
<span class="fc" id="L476">        checkGetSubMatrix(m, null,  1, 0, 2, 4, true);</span>
<span class="fc" id="L477">        checkGetSubMatrix(m, null, new int[] {},    new int[] { 0 }, true);</span>
<span class="fc" id="L478">        checkGetSubMatrix(m, null, new int[] { 0 }, new int[] { 4 }, true);</span>
<span class="fc" id="L479">    }</span>

    private void checkGetSubMatrix(RealMatrix m, double[][] reference,
                                   int startRow, int endRow, int startColumn, int endColumn,
                                   boolean mustFail) {
        try {
<span class="fc" id="L485">            RealMatrix sub = m.getSubMatrix(startRow, endRow, startColumn, endColumn);</span>
<span class="fc" id="L486">            Assert.assertEquals(new Array2DRowRealMatrix(reference), sub);</span>
<span class="pc bpc" id="L487" title="1 of 2 branches missed.">            if (mustFail) {</span>
<span class="nc" id="L488">                Assert.fail(&quot;Expecting OutOfRangeException or NumberIsTooSmallException or NoDataException&quot;);</span>
            }
<span class="fc" id="L490">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L491" title="1 of 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L492">                throw e;</span>
            }
<span class="fc" id="L494">        } catch (NumberIsTooSmallException e) {</span>
<span class="pc bpc" id="L495" title="1 of 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L496">                throw e;</span>
            }
<span class="nc" id="L498">        } catch (NoDataException e) {</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L500">                throw e;</span>
            }
<span class="fc" id="L502">        }</span>
<span class="fc" id="L503">    }</span>

    private void checkGetSubMatrix(RealMatrix m, double[][] reference,
                                   int[] selectedRows, int[] selectedColumns,
                                   boolean mustFail) {
        try {
<span class="fc" id="L509">            RealMatrix sub = m.getSubMatrix(selectedRows, selectedColumns);</span>
<span class="fc" id="L510">            Assert.assertEquals(new Array2DRowRealMatrix(reference), sub);</span>
<span class="pc bpc" id="L511" title="1 of 2 branches missed.">            if (mustFail) {</span>
<span class="nc" id="L512">                Assert.fail(&quot;Expecting OutOfRangeException or NumberIsTooSmallException or NoDataException&quot;);</span>
            }
<span class="fc" id="L514">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L515" title="1 of 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L516">                throw e;</span>
            }
<span class="nc" id="L518">        } catch (NumberIsTooSmallException e) {</span>
<span class="nc bnc" id="L519" title="All 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L520">                throw e;</span>
            }
<span class="fc" id="L522">        } catch (NoDataException e) {</span>
<span class="pc bpc" id="L523" title="1 of 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L524">                throw e;</span>
            }
<span class="pc" id="L526">        }</span>
<span class="fc" id="L527">    }</span>

    @Test
    public void testCopySubMatrix() {
<span class="fc" id="L531">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L532">        checkCopy(m, subRows23Cols00,  2 , 3 , 0, 0, false);</span>
<span class="fc" id="L533">        checkCopy(m, subRows00Cols33,  0 , 0 , 3, 3, false);</span>
<span class="fc" id="L534">        checkCopy(m, subRows01Cols23,  0 , 1 , 2, 3, false);</span>
<span class="fc" id="L535">        checkCopy(m, subRows02Cols13,  new int[] { 0, 2 }, new int[] { 1, 3 },    false);</span>
<span class="fc" id="L536">        checkCopy(m, subRows03Cols12,  new int[] { 0, 3 }, new int[] { 1, 2 },    false);</span>
<span class="fc" id="L537">        checkCopy(m, subRows03Cols123, new int[] { 0, 3 }, new int[] { 1, 2, 3 }, false);</span>
<span class="fc" id="L538">        checkCopy(m, subRows20Cols123, new int[] { 2, 0 }, new int[] { 1, 2, 3 }, false);</span>
<span class="fc" id="L539">        checkCopy(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 },    false);</span>
<span class="fc" id="L540">        checkCopy(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 },    false);</span>

<span class="fc" id="L542">        checkCopy(m, null,  1, 0, 2, 4, true);</span>
<span class="fc" id="L543">        checkCopy(m, null, -1, 1, 2, 2, true);</span>
<span class="fc" id="L544">        checkCopy(m, null,  1, 0, 2, 2, true);</span>
<span class="fc" id="L545">        checkCopy(m, null,  1, 0, 2, 4, true);</span>
<span class="fc" id="L546">        checkCopy(m, null, new int[] {},    new int[] { 0 }, true);</span>
<span class="fc" id="L547">        checkCopy(m, null, new int[] { 0 }, new int[] { 4 }, true);</span>

        // rectangular check
<span class="fc" id="L550">        double[][] copy = new double[][] { { 0, 0, 0 }, { 0, 0 } };</span>
<span class="fc" id="L551">        checkCopy(m, copy, 0, 1, 0, 2, true);</span>
<span class="fc" id="L552">        checkCopy(m, copy, new int[] { 0, 1 }, new int[] { 0, 1, 2 }, true);</span>
<span class="fc" id="L553">    }</span>

    private void checkCopy(RealMatrix m, double[][] reference,
                           int startRow, int endRow, int startColumn, int endColumn,
                           boolean mustFail) {
        try {
<span class="fc bfc" id="L559" title="All 2 branches covered.">            double[][] sub = (reference == null) ?</span>
<span class="fc" id="L560">                             new double[1][1] : createIdenticalCopy(reference);</span>
<span class="fc" id="L561">            m.copySubMatrix(startRow, endRow, startColumn, endColumn, sub);</span>
<span class="fc" id="L562">            Assert.assertEquals(new Array2DRowRealMatrix(reference), new Array2DRowRealMatrix(sub));</span>
<span class="pc bpc" id="L563" title="1 of 2 branches missed.">            if (mustFail) {</span>
<span class="nc" id="L564">                Assert.fail(&quot;Expecting OutOfRangeException or NumberIsTooSmallException or NoDataException&quot;);</span>
            }
<span class="fc" id="L566">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L567" title="1 of 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L568">                throw e;</span>
            }
<span class="fc" id="L570">        } catch (NumberIsTooSmallException e) {</span>
<span class="pc bpc" id="L571" title="1 of 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L572">                throw e;</span>
            }
<span class="nc" id="L574">        } catch (NoDataException e) {</span>
<span class="nc bnc" id="L575" title="All 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L576">                throw e;</span>
            }
<span class="fc" id="L578">        } catch (MatrixDimensionMismatchException e) {</span>
<span class="pc bpc" id="L579" title="1 of 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L580">                throw e;</span>
            }
<span class="pc" id="L582">        }</span>
<span class="fc" id="L583">    }</span>

    private void checkCopy(RealMatrix m, double[][] reference,
                           int[] selectedRows, int[] selectedColumns,
                           boolean mustFail) {
        try {
<span class="fc bfc" id="L589" title="All 2 branches covered.">            double[][] sub = (reference == null) ?</span>
<span class="fc" id="L590">                    new double[1][1] : createIdenticalCopy(reference);</span>
<span class="fc" id="L591">            m.copySubMatrix(selectedRows, selectedColumns, sub);</span>
<span class="fc" id="L592">            Assert.assertEquals(new Array2DRowRealMatrix(reference), new Array2DRowRealMatrix(sub));</span>
<span class="pc bpc" id="L593" title="1 of 2 branches missed.">            if (mustFail) {</span>
<span class="nc" id="L594">                Assert.fail(&quot;Expecting OutOfRangeException or NumberIsTooSmallException or NoDataException&quot;);</span>
            }
<span class="fc" id="L596">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L597" title="1 of 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L598">                throw e;</span>
            }
<span class="nc" id="L600">        } catch (NumberIsTooSmallException e) {</span>
<span class="nc bnc" id="L601" title="All 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L602">                throw e;</span>
            }
<span class="fc" id="L604">        } catch (NoDataException e) {</span>
<span class="pc bpc" id="L605" title="1 of 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L606">                throw e;</span>
            }
<span class="fc" id="L608">        } catch (MatrixDimensionMismatchException e) {</span>
<span class="pc bpc" id="L609" title="1 of 2 branches missed.">            if (!mustFail) {</span>
<span class="nc" id="L610">                throw e;</span>
            }
<span class="pc" id="L612">        }</span>
<span class="fc" id="L613">    }</span>

    private double[][] createIdenticalCopy(final double[][] matrix) {
<span class="fc" id="L616">        final double[][] matrixCopy = new double[matrix.length][];</span>
<span class="fc bfc" id="L617" title="All 2 branches covered.">        for (int i = 0; i &lt; matrixCopy.length; i++) {</span>
<span class="fc" id="L618">            matrixCopy[i] = new double[matrix[i].length];</span>
        }
<span class="fc" id="L620">        return matrixCopy;</span>
    }

    @Test
    public void testGetRowMatrix() {
<span class="fc" id="L625">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L626">        RealMatrix mRow0 = new Array2DRowRealMatrix(subRow0);</span>
<span class="fc" id="L627">        RealMatrix mRow3 = new Array2DRowRealMatrix(subRow3);</span>
<span class="fc" id="L628">        Assert.assertEquals(&quot;Row0&quot;, mRow0,</span>
<span class="fc" id="L629">                m.getRowMatrix(0));</span>
<span class="fc" id="L630">        Assert.assertEquals(&quot;Row3&quot;, mRow3,</span>
<span class="fc" id="L631">                m.getRowMatrix(3));</span>
        try {
<span class="nc" id="L633">            m.getRowMatrix(-1);</span>
<span class="nc" id="L634">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L635">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L637">        }</span>
        try {
<span class="nc" id="L639">            m.getRowMatrix(4);</span>
<span class="nc" id="L640">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L641">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L643">        }</span>
<span class="fc" id="L644">    }</span>

    @Test
    public void testSetRowMatrix() {
<span class="fc" id="L648">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L649">        RealMatrix mRow3 = new Array2DRowRealMatrix(subRow3);</span>
<span class="fc" id="L650">        Assert.assertNotSame(mRow3, m.getRowMatrix(0));</span>
<span class="fc" id="L651">        m.setRowMatrix(0, mRow3);</span>
<span class="fc" id="L652">        Assert.assertEquals(mRow3, m.getRowMatrix(0));</span>
        try {
<span class="nc" id="L654">            m.setRowMatrix(-1, mRow3);</span>
<span class="nc" id="L655">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L656">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L658">        }</span>
        try {
<span class="nc" id="L660">            m.setRowMatrix(0, m);</span>
<span class="nc" id="L661">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L662">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L664">        }</span>
<span class="fc" id="L665">    }</span>

    @Test
    public void testGetColumnMatrix() {
<span class="fc" id="L669">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L670">        RealMatrix mColumn1 = new Array2DRowRealMatrix(subColumn1);</span>
<span class="fc" id="L671">        RealMatrix mColumn3 = new Array2DRowRealMatrix(subColumn3);</span>
<span class="fc" id="L672">        Assert.assertEquals(&quot;Column1&quot;, mColumn1,</span>
<span class="fc" id="L673">                m.getColumnMatrix(1));</span>
<span class="fc" id="L674">        Assert.assertEquals(&quot;Column3&quot;, mColumn3,</span>
<span class="fc" id="L675">                m.getColumnMatrix(3));</span>
        try {
<span class="nc" id="L677">            m.getColumnMatrix(-1);</span>
<span class="nc" id="L678">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L679">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L681">        }</span>
        try {
<span class="nc" id="L683">            m.getColumnMatrix(4);</span>
<span class="nc" id="L684">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L685">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L687">        }</span>
<span class="fc" id="L688">    }</span>

    @Test
    public void testSetColumnMatrix() {
<span class="fc" id="L692">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L693">        RealMatrix mColumn3 = new Array2DRowRealMatrix(subColumn3);</span>
<span class="fc" id="L694">        Assert.assertNotSame(mColumn3, m.getColumnMatrix(1));</span>
<span class="fc" id="L695">        m.setColumnMatrix(1, mColumn3);</span>
<span class="fc" id="L696">        Assert.assertEquals(mColumn3, m.getColumnMatrix(1));</span>
        try {
<span class="nc" id="L698">            m.setColumnMatrix(-1, mColumn3);</span>
<span class="nc" id="L699">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L700">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L702">        }</span>
        try {
<span class="nc" id="L704">            m.setColumnMatrix(0, m);</span>
<span class="nc" id="L705">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L706">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L708">        }</span>
<span class="fc" id="L709">    }</span>

    @Test
    public void testGetRowVector() {
<span class="fc" id="L713">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L714">        RealVector mRow0 = new ArrayRealVector(subRow0[0]);</span>
<span class="fc" id="L715">        RealVector mRow3 = new ArrayRealVector(subRow3[0]);</span>
<span class="fc" id="L716">        Assert.assertEquals(&quot;Row0&quot;, mRow0, m.getRowVector(0));</span>
<span class="fc" id="L717">        Assert.assertEquals(&quot;Row3&quot;, mRow3, m.getRowVector(3));</span>
        try {
<span class="nc" id="L719">            m.getRowVector(-1);</span>
<span class="nc" id="L720">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L721">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L723">        }</span>
        try {
<span class="nc" id="L725">            m.getRowVector(4);</span>
<span class="nc" id="L726">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L727">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L729">        }</span>
<span class="fc" id="L730">    }</span>

    @Test
    public void testSetRowVector() {
<span class="fc" id="L734">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L735">        RealVector mRow3 = new ArrayRealVector(subRow3[0]);</span>
<span class="fc" id="L736">        Assert.assertNotSame(mRow3, m.getRowMatrix(0));</span>
<span class="fc" id="L737">        m.setRowVector(0, mRow3);</span>
<span class="fc" id="L738">        Assert.assertEquals(mRow3, m.getRowVector(0));</span>
        try {
<span class="nc" id="L740">            m.setRowVector(-1, mRow3);</span>
<span class="nc" id="L741">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L742">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L744">        }</span>
        try {
<span class="nc" id="L746">            m.setRowVector(0, new ArrayRealVector(5));</span>
<span class="nc" id="L747">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L748">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L750">        }</span>
<span class="fc" id="L751">    }</span>

    @Test
    public void testGetColumnVector() {
<span class="fc" id="L755">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L756">        RealVector mColumn1 = columnToVector(subColumn1);</span>
<span class="fc" id="L757">        RealVector mColumn3 = columnToVector(subColumn3);</span>
<span class="fc" id="L758">        Assert.assertEquals(&quot;Column1&quot;, mColumn1, m.getColumnVector(1));</span>
<span class="fc" id="L759">        Assert.assertEquals(&quot;Column3&quot;, mColumn3, m.getColumnVector(3));</span>
        try {
<span class="nc" id="L761">            m.getColumnVector(-1);</span>
<span class="nc" id="L762">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L763">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L765">        }</span>
        try {
<span class="nc" id="L767">            m.getColumnVector(4);</span>
<span class="nc" id="L768">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L769">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L771">        }</span>
<span class="fc" id="L772">    }</span>

    @Test
    public void testSetColumnVector() {
<span class="fc" id="L776">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L777">        RealVector mColumn3 = columnToVector(subColumn3);</span>
<span class="fc" id="L778">        Assert.assertNotSame(mColumn3, m.getColumnVector(1));</span>
<span class="fc" id="L779">        m.setColumnVector(1, mColumn3);</span>
<span class="fc" id="L780">        Assert.assertEquals(mColumn3, m.getColumnVector(1));</span>
        try {
<span class="nc" id="L782">            m.setColumnVector(-1, mColumn3);</span>
<span class="nc" id="L783">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L784">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L786">        }</span>
        try {
<span class="nc" id="L788">            m.setColumnVector(0, new ArrayRealVector(5));</span>
<span class="nc" id="L789">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L790">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L792">        }</span>
<span class="fc" id="L793">    }</span>

    private RealVector columnToVector(double[][] column) {
<span class="fc" id="L796">        double[] data = new double[column.length];</span>
<span class="fc bfc" id="L797" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc" id="L798">            data[i] = column[i][0];</span>
        }
<span class="fc" id="L800">        return new ArrayRealVector(data, false);</span>
    }

    @Test
    public void testGetRow() {
<span class="fc" id="L805">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L806">        checkArrays(subRow0[0], m.getRow(0));</span>
<span class="fc" id="L807">        checkArrays(subRow3[0], m.getRow(3));</span>
        try {
<span class="nc" id="L809">            m.getRow(-1);</span>
<span class="nc" id="L810">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L811">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L813">        }</span>
        try {
<span class="nc" id="L815">            m.getRow(4);</span>
<span class="nc" id="L816">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L817">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L819">        }</span>
<span class="fc" id="L820">    }</span>

    @Test
    public void testSetRow() {
<span class="fc" id="L824">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="pc bpc" id="L825" title="1 of 2 branches missed.">        Assert.assertTrue(subRow3[0][0] != m.getRow(0)[0]);</span>
<span class="fc" id="L826">        m.setRow(0, subRow3[0]);</span>
<span class="fc" id="L827">        checkArrays(subRow3[0], m.getRow(0));</span>
        try {
<span class="nc" id="L829">            m.setRow(-1, subRow3[0]);</span>
<span class="nc" id="L830">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L831">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L833">        }</span>
        try {
<span class="nc" id="L835">            m.setRow(0, new double[5]);</span>
<span class="nc" id="L836">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L837">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L839">        }</span>
<span class="fc" id="L840">    }</span>

    @Test
    public void testGetColumn() {
<span class="fc" id="L844">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L845">        double[] mColumn1 = columnToArray(subColumn1);</span>
<span class="fc" id="L846">        double[] mColumn3 = columnToArray(subColumn3);</span>
<span class="fc" id="L847">        checkArrays(mColumn1, m.getColumn(1));</span>
<span class="fc" id="L848">        checkArrays(mColumn3, m.getColumn(3));</span>
        try {
<span class="nc" id="L850">            m.getColumn(-1);</span>
<span class="nc" id="L851">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L852">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L854">        }</span>
        try {
<span class="nc" id="L856">            m.getColumn(4);</span>
<span class="nc" id="L857">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L858">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L860">        }</span>
<span class="fc" id="L861">    }</span>

    @Test
    public void testSetColumn() {
<span class="fc" id="L865">        RealMatrix m = new Array2DRowRealMatrix(subTestData);</span>
<span class="fc" id="L866">        double[] mColumn3 = columnToArray(subColumn3);</span>
<span class="pc bpc" id="L867" title="1 of 2 branches missed.">        Assert.assertTrue(mColumn3[0] != m.getColumn(1)[0]);</span>
<span class="fc" id="L868">        m.setColumn(1, mColumn3);</span>
<span class="fc" id="L869">        checkArrays(mColumn3, m.getColumn(1));</span>
        try {
<span class="nc" id="L871">            m.setColumn(-1, mColumn3);</span>
<span class="nc" id="L872">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L873">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L875">        }</span>
        try {
<span class="nc" id="L877">            m.setColumn(0, new double[5]);</span>
<span class="nc" id="L878">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L879">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L881">        }</span>
<span class="fc" id="L882">    }</span>

    private double[] columnToArray(double[][] column) {
<span class="fc" id="L885">        double[] data = new double[column.length];</span>
<span class="fc bfc" id="L886" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc" id="L887">            data[i] = column[i][0];</span>
        }
<span class="fc" id="L889">        return data;</span>
    }

    private void checkArrays(double[] expected, double[] actual) {
<span class="fc" id="L893">        Assert.assertEquals(expected.length, actual.length);</span>
<span class="fc bfc" id="L894" title="All 2 branches covered.">        for (int i = 0; i &lt; expected.length; ++i) {</span>
<span class="fc" id="L895">            Assert.assertEquals(expected[i], actual[i], 0);</span>
        }
<span class="fc" id="L897">    }</span>

    @Test
    public void testEqualsAndHashCode() {
<span class="fc" id="L901">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L902">        Array2DRowRealMatrix m1 = (Array2DRowRealMatrix) m.copy();</span>
<span class="fc" id="L903">        Array2DRowRealMatrix mt = (Array2DRowRealMatrix) m.transpose();</span>
<span class="pc bpc" id="L904" title="1 of 2 branches missed.">        Assert.assertTrue(m.hashCode() != mt.hashCode());</span>
<span class="fc" id="L905">        Assert.assertEquals(m.hashCode(), m1.hashCode());</span>
<span class="fc" id="L906">        Assert.assertEquals(m, m);</span>
<span class="fc" id="L907">        Assert.assertEquals(m, m1);</span>
<span class="fc" id="L908">        Assert.assertFalse(m.equals(null));</span>
<span class="fc" id="L909">        Assert.assertFalse(m.equals(mt));</span>
<span class="fc" id="L910">        Assert.assertFalse(m.equals(new Array2DRowRealMatrix(bigSingular)));</span>
<span class="fc" id="L911">    }</span>

    @Test
    public void testToString() {
<span class="fc" id="L915">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L916">        Assert.assertEquals(&quot;Array2DRowRealMatrix{{1.0,2.0,3.0},{2.0,5.0,3.0},{1.0,0.0,8.0}}&quot;,</span>
<span class="fc" id="L917">                m.toString());</span>
<span class="fc" id="L918">        m = new Array2DRowRealMatrix();</span>
<span class="fc" id="L919">        Assert.assertEquals(&quot;Array2DRowRealMatrix{}&quot;,</span>
<span class="fc" id="L920">                m.toString());</span>
<span class="fc" id="L921">    }</span>

    @Test
    public void testSetSubMatrix() {
<span class="fc" id="L925">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L926">        m.setSubMatrix(detData2,1,1);</span>
<span class="fc" id="L927">        RealMatrix expected = MatrixUtils.createRealMatrix</span>
<span class="fc" id="L928">            (new double[][] {{1.0,2.0,3.0},{2.0,1.0,3.0},{1.0,2.0,4.0}});</span>
<span class="fc" id="L929">        Assert.assertEquals(expected, m);</span>

<span class="fc" id="L931">        m.setSubMatrix(detData2,0,0);</span>
<span class="fc" id="L932">        expected = MatrixUtils.createRealMatrix</span>
<span class="fc" id="L933">            (new double[][] {{1.0,3.0,3.0},{2.0,4.0,3.0},{1.0,2.0,4.0}});</span>
<span class="fc" id="L934">        Assert.assertEquals(expected, m);</span>

<span class="fc" id="L936">        m.setSubMatrix(testDataPlus2,0,0);</span>
<span class="fc" id="L937">        expected = MatrixUtils.createRealMatrix</span>
<span class="fc" id="L938">            (new double[][] {{3.0,4.0,5.0},{4.0,7.0,5.0},{3.0,2.0,10.0}});</span>
<span class="fc" id="L939">        Assert.assertEquals(expected, m);</span>

        // dimension overflow
        try {
<span class="nc" id="L943">            m.setSubMatrix(testData,1,1);</span>
<span class="nc" id="L944">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L945">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L947">        }</span>
        // dimension underflow
        try {
<span class="nc" id="L950">            m.setSubMatrix(testData,-1,1);</span>
<span class="nc" id="L951">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L952">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L954">        }</span>
        try {
<span class="nc" id="L956">            m.setSubMatrix(testData,1,-1);</span>
<span class="nc" id="L957">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L958">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L960">        }</span>

        // null
        try {
<span class="nc" id="L964">            m.setSubMatrix(null,1,1);</span>
<span class="nc" id="L965">            Assert.fail(&quot;expecting NullArgumentException&quot;);</span>
<span class="fc" id="L966">        } catch (NullArgumentException e) {</span>
            // expected
<span class="nc" id="L968">        }</span>
<span class="fc" id="L969">        Array2DRowRealMatrix m2 = new Array2DRowRealMatrix();</span>
        try {
<span class="nc" id="L971">            m2.setSubMatrix(testData,0,1);</span>
<span class="nc" id="L972">            Assert.fail(&quot;expecting MathIllegalStateException&quot;);</span>
<span class="fc" id="L973">        } catch (MathIllegalStateException e) {</span>
            // expected
<span class="nc" id="L975">        }</span>
        try {
<span class="nc" id="L977">            m2.setSubMatrix(testData,1,0);</span>
<span class="nc" id="L978">            Assert.fail(&quot;expecting MathIllegalStateException&quot;);</span>
<span class="fc" id="L979">        } catch (MathIllegalStateException e) {</span>
            // expected
<span class="nc" id="L981">        }</span>

        // ragged
        try {
<span class="nc" id="L985">            m.setSubMatrix(new double[][] {{1}, {2, 3}}, 0, 0);</span>
<span class="nc" id="L986">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L987">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L989">        }</span>

        // empty
        try {
<span class="nc" id="L993">            m.setSubMatrix(new double[][] {{}}, 0, 0);</span>
<span class="nc" id="L994">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L995">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L997">        }</span>
<span class="fc" id="L998">    }</span>

    @Test
    public void testWalk() {
<span class="fc" id="L1002">        int rows    = 150;</span>
<span class="fc" id="L1003">        int columns = 75;</span>

<span class="fc" id="L1005">        RealMatrix m = new Array2DRowRealMatrix(rows, columns);</span>
<span class="fc" id="L1006">        m.walkInRowOrder(new SetVisitor());</span>
<span class="fc" id="L1007">        GetVisitor getVisitor = new GetVisitor();</span>
<span class="fc" id="L1008">        m.walkInOptimizedOrder(getVisitor);</span>
<span class="fc" id="L1009">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1011">        m = new Array2DRowRealMatrix(rows, columns);</span>
<span class="fc" id="L1012">        m.walkInRowOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1013">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1014">        m.walkInOptimizedOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1015">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1016" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1017">            Assert.assertEquals(0.0, m.getEntry(i, 0), 0);</span>
<span class="fc" id="L1018">            Assert.assertEquals(0.0, m.getEntry(i, columns - 1), 0);</span>
        }
<span class="fc bfc" id="L1020" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1021">            Assert.assertEquals(0.0, m.getEntry(0, j), 0);</span>
<span class="fc" id="L1022">            Assert.assertEquals(0.0, m.getEntry(rows - 1, j), 0);</span>
        }

<span class="fc" id="L1025">        m = new Array2DRowRealMatrix(rows, columns);</span>
<span class="fc" id="L1026">        m.walkInColumnOrder(new SetVisitor());</span>
<span class="fc" id="L1027">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1028">        m.walkInOptimizedOrder(getVisitor);</span>
<span class="fc" id="L1029">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1031">        m = new Array2DRowRealMatrix(rows, columns);</span>
<span class="fc" id="L1032">        m.walkInColumnOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1033">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1034">        m.walkInOptimizedOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1035">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1036" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1037">            Assert.assertEquals(0.0, m.getEntry(i, 0), 0);</span>
<span class="fc" id="L1038">            Assert.assertEquals(0.0, m.getEntry(i, columns - 1), 0);</span>
        }
<span class="fc bfc" id="L1040" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1041">            Assert.assertEquals(0.0, m.getEntry(0, j), 0);</span>
<span class="fc" id="L1042">            Assert.assertEquals(0.0, m.getEntry(rows - 1, j), 0);</span>
        }

<span class="fc" id="L1045">        m = new Array2DRowRealMatrix(rows, columns);</span>
<span class="fc" id="L1046">        m.walkInOptimizedOrder(new SetVisitor());</span>
<span class="fc" id="L1047">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1048">        m.walkInRowOrder(getVisitor);</span>
<span class="fc" id="L1049">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1051">        m = new Array2DRowRealMatrix(rows, columns);</span>
<span class="fc" id="L1052">        m.walkInOptimizedOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1053">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1054">        m.walkInRowOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1055">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1056" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1057">            Assert.assertEquals(0.0, m.getEntry(i, 0), 0);</span>
<span class="fc" id="L1058">            Assert.assertEquals(0.0, m.getEntry(i, columns - 1), 0);</span>
        }
<span class="fc bfc" id="L1060" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1061">            Assert.assertEquals(0.0, m.getEntry(0, j), 0);</span>
<span class="fc" id="L1062">            Assert.assertEquals(0.0, m.getEntry(rows - 1, j), 0);</span>
        }

<span class="fc" id="L1065">        m = new Array2DRowRealMatrix(rows, columns);</span>
<span class="fc" id="L1066">        m.walkInOptimizedOrder(new SetVisitor());</span>
<span class="fc" id="L1067">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1068">        m.walkInColumnOrder(getVisitor);</span>
<span class="fc" id="L1069">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1071">        m = new Array2DRowRealMatrix(rows, columns);</span>
<span class="fc" id="L1072">        m.walkInOptimizedOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1073">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1074">        m.walkInColumnOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1075">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1076" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1077">            Assert.assertEquals(0.0, m.getEntry(i, 0), 0);</span>
<span class="fc" id="L1078">            Assert.assertEquals(0.0, m.getEntry(i, columns - 1), 0);</span>
        }
<span class="fc bfc" id="L1080" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1081">            Assert.assertEquals(0.0, m.getEntry(0, j), 0);</span>
<span class="fc" id="L1082">            Assert.assertEquals(0.0, m.getEntry(rows - 1, j), 0);</span>
        }
<span class="fc" id="L1084">    }</span>

    @Test
    public void testSerial()  {
<span class="fc" id="L1088">        Array2DRowRealMatrix m = new Array2DRowRealMatrix(testData);</span>
<span class="fc" id="L1089">        Assert.assertEquals(m,TestUtils.serializeAndRecover(m));</span>
<span class="fc" id="L1090">    }</span>


    private static class SetVisitor extends DefaultRealMatrixChangingVisitor {
        @Override
        public double visit(int i, int j, double value) {
<span class="fc" id="L1096">            return i + j / 1024.0;</span>
        }
    }

<span class="fc" id="L1100">    private static class GetVisitor extends DefaultRealMatrixPreservingVisitor {</span>
<span class="fc" id="L1101">        private int count = 0;</span>
        @Override
        public void visit(int i, int j, double value) {
<span class="fc" id="L1104">            ++count;</span>
<span class="fc" id="L1105">            Assert.assertEquals(i + j / 1024.0, value, 0.0);</span>
<span class="fc" id="L1106">        }</span>
        public int getCount() {
<span class="fc" id="L1108">            return count;</span>
        }
    }

    //--------------- -----------------Protected methods

    /** extracts the l  and u matrices from compact lu representation */
    protected void splitLU(RealMatrix lu, double[][] lowerData, double[][] upperData) {
<span class="nc bnc" id="L1116" title="All 2 branches missed.">        if (!lu.isSquare()) {</span>
<span class="nc" id="L1117">            throw new NonSquareMatrixException(lu.getRowDimension(), lu.getColumnDimension());</span>
        }
<span class="nc bnc" id="L1119" title="All 2 branches missed.">        if (lowerData.length != lowerData[0].length) {</span>
<span class="nc" id="L1120">            throw new DimensionMismatchException(lowerData.length, lowerData[0].length);</span>
        }
<span class="nc bnc" id="L1122" title="All 2 branches missed.">        if (upperData.length != upperData[0].length) {</span>
<span class="nc" id="L1123">            throw new DimensionMismatchException(upperData.length, upperData[0].length);</span>
        }
<span class="nc bnc" id="L1125" title="All 2 branches missed.">        if (lowerData.length != upperData.length) {</span>
<span class="nc" id="L1126">            throw new DimensionMismatchException(lowerData.length, upperData.length);</span>
        }
<span class="nc bnc" id="L1128" title="All 2 branches missed.">        if (lowerData.length != lu.getRowDimension()) {</span>
<span class="nc" id="L1129">            throw new DimensionMismatchException(lowerData.length, lu.getRowDimension());</span>
        }

<span class="nc" id="L1132">        int n = lu.getRowDimension();</span>
<span class="nc bnc" id="L1133" title="All 2 branches missed.">        for (int i = 0; i &lt; n; i++) {</span>
<span class="nc bnc" id="L1134" title="All 2 branches missed.">            for (int j = 0; j &lt; n; j++) {</span>
<span class="nc bnc" id="L1135" title="All 2 branches missed.">                if (j &lt; i) {</span>
<span class="nc" id="L1136">                    lowerData[i][j] = lu.getEntry(i, j);</span>
<span class="nc" id="L1137">                    upperData[i][j] = 0d;</span>
<span class="nc bnc" id="L1138" title="All 2 branches missed.">                } else if (i == j) {</span>
<span class="nc" id="L1139">                    lowerData[i][j] = 1d;</span>
<span class="nc" id="L1140">                    upperData[i][j] = lu.getEntry(i, j);</span>
                } else {
<span class="nc" id="L1142">                    lowerData[i][j] = 0d;</span>
<span class="nc" id="L1143">                    upperData[i][j] = lu.getEntry(i, j);</span>
                }
            }
        }
<span class="nc" id="L1147">    }</span>

    /** Returns the result of applying the given row permutation to the matrix */
    protected RealMatrix permuteRows(RealMatrix matrix, int[] permutation) {
<span class="nc bnc" id="L1151" title="All 2 branches missed.">        if (!matrix.isSquare()) {</span>
<span class="nc" id="L1152">            throw new NonSquareMatrixException(matrix.getRowDimension(),</span>
<span class="nc" id="L1153">                                               matrix.getColumnDimension());</span>
        }
<span class="nc bnc" id="L1155" title="All 2 branches missed.">        if (matrix.getRowDimension() != permutation.length) {</span>
<span class="nc" id="L1156">            throw new DimensionMismatchException(matrix.getRowDimension(), permutation.length);</span>
        }

<span class="nc" id="L1159">        int n = matrix.getRowDimension();</span>
<span class="nc" id="L1160">        int m = matrix.getColumnDimension();</span>
<span class="nc" id="L1161">        double out[][] = new double[m][n];</span>
<span class="nc bnc" id="L1162" title="All 2 branches missed.">        for (int i = 0; i &lt; n; i++) {</span>
<span class="nc bnc" id="L1163" title="All 2 branches missed.">            for (int j = 0; j &lt; m; j++) {</span>
<span class="nc" id="L1164">                out[i][j] = matrix.getEntry(permutation[i], j);</span>
            }
        }
<span class="nc" id="L1167">        return new Array2DRowRealMatrix(out);</span>
    }

//    /** Useful for debugging */
//    private void dumpMatrix(RealMatrix m) {
//          for (int i = 0; i &lt; m.getRowDimension(); i++) {
//              String os = &quot;&quot;;
//              for (int j = 0; j &lt; m.getColumnDimension(); j++) {
//                  os += m.getEntry(i, j) + &quot; &quot;;
//              }
//              System.out.println(os);
//          }
//    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>