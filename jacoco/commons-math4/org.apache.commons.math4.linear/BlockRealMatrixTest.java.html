<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BlockRealMatrixTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">commons_math4$All_in_commons_math4.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.math4.linear</a> &gt; <span class="el_source">BlockRealMatrixTest.java</span></div><h1>BlockRealMatrixTest.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.math4.linear;

import java.util.Arrays;
import java.util.Random;

import org.junit.Test;
import org.junit.Assert;
import org.apache.commons.math4.TestUtils;
import org.apache.commons.math4.exception.MathIllegalArgumentException;
import org.apache.commons.math4.exception.NoDataException;
import org.apache.commons.math4.exception.NullArgumentException;
import org.apache.commons.math4.exception.NumberIsTooSmallException;
import org.apache.commons.math4.exception.OutOfRangeException;
import org.apache.commons.math4.linear.ArrayRealVector;
import org.apache.commons.math4.linear.BlockRealMatrix;
import org.apache.commons.math4.linear.DefaultRealMatrixChangingVisitor;
import org.apache.commons.math4.linear.DefaultRealMatrixPreservingVisitor;
import org.apache.commons.math4.linear.LUDecomposition;
import org.apache.commons.math4.linear.MatrixDimensionMismatchException;
import org.apache.commons.math4.linear.NonSquareMatrixException;
import org.apache.commons.math4.linear.RealMatrix;
import org.apache.commons.math4.linear.RealVector;
import org.apache.commons.math4.util.FastMath;

/**
 * Test cases for the {@link BlockRealMatrix} class.
 *
 */

<span class="fc" id="L46">public final class BlockRealMatrixTest {</span>

    // 3 x 3 identity matrix
<span class="fc" id="L49">    protected double[][] id = { {1d,0d,0d}, {0d,1d,0d}, {0d,0d,1d} };</span>

    // Test data for group operations
<span class="fc" id="L52">    protected double[][] testData = { {1d,2d,3d}, {2d,5d,3d}, {1d,0d,8d} };</span>
<span class="fc" id="L53">    protected double[][] testDataLU = {{2d, 5d, 3d}, {.5d, -2.5d, 6.5d}, {0.5d, 0.2d, .2d}};</span>
<span class="fc" id="L54">    protected double[][] testDataPlus2 = { {3d,4d,5d}, {4d,7d,5d}, {3d,2d,10d} };</span>
<span class="fc" id="L55">    protected double[][] testDataMinus = { {-1d,-2d,-3d}, {-2d,-5d,-3d},</span>
       {-1d,0d,-8d} };
<span class="fc" id="L57">    protected double[] testDataRow1 = {1d,2d,3d};</span>
<span class="fc" id="L58">    protected double[] testDataCol3 = {3d,3d,8d};</span>
<span class="fc" id="L59">    protected double[][] testDataInv =</span>
        { {-40d,16d,9d}, {13d,-5d,-3d}, {5d,-2d,-1d} };
<span class="fc" id="L61">    protected double[] preMultTest = {8,12,33};</span>
<span class="fc" id="L62">    protected double[][] testData2 ={ {1d,2d,3d}, {2d,5d,3d}};</span>
<span class="fc" id="L63">    protected double[][] testData2T = { {1d,2d}, {2d,5d}, {3d,3d}};</span>
<span class="fc" id="L64">    protected double[][] testDataPlusInv =</span>
        { {-39d,18d,12d}, {15d,0d,0d}, {6d,-2d,7d} };

    // lu decomposition tests
<span class="fc" id="L68">    protected double[][] luData = { {2d,3d,3d}, {0d,5d,7d}, {6d,9d,8d} };</span>
<span class="fc" id="L69">    protected double[][] luDataLUDecomposition = { {6d,9d,8d}, {0d,5d,7d},</span>
            {0.33333333333333,0d,0.33333333333333} };

    // singular matrices
<span class="fc" id="L73">    protected double[][] singular = { {2d,3d}, {2d,3d} };</span>
<span class="fc" id="L74">    protected double[][] bigSingular = {{1d,2d,3d,4d}, {2d,5d,3d,4d},</span>
        {7d,3d,256d,1930d}, {3d,7d,6d,8d}}; // 4th row = 1st + 2nd
<span class="fc" id="L76">    protected double[][] detData = { {1d,2d,3d}, {4d,5d,6d}, {7d,8d,10d} };</span>
<span class="fc" id="L77">    protected double[][] detData2 = { {1d, 3d}, {2d, 4d}};</span>

    // vectors
<span class="fc" id="L80">    protected double[] testVector = {1,2,3};</span>
<span class="fc" id="L81">    protected double[] testVector2 = {1,2,3,4};</span>

    // submatrix accessor tests
<span class="fc" id="L84">    protected double[][] subTestData = {{1, 2, 3, 4}, {1.5, 2.5, 3.5, 4.5},</span>
            {2, 4, 6, 8}, {4, 5, 6, 7}};
    // array selections
<span class="fc" id="L87">    protected double[][] subRows02Cols13 = { {2, 4}, {4, 8}};</span>
<span class="fc" id="L88">    protected double[][] subRows03Cols12 = { {2, 3}, {5, 6}};</span>
<span class="fc" id="L89">    protected double[][] subRows03Cols123 = { {2, 3, 4} , {5, 6, 7}};</span>
    // effective permutations
<span class="fc" id="L91">    protected double[][] subRows20Cols123 = { {4, 6, 8} , {2, 3, 4}};</span>
<span class="fc" id="L92">    protected double[][] subRows31Cols31 = {{7, 5}, {4.5, 2.5}};</span>
    // contiguous ranges
<span class="fc" id="L94">    protected double[][] subRows01Cols23 = {{3,4} , {3.5, 4.5}};</span>
<span class="fc" id="L95">    protected double[][] subRows23Cols00 = {{2} , {4}};</span>
<span class="fc" id="L96">    protected double[][] subRows00Cols33 = {{4}};</span>
    // row matrices
<span class="fc" id="L98">    protected double[][] subRow0 = {{1,2,3,4}};</span>
<span class="fc" id="L99">    protected double[][] subRow3 = {{4,5,6,7}};</span>
    // column matrices
<span class="fc" id="L101">    protected double[][] subColumn1 = {{2}, {2.5}, {4}, {5}};</span>
<span class="fc" id="L102">    protected double[][] subColumn3 = {{4}, {4.5}, {8}, {7}};</span>

    // tolerances
<span class="fc" id="L105">    protected double entryTolerance = 10E-16;</span>
<span class="fc" id="L106">    protected double normTolerance = 10E-14;</span>

    /** test dimensions */
    @Test
    public void testDimensions() {
<span class="fc" id="L111">        BlockRealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L112">        BlockRealMatrix m2 = new BlockRealMatrix(testData2);</span>
<span class="fc" id="L113">        Assert.assertEquals(&quot;testData row dimension&quot;,3,m.getRowDimension());</span>
<span class="fc" id="L114">        Assert.assertEquals(&quot;testData column dimension&quot;,3,m.getColumnDimension());</span>
<span class="fc" id="L115">        Assert.assertTrue(&quot;testData is square&quot;,m.isSquare());</span>
<span class="fc" id="L116">        Assert.assertEquals(&quot;testData2 row dimension&quot;,m2.getRowDimension(),2);</span>
<span class="fc" id="L117">        Assert.assertEquals(&quot;testData2 column dimension&quot;,m2.getColumnDimension(),3);</span>
<span class="pc bpc" id="L118" title="1 of 2 branches missed.">        Assert.assertTrue(&quot;testData2 is not square&quot;,!m2.isSquare());</span>
<span class="fc" id="L119">    }</span>

    /** test copy functions */
    @Test
    public void testCopyFunctions() {
<span class="fc" id="L124">        Random r = new Random(66636328996002l);</span>
<span class="fc" id="L125">        BlockRealMatrix m1 = createRandomMatrix(r, 47, 83);</span>
<span class="fc" id="L126">        BlockRealMatrix m2 = new BlockRealMatrix(m1.getData());</span>
<span class="fc" id="L127">        Assert.assertEquals(m1, m2);</span>
<span class="fc" id="L128">        BlockRealMatrix m3 = new BlockRealMatrix(testData);</span>
<span class="fc" id="L129">        BlockRealMatrix m4 = new BlockRealMatrix(m3.getData());</span>
<span class="fc" id="L130">        Assert.assertEquals(m3, m4);</span>
<span class="fc" id="L131">    }</span>

    /** test add */
    @Test
    public void testAdd() {
<span class="fc" id="L136">        BlockRealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L137">        BlockRealMatrix mInv = new BlockRealMatrix(testDataInv);</span>
<span class="fc" id="L138">        RealMatrix mPlusMInv = m.add(mInv);</span>
<span class="fc" id="L139">        double[][] sumEntries = mPlusMInv.getData();</span>
<span class="fc bfc" id="L140" title="All 2 branches covered.">        for (int row = 0; row &lt; m.getRowDimension(); row++) {</span>
<span class="fc bfc" id="L141" title="All 2 branches covered.">            for (int col = 0; col &lt; m.getColumnDimension(); col++) {</span>
<span class="fc" id="L142">                Assert.assertEquals(&quot;sum entry entry&quot;,</span>
                    testDataPlusInv[row][col],sumEntries[row][col],
                        entryTolerance);
            }
        }
<span class="fc" id="L147">    }</span>

    /** test add failure */
    @Test
    public void testAddFail() {
<span class="fc" id="L152">        BlockRealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L153">        BlockRealMatrix m2 = new BlockRealMatrix(testData2);</span>
        try {
<span class="nc" id="L155">            m.add(m2);</span>
<span class="nc" id="L156">            Assert.fail(&quot;MathIllegalArgumentException expected&quot;);</span>
<span class="fc" id="L157">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L159">        }</span>
<span class="fc" id="L160">    }</span>

    /** test norm */
    @Test
    public void testNorm() {
<span class="fc" id="L165">        BlockRealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L166">        BlockRealMatrix m2 = new BlockRealMatrix(testData2);</span>
<span class="fc" id="L167">        Assert.assertEquals(&quot;testData norm&quot;,14d,m.getNorm(),entryTolerance);</span>
<span class="fc" id="L168">        Assert.assertEquals(&quot;testData2 norm&quot;,7d,m2.getNorm(),entryTolerance);</span>
<span class="fc" id="L169">    }</span>

    /** test Frobenius norm */
    @Test
    public void testFrobeniusNorm() {
<span class="fc" id="L174">        BlockRealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L175">        BlockRealMatrix m2 = new BlockRealMatrix(testData2);</span>
<span class="fc" id="L176">        Assert.assertEquals(&quot;testData Frobenius norm&quot;, FastMath.sqrt(117.0), m.getFrobeniusNorm(), entryTolerance);</span>
<span class="fc" id="L177">        Assert.assertEquals(&quot;testData2 Frobenius norm&quot;, FastMath.sqrt(52.0), m2.getFrobeniusNorm(), entryTolerance);</span>
<span class="fc" id="L178">    }</span>

    /** test m-n = m + -n */
    @Test
    public void testPlusMinus() {
<span class="fc" id="L183">        BlockRealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L184">        BlockRealMatrix m2 = new BlockRealMatrix(testDataInv);</span>
<span class="fc" id="L185">        assertClose(m.subtract(m2), m2.scalarMultiply(-1d).add(m), entryTolerance);</span>
        try {
<span class="nc" id="L187">            m.subtract(new BlockRealMatrix(testData2));</span>
<span class="nc" id="L188">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L189">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L191">        }</span>
<span class="fc" id="L192">    }</span>

    /** test multiply */
    @Test
    public void testMultiply() {
<span class="fc" id="L197">        BlockRealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L198">        BlockRealMatrix mInv = new BlockRealMatrix(testDataInv);</span>
<span class="fc" id="L199">        BlockRealMatrix identity = new BlockRealMatrix(id);</span>
<span class="fc" id="L200">        BlockRealMatrix m2 = new BlockRealMatrix(testData2);</span>
<span class="fc" id="L201">        assertClose(m.multiply(mInv), identity, entryTolerance);</span>
<span class="fc" id="L202">        assertClose(mInv.multiply(m), identity, entryTolerance);</span>
<span class="fc" id="L203">        assertClose(m.multiply(identity), m, entryTolerance);</span>
<span class="fc" id="L204">        assertClose(identity.multiply(mInv), mInv, entryTolerance);</span>
<span class="fc" id="L205">        assertClose(m2.multiply(identity), m2, entryTolerance);</span>
        try {
<span class="nc" id="L207">            m.multiply(new BlockRealMatrix(bigSingular));</span>
<span class="nc" id="L208">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L209">        } catch (MathIllegalArgumentException ex) {</span>
            // expected
<span class="nc" id="L211">        }</span>
<span class="fc" id="L212">    }</span>

    @Test
    public void testSeveralBlocks() {
<span class="fc" id="L216">        RealMatrix m = new BlockRealMatrix(35, 71);</span>
<span class="fc bfc" id="L217" title="All 2 branches covered.">        for (int i = 0; i &lt; m.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L218" title="All 2 branches covered.">            for (int j = 0; j &lt; m.getColumnDimension(); ++j) {</span>
<span class="fc" id="L219">                m.setEntry(i, j, i + j / 1024.0);</span>
            }
        }

<span class="fc" id="L223">        RealMatrix mT = m.transpose();</span>
<span class="fc" id="L224">        Assert.assertEquals(m.getRowDimension(), mT.getColumnDimension());</span>
<span class="fc" id="L225">        Assert.assertEquals(m.getColumnDimension(), mT.getRowDimension());</span>
<span class="fc bfc" id="L226" title="All 2 branches covered.">        for (int i = 0; i &lt; mT.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L227" title="All 2 branches covered.">            for (int j = 0; j &lt; mT.getColumnDimension(); ++j) {</span>
<span class="fc" id="L228">                Assert.assertEquals(m.getEntry(j, i), mT.getEntry(i, j), 0);</span>
            }
        }

<span class="fc" id="L232">        RealMatrix mPm = m.add(m);</span>
<span class="fc bfc" id="L233" title="All 2 branches covered.">        for (int i = 0; i &lt; mPm.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L234" title="All 2 branches covered.">            for (int j = 0; j &lt; mPm.getColumnDimension(); ++j) {</span>
<span class="fc" id="L235">                Assert.assertEquals(2 * m.getEntry(i, j), mPm.getEntry(i, j), 0);</span>
            }
        }

<span class="fc" id="L239">        RealMatrix mPmMm = mPm.subtract(m);</span>
<span class="fc bfc" id="L240" title="All 2 branches covered.">        for (int i = 0; i &lt; mPmMm.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L241" title="All 2 branches covered.">            for (int j = 0; j &lt; mPmMm.getColumnDimension(); ++j) {</span>
<span class="fc" id="L242">                Assert.assertEquals(m.getEntry(i, j), mPmMm.getEntry(i, j), 0);</span>
            }
        }

<span class="fc" id="L246">        RealMatrix mTm = mT.multiply(m);</span>
<span class="fc bfc" id="L247" title="All 2 branches covered.">        for (int i = 0; i &lt; mTm.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L248" title="All 2 branches covered.">            for (int j = 0; j &lt; mTm.getColumnDimension(); ++j) {</span>
<span class="fc" id="L249">                double sum = 0;</span>
<span class="fc bfc" id="L250" title="All 2 branches covered.">                for (int k = 0; k &lt; mT.getColumnDimension(); ++k) {</span>
<span class="fc" id="L251">                    sum += (k + i / 1024.0) * (k + j / 1024.0);</span>
                }
<span class="fc" id="L253">                Assert.assertEquals(sum, mTm.getEntry(i, j), 0);</span>
            }
        }

<span class="fc" id="L257">        RealMatrix mmT = m.multiply(mT);</span>
<span class="fc bfc" id="L258" title="All 2 branches covered.">        for (int i = 0; i &lt; mmT.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L259" title="All 2 branches covered.">            for (int j = 0; j &lt; mmT.getColumnDimension(); ++j) {</span>
<span class="fc" id="L260">                double sum = 0;</span>
<span class="fc bfc" id="L261" title="All 2 branches covered.">                for (int k = 0; k &lt; m.getColumnDimension(); ++k) {</span>
<span class="fc" id="L262">                    sum += (i + k / 1024.0) * (j + k / 1024.0);</span>
                }
<span class="fc" id="L264">                Assert.assertEquals(sum, mmT.getEntry(i, j), 0);</span>
            }
        }

<span class="fc" id="L268">        RealMatrix sub1 = m.getSubMatrix(2, 9, 5, 20);</span>
<span class="fc bfc" id="L269" title="All 2 branches covered.">        for (int i = 0; i &lt; sub1.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L270" title="All 2 branches covered.">            for (int j = 0; j &lt; sub1.getColumnDimension(); ++j) {</span>
<span class="fc" id="L271">                Assert.assertEquals((i + 2) + (j + 5) / 1024.0, sub1.getEntry(i, j), 0);</span>
            }
        }

<span class="fc" id="L275">        RealMatrix sub2 = m.getSubMatrix(10, 12, 3, 70);</span>
<span class="fc bfc" id="L276" title="All 2 branches covered.">        for (int i = 0; i &lt; sub2.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L277" title="All 2 branches covered.">            for (int j = 0; j &lt; sub2.getColumnDimension(); ++j) {</span>
<span class="fc" id="L278">                Assert.assertEquals((i + 10) + (j + 3) / 1024.0, sub2.getEntry(i, j), 0);</span>
            }
        }

<span class="fc" id="L282">        RealMatrix sub3 = m.getSubMatrix(30, 34, 0, 5);</span>
<span class="fc bfc" id="L283" title="All 2 branches covered.">        for (int i = 0; i &lt; sub3.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L284" title="All 2 branches covered.">            for (int j = 0; j &lt; sub3.getColumnDimension(); ++j) {</span>
<span class="fc" id="L285">                Assert.assertEquals((i + 30) + (j + 0) / 1024.0, sub3.getEntry(i, j), 0);</span>
            }
        }

<span class="fc" id="L289">        RealMatrix sub4 = m.getSubMatrix(30, 32, 62, 65);</span>
<span class="fc bfc" id="L290" title="All 2 branches covered.">        for (int i = 0; i &lt; sub4.getRowDimension(); ++i) {</span>
<span class="fc bfc" id="L291" title="All 2 branches covered.">            for (int j = 0; j &lt; sub4.getColumnDimension(); ++j) {</span>
<span class="fc" id="L292">                Assert.assertEquals((i + 30) + (j + 62) / 1024.0, sub4.getEntry(i, j), 0);</span>
            }
        }

<span class="fc" id="L296">    }</span>

    //Additional Test for BlockRealMatrixTest.testMultiply

<span class="fc" id="L300">    private double[][] d3 = new double[][] {{1,2,3,4},{5,6,7,8}};</span>
<span class="fc" id="L301">    private double[][] d4 = new double[][] {{1},{2},{3},{4}};</span>
<span class="fc" id="L302">    private double[][] d5 = new double[][] {{30},{70}};</span>

    @Test
    public void testMultiply2() {
<span class="fc" id="L306">        RealMatrix m3 = new BlockRealMatrix(d3);</span>
<span class="fc" id="L307">        RealMatrix m4 = new BlockRealMatrix(d4);</span>
<span class="fc" id="L308">        RealMatrix m5 = new BlockRealMatrix(d5);</span>
<span class="fc" id="L309">        assertClose(m3.multiply(m4), m5, entryTolerance);</span>
<span class="fc" id="L310">    }</span>

    /** test trace */
    @Test
    public void testTrace() {
<span class="fc" id="L315">        RealMatrix m = new BlockRealMatrix(id);</span>
<span class="fc" id="L316">        Assert.assertEquals(&quot;identity trace&quot;,3d,m.getTrace(),entryTolerance);</span>
<span class="fc" id="L317">        m = new BlockRealMatrix(testData2);</span>
        try {
<span class="nc" id="L319">            m.getTrace();</span>
<span class="nc" id="L320">            Assert.fail(&quot;Expecting NonSquareMatrixException&quot;);</span>
<span class="fc" id="L321">        } catch (NonSquareMatrixException ex) {</span>
            // ignored
<span class="nc" id="L323">        }</span>
<span class="fc" id="L324">    }</span>

    /** test scalarAdd */
    @Test
    public void testScalarAdd() {
<span class="fc" id="L329">        RealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L330">        assertClose(new BlockRealMatrix(testDataPlus2), m.scalarAdd(2d), entryTolerance);</span>
<span class="fc" id="L331">    }</span>

    /** test operate */
    @Test
    public void testOperate() {
<span class="fc" id="L336">        RealMatrix m = new BlockRealMatrix(id);</span>
<span class="fc" id="L337">        assertClose(testVector, m.operate(testVector), entryTolerance);</span>
<span class="fc" id="L338">        assertClose(testVector, m.operate(new ArrayRealVector(testVector)).toArray(), entryTolerance);</span>
<span class="fc" id="L339">        m = new BlockRealMatrix(bigSingular);</span>
        try {
<span class="nc" id="L341">            m.operate(testVector);</span>
<span class="nc" id="L342">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L343">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L345">        }</span>
<span class="fc" id="L346">    }</span>

    @Test
    public void testOperateLarge() {
<span class="fc" id="L350">        int p = (7 * BlockRealMatrix.BLOCK_SIZE) / 2;</span>
<span class="fc" id="L351">        int q = (5 * BlockRealMatrix.BLOCK_SIZE) / 2;</span>
<span class="fc" id="L352">        int r =  3 * BlockRealMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L353">        Random random = new Random(111007463902334l);</span>
<span class="fc" id="L354">        RealMatrix m1 = createRandomMatrix(random, p, q);</span>
<span class="fc" id="L355">        RealMatrix m2 = createRandomMatrix(random, q, r);</span>
<span class="fc" id="L356">        RealMatrix m1m2 = m1.multiply(m2);</span>
<span class="fc bfc" id="L357" title="All 2 branches covered.">        for (int i = 0; i &lt; r; ++i) {</span>
<span class="fc" id="L358">            checkArrays(m1m2.getColumn(i), m1.operate(m2.getColumn(i)));</span>
        }
<span class="fc" id="L360">    }</span>

    @Test
    public void testOperatePremultiplyLarge() {
<span class="fc" id="L364">        int p = (7 * BlockRealMatrix.BLOCK_SIZE) / 2;</span>
<span class="fc" id="L365">        int q = (5 * BlockRealMatrix.BLOCK_SIZE) / 2;</span>
<span class="fc" id="L366">        int r =  3 * BlockRealMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L367">        Random random = new Random(111007463902334l);</span>
<span class="fc" id="L368">        RealMatrix m1 = createRandomMatrix(random, p, q);</span>
<span class="fc" id="L369">        RealMatrix m2 = createRandomMatrix(random, q, r);</span>
<span class="fc" id="L370">        RealMatrix m1m2 = m1.multiply(m2);</span>
<span class="fc bfc" id="L371" title="All 2 branches covered.">        for (int i = 0; i &lt; p; ++i) {</span>
<span class="fc" id="L372">            checkArrays(m1m2.getRow(i), m2.preMultiply(m1.getRow(i)));</span>
        }
<span class="fc" id="L374">    }</span>

    /** test issue MATH-209 */
    @Test
    public void testMath209() {
<span class="fc" id="L379">        RealMatrix a = new BlockRealMatrix(new double[][] {</span>
                { 1, 2 }, { 3, 4 }, { 5, 6 }
        });
<span class="fc" id="L382">        double[] b = a.operate(new double[] { 1, 1 });</span>
<span class="fc" id="L383">        Assert.assertEquals(a.getRowDimension(), b.length);</span>
<span class="fc" id="L384">        Assert.assertEquals( 3.0, b[0], 1.0e-12);</span>
<span class="fc" id="L385">        Assert.assertEquals( 7.0, b[1], 1.0e-12);</span>
<span class="fc" id="L386">        Assert.assertEquals(11.0, b[2], 1.0e-12);</span>
<span class="fc" id="L387">    }</span>

    /** test transpose */
    @Test
    public void testTranspose() {
<span class="fc" id="L392">        RealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L393">        RealMatrix mIT = new LUDecomposition(m).getSolver().getInverse().transpose();</span>
<span class="fc" id="L394">        RealMatrix mTI = new LUDecomposition(m.transpose()).getSolver().getInverse();</span>
<span class="fc" id="L395">        assertClose(mIT, mTI, normTolerance);</span>
<span class="fc" id="L396">        m = new BlockRealMatrix(testData2);</span>
<span class="fc" id="L397">        RealMatrix mt = new BlockRealMatrix(testData2T);</span>
<span class="fc" id="L398">        assertClose(mt, m.transpose(), normTolerance);</span>
<span class="fc" id="L399">    }</span>

    /** test preMultiply by vector */
    @Test
    public void testPremultiplyVector() {
<span class="fc" id="L404">        RealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L405">        assertClose(m.preMultiply(testVector), preMultTest, normTolerance);</span>
<span class="fc" id="L406">        assertClose(m.preMultiply(new ArrayRealVector(testVector).toArray()),</span>
                    preMultTest, normTolerance);
<span class="fc" id="L408">        m = new BlockRealMatrix(bigSingular);</span>
        try {
<span class="nc" id="L410">            m.preMultiply(testVector);</span>
<span class="nc" id="L411">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L412">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L414">        }</span>
<span class="fc" id="L415">    }</span>

    @Test
    public void testPremultiply() {
<span class="fc" id="L419">        RealMatrix m3 = new BlockRealMatrix(d3);</span>
<span class="fc" id="L420">        RealMatrix m4 = new BlockRealMatrix(d4);</span>
<span class="fc" id="L421">        RealMatrix m5 = new BlockRealMatrix(d5);</span>
<span class="fc" id="L422">        assertClose(m4.preMultiply(m3), m5, entryTolerance);</span>

<span class="fc" id="L424">        BlockRealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L425">        BlockRealMatrix mInv = new BlockRealMatrix(testDataInv);</span>
<span class="fc" id="L426">        BlockRealMatrix identity = new BlockRealMatrix(id);</span>
<span class="fc" id="L427">        assertClose(m.preMultiply(mInv), identity, entryTolerance);</span>
<span class="fc" id="L428">        assertClose(mInv.preMultiply(m), identity, entryTolerance);</span>
<span class="fc" id="L429">        assertClose(m.preMultiply(identity), m, entryTolerance);</span>
<span class="fc" id="L430">        assertClose(identity.preMultiply(mInv), mInv, entryTolerance);</span>
        try {
<span class="nc" id="L432">            m.preMultiply(new BlockRealMatrix(bigSingular));</span>
<span class="nc" id="L433">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L434">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L436">        }</span>
<span class="fc" id="L437">    }</span>

    @Test
    public void testGetVectors() {
<span class="fc" id="L441">        RealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L442">        assertClose(m.getRow(0), testDataRow1, entryTolerance);</span>
<span class="fc" id="L443">        assertClose(m.getColumn(2), testDataCol3, entryTolerance);</span>
        try {
<span class="nc" id="L445">            m.getRow(10);</span>
<span class="nc" id="L446">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L447">        } catch (OutOfRangeException ex) {</span>
            // ignored
<span class="nc" id="L449">        }</span>
        try {
<span class="nc" id="L451">            m.getColumn(-1);</span>
<span class="nc" id="L452">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L453">        } catch (OutOfRangeException ex) {</span>
            // ignored
<span class="nc" id="L455">        }</span>
<span class="fc" id="L456">    }</span>

    @Test
    public void testGetEntry() {
<span class="fc" id="L460">        RealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L461">        Assert.assertEquals(&quot;get entry&quot;,m.getEntry(0,1),2d,entryTolerance);</span>
        try {
<span class="nc" id="L463">            m.getEntry(10, 4);</span>
<span class="nc" id="L464">            Assert.fail (&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L465">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L467">        }</span>
<span class="fc" id="L468">    }</span>

    /** test examples in user guide */
    @Test
    public void testExamples() {
        // Create a real matrix with two rows and three columns
<span class="fc" id="L474">        double[][] matrixData = { {1d,2d,3d}, {2d,5d,3d}};</span>
<span class="fc" id="L475">        RealMatrix m = new BlockRealMatrix(matrixData);</span>
        // One more with three rows, two columns
<span class="fc" id="L477">        double[][] matrixData2 = { {1d,2d}, {2d,5d}, {1d, 7d}};</span>
<span class="fc" id="L478">        RealMatrix n = new BlockRealMatrix(matrixData2);</span>
        // Now multiply m by n
<span class="fc" id="L480">        RealMatrix p = m.multiply(n);</span>
<span class="fc" id="L481">        Assert.assertEquals(2, p.getRowDimension());</span>
<span class="fc" id="L482">        Assert.assertEquals(2, p.getColumnDimension());</span>
        // Invert p
<span class="fc" id="L484">        RealMatrix pInverse = new LUDecomposition(p).getSolver().getInverse();</span>
<span class="fc" id="L485">        Assert.assertEquals(2, pInverse.getRowDimension());</span>
<span class="fc" id="L486">        Assert.assertEquals(2, pInverse.getColumnDimension());</span>

        // Solve example
<span class="fc" id="L489">        double[][] coefficientsData = {{2, 3, -2}, {-1, 7, 6}, {4, -3, -5}};</span>
<span class="fc" id="L490">        RealMatrix coefficients = new BlockRealMatrix(coefficientsData);</span>
<span class="fc" id="L491">        RealVector constants = new ArrayRealVector(new double[]{1, -2, 1}, false);</span>
<span class="fc" id="L492">        RealVector solution = new LUDecomposition(coefficients).getSolver().solve(constants);</span>
<span class="fc" id="L493">        final double cst0 = constants.getEntry(0);</span>
<span class="fc" id="L494">        final double cst1 = constants.getEntry(1);</span>
<span class="fc" id="L495">        final double cst2 = constants.getEntry(2);</span>
<span class="fc" id="L496">        final double sol0 = solution.getEntry(0);</span>
<span class="fc" id="L497">        final double sol1 = solution.getEntry(1);</span>
<span class="fc" id="L498">        final double sol2 = solution.getEntry(2);</span>
<span class="fc" id="L499">        Assert.assertEquals(2 * sol0 + 3 * sol1 -2 * sol2, cst0, 1E-12);</span>
<span class="fc" id="L500">        Assert.assertEquals(-1 * sol0 + 7 * sol1 + 6 * sol2, cst1, 1E-12);</span>
<span class="fc" id="L501">        Assert.assertEquals(4 * sol0 - 3 * sol1 -5 * sol2, cst2, 1E-12);</span>
<span class="fc" id="L502">    }</span>

    // test submatrix accessors
    @Test
    public void testGetSubMatrix() {
<span class="fc" id="L507">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L508">        checkGetSubMatrix(m, subRows23Cols00,  2 , 3 , 0, 0);</span>
<span class="fc" id="L509">        checkGetSubMatrix(m, subRows00Cols33,  0 , 0 , 3, 3);</span>
<span class="fc" id="L510">        checkGetSubMatrix(m, subRows01Cols23,  0 , 1 , 2, 3);</span>
<span class="fc" id="L511">        checkGetSubMatrix(m, subRows02Cols13,  new int[] { 0, 2 }, new int[] { 1, 3 });</span>
<span class="fc" id="L512">        checkGetSubMatrix(m, subRows03Cols12,  new int[] { 0, 3 }, new int[] { 1, 2 });</span>
<span class="fc" id="L513">        checkGetSubMatrix(m, subRows03Cols123, new int[] { 0, 3 }, new int[] { 1, 2, 3 });</span>
<span class="fc" id="L514">        checkGetSubMatrix(m, subRows20Cols123, new int[] { 2, 0 }, new int[] { 1, 2, 3 });</span>
<span class="fc" id="L515">        checkGetSubMatrix(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 });</span>
<span class="fc" id="L516">        checkGetSubMatrix(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 });</span>
<span class="fc" id="L517">        checkGetSubMatrix(m, null,  1, 0, 2, 4);</span>
<span class="fc" id="L518">        checkGetSubMatrix(m, null, -1, 1, 2, 2);</span>
<span class="fc" id="L519">        checkGetSubMatrix(m, null,  1, 0, 2, 2);</span>
<span class="fc" id="L520">        checkGetSubMatrix(m, null,  1, 0, 2, 4);</span>
<span class="fc" id="L521">        checkGetSubMatrix(m, null, new int[] {},    new int[] { 0 });</span>
<span class="fc" id="L522">        checkGetSubMatrix(m, null, new int[] { 0 }, new int[] { 4 });</span>
<span class="fc" id="L523">    }</span>

    private void checkGetSubMatrix(RealMatrix m, double[][] reference,
                                   int startRow, int endRow, int startColumn, int endColumn) {
        try {
<span class="fc" id="L528">            RealMatrix sub = m.getSubMatrix(startRow, endRow, startColumn, endColumn);</span>
<span class="pc bpc" id="L529" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="fc" id="L530">                Assert.assertEquals(new BlockRealMatrix(reference), sub);</span>
            } else {
<span class="nc" id="L532">                Assert.fail(&quot;Expecting OutOfRangeException or NumberIsTooSmallException or NoDataException&quot;);</span>
            }
<span class="fc" id="L534">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L535" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L536">                throw e;</span>
            }
<span class="fc" id="L538">        } catch (NumberIsTooSmallException e) {</span>
<span class="pc bpc" id="L539" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L540">                throw e;</span>
            }
<span class="nc" id="L542">        } catch (NoDataException e) {</span>
<span class="nc bnc" id="L543" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L544">                throw e;</span>
            }
<span class="fc" id="L546">        }</span>
<span class="fc" id="L547">    }</span>

    private void checkGetSubMatrix(RealMatrix m, double[][] reference,
                                   int[] selectedRows, int[] selectedColumns) {
        try {
<span class="fc" id="L552">            RealMatrix sub = m.getSubMatrix(selectedRows, selectedColumns);</span>
<span class="pc bpc" id="L553" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="fc" id="L554">                Assert.assertEquals(new BlockRealMatrix(reference), sub);</span>
            } else {
<span class="nc" id="L556">                Assert.fail(&quot;Expecting OutOfRangeException or NumberIsTooSmallExceptiono r NoDataException&quot;);</span>
            }
<span class="fc" id="L558">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L559" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L560">                throw e;</span>
            }
<span class="nc" id="L562">        } catch (NumberIsTooSmallException e) {</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L564">                throw e;</span>
            }
<span class="fc" id="L566">        } catch (NoDataException e) {</span>
<span class="pc bpc" id="L567" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L568">                throw e;</span>
            }
<span class="pc" id="L570">        }</span>
<span class="fc" id="L571">    }</span>

    @Test
    public void testGetSetMatrixLarge() {
<span class="fc" id="L575">        int n = 3 * BlockRealMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L576">        RealMatrix m = new BlockRealMatrix(n, n);</span>
<span class="fc" id="L577">        RealMatrix sub = new BlockRealMatrix(n - 4, n - 4).scalarAdd(1);</span>

<span class="fc" id="L579">        m.setSubMatrix(sub.getData(), 2, 2);</span>
<span class="fc bfc" id="L580" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L581" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L582" title="All 8 branches covered.">                if ((i &lt; 2) || (i &gt; n - 3) || (j &lt; 2) || (j &gt; n - 3)) {</span>
<span class="fc" id="L583">                    Assert.assertEquals(0.0, m.getEntry(i, j), 0.0);</span>
                } else {
<span class="fc" id="L585">                    Assert.assertEquals(1.0, m.getEntry(i, j), 0.0);</span>
                }
            }
        }
<span class="fc" id="L589">        Assert.assertEquals(sub, m.getSubMatrix(2, n - 3, 2, n - 3));</span>

<span class="fc" id="L591">    }</span>

    @Test
    public void testCopySubMatrix() {
<span class="fc" id="L595">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L596">        checkCopy(m, subRows23Cols00,  2 , 3 , 0, 0);</span>
<span class="fc" id="L597">        checkCopy(m, subRows00Cols33,  0 , 0 , 3, 3);</span>
<span class="fc" id="L598">        checkCopy(m, subRows01Cols23,  0 , 1 , 2, 3);</span>
<span class="fc" id="L599">        checkCopy(m, subRows02Cols13,  new int[] { 0, 2 }, new int[] { 1, 3 });</span>
<span class="fc" id="L600">        checkCopy(m, subRows03Cols12,  new int[] { 0, 3 }, new int[] { 1, 2 });</span>
<span class="fc" id="L601">        checkCopy(m, subRows03Cols123, new int[] { 0, 3 }, new int[] { 1, 2, 3 });</span>
<span class="fc" id="L602">        checkCopy(m, subRows20Cols123, new int[] { 2, 0 }, new int[] { 1, 2, 3 });</span>
<span class="fc" id="L603">        checkCopy(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 });</span>
<span class="fc" id="L604">        checkCopy(m, subRows31Cols31,  new int[] { 3, 1 }, new int[] { 3, 1 });</span>

<span class="fc" id="L606">        checkCopy(m, null,  1, 0, 2, 4);</span>
<span class="fc" id="L607">        checkCopy(m, null, -1, 1, 2, 2);</span>
<span class="fc" id="L608">        checkCopy(m, null,  1, 0, 2, 2);</span>
<span class="fc" id="L609">        checkCopy(m, null,  1, 0, 2, 4);</span>
<span class="fc" id="L610">        checkCopy(m, null, new int[] {},    new int[] { 0 });</span>
<span class="fc" id="L611">        checkCopy(m, null, new int[] { 0 }, new int[] { 4 });</span>
<span class="fc" id="L612">    }</span>

    private void checkCopy(RealMatrix m, double[][] reference,
                           int startRow, int endRow, int startColumn, int endColumn) {
        try {
<span class="fc bfc" id="L617" title="All 2 branches covered.">            double[][] sub = (reference == null) ?</span>
                             new double[1][1] :
                             new double[reference.length][reference[0].length];
<span class="fc" id="L620">            m.copySubMatrix(startRow, endRow, startColumn, endColumn, sub);</span>
<span class="pc bpc" id="L621" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="fc" id="L622">                Assert.assertEquals(new BlockRealMatrix(reference), new BlockRealMatrix(sub));</span>
            } else {
<span class="nc" id="L624">                Assert.fail(&quot;Expecting OutOfRangeException or NumberIsTooSmallException or NoDataException&quot;);</span>
            }
<span class="fc" id="L626">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L627" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L628">                throw e;</span>
            }
<span class="fc" id="L630">        } catch (NumberIsTooSmallException e) {</span>
<span class="pc bpc" id="L631" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L632">                throw e;</span>
            }
<span class="nc" id="L634">        } catch (NoDataException e) {</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L636">                throw e;</span>
            }
<span class="fc" id="L638">        }</span>
<span class="fc" id="L639">    }</span>

    private void checkCopy(RealMatrix m, double[][] reference,
                           int[] selectedRows, int[] selectedColumns) {
        try {
<span class="fc bfc" id="L644" title="All 2 branches covered.">            double[][] sub = (reference == null) ?</span>
                    new double[1][1] :
                    new double[reference.length][reference[0].length];
<span class="fc" id="L647">            m.copySubMatrix(selectedRows, selectedColumns, sub);</span>
<span class="pc bpc" id="L648" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="fc" id="L649">                Assert.assertEquals(new BlockRealMatrix(reference), new BlockRealMatrix(sub));</span>
            } else {
<span class="nc" id="L651">                Assert.fail(&quot;Expecting OutOfRangeException or NumberIsTooSmallException or NoDataException&quot;);</span>
            }
<span class="fc" id="L653">        } catch (OutOfRangeException e) {</span>
<span class="pc bpc" id="L654" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L655">                throw e;</span>
            }
<span class="nc" id="L657">        } catch (NumberIsTooSmallException e) {</span>
<span class="nc bnc" id="L658" title="All 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L659">                throw e;</span>
            }
<span class="fc" id="L661">        } catch (NoDataException e) {</span>
<span class="pc bpc" id="L662" title="1 of 2 branches missed.">            if (reference != null) {</span>
<span class="nc" id="L663">                throw e;</span>
            }
<span class="pc" id="L665">        }</span>
<span class="fc" id="L666">    }</span>

    @Test
    public void testGetRowMatrix() {
<span class="fc" id="L670">        RealMatrix m     = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L671">        RealMatrix mRow0 = new BlockRealMatrix(subRow0);</span>
<span class="fc" id="L672">        RealMatrix mRow3 = new BlockRealMatrix(subRow3);</span>
<span class="fc" id="L673">        Assert.assertEquals(&quot;Row0&quot;, mRow0, m.getRowMatrix(0));</span>
<span class="fc" id="L674">        Assert.assertEquals(&quot;Row3&quot;, mRow3, m.getRowMatrix(3));</span>
        try {
<span class="nc" id="L676">            m.getRowMatrix(-1);</span>
<span class="nc" id="L677">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L678">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L680">        }</span>
        try {
<span class="nc" id="L682">            m.getRowMatrix(4);</span>
<span class="nc" id="L683">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L684">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L686">        }</span>
<span class="fc" id="L687">    }</span>

    @Test
    public void testSetRowMatrix() {
<span class="fc" id="L691">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L692">        RealMatrix mRow3 = new BlockRealMatrix(subRow3);</span>
<span class="fc" id="L693">        Assert.assertNotSame(mRow3, m.getRowMatrix(0));</span>
<span class="fc" id="L694">        m.setRowMatrix(0, mRow3);</span>
<span class="fc" id="L695">        Assert.assertEquals(mRow3, m.getRowMatrix(0));</span>
        try {
<span class="nc" id="L697">            m.setRowMatrix(-1, mRow3);</span>
<span class="nc" id="L698">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L699">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L701">        }</span>
        try {
<span class="nc" id="L703">            m.setRowMatrix(0, m);</span>
<span class="nc" id="L704">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L705">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L707">        }</span>
<span class="fc" id="L708">    }</span>

    @Test
    public void testGetSetRowMatrixLarge() {
<span class="fc" id="L712">        int n = 3 * BlockRealMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L713">        RealMatrix m = new BlockRealMatrix(n, n);</span>
<span class="fc" id="L714">        RealMatrix sub = new BlockRealMatrix(1, n).scalarAdd(1);</span>

<span class="fc" id="L716">        m.setRowMatrix(2, sub);</span>
<span class="fc bfc" id="L717" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L718" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L719" title="All 2 branches covered.">                if (i != 2) {</span>
<span class="fc" id="L720">                    Assert.assertEquals(0.0, m.getEntry(i, j), 0.0);</span>
                } else {
<span class="fc" id="L722">                    Assert.assertEquals(1.0, m.getEntry(i, j), 0.0);</span>
                }
            }
        }
<span class="fc" id="L726">        Assert.assertEquals(sub, m.getRowMatrix(2));</span>
<span class="fc" id="L727">    }</span>

    @Test
    public void testGetColumnMatrix() {
<span class="fc" id="L731">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L732">        RealMatrix mColumn1 = new BlockRealMatrix(subColumn1);</span>
<span class="fc" id="L733">        RealMatrix mColumn3 = new BlockRealMatrix(subColumn3);</span>
<span class="fc" id="L734">        Assert.assertEquals(mColumn1, m.getColumnMatrix(1));</span>
<span class="fc" id="L735">        Assert.assertEquals(mColumn3, m.getColumnMatrix(3));</span>
        try {
<span class="nc" id="L737">            m.getColumnMatrix(-1);</span>
<span class="nc" id="L738">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L739">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L741">        }</span>
        try {
<span class="nc" id="L743">            m.getColumnMatrix(4);</span>
<span class="nc" id="L744">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L745">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L747">        }</span>
<span class="fc" id="L748">    }</span>

    @Test
    public void testSetColumnMatrix() {
<span class="fc" id="L752">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L753">        RealMatrix mColumn3 = new BlockRealMatrix(subColumn3);</span>
<span class="fc" id="L754">        Assert.assertNotSame(mColumn3, m.getColumnMatrix(1));</span>
<span class="fc" id="L755">        m.setColumnMatrix(1, mColumn3);</span>
<span class="fc" id="L756">        Assert.assertEquals(mColumn3, m.getColumnMatrix(1));</span>
        try {
<span class="nc" id="L758">            m.setColumnMatrix(-1, mColumn3);</span>
<span class="nc" id="L759">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L760">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L762">        }</span>
        try {
<span class="nc" id="L764">            m.setColumnMatrix(0, m);</span>
<span class="nc" id="L765">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L766">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L768">        }</span>
<span class="fc" id="L769">    }</span>

    @Test
    public void testGetSetColumnMatrixLarge() {
<span class="fc" id="L773">        int n = 3 * BlockRealMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L774">        RealMatrix m = new BlockRealMatrix(n, n);</span>
<span class="fc" id="L775">        RealMatrix sub = new BlockRealMatrix(n, 1).scalarAdd(1);</span>

<span class="fc" id="L777">        m.setColumnMatrix(2, sub);</span>
<span class="fc bfc" id="L778" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L779" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L780" title="All 2 branches covered.">                if (j != 2) {</span>
<span class="fc" id="L781">                    Assert.assertEquals(0.0, m.getEntry(i, j), 0.0);</span>
                } else {
<span class="fc" id="L783">                    Assert.assertEquals(1.0, m.getEntry(i, j), 0.0);</span>
                }
            }
        }
<span class="fc" id="L787">        Assert.assertEquals(sub, m.getColumnMatrix(2));</span>

<span class="fc" id="L789">    }</span>

    @Test
    public void testGetRowVector() {
<span class="fc" id="L793">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L794">        RealVector mRow0 = new ArrayRealVector(subRow0[0]);</span>
<span class="fc" id="L795">        RealVector mRow3 = new ArrayRealVector(subRow3[0]);</span>
<span class="fc" id="L796">        Assert.assertEquals(mRow0, m.getRowVector(0));</span>
<span class="fc" id="L797">        Assert.assertEquals(mRow3, m.getRowVector(3));</span>
        try {
<span class="nc" id="L799">            m.getRowVector(-1);</span>
<span class="nc" id="L800">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L801">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L803">        }</span>
        try {
<span class="nc" id="L805">            m.getRowVector(4);</span>
<span class="nc" id="L806">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L807">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L809">        }</span>
<span class="fc" id="L810">    }</span>

    @Test
    public void testSetRowVector() {
<span class="fc" id="L814">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L815">        RealVector mRow3 = new ArrayRealVector(subRow3[0]);</span>
<span class="fc" id="L816">        Assert.assertNotSame(mRow3, m.getRowMatrix(0));</span>
<span class="fc" id="L817">        m.setRowVector(0, mRow3);</span>
<span class="fc" id="L818">        Assert.assertEquals(mRow3, m.getRowVector(0));</span>
        try {
<span class="nc" id="L820">            m.setRowVector(-1, mRow3);</span>
<span class="nc" id="L821">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L822">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L824">        }</span>
        try {
<span class="nc" id="L826">            m.setRowVector(0, new ArrayRealVector(5));</span>
<span class="nc" id="L827">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L828">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L830">        }</span>
<span class="fc" id="L831">    }</span>

    @Test
    public void testGetSetRowVectorLarge() {
<span class="fc" id="L835">        int n = 3 * BlockRealMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L836">        RealMatrix m = new BlockRealMatrix(n, n);</span>
<span class="fc" id="L837">        RealVector sub = new ArrayRealVector(n, 1.0);</span>

<span class="fc" id="L839">        m.setRowVector(2, sub);</span>
<span class="fc bfc" id="L840" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L841" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L842" title="All 2 branches covered.">                if (i != 2) {</span>
<span class="fc" id="L843">                    Assert.assertEquals(0.0, m.getEntry(i, j), 0.0);</span>
                } else {
<span class="fc" id="L845">                    Assert.assertEquals(1.0, m.getEntry(i, j), 0.0);</span>
                }
            }
        }
<span class="fc" id="L849">        Assert.assertEquals(sub, m.getRowVector(2));</span>
<span class="fc" id="L850">    }</span>

    @Test
    public void testGetColumnVector() {
<span class="fc" id="L854">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L855">        RealVector mColumn1 = columnToVector(subColumn1);</span>
<span class="fc" id="L856">        RealVector mColumn3 = columnToVector(subColumn3);</span>
<span class="fc" id="L857">        Assert.assertEquals(mColumn1, m.getColumnVector(1));</span>
<span class="fc" id="L858">        Assert.assertEquals(mColumn3, m.getColumnVector(3));</span>
        try {
<span class="nc" id="L860">            m.getColumnVector(-1);</span>
<span class="nc" id="L861">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L862">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L864">        }</span>
        try {
<span class="nc" id="L866">            m.getColumnVector(4);</span>
<span class="nc" id="L867">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L868">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L870">        }</span>
<span class="fc" id="L871">    }</span>

    @Test
    public void testSetColumnVector() {
<span class="fc" id="L875">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L876">        RealVector mColumn3 = columnToVector(subColumn3);</span>
<span class="fc" id="L877">        Assert.assertNotSame(mColumn3, m.getColumnVector(1));</span>
<span class="fc" id="L878">        m.setColumnVector(1, mColumn3);</span>
<span class="fc" id="L879">        Assert.assertEquals(mColumn3, m.getColumnVector(1));</span>
        try {
<span class="nc" id="L881">            m.setColumnVector(-1, mColumn3);</span>
<span class="nc" id="L882">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L883">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L885">        }</span>
        try {
<span class="nc" id="L887">            m.setColumnVector(0, new ArrayRealVector(5));</span>
<span class="nc" id="L888">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L889">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L891">        }</span>
<span class="fc" id="L892">    }</span>

    @Test
    public void testGetSetColumnVectorLarge() {
<span class="fc" id="L896">        int n = 3 * BlockRealMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L897">        RealMatrix m = new BlockRealMatrix(n, n);</span>
<span class="fc" id="L898">        RealVector sub = new ArrayRealVector(n, 1.0);</span>

<span class="fc" id="L900">        m.setColumnVector(2, sub);</span>
<span class="fc bfc" id="L901" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L902" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L903" title="All 2 branches covered.">                if (j != 2) {</span>
<span class="fc" id="L904">                    Assert.assertEquals(0.0, m.getEntry(i, j), 0.0);</span>
                } else {
<span class="fc" id="L906">                    Assert.assertEquals(1.0, m.getEntry(i, j), 0.0);</span>
                }
            }
        }
<span class="fc" id="L910">        Assert.assertEquals(sub, m.getColumnVector(2));</span>
<span class="fc" id="L911">    }</span>

    private RealVector columnToVector(double[][] column) {
<span class="fc" id="L914">        double[] data = new double[column.length];</span>
<span class="fc bfc" id="L915" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc" id="L916">            data[i] = column[i][0];</span>
        }
<span class="fc" id="L918">        return new ArrayRealVector(data, false);</span>
    }

    @Test
    public void testGetRow() {
<span class="fc" id="L923">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L924">        checkArrays(subRow0[0], m.getRow(0));</span>
<span class="fc" id="L925">        checkArrays(subRow3[0], m.getRow(3));</span>
        try {
<span class="nc" id="L927">            m.getRow(-1);</span>
<span class="nc" id="L928">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L929">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L931">        }</span>
        try {
<span class="nc" id="L933">            m.getRow(4);</span>
<span class="nc" id="L934">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L935">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L937">        }</span>
<span class="fc" id="L938">    }</span>

    @Test
    public void testSetRow() {
<span class="fc" id="L942">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="pc bpc" id="L943" title="1 of 2 branches missed.">        Assert.assertTrue(subRow3[0][0] != m.getRow(0)[0]);</span>
<span class="fc" id="L944">        m.setRow(0, subRow3[0]);</span>
<span class="fc" id="L945">        checkArrays(subRow3[0], m.getRow(0));</span>
        try {
<span class="nc" id="L947">            m.setRow(-1, subRow3[0]);</span>
<span class="nc" id="L948">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L949">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L951">        }</span>
        try {
<span class="nc" id="L953">            m.setRow(0, new double[5]);</span>
<span class="nc" id="L954">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L955">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L957">        }</span>
<span class="fc" id="L958">    }</span>

    @Test
    public void testGetSetRowLarge() {
<span class="fc" id="L962">        int n = 3 * BlockRealMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L963">        RealMatrix m = new BlockRealMatrix(n, n);</span>
<span class="fc" id="L964">        double[] sub = new double[n];</span>
<span class="fc" id="L965">        Arrays.fill(sub, 1.0);</span>

<span class="fc" id="L967">        m.setRow(2, sub);</span>
<span class="fc bfc" id="L968" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L969" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L970" title="All 2 branches covered.">                if (i != 2) {</span>
<span class="fc" id="L971">                    Assert.assertEquals(0.0, m.getEntry(i, j), 0.0);</span>
                } else {
<span class="fc" id="L973">                    Assert.assertEquals(1.0, m.getEntry(i, j), 0.0);</span>
                }
            }
        }
<span class="fc" id="L977">        checkArrays(sub, m.getRow(2));</span>
<span class="fc" id="L978">    }</span>

    @Test
    public void testGetColumn() {
<span class="fc" id="L982">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L983">        double[] mColumn1 = columnToArray(subColumn1);</span>
<span class="fc" id="L984">        double[] mColumn3 = columnToArray(subColumn3);</span>
<span class="fc" id="L985">        checkArrays(mColumn1, m.getColumn(1));</span>
<span class="fc" id="L986">        checkArrays(mColumn3, m.getColumn(3));</span>
        try {
<span class="nc" id="L988">            m.getColumn(-1);</span>
<span class="nc" id="L989">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L990">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L992">        }</span>
        try {
<span class="nc" id="L994">            m.getColumn(4);</span>
<span class="nc" id="L995">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L996">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L998">        }</span>
<span class="fc" id="L999">    }</span>

    @Test
    public void testSetColumn() {
<span class="fc" id="L1003">        RealMatrix m = new BlockRealMatrix(subTestData);</span>
<span class="fc" id="L1004">        double[] mColumn3 = columnToArray(subColumn3);</span>
<span class="pc bpc" id="L1005" title="1 of 2 branches missed.">        Assert.assertTrue(mColumn3[0] != m.getColumn(1)[0]);</span>
<span class="fc" id="L1006">        m.setColumn(1, mColumn3);</span>
<span class="fc" id="L1007">        checkArrays(mColumn3, m.getColumn(1));</span>
        try {
<span class="nc" id="L1009">            m.setColumn(-1, mColumn3);</span>
<span class="nc" id="L1010">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1011">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L1013">        }</span>
        try {
<span class="nc" id="L1015">            m.setColumn(0, new double[5]);</span>
<span class="nc" id="L1016">            Assert.fail(&quot;Expecting MatrixDimensionMismatchException&quot;);</span>
<span class="fc" id="L1017">        } catch (MatrixDimensionMismatchException ex) {</span>
            // expected
<span class="nc" id="L1019">        }</span>
<span class="fc" id="L1020">    }</span>

    @Test
    public void testGetSetColumnLarge() {
<span class="fc" id="L1024">        int n = 3 * BlockRealMatrix.BLOCK_SIZE;</span>
<span class="fc" id="L1025">        RealMatrix m = new BlockRealMatrix(n, n);</span>
<span class="fc" id="L1026">        double[] sub = new double[n];</span>
<span class="fc" id="L1027">        Arrays.fill(sub, 1.0);</span>

<span class="fc" id="L1029">        m.setColumn(2, sub);</span>
<span class="fc bfc" id="L1030" title="All 2 branches covered.">        for (int i = 0; i &lt; n; ++i) {</span>
<span class="fc bfc" id="L1031" title="All 2 branches covered.">            for (int j = 0; j &lt; n; ++j) {</span>
<span class="fc bfc" id="L1032" title="All 2 branches covered.">                if (j != 2) {</span>
<span class="fc" id="L1033">                    Assert.assertEquals(0.0, m.getEntry(i, j), 0.0);</span>
                } else {
<span class="fc" id="L1035">                    Assert.assertEquals(1.0, m.getEntry(i, j), 0.0);</span>
                }
            }
        }
<span class="fc" id="L1039">        checkArrays(sub, m.getColumn(2));</span>
<span class="fc" id="L1040">    }</span>

    private double[] columnToArray(double[][] column) {
<span class="fc" id="L1043">        double[] data = new double[column.length];</span>
<span class="fc bfc" id="L1044" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc" id="L1045">            data[i] = column[i][0];</span>
        }
<span class="fc" id="L1047">        return data;</span>
    }

    private void checkArrays(double[] expected, double[] actual) {
<span class="fc" id="L1051">        Assert.assertEquals(expected.length, actual.length);</span>
<span class="fc bfc" id="L1052" title="All 2 branches covered.">        for (int i = 0; i &lt; expected.length; ++i) {</span>
<span class="fc" id="L1053">            Assert.assertEquals(expected[i], actual[i], 0);</span>
        }
<span class="fc" id="L1055">    }</span>

    @Test
    public void testEqualsAndHashCode() {
<span class="fc" id="L1059">        BlockRealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L1060">        BlockRealMatrix m1 = m.copy();</span>
<span class="fc" id="L1061">        BlockRealMatrix mt = m.transpose();</span>
<span class="pc bpc" id="L1062" title="1 of 2 branches missed.">        Assert.assertTrue(m.hashCode() != mt.hashCode());</span>
<span class="fc" id="L1063">        Assert.assertEquals(m.hashCode(), m1.hashCode());</span>
<span class="fc" id="L1064">        Assert.assertEquals(m, m);</span>
<span class="fc" id="L1065">        Assert.assertEquals(m, m1);</span>
<span class="fc" id="L1066">        Assert.assertFalse(m.equals(null));</span>
<span class="fc" id="L1067">        Assert.assertFalse(m.equals(mt));</span>
<span class="fc" id="L1068">        Assert.assertFalse(m.equals(new BlockRealMatrix(bigSingular)));</span>
<span class="fc" id="L1069">    }</span>

    @Test
    public void testToString() {
<span class="fc" id="L1073">        BlockRealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L1074">        Assert.assertEquals(&quot;BlockRealMatrix{{1.0,2.0,3.0},{2.0,5.0,3.0},{1.0,0.0,8.0}}&quot;,</span>
<span class="fc" id="L1075">                m.toString());</span>
<span class="fc" id="L1076">    }</span>

    @Test
    public void testSetSubMatrix() {
<span class="fc" id="L1080">        BlockRealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L1081">        m.setSubMatrix(detData2,1,1);</span>
<span class="fc" id="L1082">        RealMatrix expected = new BlockRealMatrix</span>
            (new double[][] {{1.0,2.0,3.0},{2.0,1.0,3.0},{1.0,2.0,4.0}});
<span class="fc" id="L1084">        Assert.assertEquals(expected, m);</span>

<span class="fc" id="L1086">        m.setSubMatrix(detData2,0,0);</span>
<span class="fc" id="L1087">        expected = new BlockRealMatrix</span>
            (new double[][] {{1.0,3.0,3.0},{2.0,4.0,3.0},{1.0,2.0,4.0}});
<span class="fc" id="L1089">        Assert.assertEquals(expected, m);</span>

<span class="fc" id="L1091">        m.setSubMatrix(testDataPlus2,0,0);</span>
<span class="fc" id="L1092">        expected = new BlockRealMatrix</span>
            (new double[][] {{3.0,4.0,5.0},{4.0,7.0,5.0},{3.0,2.0,10.0}});
<span class="fc" id="L1094">        Assert.assertEquals(expected, m);</span>

        // javadoc example
<span class="fc" id="L1097">        BlockRealMatrix matrix = new BlockRealMatrix</span>
            (new double[][] {{1, 2, 3, 4}, {5, 6, 7, 8}, {9, 0, 1 , 2}});
<span class="fc" id="L1099">        matrix.setSubMatrix(new double[][] {{3, 4}, {5, 6}}, 1, 1);</span>
<span class="fc" id="L1100">        expected = new BlockRealMatrix</span>
            (new double[][] {{1, 2, 3, 4}, {5, 3, 4, 8}, {9, 5 ,6, 2}});
<span class="fc" id="L1102">        Assert.assertEquals(expected, matrix);</span>

        // dimension overflow
        try {
<span class="nc" id="L1106">            m.setSubMatrix(testData,1,1);</span>
<span class="nc" id="L1107">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1108">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L1110">        }</span>
        // dimension underflow
        try {
<span class="nc" id="L1113">            m.setSubMatrix(testData,-1,1);</span>
<span class="nc" id="L1114">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1115">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L1117">        }</span>
        try {
<span class="nc" id="L1119">            m.setSubMatrix(testData,1,-1);</span>
<span class="nc" id="L1120">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L1121">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L1123">        }</span>

        // null
        try {
<span class="nc" id="L1127">            m.setSubMatrix(null,1,1);</span>
<span class="nc" id="L1128">            Assert.fail(&quot;expecting NullArgumentException&quot;);</span>
<span class="fc" id="L1129">        } catch (NullArgumentException e) {</span>
            // expected
<span class="nc" id="L1131">        }</span>

        // ragged
        try {
<span class="nc" id="L1135">            m.setSubMatrix(new double[][] {{1}, {2, 3}}, 0, 0);</span>
<span class="nc" id="L1136">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L1137">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L1139">        }</span>

        // empty
        try {
<span class="nc" id="L1143">            m.setSubMatrix(new double[][] {{}}, 0, 0);</span>
<span class="nc" id="L1144">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L1145">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L1147">        }</span>
<span class="fc" id="L1148">    }</span>

    @Test
    public void testWalk() {
<span class="fc" id="L1152">        int rows    = 150;</span>
<span class="fc" id="L1153">        int columns = 75;</span>

<span class="fc" id="L1155">        RealMatrix m = new BlockRealMatrix(rows, columns);</span>
<span class="fc" id="L1156">        m.walkInRowOrder(new SetVisitor());</span>
<span class="fc" id="L1157">        GetVisitor getVisitor = new GetVisitor();</span>
<span class="fc" id="L1158">        m.walkInOptimizedOrder(getVisitor);</span>
<span class="fc" id="L1159">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1161">        m = new BlockRealMatrix(rows, columns);</span>
<span class="fc" id="L1162">        m.walkInRowOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1163">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1164">        m.walkInOptimizedOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1165">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1166" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1167">            Assert.assertEquals(0.0, m.getEntry(i, 0), 0);</span>
<span class="fc" id="L1168">            Assert.assertEquals(0.0, m.getEntry(i, columns - 1), 0);</span>
        }
<span class="fc bfc" id="L1170" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1171">            Assert.assertEquals(0.0, m.getEntry(0, j), 0);</span>
<span class="fc" id="L1172">            Assert.assertEquals(0.0, m.getEntry(rows - 1, j), 0);</span>
        }

<span class="fc" id="L1175">        m = new BlockRealMatrix(rows, columns);</span>
<span class="fc" id="L1176">        m.walkInColumnOrder(new SetVisitor());</span>
<span class="fc" id="L1177">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1178">        m.walkInOptimizedOrder(getVisitor);</span>
<span class="fc" id="L1179">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1181">        m = new BlockRealMatrix(rows, columns);</span>
<span class="fc" id="L1182">        m.walkInColumnOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1183">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1184">        m.walkInOptimizedOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1185">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1186" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1187">            Assert.assertEquals(0.0, m.getEntry(i, 0), 0);</span>
<span class="fc" id="L1188">            Assert.assertEquals(0.0, m.getEntry(i, columns - 1), 0);</span>
        }
<span class="fc bfc" id="L1190" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1191">            Assert.assertEquals(0.0, m.getEntry(0, j), 0);</span>
<span class="fc" id="L1192">            Assert.assertEquals(0.0, m.getEntry(rows - 1, j), 0);</span>
        }

<span class="fc" id="L1195">        m = new BlockRealMatrix(rows, columns);</span>
<span class="fc" id="L1196">        m.walkInOptimizedOrder(new SetVisitor());</span>
<span class="fc" id="L1197">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1198">        m.walkInRowOrder(getVisitor);</span>
<span class="fc" id="L1199">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1201">        m = new BlockRealMatrix(rows, columns);</span>
<span class="fc" id="L1202">        m.walkInOptimizedOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1203">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1204">        m.walkInRowOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1205">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1206" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1207">            Assert.assertEquals(0.0, m.getEntry(i, 0), 0);</span>
<span class="fc" id="L1208">            Assert.assertEquals(0.0, m.getEntry(i, columns - 1), 0);</span>
        }
<span class="fc bfc" id="L1210" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1211">            Assert.assertEquals(0.0, m.getEntry(0, j), 0);</span>
<span class="fc" id="L1212">            Assert.assertEquals(0.0, m.getEntry(rows - 1, j), 0);</span>
        }

<span class="fc" id="L1215">        m = new BlockRealMatrix(rows, columns);</span>
<span class="fc" id="L1216">        m.walkInOptimizedOrder(new SetVisitor());</span>
<span class="fc" id="L1217">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1218">        m.walkInColumnOrder(getVisitor);</span>
<span class="fc" id="L1219">        Assert.assertEquals(rows * columns, getVisitor.getCount());</span>

<span class="fc" id="L1221">        m = new BlockRealMatrix(rows, columns);</span>
<span class="fc" id="L1222">        m.walkInOptimizedOrder(new SetVisitor(), 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1223">        getVisitor = new GetVisitor();</span>
<span class="fc" id="L1224">        m.walkInColumnOrder(getVisitor, 1, rows - 2, 1, columns - 2);</span>
<span class="fc" id="L1225">        Assert.assertEquals((rows - 2) * (columns - 2), getVisitor.getCount());</span>
<span class="fc bfc" id="L1226" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc" id="L1227">            Assert.assertEquals(0.0, m.getEntry(i, 0), 0);</span>
<span class="fc" id="L1228">            Assert.assertEquals(0.0, m.getEntry(i, columns - 1), 0);</span>
        }
<span class="fc bfc" id="L1230" title="All 2 branches covered.">        for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1231">            Assert.assertEquals(0.0, m.getEntry(0, j), 0);</span>
<span class="fc" id="L1232">            Assert.assertEquals(0.0, m.getEntry(rows - 1, j), 0);</span>
        }

<span class="fc" id="L1235">    }</span>

    @Test
    public void testSerial()  {
<span class="fc" id="L1239">        BlockRealMatrix m = new BlockRealMatrix(testData);</span>
<span class="fc" id="L1240">        Assert.assertEquals(m,TestUtils.serializeAndRecover(m));</span>
<span class="fc" id="L1241">    }</span>

    private static class SetVisitor extends DefaultRealMatrixChangingVisitor {
        @Override
        public double visit(int i, int j, double value) {
<span class="fc" id="L1246">            return i + j / 1024.0;</span>
        }
    }

<span class="fc" id="L1250">    private static class GetVisitor extends DefaultRealMatrixPreservingVisitor {</span>
<span class="fc" id="L1251">        private int count = 0;</span>
        @Override
        public void visit(int i, int j, double value) {
<span class="fc" id="L1254">            ++count;</span>
<span class="fc" id="L1255">            Assert.assertEquals(i + j / 1024.0, value, 0.0);</span>
<span class="fc" id="L1256">        }</span>
        public int getCount() {
<span class="fc" id="L1258">            return count;</span>
        }
    }

    //--------------- -----------------Protected methods

    /** verifies that two matrices are close (1-norm) */
    protected void assertClose(RealMatrix m, RealMatrix n, double tolerance) {
<span class="pc bpc" id="L1266" title="1 of 2 branches missed.">        Assert.assertTrue(m.subtract(n).getNorm() &lt; tolerance);</span>
<span class="fc" id="L1267">    }</span>

    /** verifies that two vectors are close (sup norm) */
    protected void assertClose(double[] m, double[] n, double tolerance) {
<span class="pc bpc" id="L1271" title="1 of 2 branches missed.">        if (m.length != n.length) {</span>
<span class="nc" id="L1272">            Assert.fail(&quot;vectors not same length&quot;);</span>
        }
<span class="fc bfc" id="L1274" title="All 2 branches covered.">        for (int i = 0; i &lt; m.length; i++) {</span>
<span class="fc" id="L1275">            Assert.assertEquals(m[i], n[i], tolerance);</span>
        }
<span class="fc" id="L1277">    }</span>

    private BlockRealMatrix createRandomMatrix(Random r, int rows, int columns) {
<span class="fc" id="L1280">        BlockRealMatrix m = new BlockRealMatrix(rows, columns);</span>
<span class="fc bfc" id="L1281" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; ++i) {</span>
<span class="fc bfc" id="L1282" title="All 2 branches covered.">            for (int j = 0; j &lt; columns; ++j) {</span>
<span class="fc" id="L1283">                m.setEntry(i, j, 200 * r.nextDouble() - 100);</span>
            }
        }
<span class="fc" id="L1286">        return m;</span>
    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>