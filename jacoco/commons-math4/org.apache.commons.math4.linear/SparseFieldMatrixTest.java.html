<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SparseFieldMatrixTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">commons_math4$All_in_commons_math4.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.math4.linear</a> &gt; <span class="el_source">SparseFieldMatrixTest.java</span></div><h1>SparseFieldMatrixTest.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.math4.linear;

import org.junit.Test;
import org.junit.Assert;
import org.apache.commons.math4.Field;
import org.apache.commons.math4.exception.MathIllegalArgumentException;
import org.apache.commons.math4.exception.NoDataException;
import org.apache.commons.math4.exception.NullArgumentException;
import org.apache.commons.math4.exception.NumberIsTooSmallException;
import org.apache.commons.math4.exception.OutOfRangeException;
import org.apache.commons.math4.fraction.Fraction;
import org.apache.commons.math4.fraction.FractionConversionException;
import org.apache.commons.math4.fraction.FractionField;
import org.apache.commons.math4.linear.Array2DRowFieldMatrix;
import org.apache.commons.math4.linear.ArrayFieldVector;
import org.apache.commons.math4.linear.FieldLUDecomposition;
import org.apache.commons.math4.linear.FieldMatrix;
import org.apache.commons.math4.linear.FieldVector;
import org.apache.commons.math4.linear.NonSquareMatrixException;
import org.apache.commons.math4.linear.SparseFieldMatrix;

/**
 * Test cases for the {@link SparseFieldMatrix} class.
 *
 */
public class SparseFieldMatrixTest {
    // 3 x 3 identity matrix
<span class="fc" id="L44">    protected Fraction[][] id = { {new Fraction(1), new Fraction(0), new Fraction(0) }, { new Fraction(0), new Fraction(1), new Fraction(0) }, { new Fraction(0), new Fraction(0), new Fraction(1) } };</span>
    // Test data for group operations
<span class="fc" id="L46">    protected Fraction[][] testData = { { new Fraction(1), new Fraction(2), new Fraction(3) }, { new Fraction(2), new Fraction(5), new Fraction(3) },</span>
            { new Fraction(1), new Fraction(0), new Fraction(8) } };
<span class="fc" id="L48">    protected Fraction[][] testDataLU = null;</span>
<span class="fc" id="L49">    protected Fraction[][] testDataPlus2 = { { new Fraction(3), new Fraction(4), new Fraction(5) }, { new Fraction(4), new Fraction(7), new Fraction(5) },</span>
            { new Fraction(3), new Fraction(2), new Fraction(10) } };
<span class="fc" id="L51">    protected Fraction[][] testDataMinus = { { new Fraction(-1), new Fraction(-2), new Fraction(-3) },</span>
            { new Fraction(-2), new Fraction(-5), new Fraction(-3) }, { new Fraction(-1), new Fraction(0), new Fraction(-8) } };
<span class="fc" id="L53">    protected Fraction[] testDataRow1 = { new Fraction(1), new Fraction(2), new Fraction(3) };</span>
<span class="fc" id="L54">    protected Fraction[] testDataCol3 = { new Fraction(3), new Fraction(3), new Fraction(8) };</span>
<span class="fc" id="L55">    protected Fraction[][] testDataInv = { { new Fraction(-40), new Fraction(16), new Fraction(9) }, { new Fraction(13), new Fraction(-5), new Fraction(-3) },</span>
            { new Fraction(5), new Fraction(-2), new Fraction(-1) } };
<span class="fc" id="L57">    protected Fraction[] preMultTest = { new Fraction(8), new Fraction(12), new Fraction(33) };</span>
<span class="fc" id="L58">    protected Fraction[][] testData2 = { { new Fraction(1), new Fraction(2), new Fraction(3) }, { new Fraction(2), new Fraction(5), new Fraction(3) } };</span>
<span class="fc" id="L59">    protected Fraction[][] testData2T = { { new Fraction(1), new Fraction(2) }, { new Fraction(2), new Fraction(5) }, { new Fraction(3), new Fraction(3) } };</span>
<span class="fc" id="L60">    protected Fraction[][] testDataPlusInv = { { new Fraction(-39), new Fraction(18), new Fraction(12) },</span>
            { new Fraction(15), new Fraction(0), new Fraction(0) }, { new Fraction(6), new Fraction(-2), new Fraction(7) } };

    // lu decomposition tests
<span class="fc" id="L64">    protected Fraction[][] luData = { { new Fraction(2), new Fraction(3), new Fraction(3) }, { new Fraction(0), new Fraction(5), new Fraction(7) }, { new Fraction(6), new Fraction(9), new Fraction(8) } };</span>
<span class="fc" id="L65">    protected Fraction[][] luDataLUDecomposition = null;</span>

    // singular matrices
<span class="fc" id="L68">    protected Fraction[][] singular = { { new Fraction(2), new Fraction(3) }, { new Fraction(2), new Fraction(3) } };</span>
<span class="fc" id="L69">    protected Fraction[][] bigSingular = { { new Fraction(1), new Fraction(2), new Fraction(3), new Fraction(4) },</span>
            { new Fraction(2), new Fraction(5), new Fraction(3), new Fraction(4) }, { new Fraction(7), new Fraction(3), new Fraction(256), new Fraction(1930) }, { new Fraction(3), new Fraction(7), new Fraction(6), new Fraction(8) } }; // 4th

    // row
    // =
    // 1st
    // +
    // 2nd
<span class="fc" id="L77">    protected Fraction[][] detData = { { new Fraction(1), new Fraction(2), new Fraction(3) }, { new Fraction(4), new Fraction(5), new Fraction(6) },</span>
            { new Fraction(7), new Fraction(8), new Fraction(10) } };
<span class="fc" id="L79">    protected Fraction[][] detData2 = { { new Fraction(1), new Fraction(3) }, { new Fraction(2), new Fraction(4) } };</span>

    // vectors
<span class="fc" id="L82">    protected Fraction[] testVector = { new Fraction(1), new Fraction(2), new Fraction(3) };</span>
<span class="fc" id="L83">    protected Fraction[] testVector2 = { new Fraction(1), new Fraction(2), new Fraction(3), new Fraction(4) };</span>

    // submatrix accessor tests
<span class="fc" id="L86">    protected Fraction[][] subTestData = null;</span>

    // array selections
<span class="fc" id="L89">    protected Fraction[][] subRows02Cols13 = { {new Fraction(2), new Fraction(4) }, { new Fraction(4), new Fraction(8) } };</span>
<span class="fc" id="L90">    protected Fraction[][] subRows03Cols12 = { { new Fraction(2), new Fraction(3) }, { new Fraction(5), new Fraction(6) } };</span>
<span class="fc" id="L91">    protected Fraction[][] subRows03Cols123 = { { new Fraction(2), new Fraction(3), new Fraction(4) }, { new Fraction(5), new Fraction(6), new Fraction(7) } };</span>

    // effective permutations
<span class="fc" id="L94">    protected Fraction[][] subRows20Cols123 = { { new Fraction(4), new Fraction(6), new Fraction(8) }, { new Fraction(2), new Fraction(3), new Fraction(4) } };</span>
<span class="fc" id="L95">    protected Fraction[][] subRows31Cols31 = null;</span>

    // contiguous ranges
<span class="fc" id="L98">    protected Fraction[][] subRows01Cols23 = null;</span>
<span class="fc" id="L99">    protected Fraction[][] subRows23Cols00 = { { new Fraction(2) }, { new Fraction(4) } };</span>
<span class="fc" id="L100">    protected Fraction[][] subRows00Cols33 = { { new Fraction(4) } };</span>

    // row matrices
<span class="fc" id="L103">    protected Fraction[][] subRow0 = { { new Fraction(1), new Fraction(2), new Fraction(3), new Fraction(4) } };</span>
<span class="fc" id="L104">    protected Fraction[][] subRow3 = { { new Fraction(4), new Fraction(5), new Fraction(6), new Fraction(7) } };</span>

    // column matrices
<span class="fc" id="L107">    protected Fraction[][] subColumn1 = null;</span>
<span class="fc" id="L108">    protected Fraction[][] subColumn3 = null;</span>

    // tolerances
<span class="fc" id="L111">    protected double entryTolerance = 10E-16;</span>
<span class="fc" id="L112">    protected double normTolerance = 10E-14;</span>
<span class="fc" id="L113">    protected Field&lt;Fraction&gt; field = FractionField.getInstance();</span>

<span class="fc" id="L115">    public SparseFieldMatrixTest() {</span>
        try {
<span class="fc" id="L117">            testDataLU = new Fraction[][]{ { new Fraction(2), new Fraction(5), new Fraction(3) }, { new Fraction(.5d), new Fraction(-2.5d), new Fraction(6.5d) },</span>
                    { new Fraction(0.5d), new Fraction(0.2d), new Fraction(.2d) } };
<span class="fc" id="L119">            luDataLUDecomposition = new Fraction[][]{ { new Fraction(6), new Fraction(9), new Fraction(8) },</span>
                { new Fraction(0), new Fraction(5), new Fraction(7) }, { new Fraction(0.33333333333333), new Fraction(0), new Fraction(0.33333333333333) } };
<span class="fc" id="L121">            subTestData = new Fraction [][]{ { new Fraction(1), new Fraction(2), new Fraction(3), new Fraction(4) },</span>
                    { new Fraction(1.5), new Fraction(2.5), new Fraction(3.5), new Fraction(4.5) }, { new Fraction(2), new Fraction(4), new Fraction(6), new Fraction(8) }, { new Fraction(4), new Fraction(5), new Fraction(6), new Fraction(7) } };
<span class="fc" id="L123">            subRows31Cols31 = new Fraction[][]{ { new Fraction(7), new Fraction(5) }, { new Fraction(4.5), new Fraction(2.5) } };</span>
<span class="fc" id="L124">            subRows01Cols23 = new Fraction[][]{ { new Fraction(3), new Fraction(4) }, { new Fraction(3.5), new Fraction(4.5) } };</span>
<span class="fc" id="L125">            subColumn1 = new Fraction [][]{ { new Fraction(2) }, { new Fraction(2.5) }, { new Fraction(4) }, { new Fraction(5) } };</span>
<span class="fc" id="L126">            subColumn3 = new Fraction[][]{ { new Fraction(4) }, { new Fraction(4.5) }, { new Fraction(8) }, { new Fraction(7) } };</span>
<span class="nc" id="L127">        } catch (FractionConversionException e) {</span>
            // ignore, can't happen
<span class="fc" id="L129">        }</span>
<span class="fc" id="L130">    }</span>

    /** test dimensions */
    @Test
    public void testDimensions() {
<span class="fc" id="L135">        SparseFieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L136">        SparseFieldMatrix&lt;Fraction&gt; m2 = createSparseMatrix(testData2);</span>
<span class="fc" id="L137">        Assert.assertEquals(&quot;testData row dimension&quot;, 3, m.getRowDimension());</span>
<span class="fc" id="L138">        Assert.assertEquals(&quot;testData column dimension&quot;, 3, m.getColumnDimension());</span>
<span class="fc" id="L139">        Assert.assertTrue(&quot;testData is square&quot;, m.isSquare());</span>
<span class="fc" id="L140">        Assert.assertEquals(&quot;testData2 row dimension&quot;, m2.getRowDimension(), 2);</span>
<span class="fc" id="L141">        Assert.assertEquals(&quot;testData2 column dimension&quot;, m2.getColumnDimension(), 3);</span>
<span class="pc bpc" id="L142" title="1 of 2 branches missed.">        Assert.assertTrue(&quot;testData2 is not square&quot;, !m2.isSquare());</span>
<span class="fc" id="L143">    }</span>

    /** test copy functions */
    @Test
    public void testCopyFunctions() {
<span class="fc" id="L148">        SparseFieldMatrix&lt;Fraction&gt; m1 = createSparseMatrix(testData);</span>
<span class="fc" id="L149">        FieldMatrix&lt;Fraction&gt; m2 = m1.copy();</span>
<span class="fc" id="L150">        Assert.assertEquals(m1.getClass(), m2.getClass());</span>
<span class="fc" id="L151">        Assert.assertEquals((m2), m1);</span>
<span class="fc" id="L152">        SparseFieldMatrix&lt;Fraction&gt; m3 = createSparseMatrix(testData);</span>
<span class="fc" id="L153">        FieldMatrix&lt;Fraction&gt; m4 = m3.copy();</span>
<span class="fc" id="L154">        Assert.assertEquals(m3.getClass(), m4.getClass());</span>
<span class="fc" id="L155">        Assert.assertEquals((m4), m3);</span>
<span class="fc" id="L156">    }</span>

    /** test add */
    @Test
    public void testAdd() {
<span class="fc" id="L161">        SparseFieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L162">        SparseFieldMatrix&lt;Fraction&gt; mInv = createSparseMatrix(testDataInv);</span>
<span class="fc" id="L163">        SparseFieldMatrix&lt;Fraction&gt; mDataPlusInv = createSparseMatrix(testDataPlusInv);</span>
<span class="fc" id="L164">        FieldMatrix&lt;Fraction&gt; mPlusMInv = m.add(mInv);</span>
<span class="fc bfc" id="L165" title="All 2 branches covered.">        for (int row = 0; row &lt; m.getRowDimension(); row++) {</span>
<span class="fc bfc" id="L166" title="All 2 branches covered.">            for (int col = 0; col &lt; m.getColumnDimension(); col++) {</span>
<span class="fc" id="L167">                Assert.assertEquals(&quot;sum entry entry&quot;,</span>
<span class="fc" id="L168">                    mDataPlusInv.getEntry(row, col).doubleValue(), mPlusMInv.getEntry(row, col).doubleValue(),</span>
                    entryTolerance);
            }
        }
<span class="fc" id="L172">    }</span>

    /** test add failure */
    @Test
    public void testAddFail() {
<span class="fc" id="L177">        SparseFieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L178">        SparseFieldMatrix&lt;Fraction&gt; m2 = createSparseMatrix(testData2);</span>
        try {
<span class="nc" id="L180">            m.add(m2);</span>
<span class="nc" id="L181">            Assert.fail(&quot;MathIllegalArgumentException expected&quot;);</span>
<span class="fc" id="L182">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L184">        }</span>
<span class="fc" id="L185">    }</span>


    /** test m-n = m + -n */
    @Test
    public void testPlusMinus() {
<span class="fc" id="L191">        SparseFieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L192">        SparseFieldMatrix&lt;Fraction&gt; n = createSparseMatrix(testDataInv);</span>
<span class="fc" id="L193">        assertClose(&quot;m-n = m + -n&quot;, m.subtract(n),</span>
<span class="fc" id="L194">            n.scalarMultiply(new Fraction(-1)).add(m), entryTolerance);</span>
        try {
<span class="nc" id="L196">            m.subtract(createSparseMatrix(testData2));</span>
<span class="nc" id="L197">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L198">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L200">        }</span>
<span class="fc" id="L201">    }</span>

    /** test multiply */
    @Test
    public void testMultiply() {
<span class="fc" id="L206">        SparseFieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L207">        SparseFieldMatrix&lt;Fraction&gt; mInv = createSparseMatrix(testDataInv);</span>
<span class="fc" id="L208">        SparseFieldMatrix&lt;Fraction&gt; identity = createSparseMatrix(id);</span>
<span class="fc" id="L209">        SparseFieldMatrix&lt;Fraction&gt; m2 = createSparseMatrix(testData2);</span>
<span class="fc" id="L210">        assertClose(&quot;inverse multiply&quot;, m.multiply(mInv), identity,</span>
                entryTolerance);
<span class="fc" id="L212">        assertClose(&quot;inverse multiply&quot;, m.multiply(new Array2DRowFieldMatrix&lt;&gt;(FractionField.getInstance(), testDataInv)), identity,</span>
                    entryTolerance);
<span class="fc" id="L214">        assertClose(&quot;inverse multiply&quot;, mInv.multiply(m), identity,</span>
                entryTolerance);
<span class="fc" id="L216">        assertClose(&quot;identity multiply&quot;, m.multiply(identity), m,</span>
                entryTolerance);
<span class="fc" id="L218">        assertClose(&quot;identity multiply&quot;, identity.multiply(mInv), mInv,</span>
                entryTolerance);
<span class="fc" id="L220">        assertClose(&quot;identity multiply&quot;, m2.multiply(identity), m2,</span>
                entryTolerance);
        try {
<span class="nc" id="L223">            m.multiply(createSparseMatrix(bigSingular));</span>
<span class="nc" id="L224">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L225">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L227">        }</span>
<span class="fc" id="L228">    }</span>

    // Additional Test for Array2DRowRealMatrixTest.testMultiply

<span class="fc" id="L232">    private Fraction[][] d3 = new Fraction[][] { { new Fraction(1), new Fraction(2), new Fraction(3), new Fraction(4) }, { new Fraction(5), new Fraction(6), new Fraction(7), new Fraction(8) } };</span>
<span class="fc" id="L233">    private Fraction[][] d4 = new Fraction[][] { { new Fraction(1) }, { new Fraction(2) }, { new Fraction(3) }, { new Fraction(4) } };</span>
<span class="fc" id="L234">    private Fraction[][] d5 = new Fraction[][] { { new Fraction(30) }, { new Fraction(70) } };</span>

    @Test
    public void testMultiply2() {
<span class="fc" id="L238">        FieldMatrix&lt;Fraction&gt; m3 = createSparseMatrix(d3);</span>
<span class="fc" id="L239">        FieldMatrix&lt;Fraction&gt; m4 = createSparseMatrix(d4);</span>
<span class="fc" id="L240">        FieldMatrix&lt;Fraction&gt; m5 = createSparseMatrix(d5);</span>
<span class="fc" id="L241">        assertClose(&quot;m3*m4=m5&quot;, m3.multiply(m4), m5, entryTolerance);</span>
<span class="fc" id="L242">    }</span>

    /** test trace */
    @Test
    public void testTrace() {
<span class="fc" id="L247">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(id);</span>
<span class="fc" id="L248">        Assert.assertEquals(&quot;identity trace&quot;, 3d, m.getTrace().doubleValue(), entryTolerance);</span>
<span class="fc" id="L249">        m = createSparseMatrix(testData2);</span>
        try {
<span class="nc" id="L251">            m.getTrace();</span>
<span class="nc" id="L252">            Assert.fail(&quot;Expecting NonSquareMatrixException&quot;);</span>
<span class="fc" id="L253">        } catch (NonSquareMatrixException ex) {</span>
            // ignored
<span class="nc" id="L255">        }</span>
<span class="fc" id="L256">    }</span>

    /** test sclarAdd */
    @Test
    public void testScalarAdd() {
<span class="fc" id="L261">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L262">        assertClose(&quot;scalar add&quot;, createSparseMatrix(testDataPlus2),</span>
<span class="fc" id="L263">            m.scalarAdd(new Fraction(2)), entryTolerance);</span>
<span class="fc" id="L264">    }</span>

    /** test operate */
    @Test
    public void testOperate() {
<span class="fc" id="L269">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(id);</span>
<span class="fc" id="L270">        assertClose(&quot;identity operate&quot;, testVector, m.operate(testVector),</span>
                entryTolerance);
<span class="fc" id="L272">        assertClose(&quot;identity operate&quot;, testVector, m.operate(</span>
<span class="fc" id="L273">                new ArrayFieldVector&lt;&gt;(testVector)).toArray(), entryTolerance);</span>
<span class="fc" id="L274">        m = createSparseMatrix(bigSingular);</span>
        try {
<span class="nc" id="L276">            m.operate(testVector);</span>
<span class="nc" id="L277">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L278">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L280">        }</span>
<span class="fc" id="L281">    }</span>

    /** test issue MATH-209 */
    @Test
    public void testMath209() {
<span class="fc" id="L286">        FieldMatrix&lt;Fraction&gt; a = createSparseMatrix(new Fraction[][] {</span>
                { new Fraction(1), new Fraction(2) }, { new Fraction(3), new Fraction(4) }, { new Fraction(5), new Fraction(6) } });
<span class="fc" id="L288">        Fraction[] b = a.operate(new Fraction[] { new Fraction(1), new Fraction(1) });</span>
<span class="fc" id="L289">        Assert.assertEquals(a.getRowDimension(), b.length);</span>
<span class="fc" id="L290">        Assert.assertEquals(3.0, b[0].doubleValue(), 1.0e-12);</span>
<span class="fc" id="L291">        Assert.assertEquals(7.0, b[1].doubleValue(), 1.0e-12);</span>
<span class="fc" id="L292">        Assert.assertEquals(11.0, b[2].doubleValue(), 1.0e-12);</span>
<span class="fc" id="L293">    }</span>

    /** test transpose */
    @Test
    public void testTranspose() {
<span class="fc" id="L298">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L299">        FieldMatrix&lt;Fraction&gt; mIT = new FieldLUDecomposition&lt;&gt;(m).getSolver().getInverse().transpose();</span>
<span class="fc" id="L300">        FieldMatrix&lt;Fraction&gt; mTI = new FieldLUDecomposition&lt;&gt;(m.transpose()).getSolver().getInverse();</span>
<span class="fc" id="L301">        assertClose(&quot;inverse-transpose&quot;, mIT, mTI, normTolerance);</span>
<span class="fc" id="L302">        m = createSparseMatrix(testData2);</span>
<span class="fc" id="L303">        FieldMatrix&lt;Fraction&gt; mt = createSparseMatrix(testData2T);</span>
<span class="fc" id="L304">        assertClose(&quot;transpose&quot;,mt,m.transpose(),normTolerance);</span>
<span class="fc" id="L305">    }</span>

    /** test preMultiply by vector */
    @Test
    public void testPremultiplyVector() {
<span class="fc" id="L310">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L311">        assertClose(&quot;premultiply&quot;, m.preMultiply(testVector), preMultTest,</span>
            normTolerance);
<span class="fc" id="L313">        assertClose(&quot;premultiply&quot;, m.preMultiply(</span>
<span class="fc" id="L314">            new ArrayFieldVector&lt;&gt;(testVector).toArray()), preMultTest, normTolerance);</span>
<span class="fc" id="L315">        m = createSparseMatrix(bigSingular);</span>
        try {
<span class="nc" id="L317">            m.preMultiply(testVector);</span>
<span class="nc" id="L318">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L319">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L321">        }</span>
<span class="fc" id="L322">    }</span>

    @Test
    public void testPremultiply() {
<span class="fc" id="L326">        FieldMatrix&lt;Fraction&gt; m3 = createSparseMatrix(d3);</span>
<span class="fc" id="L327">        FieldMatrix&lt;Fraction&gt; m4 = createSparseMatrix(d4);</span>
<span class="fc" id="L328">        FieldMatrix&lt;Fraction&gt; m5 = createSparseMatrix(d5);</span>
<span class="fc" id="L329">        assertClose(&quot;m3*m4=m5&quot;, m4.preMultiply(m3), m5, entryTolerance);</span>

<span class="fc" id="L331">        SparseFieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L332">        SparseFieldMatrix&lt;Fraction&gt; mInv = createSparseMatrix(testDataInv);</span>
<span class="fc" id="L333">        SparseFieldMatrix&lt;Fraction&gt; identity = createSparseMatrix(id);</span>
<span class="fc" id="L334">        assertClose(&quot;inverse multiply&quot;, m.preMultiply(mInv), identity,</span>
                entryTolerance);
<span class="fc" id="L336">        assertClose(&quot;inverse multiply&quot;, mInv.preMultiply(m), identity,</span>
                entryTolerance);
<span class="fc" id="L338">        assertClose(&quot;identity multiply&quot;, m.preMultiply(identity), m,</span>
                entryTolerance);
<span class="fc" id="L340">        assertClose(&quot;identity multiply&quot;, identity.preMultiply(mInv), mInv,</span>
                entryTolerance);
        try {
<span class="nc" id="L343">            m.preMultiply(createSparseMatrix(bigSingular));</span>
<span class="nc" id="L344">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L345">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L347">        }</span>
<span class="fc" id="L348">    }</span>

    @Test
    public void testGetVectors() {
<span class="fc" id="L352">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L353">        assertClose(&quot;get row&quot;, m.getRow(0), testDataRow1, entryTolerance);</span>
<span class="fc" id="L354">        assertClose(&quot;get col&quot;, m.getColumn(2), testDataCol3, entryTolerance);</span>
        try {
<span class="nc" id="L356">            m.getRow(10);</span>
<span class="nc" id="L357">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L358">        } catch (OutOfRangeException ex) {</span>
            // ignored
<span class="nc" id="L360">        }</span>
        try {
<span class="nc" id="L362">            m.getColumn(-1);</span>
<span class="nc" id="L363">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L364">        } catch (OutOfRangeException ex) {</span>
            // ignored
<span class="nc" id="L366">        }</span>
<span class="fc" id="L367">    }</span>

    @Test
    public void testGetEntry() {
<span class="fc" id="L371">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L372">        Assert.assertEquals(&quot;get entry&quot;, m.getEntry(0, 1).doubleValue(), 2d, entryTolerance);</span>
        try {
<span class="nc" id="L374">            m.getEntry(10, 4);</span>
<span class="nc" id="L375">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L376">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L378">        }</span>
<span class="fc" id="L379">    }</span>

    /** test examples in user guide */
    @Test
    public void testExamples() {
        // Create a real matrix with two rows and three columns
<span class="fc" id="L385">        Fraction[][] matrixData = { { new Fraction(1), new Fraction(2), new Fraction(3) }, { new Fraction(2), new Fraction(5), new Fraction(3) } };</span>
<span class="fc" id="L386">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(matrixData);</span>
        // One more with three rows, two columns
<span class="fc" id="L388">        Fraction[][] matrixData2 = { { new Fraction(1), new Fraction(2) }, { new Fraction(2), new Fraction(5) }, { new Fraction(1), new Fraction(7) } };</span>
<span class="fc" id="L389">        FieldMatrix&lt;Fraction&gt; n = createSparseMatrix(matrixData2);</span>
        // Now multiply m by n
<span class="fc" id="L391">        FieldMatrix&lt;Fraction&gt; p = m.multiply(n);</span>
<span class="fc" id="L392">        Assert.assertEquals(2, p.getRowDimension());</span>
<span class="fc" id="L393">        Assert.assertEquals(2, p.getColumnDimension());</span>
        // Invert p
<span class="fc" id="L395">        FieldMatrix&lt;Fraction&gt; pInverse = new FieldLUDecomposition&lt;&gt;(p).getSolver().getInverse();</span>
<span class="fc" id="L396">        Assert.assertEquals(2, pInverse.getRowDimension());</span>
<span class="fc" id="L397">        Assert.assertEquals(2, pInverse.getColumnDimension());</span>

        // Solve example
<span class="fc" id="L400">        Fraction[][] coefficientsData = { { new Fraction(2), new Fraction(3), new Fraction(-2) }, { new Fraction(-1), new Fraction(7), new Fraction(6) },</span>
                { new Fraction(4), new Fraction(-3), new Fraction(-5) } };
<span class="fc" id="L402">        FieldMatrix&lt;Fraction&gt; coefficients = createSparseMatrix(coefficientsData);</span>
<span class="fc" id="L403">        Fraction[] constants = { new Fraction(1), new Fraction(-2), new Fraction(1) };</span>
        Fraction[] solution;
<span class="fc" id="L405">        solution = new FieldLUDecomposition&lt;&gt;(coefficients)</span>
<span class="fc" id="L406">            .getSolver()</span>
<span class="fc" id="L407">            .solve(new ArrayFieldVector&lt;&gt;(constants, false)).toArray();</span>
<span class="fc" id="L408">        Assert.assertEquals((new Fraction(2).multiply((solution[0])).add(new Fraction(3).multiply(solution[1])).subtract(new Fraction(2).multiply(solution[2]))).doubleValue(),</span>
<span class="fc" id="L409">                constants[0].doubleValue(), 1E-12);</span>
<span class="fc" id="L410">        Assert.assertEquals(((new Fraction(-1).multiply(solution[0])).add(new Fraction(7).multiply(solution[1])).add(new Fraction(6).multiply(solution[2]))).doubleValue(),</span>
<span class="fc" id="L411">                constants[1].doubleValue(), 1E-12);</span>
<span class="fc" id="L412">        Assert.assertEquals(((new Fraction(4).multiply(solution[0])).subtract(new Fraction(3).multiply( solution[1])).subtract(new Fraction(5).multiply(solution[2]))).doubleValue(),</span>
<span class="fc" id="L413">                constants[2].doubleValue(), 1E-12);</span>

<span class="fc" id="L415">    }</span>

    // test submatrix accessors
    @Test
    public void testSubMatrix() {
<span class="fc" id="L420">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(subTestData);</span>
<span class="fc" id="L421">        FieldMatrix&lt;Fraction&gt; mRows23Cols00 = createSparseMatrix(subRows23Cols00);</span>
<span class="fc" id="L422">        FieldMatrix&lt;Fraction&gt; mRows00Cols33 = createSparseMatrix(subRows00Cols33);</span>
<span class="fc" id="L423">        FieldMatrix&lt;Fraction&gt; mRows01Cols23 = createSparseMatrix(subRows01Cols23);</span>
<span class="fc" id="L424">        FieldMatrix&lt;Fraction&gt; mRows02Cols13 = createSparseMatrix(subRows02Cols13);</span>
<span class="fc" id="L425">        FieldMatrix&lt;Fraction&gt; mRows03Cols12 = createSparseMatrix(subRows03Cols12);</span>
<span class="fc" id="L426">        FieldMatrix&lt;Fraction&gt; mRows03Cols123 = createSparseMatrix(subRows03Cols123);</span>
<span class="fc" id="L427">        FieldMatrix&lt;Fraction&gt; mRows20Cols123 = createSparseMatrix(subRows20Cols123);</span>
<span class="fc" id="L428">        FieldMatrix&lt;Fraction&gt; mRows31Cols31 = createSparseMatrix(subRows31Cols31);</span>
<span class="fc" id="L429">        Assert.assertEquals(&quot;Rows23Cols00&quot;, mRows23Cols00, m.getSubMatrix(2, 3, 0, 0));</span>
<span class="fc" id="L430">        Assert.assertEquals(&quot;Rows00Cols33&quot;, mRows00Cols33, m.getSubMatrix(0, 0, 3, 3));</span>
<span class="fc" id="L431">        Assert.assertEquals(&quot;Rows01Cols23&quot;, mRows01Cols23, m.getSubMatrix(0, 1, 2, 3));</span>
<span class="fc" id="L432">        Assert.assertEquals(&quot;Rows02Cols13&quot;, mRows02Cols13,</span>
<span class="fc" id="L433">            m.getSubMatrix(new int[] { 0, 2 }, new int[] { 1, 3 }));</span>
<span class="fc" id="L434">        Assert.assertEquals(&quot;Rows03Cols12&quot;, mRows03Cols12,</span>
<span class="fc" id="L435">            m.getSubMatrix(new int[] { 0, 3 }, new int[] { 1, 2 }));</span>
<span class="fc" id="L436">        Assert.assertEquals(&quot;Rows03Cols123&quot;, mRows03Cols123,</span>
<span class="fc" id="L437">            m.getSubMatrix(new int[] { 0, 3 }, new int[] { 1, 2, 3 }));</span>
<span class="fc" id="L438">        Assert.assertEquals(&quot;Rows20Cols123&quot;, mRows20Cols123,</span>
<span class="fc" id="L439">            m.getSubMatrix(new int[] { 2, 0 }, new int[] { 1, 2, 3 }));</span>
<span class="fc" id="L440">        Assert.assertEquals(&quot;Rows31Cols31&quot;, mRows31Cols31,</span>
<span class="fc" id="L441">            m.getSubMatrix(new int[] { 3, 1 }, new int[] { 3, 1 }));</span>
<span class="fc" id="L442">        Assert.assertEquals(&quot;Rows31Cols31&quot;, mRows31Cols31,</span>
<span class="fc" id="L443">            m.getSubMatrix(new int[] { 3, 1 }, new int[] { 3, 1 }));</span>

        try {
<span class="nc" id="L446">            m.getSubMatrix(1, 0, 2, 4);</span>
<span class="nc" id="L447">            Assert.fail(&quot;Expecting NumberIsTooSmallException&quot;);</span>
<span class="fc" id="L448">        } catch (NumberIsTooSmallException ex) {</span>
            // expected
<span class="nc" id="L450">        }</span>
        try {
<span class="nc" id="L452">            m.getSubMatrix(-1, 1, 2, 2);</span>
<span class="nc" id="L453">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L454">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L456">        }</span>
        try {
<span class="nc" id="L458">            m.getSubMatrix(1, 0, 2, 2);</span>
<span class="nc" id="L459">            Assert.fail(&quot;Expecting NumberIsTooSmallException&quot;);</span>
<span class="fc" id="L460">        } catch (NumberIsTooSmallException ex) {</span>
            // expected
<span class="nc" id="L462">        }</span>
        try {
<span class="nc" id="L464">            m.getSubMatrix(1, 0, 2, 4);</span>
<span class="nc" id="L465">            Assert.fail(&quot;Expecting NumberIsTooSmallException&quot;);</span>
<span class="fc" id="L466">        } catch (NumberIsTooSmallException ex) {</span>
            // expected
<span class="nc" id="L468">        }</span>
        try {
<span class="nc" id="L470">            m.getSubMatrix(new int[] {}, new int[] { 0 });</span>
<span class="nc" id="L471">            Assert.fail(&quot;Expecting NoDataException&quot;);</span>
<span class="fc" id="L472">        } catch (NoDataException ex) {</span>
            // expected
<span class="nc" id="L474">        }</span>
        try {
<span class="nc" id="L476">            m.getSubMatrix(new int[] { 0 }, new int[] { 4 });</span>
<span class="nc" id="L477">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L478">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L480">        }</span>
<span class="fc" id="L481">    }</span>

    @Test
    public void testGetRowMatrix() {
<span class="fc" id="L485">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(subTestData);</span>
<span class="fc" id="L486">        FieldMatrix&lt;Fraction&gt; mRow0 = createSparseMatrix(subRow0);</span>
<span class="fc" id="L487">        FieldMatrix&lt;Fraction&gt; mRow3 = createSparseMatrix(subRow3);</span>
<span class="fc" id="L488">        Assert.assertEquals(&quot;Row0&quot;, mRow0, m.getRowMatrix(0));</span>
<span class="fc" id="L489">        Assert.assertEquals(&quot;Row3&quot;, mRow3, m.getRowMatrix(3));</span>
        try {
<span class="nc" id="L491">            m.getRowMatrix(-1);</span>
<span class="nc" id="L492">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L493">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L495">        }</span>
        try {
<span class="nc" id="L497">            m.getRowMatrix(4);</span>
<span class="nc" id="L498">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L499">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L501">        }</span>
<span class="fc" id="L502">    }</span>

    @Test
    public void testGetColumnMatrix() {
<span class="fc" id="L506">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(subTestData);</span>
<span class="fc" id="L507">        FieldMatrix&lt;Fraction&gt; mColumn1 = createSparseMatrix(subColumn1);</span>
<span class="fc" id="L508">        FieldMatrix&lt;Fraction&gt; mColumn3 = createSparseMatrix(subColumn3);</span>
<span class="fc" id="L509">        Assert.assertEquals(&quot;Column1&quot;, mColumn1, m.getColumnMatrix(1));</span>
<span class="fc" id="L510">        Assert.assertEquals(&quot;Column3&quot;, mColumn3, m.getColumnMatrix(3));</span>
        try {
<span class="nc" id="L512">            m.getColumnMatrix(-1);</span>
<span class="nc" id="L513">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L514">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L516">        }</span>
        try {
<span class="nc" id="L518">            m.getColumnMatrix(4);</span>
<span class="nc" id="L519">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L520">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L522">        }</span>
<span class="fc" id="L523">    }</span>

    @Test
    public void testGetRowVector() {
<span class="fc" id="L527">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(subTestData);</span>
<span class="fc" id="L528">        FieldVector&lt;Fraction&gt; mRow0 = new ArrayFieldVector&lt;&gt;(subRow0[0]);</span>
<span class="fc" id="L529">        FieldVector&lt;Fraction&gt; mRow3 = new ArrayFieldVector&lt;&gt;(subRow3[0]);</span>
<span class="fc" id="L530">        Assert.assertEquals(&quot;Row0&quot;, mRow0, m.getRowVector(0));</span>
<span class="fc" id="L531">        Assert.assertEquals(&quot;Row3&quot;, mRow3, m.getRowVector(3));</span>
        try {
<span class="nc" id="L533">            m.getRowVector(-1);</span>
<span class="nc" id="L534">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L535">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L537">        }</span>
        try {
<span class="nc" id="L539">            m.getRowVector(4);</span>
<span class="nc" id="L540">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L541">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L543">        }</span>
<span class="fc" id="L544">    }</span>

    @Test
    public void testGetColumnVector() {
<span class="fc" id="L548">        FieldMatrix&lt;Fraction&gt; m = createSparseMatrix(subTestData);</span>
<span class="fc" id="L549">        FieldVector&lt;Fraction&gt; mColumn1 = columnToVector(subColumn1);</span>
<span class="fc" id="L550">        FieldVector&lt;Fraction&gt; mColumn3 = columnToVector(subColumn3);</span>
<span class="fc" id="L551">        Assert.assertEquals(&quot;Column1&quot;, mColumn1, m.getColumnVector(1));</span>
<span class="fc" id="L552">        Assert.assertEquals(&quot;Column3&quot;, mColumn3, m.getColumnVector(3));</span>
        try {
<span class="nc" id="L554">            m.getColumnVector(-1);</span>
<span class="nc" id="L555">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L556">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L558">        }</span>
        try {
<span class="nc" id="L560">            m.getColumnVector(4);</span>
<span class="nc" id="L561">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L562">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L564">        }</span>
<span class="fc" id="L565">    }</span>

    private FieldVector&lt;Fraction&gt; columnToVector(Fraction[][] column) {
<span class="fc" id="L568">        Fraction[] data = new Fraction[column.length];</span>
<span class="fc bfc" id="L569" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc" id="L570">            data[i] = column[i][0];</span>
        }
<span class="fc" id="L572">        return new ArrayFieldVector&lt;&gt;(data, false);</span>
    }

    @Test
    public void testEqualsAndHashCode() {
<span class="fc" id="L577">        SparseFieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L578">        SparseFieldMatrix&lt;Fraction&gt; m1 = (SparseFieldMatrix&lt;Fraction&gt;) m.copy();</span>
<span class="fc" id="L579">        SparseFieldMatrix&lt;Fraction&gt; mt = (SparseFieldMatrix&lt;Fraction&gt;) m.transpose();</span>
<span class="pc bpc" id="L580" title="1 of 2 branches missed.">        Assert.assertTrue(m.hashCode() != mt.hashCode());</span>
<span class="fc" id="L581">        Assert.assertEquals(m.hashCode(), m1.hashCode());</span>
<span class="fc" id="L582">        Assert.assertEquals(m, m);</span>
<span class="fc" id="L583">        Assert.assertEquals(m, m1);</span>
<span class="fc" id="L584">        Assert.assertFalse(m.equals(null));</span>
<span class="fc" id="L585">        Assert.assertFalse(m.equals(mt));</span>
<span class="fc" id="L586">        Assert.assertFalse(m.equals(createSparseMatrix(bigSingular)));</span>
<span class="fc" id="L587">    }</span>

    /* Disable for now
    @Test
    public void testToString() {
        SparseFieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);
        Assert.assertEquals(&quot;SparseFieldMatrix&lt;Fraction&gt;{{1.0,2.0,3.0},{2.0,5.0,3.0},{1.0,0.0,8.0}}&quot;,
            m.toString());
        m = new SparseFieldMatrix&lt;Fraction&gt;(field, 1, 1);
        Assert.assertEquals(&quot;SparseFieldMatrix&lt;Fraction&gt;{{0.0}}&quot;, m.toString());
    }
    */

    @Test
    public void testSetSubMatrix() {
<span class="fc" id="L602">        SparseFieldMatrix&lt;Fraction&gt; m = createSparseMatrix(testData);</span>
<span class="fc" id="L603">        m.setSubMatrix(detData2, 1, 1);</span>
<span class="fc" id="L604">        FieldMatrix&lt;Fraction&gt; expected = createSparseMatrix(new Fraction[][] {</span>
                { new Fraction(1), new Fraction(2), new Fraction(3) }, { new Fraction(2), new Fraction(1), new Fraction(3) }, { new Fraction(1), new Fraction(2), new Fraction(4) } });
<span class="fc" id="L606">        Assert.assertEquals(expected, m);</span>

<span class="fc" id="L608">        m.setSubMatrix(detData2, 0, 0);</span>
<span class="fc" id="L609">        expected = createSparseMatrix(new Fraction[][] {</span>
                { new Fraction(1), new Fraction(3), new Fraction(3) }, { new Fraction(2), new Fraction(4), new Fraction(3) }, { new Fraction(1), new Fraction(2), new Fraction(4) } });
<span class="fc" id="L611">        Assert.assertEquals(expected, m);</span>

<span class="fc" id="L613">        m.setSubMatrix(testDataPlus2, 0, 0);</span>
<span class="fc" id="L614">        expected = createSparseMatrix(new Fraction[][] {</span>
                { new Fraction(3), new Fraction(4), new Fraction(5) }, { new Fraction(4), new Fraction(7), new Fraction(5) }, { new Fraction(3), new Fraction(2), new Fraction(10) } });
<span class="fc" id="L616">        Assert.assertEquals(expected, m);</span>

        // javadoc example
<span class="fc" id="L619">        SparseFieldMatrix&lt;Fraction&gt; matrix =</span>
<span class="fc" id="L620">            createSparseMatrix(new Fraction[][] {</span>
        { new Fraction(1), new Fraction(2), new Fraction(3), new Fraction(4) }, { new Fraction(5), new Fraction(6), new Fraction(7), new Fraction(8) }, { new Fraction(9), new Fraction(0), new Fraction(1), new Fraction(2) } });
<span class="fc" id="L622">        matrix.setSubMatrix(new Fraction[][] { { new Fraction(3), new Fraction(4) }, { new Fraction(5), new Fraction(6) } }, 1, 1);</span>
<span class="fc" id="L623">        expected = createSparseMatrix(new Fraction[][] {</span>
                { new Fraction(1), new Fraction(2), new Fraction(3), new Fraction(4) }, { new Fraction(5), new Fraction(3), new Fraction(4), new Fraction(8) }, { new Fraction(9), new Fraction(5), new Fraction(6), new Fraction(2) } });
<span class="fc" id="L625">        Assert.assertEquals(expected, matrix);</span>

        // dimension overflow
        try {
<span class="nc" id="L629">            m.setSubMatrix(testData, 1, 1);</span>
<span class="nc" id="L630">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L631">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L633">        }</span>
        // dimension underflow
        try {
<span class="nc" id="L636">            m.setSubMatrix(testData, -1, 1);</span>
<span class="nc" id="L637">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L638">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L640">        }</span>
        try {
<span class="nc" id="L642">            m.setSubMatrix(testData, 1, -1);</span>
<span class="nc" id="L643">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L644">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L646">        }</span>

        // null
        try {
<span class="nc" id="L650">            m.setSubMatrix(null, 1, 1);</span>
<span class="nc" id="L651">            Assert.fail(&quot;expecting NullArgumentException&quot;);</span>
<span class="fc" id="L652">        } catch (NullArgumentException e) {</span>
            // expected
<span class="nc" id="L654">        }</span>
        try {
<span class="nc" id="L656">            new SparseFieldMatrix&lt;&gt;(field, 0, 0);</span>
<span class="nc" id="L657">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L658">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L660">        }</span>

        // ragged
        try {
<span class="nc" id="L664">            m.setSubMatrix(new Fraction[][] { { new Fraction(1) }, { new Fraction(2), new Fraction(3) } }, 0, 0);</span>
<span class="nc" id="L665">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L666">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L668">        }</span>

        // empty
        try {
<span class="nc" id="L672">            m.setSubMatrix(new Fraction[][] { {} }, 0, 0);</span>
<span class="nc" id="L673">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L674">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L676">        }</span>
<span class="fc" id="L677">    }</span>

    // --------------- -----------------Protected methods

    /** verifies that two matrices are close (1-norm) */
    protected void assertClose(String msg, FieldMatrix&lt;Fraction&gt; m, FieldMatrix&lt;Fraction&gt; n,
            double tolerance) {
<span class="fc bfc" id="L684" title="All 2 branches covered.">        for(int i=0; i &lt; m.getRowDimension(); i++){</span>
<span class="fc bfc" id="L685" title="All 2 branches covered.">            for(int j=0; j &lt; m.getColumnDimension(); j++){</span>
<span class="fc" id="L686">                Assert.assertEquals(msg, m.getEntry(i,j).doubleValue(), n.getEntry(i,j).doubleValue(), tolerance);</span>
            }

        }
<span class="fc" id="L690">    }</span>

    /** verifies that two vectors are close (sup norm) */
    protected void assertClose(String msg, Fraction[] m, Fraction[] n,
            double tolerance) {
<span class="pc bpc" id="L695" title="1 of 2 branches missed.">        if (m.length != n.length) {</span>
<span class="nc" id="L696">            Assert.fail(&quot;vectors not same length&quot;);</span>
        }
<span class="fc bfc" id="L698" title="All 2 branches covered.">        for (int i = 0; i &lt; m.length; i++) {</span>
<span class="fc" id="L699">            Assert.assertEquals(msg + &quot; &quot; + i + &quot; elements differ&quot;, m[i].doubleValue(), n[i].doubleValue(),</span>
                    tolerance);
        }
<span class="fc" id="L702">    }</span>

    private SparseFieldMatrix&lt;Fraction&gt; createSparseMatrix(Fraction[][] data) {
<span class="fc" id="L705">        SparseFieldMatrix&lt;Fraction&gt; matrix = new SparseFieldMatrix&lt;&gt;(field, data.length, data[0].length);</span>
<span class="fc bfc" id="L706" title="All 2 branches covered.">        for (int row = 0; row &lt; data.length; row++) {</span>
<span class="fc bfc" id="L707" title="All 2 branches covered.">            for (int col = 0; col &lt; data[row].length; col++) {</span>
<span class="fc" id="L708">                matrix.setEntry(row, col, data[row][col]);</span>
            }
        }
<span class="fc" id="L711">        return matrix;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>