<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SparseRealMatrixTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">commons_math4$All_in_commons_math4.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.math4.linear</a> &gt; <span class="el_source">SparseRealMatrixTest.java</span></div><h1>SparseRealMatrixTest.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.math4.linear;

import org.junit.Test;
import org.junit.Assert;
import org.apache.commons.math4.TestUtils;
import org.apache.commons.math4.exception.MathIllegalArgumentException;
import org.apache.commons.math4.exception.NoDataException;
import org.apache.commons.math4.exception.NullArgumentException;
import org.apache.commons.math4.exception.NumberIsTooSmallException;
import org.apache.commons.math4.exception.OutOfRangeException;
import org.apache.commons.math4.linear.ArrayRealVector;
import org.apache.commons.math4.linear.BlockRealMatrix;
import org.apache.commons.math4.linear.LUDecomposition;
import org.apache.commons.math4.linear.NonSquareMatrixException;
import org.apache.commons.math4.linear.OpenMapRealMatrix;
import org.apache.commons.math4.linear.RealMatrix;
import org.apache.commons.math4.linear.RealVector;

/**
 * Test cases for the {@link OpenMapRealMatrix} class.
 *
 */
<span class="fc" id="L39">public final class SparseRealMatrixTest {</span>

    // 3 x 3 identity matrix
<span class="fc" id="L42">    protected double[][] id = { { 1d, 0d, 0d }, { 0d, 1d, 0d }, { 0d, 0d, 1d } };</span>
    // Test data for group operations
<span class="fc" id="L44">    protected double[][] testData = { { 1d, 2d, 3d }, { 2d, 5d, 3d },</span>
            { 1d, 0d, 8d } };
<span class="fc" id="L46">    protected double[][] testDataLU = { { 2d, 5d, 3d }, { .5d, -2.5d, 6.5d },</span>
            { 0.5d, 0.2d, .2d } };
<span class="fc" id="L48">    protected double[][] testDataPlus2 = { { 3d, 4d, 5d }, { 4d, 7d, 5d },</span>
            { 3d, 2d, 10d } };
<span class="fc" id="L50">    protected double[][] testDataMinus = { { -1d, -2d, -3d },</span>
            { -2d, -5d, -3d }, { -1d, 0d, -8d } };
<span class="fc" id="L52">    protected double[] testDataRow1 = { 1d, 2d, 3d };</span>
<span class="fc" id="L53">    protected double[] testDataCol3 = { 3d, 3d, 8d };</span>
<span class="fc" id="L54">    protected double[][] testDataInv = { { -40d, 16d, 9d }, { 13d, -5d, -3d },</span>
            { 5d, -2d, -1d } };
<span class="fc" id="L56">    protected double[] preMultTest = { 8, 12, 33 };</span>
<span class="fc" id="L57">    protected double[][] testData2 = { { 1d, 2d, 3d }, { 2d, 5d, 3d } };</span>
<span class="fc" id="L58">    protected double[][] testData2T = { { 1d, 2d }, { 2d, 5d }, { 3d, 3d } };</span>
<span class="fc" id="L59">    protected double[][] testDataPlusInv = { { -39d, 18d, 12d },</span>
            { 15d, 0d, 0d }, { 6d, -2d, 7d } };

    // lu decomposition tests
<span class="fc" id="L63">    protected double[][] luData = { { 2d, 3d, 3d }, { 0d, 5d, 7d }, { 6d, 9d, 8d } };</span>
<span class="fc" id="L64">    protected double[][] luDataLUDecomposition = { { 6d, 9d, 8d },</span>
            { 0d, 5d, 7d }, { 0.33333333333333, 0d, 0.33333333333333 } };

    // singular matrices
<span class="fc" id="L68">    protected double[][] singular = { { 2d, 3d }, { 2d, 3d } };</span>
<span class="fc" id="L69">    protected double[][] bigSingular = { { 1d, 2d, 3d, 4d },</span>
            { 2d, 5d, 3d, 4d }, { 7d, 3d, 256d, 1930d }, { 3d, 7d, 6d, 8d } }; // 4th

    // row
    // =
    // 1st
    // +
    // 2nd
<span class="fc" id="L77">    protected double[][] detData = { { 1d, 2d, 3d }, { 4d, 5d, 6d },</span>
            { 7d, 8d, 10d } };
<span class="fc" id="L79">    protected double[][] detData2 = { { 1d, 3d }, { 2d, 4d } };</span>

    // vectors
<span class="fc" id="L82">    protected double[] testVector = { 1, 2, 3 };</span>
<span class="fc" id="L83">    protected double[] testVector2 = { 1, 2, 3, 4 };</span>

    // submatrix accessor tests
<span class="fc" id="L86">    protected double[][] subTestData = { { 1, 2, 3, 4 },</span>
            { 1.5, 2.5, 3.5, 4.5 }, { 2, 4, 6, 8 }, { 4, 5, 6, 7 } };

    // array selections
<span class="fc" id="L90">    protected double[][] subRows02Cols13 = { { 2, 4 }, { 4, 8 } };</span>
<span class="fc" id="L91">    protected double[][] subRows03Cols12 = { { 2, 3 }, { 5, 6 } };</span>
<span class="fc" id="L92">    protected double[][] subRows03Cols123 = { { 2, 3, 4 }, { 5, 6, 7 } };</span>

    // effective permutations
<span class="fc" id="L95">    protected double[][] subRows20Cols123 = { { 4, 6, 8 }, { 2, 3, 4 } };</span>
<span class="fc" id="L96">    protected double[][] subRows31Cols31 = { { 7, 5 }, { 4.5, 2.5 } };</span>

    // contiguous ranges
<span class="fc" id="L99">    protected double[][] subRows01Cols23 = { { 3, 4 }, { 3.5, 4.5 } };</span>
<span class="fc" id="L100">    protected double[][] subRows23Cols00 = { { 2 }, { 4 } };</span>
<span class="fc" id="L101">    protected double[][] subRows00Cols33 = { { 4 } };</span>

    // row matrices
<span class="fc" id="L104">    protected double[][] subRow0 = { { 1, 2, 3, 4 } };</span>
<span class="fc" id="L105">    protected double[][] subRow3 = { { 4, 5, 6, 7 } };</span>

    // column matrices
<span class="fc" id="L108">    protected double[][] subColumn1 = { { 2 }, { 2.5 }, { 4 }, { 5 } };</span>
<span class="fc" id="L109">    protected double[][] subColumn3 = { { 4 }, { 4.5 }, { 8 }, { 7 } };</span>

    // tolerances
<span class="fc" id="L112">    protected double entryTolerance = 10E-16;</span>
<span class="fc" id="L113">    protected double normTolerance = 10E-14;</span>

    /** test dimensions */
    @Test
    public void testDimensions() {
<span class="fc" id="L118">        OpenMapRealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L119">        OpenMapRealMatrix m2 = createSparseMatrix(testData2);</span>
<span class="fc" id="L120">        Assert.assertEquals(&quot;testData row dimension&quot;, 3, m.getRowDimension());</span>
<span class="fc" id="L121">        Assert.assertEquals(&quot;testData column dimension&quot;, 3, m.getColumnDimension());</span>
<span class="fc" id="L122">        Assert.assertTrue(&quot;testData is square&quot;, m.isSquare());</span>
<span class="fc" id="L123">        Assert.assertEquals(&quot;testData2 row dimension&quot;, m2.getRowDimension(), 2);</span>
<span class="fc" id="L124">        Assert.assertEquals(&quot;testData2 column dimension&quot;, m2.getColumnDimension(), 3);</span>
<span class="pc bpc" id="L125" title="1 of 2 branches missed.">        Assert.assertTrue(&quot;testData2 is not square&quot;, !m2.isSquare());</span>
<span class="fc" id="L126">    }</span>

    /** test copy functions */
    @Test
    public void testCopyFunctions() {
<span class="fc" id="L131">        OpenMapRealMatrix m1 = createSparseMatrix(testData);</span>
<span class="fc" id="L132">        RealMatrix m2 = m1.copy();</span>
<span class="fc" id="L133">        Assert.assertEquals(m1.getClass(), m2.getClass());</span>
<span class="fc" id="L134">        Assert.assertEquals((m2), m1);</span>
<span class="fc" id="L135">        OpenMapRealMatrix m3 = createSparseMatrix(testData);</span>
<span class="fc" id="L136">        RealMatrix m4 = m3.copy();</span>
<span class="fc" id="L137">        Assert.assertEquals(m3.getClass(), m4.getClass());</span>
<span class="fc" id="L138">        Assert.assertEquals((m4), m3);</span>
<span class="fc" id="L139">    }</span>

    /** test add */
    @Test
    public void testAdd() {
<span class="fc" id="L144">        OpenMapRealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L145">        OpenMapRealMatrix mInv = createSparseMatrix(testDataInv);</span>
<span class="fc" id="L146">        OpenMapRealMatrix mDataPlusInv = createSparseMatrix(testDataPlusInv);</span>
<span class="fc" id="L147">        RealMatrix mPlusMInv = m.add(mInv);</span>
<span class="fc bfc" id="L148" title="All 2 branches covered.">        for (int row = 0; row &lt; m.getRowDimension(); row++) {</span>
<span class="fc bfc" id="L149" title="All 2 branches covered.">            for (int col = 0; col &lt; m.getColumnDimension(); col++) {</span>
<span class="fc" id="L150">                Assert.assertEquals(&quot;sum entry entry&quot;,</span>
<span class="fc" id="L151">                    mDataPlusInv.getEntry(row, col), mPlusMInv.getEntry(row, col),</span>
                    entryTolerance);
            }
        }
<span class="fc" id="L155">    }</span>

    /** test add failure */
    @Test
    public void testAddFail() {
<span class="fc" id="L160">        OpenMapRealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L161">        OpenMapRealMatrix m2 = createSparseMatrix(testData2);</span>
        try {
<span class="nc" id="L163">            m.add(m2);</span>
<span class="nc" id="L164">            Assert.fail(&quot;MathIllegalArgumentException expected&quot;);</span>
<span class="fc" id="L165">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L167">        }</span>
<span class="fc" id="L168">    }</span>

    /** test norm */
    @Test
    public void testNorm() {
<span class="fc" id="L173">        OpenMapRealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L174">        OpenMapRealMatrix m2 = createSparseMatrix(testData2);</span>
<span class="fc" id="L175">        Assert.assertEquals(&quot;testData norm&quot;, 14d, m.getNorm(), entryTolerance);</span>
<span class="fc" id="L176">        Assert.assertEquals(&quot;testData2 norm&quot;, 7d, m2.getNorm(), entryTolerance);</span>
<span class="fc" id="L177">    }</span>

    /** test m-n = m + -n */
    @Test
    public void testPlusMinus() {
<span class="fc" id="L182">        OpenMapRealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L183">        OpenMapRealMatrix n = createSparseMatrix(testDataInv);</span>
<span class="fc" id="L184">        assertClose(&quot;m-n = m + -n&quot;, m.subtract(n),</span>
<span class="fc" id="L185">            n.scalarMultiply(-1d).add(m), entryTolerance);</span>
        try {
<span class="nc" id="L187">            m.subtract(createSparseMatrix(testData2));</span>
<span class="nc" id="L188">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L189">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L191">        }</span>
<span class="fc" id="L192">    }</span>

    /** test multiply */
    @Test
    public void testMultiply() {
<span class="fc" id="L197">        OpenMapRealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L198">        OpenMapRealMatrix mInv = createSparseMatrix(testDataInv);</span>
<span class="fc" id="L199">        OpenMapRealMatrix identity = createSparseMatrix(id);</span>
<span class="fc" id="L200">        OpenMapRealMatrix m2 = createSparseMatrix(testData2);</span>
<span class="fc" id="L201">        assertClose(&quot;inverse multiply&quot;, m.multiply(mInv), identity,</span>
                entryTolerance);
<span class="fc" id="L203">        assertClose(&quot;inverse multiply&quot;, m.multiply(new BlockRealMatrix(testDataInv)), identity,</span>
                    entryTolerance);
<span class="fc" id="L205">        assertClose(&quot;inverse multiply&quot;, mInv.multiply(m), identity,</span>
                entryTolerance);
<span class="fc" id="L207">        assertClose(&quot;identity multiply&quot;, m.multiply(identity), m,</span>
                entryTolerance);
<span class="fc" id="L209">        assertClose(&quot;identity multiply&quot;, identity.multiply(mInv), mInv,</span>
                entryTolerance);
<span class="fc" id="L211">        assertClose(&quot;identity multiply&quot;, m2.multiply(identity), m2,</span>
                entryTolerance);
        try {
<span class="nc" id="L214">            m.multiply(createSparseMatrix(bigSingular));</span>
<span class="nc" id="L215">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L216">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L218">        }</span>
<span class="fc" id="L219">    }</span>

    // Additional Test for Array2DRowRealMatrixTest.testMultiply

<span class="fc" id="L223">    private double[][] d3 = new double[][] { { 1, 2, 3, 4 }, { 5, 6, 7, 8 } };</span>
<span class="fc" id="L224">    private double[][] d4 = new double[][] { { 1 }, { 2 }, { 3 }, { 4 } };</span>
<span class="fc" id="L225">    private double[][] d5 = new double[][] { { 30 }, { 70 } };</span>

    @Test
    public void testMultiply2() {
<span class="fc" id="L229">        RealMatrix m3 = createSparseMatrix(d3);</span>
<span class="fc" id="L230">        RealMatrix m4 = createSparseMatrix(d4);</span>
<span class="fc" id="L231">        RealMatrix m5 = createSparseMatrix(d5);</span>
<span class="fc" id="L232">        assertClose(&quot;m3*m4=m5&quot;, m3.multiply(m4), m5, entryTolerance);</span>
<span class="fc" id="L233">    }</span>

    /** test trace */
    @Test
    public void testTrace() {
<span class="fc" id="L238">        RealMatrix m = createSparseMatrix(id);</span>
<span class="fc" id="L239">        Assert.assertEquals(&quot;identity trace&quot;, 3d, m.getTrace(), entryTolerance);</span>
<span class="fc" id="L240">        m = createSparseMatrix(testData2);</span>
        try {
<span class="nc" id="L242">            m.getTrace();</span>
<span class="nc" id="L243">            Assert.fail(&quot;Expecting NonSquareMatrixException&quot;);</span>
<span class="fc" id="L244">        } catch (NonSquareMatrixException ex) {</span>
            // ignored
<span class="nc" id="L246">        }</span>
<span class="fc" id="L247">    }</span>

    /** test sclarAdd */
    @Test
    public void testScalarAdd() {
<span class="fc" id="L252">        RealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L253">        assertClose(&quot;scalar add&quot;, createSparseMatrix(testDataPlus2),</span>
<span class="fc" id="L254">            m.scalarAdd(2d), entryTolerance);</span>
<span class="fc" id="L255">    }</span>

    /** test operate */
    @Test
    public void testOperate() {
<span class="fc" id="L260">        RealMatrix m = createSparseMatrix(id);</span>
<span class="fc" id="L261">        assertClose(&quot;identity operate&quot;, testVector, m.operate(testVector),</span>
                entryTolerance);
<span class="fc" id="L263">        assertClose(&quot;identity operate&quot;, testVector, m.operate(</span>
<span class="fc" id="L264">                new ArrayRealVector(testVector)).toArray(), entryTolerance);</span>
<span class="fc" id="L265">        m = createSparseMatrix(bigSingular);</span>
        try {
<span class="nc" id="L267">            m.operate(testVector);</span>
<span class="nc" id="L268">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L269">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L271">        }</span>
<span class="fc" id="L272">    }</span>

    /** test issue MATH-209 */
    @Test
    public void testMath209() {
<span class="fc" id="L277">        RealMatrix a = createSparseMatrix(new double[][] {</span>
                { 1, 2 }, { 3, 4 }, { 5, 6 } });
<span class="fc" id="L279">        double[] b = a.operate(new double[] { 1, 1 });</span>
<span class="fc" id="L280">        Assert.assertEquals(a.getRowDimension(), b.length);</span>
<span class="fc" id="L281">        Assert.assertEquals(3.0, b[0], 1.0e-12);</span>
<span class="fc" id="L282">        Assert.assertEquals(7.0, b[1], 1.0e-12);</span>
<span class="fc" id="L283">        Assert.assertEquals(11.0, b[2], 1.0e-12);</span>
<span class="fc" id="L284">    }</span>

    /** test transpose */
    @Test
    public void testTranspose() {
<span class="fc" id="L289">        RealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L290">        RealMatrix mIT = new LUDecomposition(m).getSolver().getInverse().transpose();</span>
<span class="fc" id="L291">        RealMatrix mTI = new LUDecomposition(m.transpose()).getSolver().getInverse();</span>
<span class="fc" id="L292">        assertClose(&quot;inverse-transpose&quot;, mIT, mTI, normTolerance);</span>
<span class="fc" id="L293">        m = createSparseMatrix(testData2);</span>
<span class="fc" id="L294">        RealMatrix mt = createSparseMatrix(testData2T);</span>
<span class="fc" id="L295">        assertClose(&quot;transpose&quot;,mt,m.transpose(),normTolerance);</span>
<span class="fc" id="L296">    }</span>

    /** test preMultiply by vector */
    @Test
    public void testPremultiplyVector() {
<span class="fc" id="L301">        RealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L302">        assertClose(&quot;premultiply&quot;, m.preMultiply(testVector), preMultTest,</span>
            normTolerance);
<span class="fc" id="L304">        assertClose(&quot;premultiply&quot;, m.preMultiply(</span>
<span class="fc" id="L305">            new ArrayRealVector(testVector).toArray()), preMultTest, normTolerance);</span>
<span class="fc" id="L306">        m = createSparseMatrix(bigSingular);</span>
        try {
<span class="nc" id="L308">            m.preMultiply(testVector);</span>
<span class="nc" id="L309">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L310">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L312">        }</span>
<span class="fc" id="L313">    }</span>

    @Test
    public void testPremultiply() {
<span class="fc" id="L317">        RealMatrix m3 = createSparseMatrix(d3);</span>
<span class="fc" id="L318">        RealMatrix m4 = createSparseMatrix(d4);</span>
<span class="fc" id="L319">        RealMatrix m5 = createSparseMatrix(d5);</span>
<span class="fc" id="L320">        assertClose(&quot;m3*m4=m5&quot;, m4.preMultiply(m3), m5, entryTolerance);</span>

<span class="fc" id="L322">        OpenMapRealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L323">        OpenMapRealMatrix mInv = createSparseMatrix(testDataInv);</span>
<span class="fc" id="L324">        OpenMapRealMatrix identity = createSparseMatrix(id);</span>
<span class="fc" id="L325">        assertClose(&quot;inverse multiply&quot;, m.preMultiply(mInv), identity,</span>
                entryTolerance);
<span class="fc" id="L327">        assertClose(&quot;inverse multiply&quot;, mInv.preMultiply(m), identity,</span>
                entryTolerance);
<span class="fc" id="L329">        assertClose(&quot;identity multiply&quot;, m.preMultiply(identity), m,</span>
                entryTolerance);
<span class="fc" id="L331">        assertClose(&quot;identity multiply&quot;, identity.preMultiply(mInv), mInv,</span>
                entryTolerance);
        try {
<span class="nc" id="L334">            m.preMultiply(createSparseMatrix(bigSingular));</span>
<span class="nc" id="L335">            Assert.fail(&quot;Expecting illegalArgumentException&quot;);</span>
<span class="fc" id="L336">        } catch (MathIllegalArgumentException ex) {</span>
            // ignored
<span class="nc" id="L338">        }</span>
<span class="fc" id="L339">    }</span>

    @Test
    public void testGetVectors() {
<span class="fc" id="L343">        RealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L344">        assertClose(&quot;get row&quot;, m.getRow(0), testDataRow1, entryTolerance);</span>
<span class="fc" id="L345">        assertClose(&quot;get col&quot;, m.getColumn(2), testDataCol3, entryTolerance);</span>
        try {
<span class="nc" id="L347">            m.getRow(10);</span>
<span class="nc" id="L348">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L349">        } catch (OutOfRangeException ex) {</span>
            // ignored
<span class="nc" id="L351">        }</span>
        try {
<span class="nc" id="L353">            m.getColumn(-1);</span>
<span class="nc" id="L354">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L355">        } catch (OutOfRangeException ex) {</span>
            // ignored
<span class="nc" id="L357">        }</span>
<span class="fc" id="L358">    }</span>

    @Test
    public void testGetEntry() {
<span class="fc" id="L362">        RealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L363">        Assert.assertEquals(&quot;get entry&quot;, m.getEntry(0, 1), 2d, entryTolerance);</span>
        try {
<span class="nc" id="L365">            m.getEntry(10, 4);</span>
<span class="nc" id="L366">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L367">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L369">        }</span>
<span class="fc" id="L370">    }</span>

    /** test examples in user guide */
    @Test
    public void testExamples() {
        // Create a real matrix with two rows and three columns
<span class="fc" id="L376">        double[][] matrixData = { { 1d, 2d, 3d }, { 2d, 5d, 3d } };</span>
<span class="fc" id="L377">        RealMatrix m = createSparseMatrix(matrixData);</span>
        // One more with three rows, two columns
<span class="fc" id="L379">        double[][] matrixData2 = { { 1d, 2d }, { 2d, 5d }, { 1d, 7d } };</span>
<span class="fc" id="L380">        RealMatrix n = createSparseMatrix(matrixData2);</span>
        // Now multiply m by n
<span class="fc" id="L382">        RealMatrix p = m.multiply(n);</span>
<span class="fc" id="L383">        Assert.assertEquals(2, p.getRowDimension());</span>
<span class="fc" id="L384">        Assert.assertEquals(2, p.getColumnDimension());</span>
        // Invert p
<span class="fc" id="L386">        RealMatrix pInverse = new LUDecomposition(p).getSolver().getInverse();</span>
<span class="fc" id="L387">        Assert.assertEquals(2, pInverse.getRowDimension());</span>
<span class="fc" id="L388">        Assert.assertEquals(2, pInverse.getColumnDimension());</span>

        // Solve example
<span class="fc" id="L391">        double[][] coefficientsData = { { 2, 3, -2 }, { -1, 7, 6 },</span>
                { 4, -3, -5 } };
<span class="fc" id="L393">        RealMatrix coefficients = createSparseMatrix(coefficientsData);</span>
<span class="fc" id="L394">        RealVector constants = new ArrayRealVector(new double[]{ 1, -2, 1 }, false);</span>
<span class="fc" id="L395">        RealVector solution = new LUDecomposition(coefficients).getSolver().solve(constants);</span>
<span class="fc" id="L396">        final double cst0 = constants.getEntry(0);</span>
<span class="fc" id="L397">        final double cst1 = constants.getEntry(1);</span>
<span class="fc" id="L398">        final double cst2 = constants.getEntry(2);</span>
<span class="fc" id="L399">        final double sol0 = solution.getEntry(0);</span>
<span class="fc" id="L400">        final double sol1 = solution.getEntry(1);</span>
<span class="fc" id="L401">        final double sol2 = solution.getEntry(2);</span>
<span class="fc" id="L402">        Assert.assertEquals(2 * sol0 + 3 * sol1 - 2 * sol2, cst0, 1E-12);</span>
<span class="fc" id="L403">        Assert.assertEquals(-1 * sol0 + 7 * sol1 + 6 * sol2, cst1, 1E-12);</span>
<span class="fc" id="L404">        Assert.assertEquals(4 * sol0 - 3 * sol1 - 5 * sol2, cst2, 1E-12);</span>

<span class="fc" id="L406">    }</span>

    // test submatrix accessors
    @Test
    public void testSubMatrix() {
<span class="fc" id="L411">        RealMatrix m = createSparseMatrix(subTestData);</span>
<span class="fc" id="L412">        RealMatrix mRows23Cols00 = createSparseMatrix(subRows23Cols00);</span>
<span class="fc" id="L413">        RealMatrix mRows00Cols33 = createSparseMatrix(subRows00Cols33);</span>
<span class="fc" id="L414">        RealMatrix mRows01Cols23 = createSparseMatrix(subRows01Cols23);</span>
<span class="fc" id="L415">        RealMatrix mRows02Cols13 = createSparseMatrix(subRows02Cols13);</span>
<span class="fc" id="L416">        RealMatrix mRows03Cols12 = createSparseMatrix(subRows03Cols12);</span>
<span class="fc" id="L417">        RealMatrix mRows03Cols123 = createSparseMatrix(subRows03Cols123);</span>
<span class="fc" id="L418">        RealMatrix mRows20Cols123 = createSparseMatrix(subRows20Cols123);</span>
<span class="fc" id="L419">        RealMatrix mRows31Cols31 = createSparseMatrix(subRows31Cols31);</span>
<span class="fc" id="L420">        Assert.assertEquals(&quot;Rows23Cols00&quot;, mRows23Cols00, m.getSubMatrix(2, 3, 0, 0));</span>
<span class="fc" id="L421">        Assert.assertEquals(&quot;Rows00Cols33&quot;, mRows00Cols33, m.getSubMatrix(0, 0, 3, 3));</span>
<span class="fc" id="L422">        Assert.assertEquals(&quot;Rows01Cols23&quot;, mRows01Cols23, m.getSubMatrix(0, 1, 2, 3));</span>
<span class="fc" id="L423">        Assert.assertEquals(&quot;Rows02Cols13&quot;, mRows02Cols13,</span>
<span class="fc" id="L424">            m.getSubMatrix(new int[] { 0, 2 }, new int[] { 1, 3 }));</span>
<span class="fc" id="L425">        Assert.assertEquals(&quot;Rows03Cols12&quot;, mRows03Cols12,</span>
<span class="fc" id="L426">            m.getSubMatrix(new int[] { 0, 3 }, new int[] { 1, 2 }));</span>
<span class="fc" id="L427">        Assert.assertEquals(&quot;Rows03Cols123&quot;, mRows03Cols123,</span>
<span class="fc" id="L428">            m.getSubMatrix(new int[] { 0, 3 }, new int[] { 1, 2, 3 }));</span>
<span class="fc" id="L429">        Assert.assertEquals(&quot;Rows20Cols123&quot;, mRows20Cols123,</span>
<span class="fc" id="L430">            m.getSubMatrix(new int[] { 2, 0 }, new int[] { 1, 2, 3 }));</span>
<span class="fc" id="L431">        Assert.assertEquals(&quot;Rows31Cols31&quot;, mRows31Cols31,</span>
<span class="fc" id="L432">            m.getSubMatrix(new int[] { 3, 1 }, new int[] { 3, 1 }));</span>
<span class="fc" id="L433">        Assert.assertEquals(&quot;Rows31Cols31&quot;, mRows31Cols31,</span>
<span class="fc" id="L434">            m.getSubMatrix(new int[] { 3, 1 }, new int[] { 3, 1 }));</span>

        try {
<span class="nc" id="L437">            m.getSubMatrix(1, 0, 2, 4);</span>
<span class="nc" id="L438">            Assert.fail(&quot;Expecting NumberIsTooSmallException&quot;);</span>
<span class="fc" id="L439">        } catch (NumberIsTooSmallException ex) {</span>
            // expected
<span class="nc" id="L441">        }</span>
        try {
<span class="nc" id="L443">            m.getSubMatrix(-1, 1, 2, 2);</span>
<span class="nc" id="L444">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L445">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L447">        }</span>
        try {
<span class="nc" id="L449">            m.getSubMatrix(1, 0, 2, 2);</span>
<span class="nc" id="L450">            Assert.fail(&quot;Expecting NumberIsTooSmallException&quot;);</span>
<span class="fc" id="L451">        } catch (NumberIsTooSmallException ex) {</span>
            // expected
<span class="nc" id="L453">        }</span>
        try {
<span class="nc" id="L455">            m.getSubMatrix(1, 0, 2, 4);</span>
<span class="nc" id="L456">            Assert.fail(&quot;Expecting NumberIsTooSmallException&quot;);</span>
<span class="fc" id="L457">        } catch (NumberIsTooSmallException ex) {</span>
            // expected
<span class="nc" id="L459">        }</span>
        try {
<span class="nc" id="L461">            m.getSubMatrix(new int[] {}, new int[] { 0 });</span>
<span class="nc" id="L462">            Assert.fail(&quot;Expecting NoDataException&quot;);</span>
<span class="fc" id="L463">        } catch (NoDataException ex) {</span>
            // expected
<span class="nc" id="L465">        }</span>
        try {
<span class="nc" id="L467">            m.getSubMatrix(new int[] { 0 }, new int[] { 4 });</span>
<span class="nc" id="L468">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L469">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L471">        }</span>
<span class="fc" id="L472">    }</span>

    @Test
    public void testGetRowMatrix() {
<span class="fc" id="L476">        RealMatrix m = createSparseMatrix(subTestData);</span>
<span class="fc" id="L477">        RealMatrix mRow0 = createSparseMatrix(subRow0);</span>
<span class="fc" id="L478">        RealMatrix mRow3 = createSparseMatrix(subRow3);</span>
<span class="fc" id="L479">        Assert.assertEquals(&quot;Row0&quot;, mRow0, m.getRowMatrix(0));</span>
<span class="fc" id="L480">        Assert.assertEquals(&quot;Row3&quot;, mRow3, m.getRowMatrix(3));</span>
        try {
<span class="nc" id="L482">            m.getRowMatrix(-1);</span>
<span class="nc" id="L483">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L484">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L486">        }</span>
        try {
<span class="nc" id="L488">            m.getRowMatrix(4);</span>
<span class="nc" id="L489">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L490">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L492">        }</span>
<span class="fc" id="L493">    }</span>

    @Test
    public void testGetColumnMatrix() {
<span class="fc" id="L497">        RealMatrix m = createSparseMatrix(subTestData);</span>
<span class="fc" id="L498">        RealMatrix mColumn1 = createSparseMatrix(subColumn1);</span>
<span class="fc" id="L499">        RealMatrix mColumn3 = createSparseMatrix(subColumn3);</span>
<span class="fc" id="L500">        Assert.assertEquals(&quot;Column1&quot;, mColumn1, m.getColumnMatrix(1));</span>
<span class="fc" id="L501">        Assert.assertEquals(&quot;Column3&quot;, mColumn3, m.getColumnMatrix(3));</span>
        try {
<span class="nc" id="L503">            m.getColumnMatrix(-1);</span>
<span class="nc" id="L504">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L505">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L507">        }</span>
        try {
<span class="nc" id="L509">            m.getColumnMatrix(4);</span>
<span class="nc" id="L510">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L511">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L513">        }</span>
<span class="fc" id="L514">    }</span>

    @Test
    public void testGetRowVector() {
<span class="fc" id="L518">        RealMatrix m = createSparseMatrix(subTestData);</span>
<span class="fc" id="L519">        RealVector mRow0 = new ArrayRealVector(subRow0[0]);</span>
<span class="fc" id="L520">        RealVector mRow3 = new ArrayRealVector(subRow3[0]);</span>
<span class="fc" id="L521">        Assert.assertEquals(&quot;Row0&quot;, mRow0, m.getRowVector(0));</span>
<span class="fc" id="L522">        Assert.assertEquals(&quot;Row3&quot;, mRow3, m.getRowVector(3));</span>
        try {
<span class="nc" id="L524">            m.getRowVector(-1);</span>
<span class="nc" id="L525">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L526">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L528">        }</span>
        try {
<span class="nc" id="L530">            m.getRowVector(4);</span>
<span class="nc" id="L531">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L532">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L534">        }</span>
<span class="fc" id="L535">    }</span>

    @Test
    public void testGetColumnVector() {
<span class="fc" id="L539">        RealMatrix m = createSparseMatrix(subTestData);</span>
<span class="fc" id="L540">        RealVector mColumn1 = columnToVector(subColumn1);</span>
<span class="fc" id="L541">        RealVector mColumn3 = columnToVector(subColumn3);</span>
<span class="fc" id="L542">        Assert.assertEquals(&quot;Column1&quot;, mColumn1, m.getColumnVector(1));</span>
<span class="fc" id="L543">        Assert.assertEquals(&quot;Column3&quot;, mColumn3, m.getColumnVector(3));</span>
        try {
<span class="nc" id="L545">            m.getColumnVector(-1);</span>
<span class="nc" id="L546">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L547">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L549">        }</span>
        try {
<span class="nc" id="L551">            m.getColumnVector(4);</span>
<span class="nc" id="L552">            Assert.fail(&quot;Expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L553">        } catch (OutOfRangeException ex) {</span>
            // expected
<span class="nc" id="L555">        }</span>
<span class="fc" id="L556">    }</span>

    private RealVector columnToVector(double[][] column) {
<span class="fc" id="L559">        double[] data = new double[column.length];</span>
<span class="fc bfc" id="L560" title="All 2 branches covered.">        for (int i = 0; i &lt; data.length; ++i) {</span>
<span class="fc" id="L561">            data[i] = column[i][0];</span>
        }
<span class="fc" id="L563">        return new ArrayRealVector(data, false);</span>
    }

    @Test
    public void testEqualsAndHashCode() {
<span class="fc" id="L568">        OpenMapRealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L569">        OpenMapRealMatrix m1 = m.copy();</span>
<span class="fc" id="L570">        OpenMapRealMatrix mt = (OpenMapRealMatrix) m.transpose();</span>
<span class="pc bpc" id="L571" title="1 of 2 branches missed.">        Assert.assertTrue(m.hashCode() != mt.hashCode());</span>
<span class="fc" id="L572">        Assert.assertEquals(m.hashCode(), m1.hashCode());</span>
<span class="fc" id="L573">        Assert.assertEquals(m, m);</span>
<span class="fc" id="L574">        Assert.assertEquals(m, m1);</span>
<span class="fc" id="L575">        Assert.assertFalse(m.equals(null));</span>
<span class="fc" id="L576">        Assert.assertFalse(m.equals(mt));</span>
<span class="fc" id="L577">        Assert.assertFalse(m.equals(createSparseMatrix(bigSingular)));</span>
<span class="fc" id="L578">    }</span>

    @Test
    public void testToString() {
<span class="fc" id="L582">        OpenMapRealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L583">        Assert.assertEquals(&quot;OpenMapRealMatrix{{1.0,2.0,3.0},{2.0,5.0,3.0},{1.0,0.0,8.0}}&quot;,</span>
<span class="fc" id="L584">            m.toString());</span>
<span class="fc" id="L585">        m = new OpenMapRealMatrix(1, 1);</span>
<span class="fc" id="L586">        Assert.assertEquals(&quot;OpenMapRealMatrix{{0.0}}&quot;, m.toString());</span>
<span class="fc" id="L587">    }</span>

    @Test
    public void testSetSubMatrix() {
<span class="fc" id="L591">        OpenMapRealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L592">        m.setSubMatrix(detData2, 1, 1);</span>
<span class="fc" id="L593">        RealMatrix expected = createSparseMatrix(new double[][] {</span>
                { 1.0, 2.0, 3.0 }, { 2.0, 1.0, 3.0 }, { 1.0, 2.0, 4.0 } });
<span class="fc" id="L595">        Assert.assertEquals(expected, m);</span>

<span class="fc" id="L597">        m.setSubMatrix(detData2, 0, 0);</span>
<span class="fc" id="L598">        expected = createSparseMatrix(new double[][] {</span>
                { 1.0, 3.0, 3.0 }, { 2.0, 4.0, 3.0 }, { 1.0, 2.0, 4.0 } });
<span class="fc" id="L600">        Assert.assertEquals(expected, m);</span>

<span class="fc" id="L602">        m.setSubMatrix(testDataPlus2, 0, 0);</span>
<span class="fc" id="L603">        expected = createSparseMatrix(new double[][] {</span>
                { 3.0, 4.0, 5.0 }, { 4.0, 7.0, 5.0 }, { 3.0, 2.0, 10.0 } });
<span class="fc" id="L605">        Assert.assertEquals(expected, m);</span>

        // javadoc example
<span class="fc" id="L608">        OpenMapRealMatrix matrix =</span>
<span class="fc" id="L609">            createSparseMatrix(new double[][] {</span>
        { 1, 2, 3, 4 }, { 5, 6, 7, 8 }, { 9, 0, 1, 2 } });
<span class="fc" id="L611">        matrix.setSubMatrix(new double[][] { { 3, 4 }, { 5, 6 } }, 1, 1);</span>
<span class="fc" id="L612">        expected = createSparseMatrix(new double[][] {</span>
                { 1, 2, 3, 4 }, { 5, 3, 4, 8 }, { 9, 5, 6, 2 } });
<span class="fc" id="L614">        Assert.assertEquals(expected, matrix);</span>

        // dimension overflow
        try {
<span class="nc" id="L618">            m.setSubMatrix(testData, 1, 1);</span>
<span class="nc" id="L619">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L620">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L622">        }</span>
        // dimension underflow
        try {
<span class="nc" id="L625">            m.setSubMatrix(testData, -1, 1);</span>
<span class="nc" id="L626">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L627">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L629">        }</span>
        try {
<span class="nc" id="L631">            m.setSubMatrix(testData, 1, -1);</span>
<span class="nc" id="L632">            Assert.fail(&quot;expecting OutOfRangeException&quot;);</span>
<span class="fc" id="L633">        } catch (OutOfRangeException e) {</span>
            // expected
<span class="nc" id="L635">        }</span>

        // null
        try {
<span class="nc" id="L639">            m.setSubMatrix(null, 1, 1);</span>
<span class="nc" id="L640">            Assert.fail(&quot;expecting NullArgumentException&quot;);</span>
<span class="fc" id="L641">        } catch (NullArgumentException e) {</span>
            // expected
<span class="nc" id="L643">        }</span>
        try {
<span class="nc" id="L645">            new OpenMapRealMatrix(0, 0);</span>
<span class="nc" id="L646">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L647">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L649">        }</span>

        // ragged
        try {
<span class="nc" id="L653">            m.setSubMatrix(new double[][] { { 1 }, { 2, 3 } }, 0, 0);</span>
<span class="nc" id="L654">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L655">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L657">        }</span>

        // empty
        try {
<span class="nc" id="L661">            m.setSubMatrix(new double[][] { {} }, 0, 0);</span>
<span class="nc" id="L662">            Assert.fail(&quot;expecting MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L663">        } catch (MathIllegalArgumentException e) {</span>
            // expected
<span class="nc" id="L665">        }</span>

<span class="fc" id="L667">    }</span>

    @Test
    public void testSerial()  {
<span class="fc" id="L671">        OpenMapRealMatrix m = createSparseMatrix(testData);</span>
<span class="fc" id="L672">        Assert.assertEquals(m,TestUtils.serializeAndRecover(m));</span>
<span class="fc" id="L673">    }</span>

    // --------------- -----------------Protected methods

    /** verifies that two matrices are close (1-norm) */
    protected void assertClose(String msg, RealMatrix m, RealMatrix n,
            double tolerance) {
<span class="pc bpc" id="L680" title="1 of 2 branches missed.">        Assert.assertTrue(msg, m.subtract(n).getNorm() &lt; tolerance);</span>
<span class="fc" id="L681">    }</span>

    /** verifies that two vectors are close (sup norm) */
    protected void assertClose(String msg, double[] m, double[] n,
            double tolerance) {
<span class="pc bpc" id="L686" title="1 of 2 branches missed.">        if (m.length != n.length) {</span>
<span class="nc" id="L687">            Assert.fail(&quot;vectors not same length&quot;);</span>
        }
<span class="fc bfc" id="L689" title="All 2 branches covered.">        for (int i = 0; i &lt; m.length; i++) {</span>
<span class="fc" id="L690">            Assert.assertEquals(msg + &quot; &quot; + i + &quot; elements differ&quot;, m[i], n[i],</span>
                    tolerance);
        }
<span class="fc" id="L693">    }</span>

    private OpenMapRealMatrix createSparseMatrix(double[][] data) {
<span class="fc" id="L696">        OpenMapRealMatrix matrix = new OpenMapRealMatrix(data.length, data[0].length);</span>
<span class="fc bfc" id="L697" title="All 2 branches covered.">        for (int row = 0; row &lt; data.length; row++) {</span>
<span class="fc bfc" id="L698" title="All 2 branches covered.">            for (int col = 0; col &lt; data[row].length; col++) {</span>
<span class="fc" id="L699">                matrix.setEntry(row, col, data[row][col]);</span>
            }
        }
<span class="fc" id="L702">        return matrix;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>