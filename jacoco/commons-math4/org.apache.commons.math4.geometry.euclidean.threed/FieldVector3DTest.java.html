<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FieldVector3DTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">commons_math4$All_in_commons_math4.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.math4.geometry.euclidean.threed</a> &gt; <span class="el_source">FieldVector3DTest.java</span></div><h1>FieldVector3DTest.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.apache.commons.math4.geometry.euclidean.threed;

import java.text.DecimalFormat;
import java.text.DecimalFormatSymbols;
import java.text.NumberFormat;
import java.util.Locale;

import org.apache.commons.math4.analysis.differentiation.DerivativeStructure;
import org.apache.commons.math4.exception.DimensionMismatchException;
import org.apache.commons.math4.exception.MathArithmeticException;
import org.apache.commons.math4.geometry.euclidean.threed.FieldVector3D;
import org.apache.commons.math4.geometry.euclidean.threed.Cartesian3D;
import org.apache.commons.rng.UniformRandomProvider;
import org.apache.commons.rng.simple.RandomSource;
import org.apache.commons.math4.util.FastMath;
import org.apache.commons.numbers.core.Precision;
import org.junit.Assert;
import org.junit.Test;

<span class="fc" id="L37">public class FieldVector3DTest {</span>

    @Test
    public void testConstructors() throws DimensionMismatchException {
<span class="fc" id="L41">        double cosAlpha = 1 / 2.0;</span>
<span class="fc" id="L42">        double sinAlpha = FastMath.sqrt(3) / 2.0;</span>
<span class="fc" id="L43">        double cosDelta = FastMath.sqrt(2) / 2.0;</span>
<span class="fc" id="L44">        double sinDelta = -FastMath.sqrt(2) / 2.0;</span>
<span class="fc" id="L45">        FieldVector3D&lt;DerivativeStructure&gt; u = new FieldVector3D&lt;&gt;(2,</span>
                new FieldVector3D&lt;&gt;(new DerivativeStructure(2, 1, 0,  FastMath.PI / 3),
                        new DerivativeStructure(2, 1, 1, -FastMath.PI / 4)));
<span class="fc" id="L48">        checkVector(u, 2 * cosAlpha * cosDelta, 2 * sinAlpha * cosDelta, 2 * sinDelta);</span>
<span class="fc" id="L49">        Assert.assertEquals(-2 * sinAlpha * cosDelta, u.getX().getPartialDerivative(1, 0), 1.0e-12);</span>
<span class="fc" id="L50">        Assert.assertEquals(+2 * cosAlpha * cosDelta, u.getY().getPartialDerivative(1, 0), 1.0e-12);</span>
<span class="fc" id="L51">        Assert.assertEquals(0,                        u.getZ().getPartialDerivative(1, 0), 1.0e-12);</span>
<span class="fc" id="L52">        Assert.assertEquals(-2 * cosAlpha * sinDelta, u.getX().getPartialDerivative(0, 1), 1.0e-12);</span>
<span class="fc" id="L53">        Assert.assertEquals(-2 * sinAlpha * sinDelta, u.getY().getPartialDerivative(0, 1), 1.0e-12);</span>
<span class="fc" id="L54">        Assert.assertEquals(2 * cosDelta,             u.getZ().getPartialDerivative(0, 1), 1.0e-12);</span>

<span class="fc" id="L56">        checkVector(new FieldVector3D&lt;&gt;(2, createVector(1, 0,  0, 3)),</span>
                                   2, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 2);
<span class="fc" id="L58">        checkVector(new FieldVector3D&lt;&gt;(new DerivativeStructure(4, 1, 3,  2.0),</span>
<span class="fc" id="L59">                                   createVector(1, 0,  0, 4)),</span>
                                   2, 0, 0, 2, 0, 0, 1, 0, 2, 0, 0, 0, 0, 2, 0);
<span class="fc" id="L61">        checkVector(new FieldVector3D&lt;&gt;(new DerivativeStructure(4, 1, 3,  2.0),</span>
                                   new Cartesian3D(1, 0,  0)),
                                   2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0);

<span class="fc" id="L65">        checkVector(new FieldVector3D&lt;&gt;(2, createVector(1, 0,  0, 3),</span>
<span class="fc" id="L66">                                   -3, createVector(0, 0, -1, 3)),</span>
                                   2, 0, 3, -1, 0, 0, 0, -1, 0, 0, 0, -1);
<span class="fc" id="L68">        checkVector(new FieldVector3D&lt;&gt;(new DerivativeStructure(4, 1, 3,  2.0),</span>
<span class="fc" id="L69">                                   createVector(1, 0,  0, 4),</span>
                                   new DerivativeStructure(4, 1, 3, -3.0),
<span class="fc" id="L71">                                   createVector(0, 0, -1, 4)),</span>
                                   2, 0, 3, -1, 0, 0, 1, 0, -1, 0, 0, 0, 0, -1, -1);
<span class="fc" id="L73">        checkVector(new FieldVector3D&lt;&gt;(new DerivativeStructure(4, 1, 3,  2.0),</span>
                                   new Cartesian3D(1, 0,  0),
                                   new DerivativeStructure(4, 1, 3, -3.0),
                                   new Cartesian3D(0, 0, -1)),
                                   2, 0, 3, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, -1);

<span class="fc" id="L79">        checkVector(new FieldVector3D&lt;&gt;(2, createVector(1, 0, 0, 3),</span>
<span class="fc" id="L80">                                   5, createVector(0, 1, 0, 3),</span>
<span class="fc" id="L81">                                   -3, createVector(0, 0, -1, 3)),</span>
                                   2, 5, 3, 4, 0, 0, 0, 4, 0, 0, 0, 4);
<span class="fc" id="L83">        checkVector(new FieldVector3D&lt;&gt;(new DerivativeStructure(4, 1, 3,  2.0),</span>
<span class="fc" id="L84">                                   createVector(1, 0,  0, 4),</span>
                                   new DerivativeStructure(4, 1, 3,  5.0),
<span class="fc" id="L86">                                   createVector(0, 1,  0, 4),</span>
                                   new DerivativeStructure(4, 1, 3, -3.0),
<span class="fc" id="L88">                                   createVector(0, 0, -1, 4)),</span>
                                   2, 5, 3, 4, 0, 0, 1, 0, 4, 0, 1, 0, 0, 4, -1);
<span class="fc" id="L90">        checkVector(new FieldVector3D&lt;&gt;(new DerivativeStructure(4, 1, 3,  2.0),</span>
                                   new Cartesian3D(1, 0,  0),
                                   new DerivativeStructure(4, 1, 3,  5.0),
                                   new Cartesian3D(0, 1,  0),
                                   new DerivativeStructure(4, 1, 3, -3.0),
                                   new Cartesian3D(0, 0, -1)),
                                   2, 5, 3, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, -1);

<span class="fc" id="L98">        checkVector(new FieldVector3D&lt;&gt;(2, createVector(1, 0, 0, 3),</span>
<span class="fc" id="L99">                                   5, createVector(0, 1, 0, 3),</span>
<span class="fc" id="L100">                                   5, createVector(0, -1, 0, 3),</span>
<span class="fc" id="L101">                                   -3, createVector(0, 0, -1, 3)),</span>
                                   2, 0, 3, 9, 0, 0, 0, 9, 0, 0, 0, 9);
<span class="fc" id="L103">        checkVector(new FieldVector3D&lt;&gt;(new DerivativeStructure(4, 1, 3,  2.0),</span>
<span class="fc" id="L104">                                   createVector(1, 0,  0, 4),</span>
                                   new DerivativeStructure(4, 1, 3,  5.0),
<span class="fc" id="L106">                                   createVector(0, 1,  0, 4),</span>
                                   new DerivativeStructure(4, 1, 3,  5.0),
<span class="fc" id="L108">                                   createVector(0, -1,  0, 4),</span>
                                   new DerivativeStructure(4, 1, 3, -3.0),
<span class="fc" id="L110">                                   createVector(0, 0, -1, 4)),</span>
                                   2, 0, 3, 9, 0, 0, 1, 0, 9, 0, 0, 0, 0, 9, -1);
<span class="fc" id="L112">        checkVector(new FieldVector3D&lt;&gt;(new DerivativeStructure(4, 1, 3,  2.0),</span>
                                   new Cartesian3D(1, 0,  0),
                                   new DerivativeStructure(4, 1, 3,  5.0),
                                   new Cartesian3D(0, 1,  0),
                                   new DerivativeStructure(4, 1, 3,  5.0),
                                   new Cartesian3D(0, -1,  0),
                                   new DerivativeStructure(4, 1, 3, -3.0),
                                   new Cartesian3D(0, 0, -1)),
                                   2, 0, 3, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, -1);

<span class="fc" id="L122">        checkVector(new FieldVector3D&lt;&gt;(new DerivativeStructure[] {</span>
            new DerivativeStructure(3, 1, 2,  2),
            new DerivativeStructure(3, 1, 1,  5),
            new DerivativeStructure(3, 1, 0, -3)
        }),
        2, 5, -3, 0, 0, 1, 0, 1, 0, 1, 0, 0);

<span class="fc" id="L129">    }</span>

    @Test
    public void testEquals() {
<span class="fc" id="L133">        FieldVector3D&lt;DerivativeStructure&gt; u1 = createVector(1, 2, 3, 3);</span>
<span class="fc" id="L134">        FieldVector3D&lt;DerivativeStructure&gt; v  = createVector(1, 2, 3 + 10 * Precision.EPSILON, 3);</span>
<span class="fc" id="L135">        Assert.assertTrue(u1.equals(u1));</span>
<span class="fc" id="L136">        Assert.assertTrue(u1.equals(new FieldVector3D&lt;&gt;(new DerivativeStructure(3, 1, 0, 1.0),</span>
                                                   new DerivativeStructure(3, 1, 1, 2.0),
                                                   new DerivativeStructure(3, 1, 2, 3.0))));
<span class="fc" id="L139">        Assert.assertFalse(u1.equals(new FieldVector3D&lt;&gt;(new DerivativeStructure(3, 1, 1.0),</span>
                                                    new DerivativeStructure(3, 1, 1, 2.0),
                                                    new DerivativeStructure(3, 1, 2, 3.0))));
<span class="fc" id="L142">        Assert.assertFalse(u1.equals(new FieldVector3D&lt;&gt;(new DerivativeStructure(3, 1, 0, 1.0),</span>
                                                    new DerivativeStructure(3, 1, 2.0),
                                                    new DerivativeStructure(3, 1, 2, 3.0))));
<span class="fc" id="L145">        Assert.assertFalse(u1.equals(new FieldVector3D&lt;&gt;(new DerivativeStructure(3, 1, 0, 1.0),</span>
                                                    new DerivativeStructure(3, 1, 1, 2.0),
                                                    new DerivativeStructure(3, 1, 3.0))));
<span class="fc" id="L148">        Assert.assertFalse(u1.equals(v));</span>
<span class="fc" id="L149">        Assert.assertFalse(u1.equals(u1.toVector3D()));</span>
<span class="fc" id="L150">        Assert.assertTrue(createVector(0, Double.NaN, 0, 3).equals(createVector(0, 0, Double.NaN, 3)));</span>
<span class="fc" id="L151">    }</span>

    @Test
    public void testHash() {
<span class="fc" id="L155">        Assert.assertEquals(createVector(0, Double.NaN, 0, 3).hashCode(), createVector(0, 0, Double.NaN, 3).hashCode());</span>
<span class="fc" id="L156">        FieldVector3D&lt;DerivativeStructure&gt; u = createVector(1, 2, 3, 3);</span>
<span class="fc" id="L157">        FieldVector3D&lt;DerivativeStructure&gt; v = createVector(1, 2, 3 + 10 * Precision.EPSILON, 3);</span>
<span class="pc bpc" id="L158" title="1 of 2 branches missed.">        Assert.assertTrue(u.hashCode() != v.hashCode());</span>
<span class="fc" id="L159">    }</span>

    @Test
    public void testInfinite() {
<span class="fc" id="L163">        Assert.assertTrue(createVector(1, 1, Double.NEGATIVE_INFINITY, 3).isInfinite());</span>
<span class="fc" id="L164">        Assert.assertTrue(createVector(1, Double.NEGATIVE_INFINITY, 1, 3).isInfinite());</span>
<span class="fc" id="L165">        Assert.assertTrue(createVector(Double.NEGATIVE_INFINITY, 1, 1, 3).isInfinite());</span>
<span class="fc" id="L166">        Assert.assertFalse(createVector(1, 1, 2, 3).isInfinite());</span>
<span class="fc" id="L167">        Assert.assertFalse(createVector(1, Double.NaN, Double.NEGATIVE_INFINITY, 3).isInfinite());</span>
<span class="fc" id="L168">    }</span>

    @Test
    public void testNaN() {
<span class="fc" id="L172">        Assert.assertTrue(createVector(1, 1, Double.NaN, 3).isNaN());</span>
<span class="fc" id="L173">        Assert.assertTrue(createVector(1, Double.NaN, 1, 3).isNaN());</span>
<span class="fc" id="L174">        Assert.assertTrue(createVector(Double.NaN, 1, 1, 3).isNaN());</span>
<span class="fc" id="L175">        Assert.assertFalse(createVector(1, 1, 2, 3).isNaN());</span>
<span class="fc" id="L176">        Assert.assertFalse(createVector(1, 1, Double.NEGATIVE_INFINITY, 3).isNaN());</span>
<span class="fc" id="L177">    }</span>

    @Test
    public void testToString() {
<span class="fc" id="L181">        Assert.assertEquals(&quot;{3; 2; 1}&quot;, createVector(3, 2, 1, 3).toString());</span>
<span class="fc" id="L182">        NumberFormat format = new DecimalFormat(&quot;0.000&quot;, new DecimalFormatSymbols(Locale.US));</span>
<span class="fc" id="L183">        Assert.assertEquals(&quot;{3.000; 2.000; 1.000}&quot;, createVector(3, 2, 1, 3).toString(format));</span>
<span class="fc" id="L184">    }</span>

    @Test(expected=DimensionMismatchException.class)
    public void testWrongDimension() throws DimensionMismatchException {
<span class="nc" id="L188">        new FieldVector3D&lt;&gt;(new DerivativeStructure[] {</span>
            new DerivativeStructure(3, 1, 0, 2),
            new DerivativeStructure(3, 1, 0, 5)
        });
<span class="nc" id="L192">    }</span>

    @Test
    public void testCoordinates() {
<span class="fc" id="L196">        FieldVector3D&lt;DerivativeStructure&gt; v = createVector(1, 2, 3, 3);</span>
<span class="pc bpc" id="L197" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(v.getX().getReal() - 1) &lt; 1.0e-12);</span>
<span class="pc bpc" id="L198" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(v.getY().getReal() - 2) &lt; 1.0e-12);</span>
<span class="pc bpc" id="L199" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(v.getZ().getReal() - 3) &lt; 1.0e-12);</span>
<span class="fc" id="L200">        DerivativeStructure[] coordinates = v.toArray();</span>
<span class="pc bpc" id="L201" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(coordinates[0].getReal() - 1) &lt; 1.0e-12);</span>
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(coordinates[1].getReal() - 2) &lt; 1.0e-12);</span>
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(coordinates[2].getReal() - 3) &lt; 1.0e-12);</span>
<span class="fc" id="L204">    }</span>

    @Test
    public void testNorm1() {
<span class="fc" id="L208">        Assert.assertEquals( 0.0, createVector(0, 0, 0, 3).getNorm1().getReal(), 0);</span>
<span class="fc" id="L209">        Assert.assertEquals( 6.0, createVector(1, -2, 3, 3).getNorm1().getReal(), 0);</span>
<span class="fc" id="L210">        Assert.assertEquals( 1.0, createVector(1, -2, 3, 3).getNorm1().getPartialDerivative(1, 0, 0), 0);</span>
<span class="fc" id="L211">        Assert.assertEquals(-1.0, createVector(1, -2, 3, 3).getNorm1().getPartialDerivative(0, 1, 0), 0);</span>
<span class="fc" id="L212">        Assert.assertEquals( 1.0, createVector(1, -2, 3, 3).getNorm1().getPartialDerivative(0, 0, 1), 0);</span>
<span class="fc" id="L213">    }</span>

    @Test
    public void testNorm() {
<span class="fc" id="L217">        double r = FastMath.sqrt(14);</span>
<span class="fc" id="L218">        Assert.assertEquals(0.0, createVector(0, 0, 0, 3).getNorm().getReal(), 0);</span>
<span class="fc" id="L219">        Assert.assertEquals(r, createVector(1, 2, 3, 3).getNorm().getReal(), 1.0e-12);</span>
<span class="fc" id="L220">        Assert.assertEquals( 1.0 / r, createVector(1, 2, 3, 3).getNorm().getPartialDerivative(1, 0, 0), 0);</span>
<span class="fc" id="L221">        Assert.assertEquals( 2.0 / r, createVector(1, 2, 3, 3).getNorm().getPartialDerivative(0, 1, 0), 0);</span>
<span class="fc" id="L222">        Assert.assertEquals( 3.0 / r, createVector(1, 2, 3, 3).getNorm().getPartialDerivative(0, 0, 1), 0);</span>
<span class="fc" id="L223">    }</span>

    @Test
    public void testNormSq() {
<span class="fc" id="L227">        Assert.assertEquals(0.0, createVector(0, 0, 0, 3).getNormSq().getReal(), 0);</span>
<span class="fc" id="L228">        Assert.assertEquals(14, createVector(1, 2, 3, 3).getNormSq().getReal(), 1.0e-12);</span>
<span class="fc" id="L229">        Assert.assertEquals( 2, createVector(1, 2, 3, 3).getNormSq().getPartialDerivative(1, 0, 0), 0);</span>
<span class="fc" id="L230">        Assert.assertEquals( 4, createVector(1, 2, 3, 3).getNormSq().getPartialDerivative(0, 1, 0), 0);</span>
<span class="fc" id="L231">        Assert.assertEquals( 6, createVector(1, 2, 3, 3).getNormSq().getPartialDerivative(0, 0, 1), 0);</span>
<span class="fc" id="L232">    }</span>

    @Test
    public void testNormInf() {
<span class="fc" id="L236">        Assert.assertEquals( 0.0, createVector(0, 0, 0, 3).getNormInf().getReal(), 0);</span>
<span class="fc" id="L237">        Assert.assertEquals( 3.0, createVector(1, -2, 3, 3).getNormInf().getReal(), 0);</span>
<span class="fc" id="L238">        Assert.assertEquals( 0.0, createVector(1, -2, 3, 3).getNormInf().getPartialDerivative(1, 0, 0), 0);</span>
<span class="fc" id="L239">        Assert.assertEquals( 0.0, createVector(1, -2, 3, 3).getNormInf().getPartialDerivative(0, 1, 0), 0);</span>
<span class="fc" id="L240">        Assert.assertEquals( 1.0, createVector(1, -2, 3, 3).getNormInf().getPartialDerivative(0, 0, 1), 0);</span>
<span class="fc" id="L241">        Assert.assertEquals( 3.0, createVector(2, -1, 3, 3).getNormInf().getReal(), 0);</span>
<span class="fc" id="L242">        Assert.assertEquals( 0.0, createVector(2, -1, 3, 3).getNormInf().getPartialDerivative(1, 0, 0), 0);</span>
<span class="fc" id="L243">        Assert.assertEquals( 0.0, createVector(2, -1, 3, 3).getNormInf().getPartialDerivative(0, 1, 0), 0);</span>
<span class="fc" id="L244">        Assert.assertEquals( 1.0, createVector(2, -1, 3, 3).getNormInf().getPartialDerivative(0, 0, 1), 0);</span>
<span class="fc" id="L245">        Assert.assertEquals( 3.0, createVector(1, -3, 2, 3).getNormInf().getReal(), 0);</span>
<span class="fc" id="L246">        Assert.assertEquals( 0.0, createVector(1, -3, 2, 3).getNormInf().getPartialDerivative(1, 0, 0), 0);</span>
<span class="fc" id="L247">        Assert.assertEquals(-1.0, createVector(1, -3, 2, 3).getNormInf().getPartialDerivative(0, 1, 0), 0);</span>
<span class="fc" id="L248">        Assert.assertEquals( 0.0, createVector(1, -3, 2, 3).getNormInf().getPartialDerivative(0, 0, 1), 0);</span>
<span class="fc" id="L249">        Assert.assertEquals( 3.0, createVector(2, -3, 1, 3).getNormInf().getReal(), 0);</span>
<span class="fc" id="L250">        Assert.assertEquals( 0.0, createVector(2, -3, 1, 3).getNormInf().getPartialDerivative(1, 0, 0), 0);</span>
<span class="fc" id="L251">        Assert.assertEquals(-1.0, createVector(2, -3, 1, 3).getNormInf().getPartialDerivative(0, 1, 0), 0);</span>
<span class="fc" id="L252">        Assert.assertEquals( 0.0, createVector(2, -3, 1, 3).getNormInf().getPartialDerivative(0, 0, 1), 0);</span>
<span class="fc" id="L253">        Assert.assertEquals( 3.0, createVector(3, -1, 2, 3).getNormInf().getReal(), 0);</span>
<span class="fc" id="L254">        Assert.assertEquals( 1.0, createVector(3, -1, 2, 3).getNormInf().getPartialDerivative(1, 0, 0), 0);</span>
<span class="fc" id="L255">        Assert.assertEquals( 0.0, createVector(3, -1, 2, 3).getNormInf().getPartialDerivative(0, 1, 0), 0);</span>
<span class="fc" id="L256">        Assert.assertEquals( 0.0, createVector(3, -1, 2, 3).getNormInf().getPartialDerivative(0, 0, 1), 0);</span>
<span class="fc" id="L257">        Assert.assertEquals( 3.0, createVector(3, -2, 1, 3).getNormInf().getReal(), 0);</span>
<span class="fc" id="L258">        Assert.assertEquals( 1.0, createVector(3, -2, 1, 3).getNormInf().getPartialDerivative(1, 0, 0), 0);</span>
<span class="fc" id="L259">        Assert.assertEquals( 0.0, createVector(3, -2, 1, 3).getNormInf().getPartialDerivative(0, 1, 0), 0);</span>
<span class="fc" id="L260">        Assert.assertEquals( 0.0, createVector(3, -2, 1, 3).getNormInf().getPartialDerivative(0, 0, 1), 0);</span>
<span class="fc" id="L261">    }</span>

    @Test
    public void testDistance1() {
<span class="fc" id="L265">        FieldVector3D&lt;DerivativeStructure&gt; v1 = createVector(1, -2, 3, 3);</span>
<span class="fc" id="L266">        FieldVector3D&lt;DerivativeStructure&gt; v2 = createVector(-4, 2, 0, 3);</span>
<span class="fc" id="L267">        Assert.assertEquals(0.0, FieldVector3D.distance1(createVector(-1, 0, 0, 3), createVector(-1, 0, 0, 3)).getReal(), 0);</span>
<span class="fc" id="L268">        DerivativeStructure distance = FieldVector3D.distance1(v1, v2);</span>
<span class="fc" id="L269">        Assert.assertEquals(12.0, distance.getReal(), 1.0e-12);</span>
<span class="fc" id="L270">        Assert.assertEquals(0, distance.getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L271">        Assert.assertEquals(0, distance.getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L272">        Assert.assertEquals(0, distance.getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L273">        distance = FieldVector3D.distance1(v1, new Cartesian3D(-4, 2, 0));</span>
<span class="fc" id="L274">        Assert.assertEquals(12.0, distance.getReal(), 1.0e-12);</span>
<span class="fc" id="L275">        Assert.assertEquals( 1, distance.getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L276">        Assert.assertEquals(-1, distance.getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L277">        Assert.assertEquals( 1, distance.getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L278">        distance = FieldVector3D.distance1(new Cartesian3D(-4, 2, 0), v1);</span>
<span class="fc" id="L279">        Assert.assertEquals(12.0, distance.getReal(), 1.0e-12);</span>
<span class="fc" id="L280">        Assert.assertEquals( 1, distance.getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L281">        Assert.assertEquals(-1, distance.getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L282">        Assert.assertEquals( 1, distance.getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L283">    }</span>

    @Test
    public void testDistance() {
<span class="fc" id="L287">        FieldVector3D&lt;DerivativeStructure&gt; v1 = createVector(1, -2, 3, 3);</span>
<span class="fc" id="L288">        FieldVector3D&lt;DerivativeStructure&gt; v2 = createVector(-4, 2, 0, 3);</span>
<span class="fc" id="L289">        Assert.assertEquals(0.0, FieldVector3D.distance(createVector(-1, 0, 0, 3), createVector(-1, 0, 0, 3)).getReal(), 0);</span>
<span class="fc" id="L290">        DerivativeStructure distance = FieldVector3D.distance(v1, v2);</span>
<span class="fc" id="L291">        Assert.assertEquals(FastMath.sqrt(50), distance.getReal(), 1.0e-12);</span>
<span class="fc" id="L292">        Assert.assertEquals(0, distance.getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L293">        Assert.assertEquals(0, distance.getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L294">        Assert.assertEquals(0, distance.getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L295">        distance = FieldVector3D.distance(v1, new Cartesian3D(-4, 2, 0));</span>
<span class="fc" id="L296">        Assert.assertEquals(FastMath.sqrt(50), distance.getReal(), 1.0e-12);</span>
<span class="fc" id="L297">        Assert.assertEquals( 5 / FastMath.sqrt(50), distance.getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L298">        Assert.assertEquals(-4 / FastMath.sqrt(50), distance.getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L299">        Assert.assertEquals( 3 / FastMath.sqrt(50), distance.getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L300">        distance = FieldVector3D.distance(new Cartesian3D(-4, 2, 0), v1);</span>
<span class="fc" id="L301">        Assert.assertEquals(FastMath.sqrt(50), distance.getReal(), 1.0e-12);</span>
<span class="fc" id="L302">        Assert.assertEquals( 5 / FastMath.sqrt(50), distance.getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L303">        Assert.assertEquals(-4 / FastMath.sqrt(50), distance.getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L304">        Assert.assertEquals( 3 / FastMath.sqrt(50), distance.getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L305">    }</span>

    @Test
    public void testDistanceSq() {
<span class="fc" id="L309">        FieldVector3D&lt;DerivativeStructure&gt; v1 = createVector(1, -2, 3, 3);</span>
<span class="fc" id="L310">        FieldVector3D&lt;DerivativeStructure&gt; v2 = createVector(-4, 2, 0, 3);</span>
<span class="fc" id="L311">        Assert.assertEquals(0.0, FieldVector3D.distanceSq(createVector(-1, 0, 0, 3), createVector(-1, 0, 0, 3)).getReal(), 0);</span>
<span class="fc" id="L312">        DerivativeStructure distanceSq = FieldVector3D.distanceSq(v1, v2);</span>
<span class="fc" id="L313">        Assert.assertEquals(50.0, distanceSq.getReal(), 1.0e-12);</span>
<span class="fc" id="L314">        Assert.assertEquals(0, distanceSq.getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L315">        Assert.assertEquals(0, distanceSq.getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L316">        Assert.assertEquals(0, distanceSq.getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L317">        distanceSq = FieldVector3D.distanceSq(v1, new Cartesian3D(-4, 2, 0));</span>
<span class="fc" id="L318">        Assert.assertEquals(50.0, distanceSq.getReal(), 1.0e-12);</span>
<span class="fc" id="L319">        Assert.assertEquals(10, distanceSq.getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L320">        Assert.assertEquals(-8, distanceSq.getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L321">        Assert.assertEquals( 6, distanceSq.getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L322">        distanceSq = FieldVector3D.distanceSq(new Cartesian3D(-4, 2, 0), v1);</span>
<span class="fc" id="L323">        Assert.assertEquals(50.0, distanceSq.getReal(), 1.0e-12);</span>
<span class="fc" id="L324">        Assert.assertEquals(10, distanceSq.getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L325">        Assert.assertEquals(-8, distanceSq.getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L326">        Assert.assertEquals( 6, distanceSq.getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L327">  }</span>

    @Test
    public void testDistanceInf() {
<span class="fc" id="L331">        FieldVector3D&lt;DerivativeStructure&gt; v1 = createVector(1, -2, 3, 3);</span>
<span class="fc" id="L332">        FieldVector3D&lt;DerivativeStructure&gt; v2 = createVector(-4, 2, 0, 3);</span>
<span class="fc" id="L333">        Assert.assertEquals(0.0, FieldVector3D.distanceInf(createVector(-1, 0, 0, 3), createVector(-1, 0, 0, 3)).getReal(), 0);</span>
<span class="fc" id="L334">        DerivativeStructure distance = FieldVector3D.distanceInf(v1, v2);</span>
<span class="fc" id="L335">        Assert.assertEquals(5.0, distance.getReal(), 1.0e-12);</span>
<span class="fc" id="L336">        Assert.assertEquals(0, distance.getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L337">        Assert.assertEquals(0, distance.getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L338">        Assert.assertEquals(0, distance.getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L339">        distance = FieldVector3D.distanceInf(v1, new Cartesian3D(-4, 2, 0));</span>
<span class="fc" id="L340">        Assert.assertEquals(5.0, distance.getReal(), 1.0e-12);</span>
<span class="fc" id="L341">        Assert.assertEquals(1, distance.getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L342">        Assert.assertEquals(0, distance.getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L343">        Assert.assertEquals(0, distance.getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L344">        distance = FieldVector3D.distanceInf(new Cartesian3D(-4, 2, 0), v1);</span>
<span class="fc" id="L345">        Assert.assertEquals(5.0, distance.getReal(), 1.0e-12);</span>
<span class="fc" id="L346">        Assert.assertEquals(1, distance.getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L347">        Assert.assertEquals(0, distance.getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L348">        Assert.assertEquals(0, distance.getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L349">        Assert.assertEquals(v1.subtract(v2).getNormInf().getReal(), FieldVector3D.distanceInf(v1, v2).getReal(), 1.0e-12);</span>

<span class="fc" id="L351">        Assert.assertEquals(5.0,</span>
<span class="fc" id="L352">                            FieldVector3D.distanceInf(createVector( 1, -2, 3, 3), createVector(-4,  2, 0, 3)).getReal(),</span>
                            1.0e-12);
<span class="fc" id="L354">        Assert.assertEquals(5.0,</span>
<span class="fc" id="L355">                            FieldVector3D.distanceInf(createVector( 1, 3, -2, 3), createVector(-4, 0,  2, 3)).getReal(),</span>
                            1.0e-12);
<span class="fc" id="L357">        Assert.assertEquals(5.0,</span>
<span class="fc" id="L358">                            FieldVector3D.distanceInf(createVector(-2,  1, 3, 3), createVector( 2, -4, 0, 3)).getReal(),</span>
                            1.0e-12);
<span class="fc" id="L360">        Assert.assertEquals(5.0,</span>
<span class="fc" id="L361">                            FieldVector3D.distanceInf(createVector(-2, 3,  1, 3), createVector( 2, 0, -4, 3)).getReal(),</span>
                            1.0e-12);
<span class="fc" id="L363">        Assert.assertEquals(5.0,</span>
<span class="fc" id="L364">                            FieldVector3D.distanceInf(createVector(3, -2,  1, 3), createVector(0,  2, -4, 3)).getReal(),</span>
                            1.0e-12);
<span class="fc" id="L366">        Assert.assertEquals(5.0,</span>
<span class="fc" id="L367">                            FieldVector3D.distanceInf(createVector(3,  1, -2, 3), createVector(0, -4,  2, 3)).getReal(),</span>
                            1.0e-12);

<span class="fc" id="L370">        Assert.assertEquals(5.0,</span>
<span class="fc" id="L371">                            FieldVector3D.distanceInf(createVector( 1, -2, 3, 3), new Cartesian3D(-4,  2, 0)).getReal(),</span>
                            1.0e-12);
<span class="fc" id="L373">        Assert.assertEquals(5.0,</span>
<span class="fc" id="L374">                            FieldVector3D.distanceInf(createVector( 1, 3, -2, 3), new Cartesian3D(-4, 0,  2)).getReal(),</span>
                            1.0e-12);
<span class="fc" id="L376">        Assert.assertEquals(5.0,</span>
<span class="fc" id="L377">                            FieldVector3D.distanceInf(createVector(-2,  1, 3, 3), new Cartesian3D( 2, -4, 0)).getReal(),</span>
                            1.0e-12);
<span class="fc" id="L379">        Assert.assertEquals(5.0,</span>
<span class="fc" id="L380">                            FieldVector3D.distanceInf(createVector(-2, 3,  1, 3), new Cartesian3D( 2, 0, -4)).getReal(),</span>
                            1.0e-12);
<span class="fc" id="L382">        Assert.assertEquals(5.0,</span>
<span class="fc" id="L383">                            FieldVector3D.distanceInf(createVector(3, -2,  1, 3), new Cartesian3D(0,  2, -4)).getReal(),</span>
                            1.0e-12);
<span class="fc" id="L385">        Assert.assertEquals(5.0,</span>
<span class="fc" id="L386">                            FieldVector3D.distanceInf(createVector(3,  1, -2, 3), new Cartesian3D(0, -4,  2)).getReal(),</span>
                            1.0e-12);

<span class="fc" id="L389">    }</span>

    @Test
    public void testSubtract() {
<span class="fc" id="L393">        FieldVector3D&lt;DerivativeStructure&gt; v1 = createVector(1, 2, 3, 3);</span>
<span class="fc" id="L394">        FieldVector3D&lt;DerivativeStructure&gt; v2 = createVector(-3, -2, -1, 3);</span>
<span class="fc" id="L395">        v1 = v1.subtract(v2);</span>
<span class="fc" id="L396">        checkVector(v1, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0);</span>

<span class="fc" id="L398">        checkVector(v2.subtract(v1), -7, -6, -5, 1, 0, 0, 0, 1, 0, 0, 0, 1);</span>
<span class="fc" id="L399">        checkVector(v2.subtract(new Cartesian3D(4, 4, 4)), -7, -6, -5, 1, 0, 0, 0, 1, 0, 0, 0, 1);</span>
<span class="fc" id="L400">        checkVector(v2.subtract(3, v1), -15, -14, -13, 1, 0, 0, 0, 1, 0, 0, 0, 1);</span>
<span class="fc" id="L401">        checkVector(v2.subtract(3, new Cartesian3D(4, 4, 4)), -15, -14, -13, 1, 0, 0, 0, 1, 0, 0, 0, 1);</span>
<span class="fc" id="L402">        checkVector(v2.subtract(new DerivativeStructure(3, 1, 2, 3), new Cartesian3D(4, 4, 4)),</span>
                    -15, -14, -13, 1, 0, -4, 0, 1, -4, 0, 0, -3);

<span class="fc" id="L405">        checkVector(createVector(1, 2, 3, 4).subtract(new DerivativeStructure(4, 1, 3, 5.0),</span>
<span class="fc" id="L406">                                                      createVector(3, -2, 1, 4)),</span>
                    -14, 12, -2,
                     -4,  0,  0, -3,
                      0, -4,  0,  2,
                      0,  0, -4, -1);

<span class="fc" id="L412">    }</span>

    @Test
    public void testAdd() {
<span class="fc" id="L416">        FieldVector3D&lt;DerivativeStructure&gt; v1 = createVector(1, 2, 3, 3);</span>
<span class="fc" id="L417">        FieldVector3D&lt;DerivativeStructure&gt; v2 = createVector(-3, -2, -1, 3);</span>
<span class="fc" id="L418">        v1 = v1.add(v2);</span>
<span class="fc" id="L419">        checkVector(v1, -2, 0, 2, 2, 0, 0, 0, 2, 0, 0, 0, 2);</span>

<span class="fc" id="L421">        checkVector(v2.add(v1), -5, -2, 1, 3, 0, 0, 0, 3, 0, 0, 0, 3);</span>
<span class="fc" id="L422">        checkVector(v2.add(new Cartesian3D(-2, 0, 2)), -5, -2, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1);</span>
<span class="fc" id="L423">        checkVector(v2.add(3, v1), -9, -2, 5, 7, 0, 0, 0, 7, 0, 0, 0, 7);</span>
<span class="fc" id="L424">        checkVector(v2.add(3, new Cartesian3D(-2, 0, 2)), -9, -2, 5, 1, 0, 0, 0, 1, 0, 0, 0, 1);</span>
<span class="fc" id="L425">        checkVector(v2.add(new DerivativeStructure(3, 1, 2, 3), new Cartesian3D(-2, 0, 2)),</span>
                    -9, -2, 5, 1, 0, -2, 0, 1, 0, 0, 0, 3);

<span class="fc" id="L428">        checkVector(createVector(1, 2, 3, 4).add(new DerivativeStructure(4, 1, 3, 5.0),</span>
<span class="fc" id="L429">                                                 createVector(3, -2, 1, 4)),</span>
                    16, -8,  8,
                     6,  0,  0,  3,
                     0,  6,  0, -2,
                     0,  0,  6,  1);

<span class="fc" id="L435">    }</span>

    @Test
    public void testScalarProduct() {
<span class="fc" id="L439">        FieldVector3D&lt;DerivativeStructure&gt; v = createVector(1, 2, 3, 3);</span>
<span class="fc" id="L440">        v = v.scalarMultiply(3);</span>
<span class="fc" id="L441">        checkVector(v, 3, 6, 9);</span>

<span class="fc" id="L443">        checkVector(v.scalarMultiply(0.5), 1.5, 3, 4.5);</span>
<span class="fc" id="L444">    }</span>

    @Test
    public void testVectorialProducts() {
<span class="fc" id="L448">        FieldVector3D&lt;DerivativeStructure&gt; v1 = createVector(2, 1, -4, 3);</span>
<span class="fc" id="L449">        FieldVector3D&lt;DerivativeStructure&gt; v2 = createVector(3, 1, -1, 3);</span>

<span class="pc bpc" id="L451" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(FieldVector3D.dotProduct(v1, v2).getReal() - 11) &lt; 1.0e-12);</span>
<span class="pc bpc" id="L452" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(FieldVector3D.dotProduct(v1, v2.toVector3D()).getReal() - 11) &lt; 1.0e-12);</span>
<span class="pc bpc" id="L453" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(FieldVector3D.dotProduct(v1.toVector3D(), v2).getReal() - 11) &lt; 1.0e-12);</span>

<span class="fc" id="L455">        FieldVector3D&lt;DerivativeStructure&gt; v3 = FieldVector3D.crossProduct(v1, v2);</span>
<span class="fc" id="L456">        checkVector(v3, 3, -10, -1);</span>
<span class="pc bpc" id="L457" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(FieldVector3D.dotProduct(v1, v3).getReal()) &lt; 1.0e-12);</span>
<span class="pc bpc" id="L458" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(FieldVector3D.dotProduct(v2, v3).getReal()) &lt; 1.0e-12);</span>

<span class="fc" id="L460">        v3 = FieldVector3D.crossProduct(v1, v2.toVector3D());</span>
<span class="fc" id="L461">        checkVector(v3, 3, -10, -1);</span>
<span class="pc bpc" id="L462" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(FieldVector3D.dotProduct(v1, v3).getReal()) &lt; 1.0e-12);</span>
<span class="pc bpc" id="L463" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(FieldVector3D.dotProduct(v2, v3).getReal()) &lt; 1.0e-12);</span>

<span class="fc" id="L465">        v3 = FieldVector3D.crossProduct(v1.toVector3D(), v2);</span>
<span class="fc" id="L466">        checkVector(v3, 3, -10, -1);</span>
<span class="pc bpc" id="L467" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(FieldVector3D.dotProduct(v1, v3).getReal()) &lt; 1.0e-12);</span>
<span class="pc bpc" id="L468" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(FieldVector3D.dotProduct(v2, v3).getReal()) &lt; 1.0e-12);</span>

<span class="fc" id="L470">    }</span>

    @Test
    public void testCrossProductCancellation() {
<span class="fc" id="L474">        FieldVector3D&lt;DerivativeStructure&gt; v1 = createVector(9070467121.0, 4535233560.0, 1, 3);</span>
<span class="fc" id="L475">        FieldVector3D&lt;DerivativeStructure&gt; v2 = createVector(9070467123.0, 4535233561.0, 1, 3);</span>
<span class="fc" id="L476">        checkVector(FieldVector3D.crossProduct(v1, v2), -1, 2, 1);</span>

<span class="fc" id="L478">        double scale    = FastMath.scalb(1.0, 100);</span>
<span class="fc" id="L479">        FieldVector3D&lt;DerivativeStructure&gt; big1   = new FieldVector3D&lt;&gt;(scale, v1);</span>
<span class="fc" id="L480">        FieldVector3D&lt;DerivativeStructure&gt; small2 = new FieldVector3D&lt;&gt;(1 / scale, v2);</span>
<span class="fc" id="L481">        checkVector(FieldVector3D.crossProduct(big1, small2), -1, 2, 1);</span>

<span class="fc" id="L483">    }</span>

    @Test
    public void testAngular() {
<span class="fc" id="L487">        Assert.assertEquals(0,           createVector(1, 0, 0, 3).getAlpha().getReal(), 1.0e-10);</span>
<span class="fc" id="L488">        Assert.assertEquals(0,           createVector(1, 0, 0, 3).getDelta().getReal(), 1.0e-10);</span>
<span class="fc" id="L489">        Assert.assertEquals(FastMath.PI / 2, createVector(0, 1, 0, 3).getAlpha().getReal(), 1.0e-10);</span>
<span class="fc" id="L490">        Assert.assertEquals(0,           createVector(0, 1, 0, 3).getDelta().getReal(), 1.0e-10);</span>
<span class="fc" id="L491">        Assert.assertEquals(FastMath.PI / 2, createVector(0, 0, 1, 3).getDelta().getReal(), 1.0e-10);</span>

<span class="fc" id="L493">        FieldVector3D&lt;DerivativeStructure&gt; u = createVector(-1, 1, -1, 3);</span>
<span class="fc" id="L494">        Assert.assertEquals(3 * FastMath.PI /4, u.getAlpha().getReal(), 1.0e-10);</span>
<span class="fc" id="L495">        Assert.assertEquals(-1.0 / FastMath.sqrt(3), u.getDelta().sin().getReal(), 1.0e-10);</span>
<span class="fc" id="L496">    }</span>

    @Test
    public void testAngularSeparation() throws MathArithmeticException {
<span class="fc" id="L500">        FieldVector3D&lt;DerivativeStructure&gt; v1 = createVector(2, -1, 4, 3);</span>

<span class="fc" id="L502">        FieldVector3D&lt;DerivativeStructure&gt;  k = v1.normalize();</span>
<span class="fc" id="L503">        FieldVector3D&lt;DerivativeStructure&gt;  i = k.orthogonal();</span>
<span class="fc" id="L504">        FieldVector3D&lt;DerivativeStructure&gt; v2 = k.scalarMultiply(FastMath.cos(1.2)).add(i.scalarMultiply(FastMath.sin(1.2)));</span>

<span class="pc bpc" id="L506" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(FieldVector3D.angle(v1, v2).getReal() - 1.2) &lt; 1.0e-12);</span>
<span class="pc bpc" id="L507" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(FieldVector3D.angle(v1, v2.toVector3D()).getReal() - 1.2) &lt; 1.0e-12);</span>
<span class="pc bpc" id="L508" title="1 of 2 branches missed.">        Assert.assertTrue(FastMath.abs(FieldVector3D.angle(v1.toVector3D(), v2).getReal() - 1.2) &lt; 1.0e-12);</span>

        try {
<span class="nc" id="L511">            FieldVector3D.angle(v1, Cartesian3D.ZERO);</span>
<span class="nc" id="L512">            Assert.fail(&quot;an exception should have been thrown&quot;);</span>
<span class="fc" id="L513">        } catch (MathArithmeticException mae) {</span>
            // expected
<span class="nc" id="L515">        }</span>
<span class="fc" id="L516">        Assert.assertEquals(0.0, FieldVector3D.angle(v1, v1.toVector3D()).getReal(), 1.0e-15);</span>
<span class="fc" id="L517">        Assert.assertEquals(FastMath.PI, FieldVector3D.angle(v1, v1.negate().toVector3D()).getReal(), 1.0e-15);</span>

<span class="fc" id="L519">    }</span>

    @Test
    public void testNormalize() throws MathArithmeticException {
<span class="fc" id="L523">        Assert.assertEquals(1.0, createVector(5, -4, 2, 3).normalize().getNorm().getReal(), 1.0e-12);</span>
        try {
<span class="nc" id="L525">            createVector(0, 0, 0, 3).normalize();</span>
<span class="nc" id="L526">            Assert.fail(&quot;an exception should have been thrown&quot;);</span>
<span class="fc" id="L527">        } catch (MathArithmeticException ae) {</span>
            // expected behavior
<span class="nc" id="L529">        }</span>
<span class="fc" id="L530">    }</span>

    @Test
    public void testNegate() {
<span class="fc" id="L534">        checkVector(createVector(0.1, 2.5, 1.3, 3).negate(),</span>
                    -0.1, -2.5, -1.3, -1, 0, 0, 0, -1, 0, 0, 0, -1);
<span class="fc" id="L536">    }</span>

    @Test
    public void testOrthogonal() throws MathArithmeticException {
<span class="fc" id="L540">        FieldVector3D&lt;DerivativeStructure&gt; v1 = createVector(0.1, 2.5, 1.3, 3);</span>
<span class="fc" id="L541">        Assert.assertEquals(0.0, FieldVector3D.dotProduct(v1, v1.orthogonal()).getReal(), 1.0e-12);</span>
<span class="fc" id="L542">        FieldVector3D&lt;DerivativeStructure&gt; v2 = createVector(2.3, -0.003, 7.6, 3);</span>
<span class="fc" id="L543">        Assert.assertEquals(0.0, FieldVector3D.dotProduct(v2, v2.orthogonal()).getReal(), 1.0e-12);</span>
<span class="fc" id="L544">        FieldVector3D&lt;DerivativeStructure&gt; v3 = createVector(-1.7, 1.4, 0.2, 3);</span>
<span class="fc" id="L545">        Assert.assertEquals(0.0, FieldVector3D.dotProduct(v3, v3.orthogonal()).getReal(), 1.0e-12);</span>
<span class="fc" id="L546">        FieldVector3D&lt;DerivativeStructure&gt; v4 = createVector(4.2, 0.1, -1.8, 3);</span>
<span class="fc" id="L547">        Assert.assertEquals(0.0, FieldVector3D.dotProduct(v4, v4.orthogonal()).getReal(), 1.0e-12);</span>
        try {
<span class="nc" id="L549">            createVector(0, 0, 0, 3).orthogonal();</span>
<span class="nc" id="L550">            Assert.fail(&quot;an exception should have been thrown&quot;);</span>
<span class="fc" id="L551">        } catch (MathArithmeticException ae) {</span>
            // expected behavior
<span class="nc" id="L553">        }</span>
<span class="fc" id="L554">    }</span>

    @Test
    public void testAngle() throws MathArithmeticException {
<span class="fc" id="L558">        Assert.assertEquals(0.22572612855273393616,</span>
<span class="fc" id="L559">                            FieldVector3D.angle(createVector(1, 2, 3, 3), createVector(4, 5, 6, 3)).getReal(),</span>
                            1.0e-12);
<span class="fc" id="L561">        Assert.assertEquals(7.98595620686106654517199e-8,</span>
<span class="fc" id="L562">                            FieldVector3D.angle(createVector(1, 2, 3, 3), createVector(2, 4, 6.000001, 3)).getReal(),</span>
                            1.0e-12);
<span class="fc" id="L564">        Assert.assertEquals(3.14159257373023116985197793156,</span>
<span class="fc" id="L565">                            FieldVector3D.angle(createVector(1, 2, 3, 3), createVector(-2, -4, -6.000001, 3)).getReal(),</span>
                            1.0e-12);
        try {
<span class="nc" id="L568">            FieldVector3D.angle(createVector(0, 0, 0, 3), createVector(1, 0, 0, 3));</span>
<span class="nc" id="L569">            Assert.fail(&quot;an exception should have been thrown&quot;);</span>
<span class="fc" id="L570">        } catch (MathArithmeticException ae) {</span>
            // expected behavior
<span class="nc" id="L572">        }</span>
<span class="fc" id="L573">    }</span>

    @Test
    public void testAccurateDotProduct() {
        // the following two vectors are nearly but not exactly orthogonal
        // naive dot product (i.e. computing u1.x * u2.x + u1.y * u2.y + u1.z * u2.z
        // leads to a result of 0.0, instead of the correct -1.855129...
<span class="fc" id="L580">        FieldVector3D&lt;DerivativeStructure&gt; u1 = createVector(-1321008684645961.0 /  268435456.0,</span>
                                   -5774608829631843.0 /  268435456.0,
                                   -7645843051051357.0 / 8589934592.0, 3);
<span class="fc" id="L583">        FieldVector3D&lt;DerivativeStructure&gt; u2 = createVector(-5712344449280879.0 /    2097152.0,</span>
                                   -4550117129121957.0 /    2097152.0,
                                    8846951984510141.0 /     131072.0, 3);
<span class="fc" id="L586">        DerivativeStructure sNaive = u1.getX().multiply(u2.getX()).add(u1.getY().multiply(u2.getY())).add(u1.getZ().multiply(u2.getZ()));</span>
<span class="fc" id="L587">        DerivativeStructure sAccurate = FieldVector3D.dotProduct(u1, u2);</span>
<span class="fc" id="L588">        Assert.assertEquals(0.0, sNaive.getReal(), 1.0e-30);</span>
<span class="fc" id="L589">        Assert.assertEquals(-2088690039198397.0 / 1125899906842624.0, sAccurate.getReal(), 1.0e-15);</span>
<span class="fc" id="L590">    }</span>

    @Test
    public void testDotProduct() {
        // we compare accurate versus naive dot product implementations
        // on regular vectors (i.e. not extreme cases like in the previous test)
<span class="fc" id="L596">        UniformRandomProvider random = RandomSource.create(RandomSource.WELL_1024_A, 553267312521321237l);</span>
<span class="fc bfc" id="L597" title="All 2 branches covered.">        for (int i = 0; i &lt; 10000; ++i) {</span>
<span class="fc" id="L598">            double ux = 10000 * random.nextDouble();</span>
<span class="fc" id="L599">            double uy = 10000 * random.nextDouble();</span>
<span class="fc" id="L600">            double uz = 10000 * random.nextDouble();</span>
<span class="fc" id="L601">            double vx = 10000 * random.nextDouble();</span>
<span class="fc" id="L602">            double vy = 10000 * random.nextDouble();</span>
<span class="fc" id="L603">            double vz = 10000 * random.nextDouble();</span>
<span class="fc" id="L604">            double sNaive = ux * vx + uy * vy + uz * vz;</span>

<span class="fc" id="L606">            FieldVector3D&lt;DerivativeStructure&gt; uds = createVector(ux, uy, uz, 3);</span>
<span class="fc" id="L607">            FieldVector3D&lt;DerivativeStructure&gt; vds = createVector(vx, vy, vz, 3);</span>
<span class="fc" id="L608">            Cartesian3D v = new Cartesian3D(vx, vy, vz);</span>

<span class="fc" id="L610">            DerivativeStructure sAccurate = FieldVector3D.dotProduct(uds, vds);</span>
<span class="fc" id="L611">            Assert.assertEquals(sNaive, sAccurate.getReal(), 2.5e-16 * sNaive);</span>
<span class="fc" id="L612">            Assert.assertEquals(ux + vx, sAccurate.getPartialDerivative(1, 0, 0), 2.5e-16 * sNaive);</span>
<span class="fc" id="L613">            Assert.assertEquals(uy + vy, sAccurate.getPartialDerivative(0, 1, 0), 2.5e-16 * sNaive);</span>
<span class="fc" id="L614">            Assert.assertEquals(uz + vz, sAccurate.getPartialDerivative(0, 0, 1), 2.5e-16 * sNaive);</span>

<span class="fc" id="L616">            sAccurate = FieldVector3D.dotProduct(uds, v);</span>
<span class="fc" id="L617">            Assert.assertEquals(sNaive, sAccurate.getReal(), 2.5e-16 * sNaive);</span>
<span class="fc" id="L618">            Assert.assertEquals(vx, sAccurate.getPartialDerivative(1, 0, 0), 2.5e-16 * sNaive);</span>
<span class="fc" id="L619">            Assert.assertEquals(vy, sAccurate.getPartialDerivative(0, 1, 0), 2.5e-16 * sNaive);</span>
<span class="fc" id="L620">            Assert.assertEquals(vz, sAccurate.getPartialDerivative(0, 0, 1), 2.5e-16 * sNaive);</span>

        }
<span class="fc" id="L623">    }</span>

    @Test
    public void testAccurateCrossProduct() {
        // the vectors u1 and u2 are nearly but not exactly anti-parallel
        // (7.31e-16 degrees from 180 degrees) naive cross product (i.e.
        // computing u1.x * u2.x + u1.y * u2.y + u1.z * u2.z
        // leads to a result of   [0.0009765, -0.0001220, -0.0039062],
        // instead of the correct [0.0006913, -0.0001254, -0.0007909]
<span class="fc" id="L632">        final FieldVector3D&lt;DerivativeStructure&gt; u1 = createVector(-1321008684645961.0 /   268435456.0,</span>
                                         -5774608829631843.0 /   268435456.0,
                                         -7645843051051357.0 /  8589934592.0, 3);
<span class="fc" id="L635">        final FieldVector3D&lt;DerivativeStructure&gt; u2 = createVector( 1796571811118507.0 /  2147483648.0,</span>
                                          7853468008299307.0 /  2147483648.0,
                                          2599586637357461.0 / 17179869184.0, 3);
<span class="fc" id="L638">        final FieldVector3D&lt;DerivativeStructure&gt; u3 = createVector(12753243807587107.0 / 18446744073709551616.0,</span>
                                         -2313766922703915.0 / 18446744073709551616.0,
                                          -227970081415313.0 /   288230376151711744.0, 3);
<span class="fc" id="L641">        FieldVector3D&lt;DerivativeStructure&gt; cNaive = new FieldVector3D&lt;&gt;(u1.getY().multiply(u2.getZ()).subtract(u1.getZ().multiply(u2.getY())),</span>
<span class="fc" id="L642">                                       u1.getZ().multiply(u2.getX()).subtract(u1.getX().multiply(u2.getZ())),</span>
<span class="fc" id="L643">                                       u1.getX().multiply(u2.getY()).subtract(u1.getY().multiply(u2.getX())));</span>
<span class="fc" id="L644">        FieldVector3D&lt;DerivativeStructure&gt; cAccurate = FieldVector3D.crossProduct(u1, u2);</span>
<span class="pc bpc" id="L645" title="1 of 2 branches missed.">        Assert.assertTrue(FieldVector3D.distance(u3, cNaive).getReal() &gt; 2.9 * u3.getNorm().getReal());</span>
<span class="fc" id="L646">        Assert.assertEquals(0.0, FieldVector3D.distance(u3, cAccurate).getReal(), 1.0e-30 * cAccurate.getNorm().getReal());</span>
<span class="fc" id="L647">    }</span>

    @Test
    public void testCrossProduct() {
        // we compare accurate versus naive cross product implementations
        // on regular vectors (i.e. not extreme cases like in the previous test)
<span class="fc" id="L653">        UniformRandomProvider random = RandomSource.create(RandomSource.WELL_1024_A, 885362227452043214l);</span>
<span class="fc bfc" id="L654" title="All 2 branches covered.">        for (int i = 0; i &lt; 10000; ++i) {</span>
<span class="fc" id="L655">            double ux = random.nextDouble();</span>
<span class="fc" id="L656">            double uy = random.nextDouble();</span>
<span class="fc" id="L657">            double uz = random.nextDouble();</span>
<span class="fc" id="L658">            double vx = random.nextDouble();</span>
<span class="fc" id="L659">            double vy = random.nextDouble();</span>
<span class="fc" id="L660">            double vz = random.nextDouble();</span>
<span class="fc" id="L661">            Cartesian3D cNaive = new Cartesian3D(uy * vz - uz * vy, uz * vx - ux * vz, ux * vy - uy * vx);</span>

<span class="fc" id="L663">            FieldVector3D&lt;DerivativeStructure&gt; uds = createVector(ux, uy, uz, 3);</span>
<span class="fc" id="L664">            FieldVector3D&lt;DerivativeStructure&gt; vds = createVector(vx, vy, vz, 3);</span>
<span class="fc" id="L665">            Cartesian3D v = new Cartesian3D(vx, vy, vz);</span>

<span class="fc" id="L667">            checkVector(FieldVector3D.crossProduct(uds, vds),</span>
<span class="fc" id="L668">                        cNaive.getX(), cNaive.getY(), cNaive.getZ(),</span>
                        0, vz - uz, uy - vy,
                        uz - vz, 0, vx - ux,
                        vy - uy, ux - vx, 0);

<span class="fc" id="L673">            checkVector(FieldVector3D.crossProduct(uds, v),</span>
<span class="fc" id="L674">                        cNaive.getX(), cNaive.getY(), cNaive.getZ(),</span>
                          0,  vz, -vy,
                        -vz,   0,  vx,
                         vy, -vx,   0);

        }
<span class="fc" id="L680">    }</span>

    private FieldVector3D&lt;DerivativeStructure&gt; createVector(double x, double y, double z, int params) {
<span class="fc" id="L683">        return new FieldVector3D&lt;&gt;(new DerivativeStructure(params, 1, 0, x),</span>
                              new DerivativeStructure(params, 1, 1, y),
                              new DerivativeStructure(params, 1, 2, z));
    }

    private void checkVector(FieldVector3D&lt;DerivativeStructure&gt; v, double x, double y, double z) {
<span class="fc" id="L689">        Assert.assertEquals(x, v.getX().getReal(), 1.0e-12);</span>
<span class="fc" id="L690">        Assert.assertEquals(y, v.getY().getReal(), 1.0e-12);</span>
<span class="fc" id="L691">        Assert.assertEquals(z, v.getZ().getReal(), 1.0e-12);</span>
<span class="fc" id="L692">    }</span>

    private void checkVector(FieldVector3D&lt;DerivativeStructure&gt; v, double x, double y, double z,
                             double dxdx, double dxdy, double dxdz,
                             double dydx, double dydy, double dydz,
                             double dzdx, double dzdy, double dzdz) {
<span class="fc" id="L698">        Assert.assertEquals(x, v.getX().getReal(), 1.0e-12);</span>
<span class="fc" id="L699">        Assert.assertEquals(y, v.getY().getReal(), 1.0e-12);</span>
<span class="fc" id="L700">        Assert.assertEquals(z, v.getZ().getReal(), 1.0e-12);</span>
<span class="fc" id="L701">        Assert.assertEquals(dxdx, v.getX().getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L702">        Assert.assertEquals(dxdy, v.getX().getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L703">        Assert.assertEquals(dxdz, v.getX().getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L704">        Assert.assertEquals(dydx, v.getY().getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L705">        Assert.assertEquals(dydy, v.getY().getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L706">        Assert.assertEquals(dydz, v.getY().getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L707">        Assert.assertEquals(dzdx, v.getZ().getPartialDerivative(1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L708">        Assert.assertEquals(dzdy, v.getZ().getPartialDerivative(0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L709">        Assert.assertEquals(dzdz, v.getZ().getPartialDerivative(0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L710">    }</span>

    private void checkVector(FieldVector3D&lt;DerivativeStructure&gt; v, double x, double y, double z,
                             double dxdx, double dxdy, double dxdz, double dxdt,
                             double dydx, double dydy, double dydz, double dydt,
                             double dzdx, double dzdy, double dzdz, double dzdt) {
<span class="fc" id="L716">        Assert.assertEquals(x, v.getX().getReal(), 1.0e-12);</span>
<span class="fc" id="L717">        Assert.assertEquals(y, v.getY().getReal(), 1.0e-12);</span>
<span class="fc" id="L718">        Assert.assertEquals(z, v.getZ().getReal(), 1.0e-12);</span>
<span class="fc" id="L719">        Assert.assertEquals(dxdx, v.getX().getPartialDerivative(1, 0, 0, 0), 1.0e-12);</span>
<span class="fc" id="L720">        Assert.assertEquals(dxdy, v.getX().getPartialDerivative(0, 1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L721">        Assert.assertEquals(dxdz, v.getX().getPartialDerivative(0, 0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L722">        Assert.assertEquals(dxdt, v.getX().getPartialDerivative(0, 0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L723">        Assert.assertEquals(dydx, v.getY().getPartialDerivative(1, 0, 0, 0), 1.0e-12);</span>
<span class="fc" id="L724">        Assert.assertEquals(dydy, v.getY().getPartialDerivative(0, 1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L725">        Assert.assertEquals(dydz, v.getY().getPartialDerivative(0, 0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L726">        Assert.assertEquals(dydt, v.getY().getPartialDerivative(0, 0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L727">        Assert.assertEquals(dzdx, v.getZ().getPartialDerivative(1, 0, 0, 0), 1.0e-12);</span>
<span class="fc" id="L728">        Assert.assertEquals(dzdy, v.getZ().getPartialDerivative(0, 1, 0, 0), 1.0e-12);</span>
<span class="fc" id="L729">        Assert.assertEquals(dzdz, v.getZ().getPartialDerivative(0, 0, 1, 0), 1.0e-12);</span>
<span class="fc" id="L730">        Assert.assertEquals(dzdt, v.getZ().getPartialDerivative(0, 0, 0, 1), 1.0e-12);</span>
<span class="fc" id="L731">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>