<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MillerUpdatingRegressionTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">commons_math4$All_in_commons_math4.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.math4.stat.regression</a> &gt; <span class="el_source">MillerUpdatingRegressionTest.java</span></div><h1>MillerUpdatingRegressionTest.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.math4.stat.regression;

import org.apache.commons.math4.TestUtils;
import org.apache.commons.math4.exception.MathIllegalArgumentException;
import org.apache.commons.math4.linear.RealMatrix;
import org.apache.commons.math4.stat.correlation.PearsonsCorrelation;
import org.apache.commons.math4.stat.regression.MillerUpdatingRegression;
import org.apache.commons.math4.stat.regression.OLSMultipleLinearRegression;
import org.apache.commons.math4.stat.regression.RegressionResults;
import org.apache.commons.math4.util.FastMath;
import org.junit.Assert;
import org.junit.Test;

/**
 * MillerUpdatingRegression tests.
 */
public class MillerUpdatingRegressionTest {

<span class="fc" id="L35">    public MillerUpdatingRegressionTest() {</span>
<span class="fc" id="L36">    }</span>
    /* This is the Greene Airline Cost data.
     * The data can be downloaded from http://www.indiana.edu/~statmath/stat/all/panel/airline.csv
     */
<span class="fc" id="L40">    private final static double[][] airdata = {</span>
        /*&quot;I&quot;,*/new double[]{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6},
        /*&quot;T&quot;,*/ new double[]{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15},
        /*&quot;C&quot;,*/ new double[]{1140640, 1215690, 1309570, 1511530, 1676730, 1823740, 2022890, 2314760, 2639160, 3247620, 3787750, 3867750, 3996020, 4282880, 4748320, 569292, 640614, 777655, 999294, 1203970, 1358100, 1501350, 1709270, 2025400, 2548370, 3137740, 3557700, 3717740, 3962370, 4209390, 286298, 309290, 342056, 374595, 450037, 510412, 575347, 669331, 783799, 913883, 1041520, 1125800, 1096070, 1198930, 1170470, 145167, 170192, 247506, 309391, 354338, 373941, 420915, 474017, 532590, 676771, 880438, 1052020, 1193680, 1303390, 1436970, 91361, 95428, 98187, 115967, 138382, 156228, 183169, 210212, 274024, 356915, 432344, 524294, 530924, 581447, 610257, 68978, 74904, 83829, 98148, 118449, 133161, 145062, 170711, 199775, 276797, 381478, 506969, 633388, 804388, 1009500},
        /*&quot;Q&quot;,*/ new double[]{0.952757, 0.986757, 1.09198, 1.17578, 1.16017, 1.17376, 1.29051, 1.39067, 1.61273, 1.82544, 1.54604, 1.5279, 1.6602, 1.82231, 1.93646, 0.520635, 0.534627, 0.655192, 0.791575, 0.842945, 0.852892, 0.922843, 1, 1.19845, 1.34067, 1.32624, 1.24852, 1.25432, 1.37177, 1.38974, 0.262424, 0.266433, 0.306043, 0.325586, 0.345706, 0.367517, 0.409937, 0.448023, 0.539595, 0.539382, 0.467967, 0.450544, 0.468793, 0.494397, 0.493317, 0.086393, 0.09674, 0.1415, 0.169715, 0.173805, 0.164272, 0.170906, 0.17784, 0.192248, 0.242469, 0.256505, 0.249657, 0.273923, 0.371131, 0.421411, 0.051028, 0.052646, 0.056348, 0.066953, 0.070308, 0.073961, 0.084946, 0.095474, 0.119814, 0.150046, 0.144014, 0.1693, 0.172761, 0.18667, 0.213279, 0.037682, 0.039784, 0.044331, 0.050245, 0.055046, 0.052462, 0.056977, 0.06149, 0.069027, 0.092749, 0.11264, 0.154154, 0.186461, 0.246847, 0.304013},
        /*&quot;PF&quot;,*/ new double[]{106650, 110307, 110574, 121974, 196606, 265609, 263451, 316411, 384110, 569251, 871636, 997239, 938002, 859572, 823411, 103795, 111477, 118664, 114797, 215322, 281704, 304818, 348609, 374579, 544109, 853356, 1003200, 941977, 856533, 821361, 118788, 123798, 122882, 131274, 222037, 278721, 306564, 356073, 378311, 555267, 850322, 1015610, 954508, 886999, 844079, 114987, 120501, 121908, 127220, 209405, 263148, 316724, 363598, 389436, 547376, 850418, 1011170, 951934, 881323, 831374, 118222, 116223, 115853, 129372, 243266, 277930, 317273, 358794, 397667, 566672, 848393, 1005740, 958231, 872924, 844622, 117112, 119420, 116087, 122997, 194309, 307923, 323595, 363081, 386422, 564867, 874818, 1013170, 930477, 851676, 819476},
        /*&quot;LF&quot;,*/ new double[]{0.534487, 0.532328, 0.547736, 0.540846, 0.591167, 0.575417, 0.594495, 0.597409, 0.638522, 0.676287, 0.605735, 0.61436, 0.633366, 0.650117, 0.625603, 0.490851, 0.473449, 0.503013, 0.512501, 0.566782, 0.558133, 0.558799, 0.57207, 0.624763, 0.628706, 0.58915, 0.532612, 0.526652, 0.540163, 0.528775, 0.524334, 0.537185, 0.582119, 0.579489, 0.606592, 0.60727, 0.582425, 0.573972, 0.654256, 0.631055, 0.56924, 0.589682, 0.587953, 0.565388, 0.577078, 0.432066, 0.439669, 0.488932, 0.484181, 0.529925, 0.532723, 0.549067, 0.55714, 0.611377, 0.645319, 0.611734, 0.580884, 0.572047, 0.59457, 0.585525, 0.442875, 0.462473, 0.519118, 0.529331, 0.557797, 0.556181, 0.569327, 0.583465, 0.631818, 0.604723, 0.587921, 0.616159, 0.605868, 0.594688, 0.635545, 0.448539, 0.475889, 0.500562, 0.500344, 0.528897, 0.495361, 0.510342, 0.518296, 0.546723, 0.554276, 0.517766, 0.580049, 0.556024, 0.537791, 0.525775}
    };

    /**
     * Test of hasIntercept method, of class MillerUpdatingRegression.
     */
    @Test
    public void testHasIntercept() {
<span class="fc" id="L54">        MillerUpdatingRegression instance = new MillerUpdatingRegression(10, false);</span>
<span class="pc bpc" id="L55" title="1 of 2 branches missed.">        if (instance.hasIntercept()) {</span>
<span class="nc" id="L56">            Assert.fail(&quot;Should not have intercept&quot;);</span>
        }
<span class="fc" id="L58">        instance = new MillerUpdatingRegression(10, true);</span>
<span class="pc bpc" id="L59" title="1 of 2 branches missed.">        if (!instance.hasIntercept()) {</span>
<span class="nc" id="L60">            Assert.fail(&quot;Should have intercept&quot;);</span>
        }
<span class="fc" id="L62">    }</span>

    /**
     * Test of getN method, of class MillerUpdatingRegression.
     */
    @Test
    public void testAddObsGetNClear() {
<span class="fc" id="L69">        MillerUpdatingRegression instance = new MillerUpdatingRegression(3, true);</span>
<span class="fc" id="L70">        double[][] xAll = new double[airdata[0].length][];</span>
<span class="fc" id="L71">        double[] y = new double[airdata[0].length];</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">        for (int i = 0; i &lt; airdata[0].length; i++) {</span>
<span class="fc" id="L73">            xAll[i] = new double[3];</span>
<span class="fc" id="L74">            xAll[i][0] = FastMath.log(airdata[3][i]);</span>
<span class="fc" id="L75">            xAll[i][1] = FastMath.log(airdata[4][i]);</span>
<span class="fc" id="L76">            xAll[i][2] = airdata[5][i];</span>
<span class="fc" id="L77">            y[i] = FastMath.log(airdata[2][i]);</span>
        }
<span class="fc" id="L79">        instance.addObservations(xAll, y);</span>
<span class="pc bpc" id="L80" title="1 of 2 branches missed.">        if (instance.getN() != xAll.length) {</span>
<span class="nc" id="L81">            Assert.fail(&quot;Number of observations not correct in bulk addition&quot;);</span>
        }
<span class="fc" id="L83">        instance.clear();</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">        for (int i = 0; i &lt; xAll.length; i++) {</span>
<span class="fc" id="L85">            instance.addObservation(xAll[i], y[i]);</span>
        }
<span class="pc bpc" id="L87" title="1 of 2 branches missed.">        if (instance.getN() != xAll.length) {</span>
<span class="nc" id="L88">            Assert.fail(&quot;Number of observations not correct in drip addition&quot;);</span>
        }
<span class="fc" id="L90">        return;</span>
    }

    @Test
    public void testNegativeTestAddObs() {
<span class="fc" id="L95">        MillerUpdatingRegression instance = new MillerUpdatingRegression(3, true);</span>
        try {
<span class="nc" id="L97">            instance.addObservation(new double[]{1.0}, 0.0);</span>
<span class="nc" id="L98">            Assert.fail(&quot;Should throw MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L99">        } catch (MathIllegalArgumentException iae) {</span>
<span class="nc" id="L100">        } catch (Exception e) {</span>
<span class="nc" id="L101">            Assert.fail(&quot;Should throw MathIllegalArgumentException&quot;);</span>
<span class="pc" id="L102">        }</span>
        try {
<span class="nc" id="L104">            instance.addObservation(new double[]{1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0}, 0.0);</span>
<span class="nc" id="L105">            Assert.fail(&quot;Should throw MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L106">        } catch (MathIllegalArgumentException iae) {</span>
<span class="nc" id="L107">        } catch (Exception e) {</span>
<span class="nc" id="L108">            Assert.fail(&quot;Should throw MathIllegalArgumentException&quot;);</span>
<span class="pc" id="L109">        }</span>
        try {
<span class="fc" id="L111">            instance.addObservation(new double[]{1.0, 1.0, 1.0}, 0.0);</span>
<span class="nc" id="L112">        } catch (Exception e) {</span>
<span class="nc" id="L113">            Assert.fail(&quot;Should throw MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L114">        }</span>

        //now we try it without an intercept
<span class="fc" id="L117">        instance = new MillerUpdatingRegression(3, false);</span>
        try {
<span class="nc" id="L119">            instance.addObservation(new double[]{1.0}, 0.0);</span>
<span class="nc" id="L120">            Assert.fail(&quot;Should throw MathIllegalArgumentException [NOINTERCEPT]&quot;);</span>
<span class="fc" id="L121">        } catch (MathIllegalArgumentException iae) {</span>
<span class="nc" id="L122">        } catch (Exception e) {</span>
<span class="nc" id="L123">            Assert.fail(&quot;Should throw MathIllegalArgumentException [NOINTERCEPT]&quot;);</span>
<span class="pc" id="L124">        }</span>
        try {
<span class="nc" id="L126">            instance.addObservation(new double[]{1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0}, 0.0);</span>
<span class="nc" id="L127">            Assert.fail(&quot;Should throw MathIllegalArgumentException [NOINTERCEPT]&quot;);</span>
<span class="fc" id="L128">        } catch (MathIllegalArgumentException iae) {</span>
<span class="nc" id="L129">        } catch (Exception e) {</span>
<span class="nc" id="L130">            Assert.fail(&quot;Should throw MathIllegalArgumentException [NOINTERCEPT]&quot;);</span>
<span class="pc" id="L131">        }</span>
        try {
<span class="fc" id="L133">            instance.addObservation(new double[]{1.0, 1.0, 1.0}, 0.0);</span>
<span class="nc" id="L134">        } catch (Exception e) {</span>
<span class="nc" id="L135">            Assert.fail(&quot;Should throw MathIllegalArgumentException [NOINTERCEPT]&quot;);</span>
<span class="fc" id="L136">        }</span>
<span class="fc" id="L137">    }</span>

    @Test
    public void testNegativeTestAddMultipleObs() {
<span class="fc" id="L141">        MillerUpdatingRegression instance = new MillerUpdatingRegression(3, true);</span>
        try {
<span class="fc" id="L143">            double[][] tst = {{1.0, 1.0, 1.0}, {1.20, 2.0, 2.1}};</span>
<span class="fc" id="L144">            double[] y = {1.0};</span>
<span class="nc" id="L145">            instance.addObservations(tst, y);</span>

<span class="nc" id="L147">            Assert.fail(&quot;Should throw MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L148">        } catch (MathIllegalArgumentException iae) {</span>
<span class="nc" id="L149">        } catch (Exception e) {</span>
<span class="nc" id="L150">            Assert.fail(&quot;Should throw MathIllegalArgumentException&quot;);</span>
<span class="pc" id="L151">        }</span>

        try {
<span class="fc" id="L154">            double[][] tst = {{1.0, 1.0, 1.0}, {1.20, 2.0, 2.1}};</span>
<span class="fc" id="L155">            double[] y = {1.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0};</span>
<span class="nc" id="L156">            instance.addObservations(tst, y);</span>

<span class="nc" id="L158">            Assert.fail(&quot;Should throw MathIllegalArgumentException&quot;);</span>
<span class="fc" id="L159">        } catch (MathIllegalArgumentException iae) {</span>
<span class="nc" id="L160">        } catch (Exception e) {</span>
<span class="nc" id="L161">            Assert.fail(&quot;Should throw MathIllegalArgumentException&quot;);</span>
<span class="pc" id="L162">        }</span>
<span class="fc" id="L163">    }</span>

    /* Results can be found at http://www.indiana.edu/~statmath/stat/all/panel/panel4.html
     * This test concerns a known data set
     */
    @Test
    public void testRegressAirlineConstantExternal() {
<span class="fc" id="L170">        MillerUpdatingRegression instance = new MillerUpdatingRegression(4, false);</span>
<span class="fc" id="L171">        double[][] x = new double[airdata[0].length][];</span>
<span class="fc" id="L172">        double[] y = new double[airdata[0].length];</span>
<span class="fc bfc" id="L173" title="All 2 branches covered.">        for (int i = 0; i &lt; airdata[0].length; i++) {</span>
<span class="fc" id="L174">            x[i] = new double[4];</span>
<span class="fc" id="L175">            x[i][0] = 1.0;</span>
<span class="fc" id="L176">            x[i][1] = FastMath.log(airdata[3][i]);</span>
<span class="fc" id="L177">            x[i][2] = FastMath.log(airdata[4][i]);</span>
<span class="fc" id="L178">            x[i][3] = airdata[5][i];</span>
<span class="fc" id="L179">            y[i] = FastMath.log(airdata[2][i]);</span>
        }

<span class="fc" id="L182">        instance.addObservations(x, y);</span>
        try {
<span class="fc" id="L184">            RegressionResults result = instance.regress();</span>
<span class="fc" id="L185">            Assert.assertNotNull(&quot;The test case is a prototype.&quot;, result);</span>
<span class="fc" id="L186">            TestUtils.assertEquals(</span>
                    new double[]{9.5169, 0.8827, 0.4540, -1.6275},
<span class="fc" id="L188">                    result.getParameterEstimates(), 1e-4);</span>


<span class="fc" id="L191">            TestUtils.assertEquals(</span>
                    new double[]{.2292445, .0132545, .0203042, .345302},
<span class="fc" id="L193">                    result.getStdErrorOfEstimates(), 1.0e-4);</span>

<span class="fc" id="L195">            TestUtils.assertEquals(0.01552839, result.getMeanSquareError(), 1.0e-8);</span>
<span class="nc" id="L196">        } catch (Exception e) {</span>
<span class="nc" id="L197">            Assert.fail(&quot;Should not throw exception but does&quot;);</span>
<span class="fc" id="L198">        }</span>
<span class="fc" id="L199">    }</span>

    @Test
    public void testRegressAirlineConstantInternal() {
<span class="fc" id="L203">        MillerUpdatingRegression instance = new MillerUpdatingRegression(3, true);</span>
<span class="fc" id="L204">        double[][] x = new double[airdata[0].length][];</span>
<span class="fc" id="L205">        double[] y = new double[airdata[0].length];</span>
<span class="fc bfc" id="L206" title="All 2 branches covered.">        for (int i = 0; i &lt; airdata[0].length; i++) {</span>
<span class="fc" id="L207">            x[i] = new double[3];</span>
<span class="fc" id="L208">            x[i][0] = FastMath.log(airdata[3][i]);</span>
<span class="fc" id="L209">            x[i][1] = FastMath.log(airdata[4][i]);</span>
<span class="fc" id="L210">            x[i][2] = airdata[5][i];</span>
<span class="fc" id="L211">            y[i] = FastMath.log(airdata[2][i]);</span>
        }

<span class="fc" id="L214">        instance.addObservations(x, y);</span>
        try {
<span class="fc" id="L216">            RegressionResults result = instance.regress();</span>
<span class="fc" id="L217">            Assert.assertNotNull(&quot;The test case is a prototype.&quot;, result);</span>
<span class="fc" id="L218">            TestUtils.assertEquals(</span>
                    new double[]{9.5169, 0.8827, 0.4540, -1.6275},
<span class="fc" id="L220">                    result.getParameterEstimates(), 1e-4);</span>


<span class="fc" id="L223">            TestUtils.assertEquals(</span>
                    new double[]{.2292445, .0132545, .0203042, .345302},
<span class="fc" id="L225">                    result.getStdErrorOfEstimates(), 1.0e-4);</span>

<span class="fc" id="L227">            TestUtils.assertEquals(0.9883, result.getRSquared(), 1.0e-4);</span>
<span class="fc" id="L228">            TestUtils.assertEquals(0.01552839, result.getMeanSquareError(), 1.0e-8);</span>
<span class="nc" id="L229">        } catch (Exception e) {</span>
<span class="nc" id="L230">            Assert.fail(&quot;Should not throw exception but does&quot;);</span>
<span class="fc" id="L231">        }</span>
<span class="fc" id="L232">    }</span>

    @Test
    public void testFilippelli() {
<span class="fc" id="L236">        double[] data = new double[]{</span>
            0.8116, -6.860120914,
            0.9072, -4.324130045,
            0.9052, -4.358625055,
            0.9039, -4.358426747,
            0.8053, -6.955852379,
            0.8377, -6.661145254,
            0.8667, -6.355462942,
            0.8809, -6.118102026,
            0.7975, -7.115148017,
            0.8162, -6.815308569,
            0.8515, -6.519993057,
            0.8766, -6.204119983,
            0.8885, -5.853871964,
            0.8859, -6.109523091,
            0.8959, -5.79832982,
            0.8913, -5.482672118,
            0.8959, -5.171791386,
            0.8971, -4.851705903,
            0.9021, -4.517126416,
            0.909, -4.143573228,
            0.9139, -3.709075441,
            0.9199, -3.499489089,
            0.8692, -6.300769497,
            0.8872, -5.953504836,
            0.89, -5.642065153,
            0.891, -5.031376979,
            0.8977, -4.680685696,
            0.9035, -4.329846955,
            0.9078, -3.928486195,
            0.7675, -8.56735134,
            0.7705, -8.363211311,
            0.7713, -8.107682739,
            0.7736, -7.823908741,
            0.7775, -7.522878745,
            0.7841, -7.218819279,
            0.7971, -6.920818754,
            0.8329, -6.628932138,
            0.8641, -6.323946875,
            0.8804, -5.991399828,
            0.7668, -8.781464495,
            0.7633, -8.663140179,
            0.7678, -8.473531488,
            0.7697, -8.247337057,
            0.77, -7.971428747,
            0.7749, -7.676129393,
            0.7796, -7.352812702,
            0.7897, -7.072065318,
            0.8131, -6.774174009,
            0.8498, -6.478861916,
            0.8741, -6.159517513,
            0.8061, -6.835647144,
            0.846, -6.53165267,
            0.8751, -6.224098421,
            0.8856, -5.910094889,
            0.8919, -5.598599459,
            0.8934, -5.290645224,
            0.894, -4.974284616,
            0.8957, -4.64454848,
            0.9047, -4.290560426,
            0.9129, -3.885055584,
            0.9209, -3.408378962,
            0.9219, -3.13200249,
            0.7739, -8.726767166,
            0.7681, -8.66695597,
            0.7665, -8.511026475,
            0.7703, -8.165388579,
            0.7702, -7.886056648,
            0.7761, -7.588043762,
            0.7809, -7.283412422,
            0.7961, -6.995678626,
            0.8253, -6.691862621,
            0.8602, -6.392544977,
            0.8809, -6.067374056,
            0.8301, -6.684029655,
            0.8664, -6.378719832,
            0.8834, -6.065855188,
            0.8898, -5.752272167,
            0.8964, -5.132414673,
            0.8963, -4.811352704,
            0.9074, -4.098269308,
            0.9119, -3.66174277,
            0.9228, -3.2644011
        };
<span class="fc" id="L320">        MillerUpdatingRegression model = new MillerUpdatingRegression(10, true);</span>
<span class="fc" id="L321">        int off = 0;</span>
<span class="fc" id="L322">        double[] tmp = new double[10];</span>
<span class="fc" id="L323">        int nobs = 82;</span>
<span class="fc bfc" id="L324" title="All 2 branches covered.">        for (int i = 0; i &lt; nobs; i++) {</span>
<span class="fc" id="L325">            tmp[0] = data[off + 1];</span>
//            tmp[1] = tmp[0] * tmp[0];
//            tmp[2] = tmp[0] * tmp[1]; //^3
//            tmp[3] = tmp[1] * tmp[1]; //^4
//            tmp[4] = tmp[2] * tmp[1]; //^5
//            tmp[5] = tmp[2] * tmp[2]; //^6
//            tmp[6] = tmp[2] * tmp[3]; //^7
//            tmp[7] = tmp[3] * tmp[3]; //^8
//            tmp[8] = tmp[4] * tmp[3]; //^9
//            tmp[9] = tmp[4] * tmp[4]; //^10
<span class="fc" id="L335">            tmp[1] = tmp[0] * tmp[0];</span>
<span class="fc" id="L336">            tmp[2] = tmp[0] * tmp[1];</span>
<span class="fc" id="L337">            tmp[3] = tmp[0] * tmp[2];</span>
<span class="fc" id="L338">            tmp[4] = tmp[0] * tmp[3];</span>
<span class="fc" id="L339">            tmp[5] = tmp[0] * tmp[4];</span>
<span class="fc" id="L340">            tmp[6] = tmp[0] * tmp[5];</span>
<span class="fc" id="L341">            tmp[7] = tmp[0] * tmp[6];</span>
<span class="fc" id="L342">            tmp[8] = tmp[0] * tmp[7];</span>
<span class="fc" id="L343">            tmp[9] = tmp[0] * tmp[8];</span>
<span class="fc" id="L344">            model.addObservation(tmp, data[off]);</span>
<span class="fc" id="L345">            off += 2;</span>
        }
<span class="fc" id="L347">        RegressionResults result = model.regress();</span>
<span class="fc" id="L348">        double[] betaHat = result.getParameterEstimates();</span>
<span class="fc" id="L349">        TestUtils.assertEquals(betaHat,</span>
                new double[]{
                    -1467.48961422980,
                    -2772.17959193342,
                    -2316.37108160893,
                    -1127.97394098372,
                    -354.478233703349,
                    -75.1242017393757,
                    -10.8753180355343,
                    -1.06221498588947,
                    -0.670191154593408E-01,
                    -0.246781078275479E-02,
                    -0.402962525080404E-04
                }, 1E-5); //
//
<span class="fc" id="L364">        double[] se = result.getStdErrorOfEstimates();</span>
<span class="fc" id="L365">        TestUtils.assertEquals(se,</span>
                new double[]{
                    298.084530995537,
                    559.779865474950,
                    466.477572127796,
                    227.204274477751,
                    71.6478660875927,
                    15.2897178747400,
                    2.23691159816033,
                    0.221624321934227,
                    0.142363763154724E-01,
                    0.535617408889821E-03,
                    0.896632837373868E-05
                }, 1E-5); //

<span class="fc" id="L380">        TestUtils.assertEquals(0.996727416185620, result.getRSquared(), 1.0e-8);</span>
<span class="fc" id="L381">        TestUtils.assertEquals(0.112091743968020E-04, result.getMeanSquareError(), 1.0e-10);</span>
<span class="fc" id="L382">        TestUtils.assertEquals(0.795851382172941E-03, result.getErrorSumSquares(), 1.0e-10);</span>

<span class="fc" id="L384">    }</span>

    @Test
    public void testWampler1() {
<span class="fc" id="L388">        double[] data = new double[]{</span>
            1, 0,
            6, 1,
            63, 2,
            364, 3,
            1365, 4,
            3906, 5,
            9331, 6,
            19608, 7,
            37449, 8,
            66430, 9,
            111111, 10,
            177156, 11,
            271453, 12,
            402234, 13,
            579195, 14,
            813616, 15,
            1118481, 16,
            1508598, 17,
            2000719, 18,
            2613660, 19,
            3368421, 20};

<span class="fc" id="L411">        MillerUpdatingRegression model = new MillerUpdatingRegression(5, true);</span>
<span class="fc" id="L412">        int off = 0;</span>
<span class="fc" id="L413">        double[] tmp = new double[5];</span>
<span class="fc" id="L414">        int nobs = 21;</span>
<span class="fc bfc" id="L415" title="All 2 branches covered.">        for (int i = 0; i &lt; nobs; i++) {</span>
<span class="fc" id="L416">            tmp[0] = data[off + 1];</span>
<span class="fc" id="L417">            tmp[1] = tmp[0] * tmp[0];</span>
<span class="fc" id="L418">            tmp[2] = tmp[0] * tmp[1];</span>
<span class="fc" id="L419">            tmp[3] = tmp[0] * tmp[2];</span>
<span class="fc" id="L420">            tmp[4] = tmp[0] * tmp[3];</span>
<span class="fc" id="L421">            model.addObservation(tmp, data[off]);</span>
<span class="fc" id="L422">            off += 2;</span>
        }
<span class="fc" id="L424">        RegressionResults result = model.regress();</span>
<span class="fc" id="L425">        double[] betaHat = result.getParameterEstimates();</span>
<span class="fc" id="L426">        TestUtils.assertEquals(betaHat,</span>
                new double[]{1.0,
                    1.0, 1.0,
                    1.0, 1.0,
                    1.0}, 1E-8); //
//
<span class="fc" id="L432">        double[] se = result.getStdErrorOfEstimates();</span>
<span class="fc" id="L433">        TestUtils.assertEquals(se,</span>
                new double[]{0.0,
                    0.0, 0.0,
                    0.0, 0.0,
                    0.0}, 1E-8); //

<span class="fc" id="L439">        TestUtils.assertEquals(1.0, result.getRSquared(), 1.0e-10);</span>
<span class="fc" id="L440">        TestUtils.assertEquals(0, result.getMeanSquareError(), 1.0e-7);</span>
<span class="fc" id="L441">        TestUtils.assertEquals(0.00, result.getErrorSumSquares(), 1.0e-6);</span>

<span class="fc" id="L443">        return;</span>
    }

    @Test
    public void testWampler2() {
<span class="fc" id="L448">        double[] data = new double[]{</span>
            1.00000, 0,
            1.11111, 1,
            1.24992, 2,
            1.42753, 3,
            1.65984, 4,
            1.96875, 5,
            2.38336, 6,
            2.94117, 7,
            3.68928, 8,
            4.68559, 9,
            6.00000, 10,
            7.71561, 11,
            9.92992, 12,
            12.75603, 13,
            16.32384, 14,
            20.78125, 15,
            26.29536, 16,
            33.05367, 17,
            41.26528, 18,
            51.16209, 19,
            63.00000, 20};

<span class="fc" id="L471">        MillerUpdatingRegression model = new MillerUpdatingRegression(5, true);</span>
<span class="fc" id="L472">        int off = 0;</span>
<span class="fc" id="L473">        double[] tmp = new double[5];</span>
<span class="fc" id="L474">        int nobs = 21;</span>
<span class="fc bfc" id="L475" title="All 2 branches covered.">        for (int i = 0; i &lt; nobs; i++) {</span>
<span class="fc" id="L476">            tmp[0] = data[off + 1];</span>
<span class="fc" id="L477">            tmp[1] = tmp[0] * tmp[0];</span>
<span class="fc" id="L478">            tmp[2] = tmp[0] * tmp[1];</span>
<span class="fc" id="L479">            tmp[3] = tmp[0] * tmp[2];</span>
<span class="fc" id="L480">            tmp[4] = tmp[0] * tmp[3];</span>
<span class="fc" id="L481">            model.addObservation(tmp, data[off]);</span>
<span class="fc" id="L482">            off += 2;</span>
        }
<span class="fc" id="L484">        RegressionResults result = model.regress();</span>
<span class="fc" id="L485">        double[] betaHat = result.getParameterEstimates();</span>
<span class="fc" id="L486">        TestUtils.assertEquals(betaHat,</span>
                new double[]{1.0,
                    1.0e-1, 1.0e-2,
                    1.0e-3, 1.0e-4,
                    1.0e-5}, 1E-8); //
//
<span class="fc" id="L492">        double[] se = result.getStdErrorOfEstimates();</span>
<span class="fc" id="L493">        TestUtils.assertEquals(se,</span>
                new double[]{0.0,
                    0.0, 0.0,
                    0.0, 0.0,
                    0.0}, 1E-8); //

<span class="fc" id="L499">        TestUtils.assertEquals(1.0, result.getRSquared(), 1.0e-10);</span>
<span class="fc" id="L500">        TestUtils.assertEquals(0, result.getMeanSquareError(), 1.0e-7);</span>
<span class="fc" id="L501">        TestUtils.assertEquals(0.00, result.getErrorSumSquares(), 1.0e-6);</span>
<span class="fc" id="L502">        return;</span>
    }

    @Test
    public void testWampler3() {
<span class="fc" id="L507">        double[] data = new double[]{</span>
            760, 0,
            -2042, 1,
            2111, 2,
            -1684, 3,
            3888, 4,
            1858, 5,
            11379, 6,
            17560, 7,
            39287, 8,
            64382, 9,
            113159, 10,
            175108, 11,
            273291, 12,
            400186, 13,
            581243, 14,
            811568, 15,
            1121004, 16,
            1506550, 17,
            2002767, 18,
            2611612, 19,
            3369180, 20};
<span class="fc" id="L529">        MillerUpdatingRegression model = new MillerUpdatingRegression(5, true);</span>
<span class="fc" id="L530">        int off = 0;</span>
<span class="fc" id="L531">        double[] tmp = new double[5];</span>
<span class="fc" id="L532">        int nobs = 21;</span>
<span class="fc bfc" id="L533" title="All 2 branches covered.">        for (int i = 0; i &lt; nobs; i++) {</span>
<span class="fc" id="L534">            tmp[0] = data[off + 1];</span>
<span class="fc" id="L535">            tmp[1] = tmp[0] * tmp[0];</span>
<span class="fc" id="L536">            tmp[2] = tmp[0] * tmp[1];</span>
<span class="fc" id="L537">            tmp[3] = tmp[0] * tmp[2];</span>
<span class="fc" id="L538">            tmp[4] = tmp[0] * tmp[3];</span>
<span class="fc" id="L539">            model.addObservation(tmp, data[off]);</span>
<span class="fc" id="L540">            off += 2;</span>
        }
<span class="fc" id="L542">        RegressionResults result = model.regress();</span>
<span class="fc" id="L543">        double[] betaHat = result.getParameterEstimates();</span>
<span class="fc" id="L544">        TestUtils.assertEquals(betaHat,</span>
                new double[]{1.0,
                    1.0, 1.0,
                    1.0, 1.0,
                    1.0}, 1E-8); //
<span class="fc" id="L549">        double[] se = result.getStdErrorOfEstimates();</span>
<span class="fc" id="L550">        TestUtils.assertEquals(se,</span>
                new double[]{2152.32624678170,
                    2363.55173469681, 779.343524331583,
                    101.475507550350, 5.64566512170752,
                    0.112324854679312}, 1E-8); //

<span class="fc" id="L556">        TestUtils.assertEquals(.999995559025820, result.getRSquared(), 1.0e-10);</span>
<span class="fc" id="L557">        TestUtils.assertEquals(5570284.53333333, result.getMeanSquareError(), 1.0e-7);</span>
<span class="fc" id="L558">        TestUtils.assertEquals(83554268.0000000, result.getErrorSumSquares(), 1.0e-6);</span>
<span class="fc" id="L559">        return;</span>
    }

    //@Test
    public void testWampler4() {
<span class="nc" id="L564">        double[] data = new double[]{</span>
            75901, 0,
            -204794, 1,
            204863, 2,
            -204436, 3,
            253665, 4,
            -200894, 5,
            214131, 6,
            -185192, 7,
            221249, 8,
            -138370, 9,
            315911, 10,
            -27644, 11,
            455253, 12,
            197434, 13,
            783995, 14,
            608816, 15,
            1370781, 16,
            1303798, 17,
            2205519, 18,
            2408860, 19,
            3444321, 20};
<span class="nc" id="L586">        MillerUpdatingRegression model = new MillerUpdatingRegression(5, true);</span>
<span class="nc" id="L587">        int off = 0;</span>
<span class="nc" id="L588">        double[] tmp = new double[5];</span>
<span class="nc" id="L589">        int nobs = 21;</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">        for (int i = 0; i &lt; nobs; i++) {</span>
<span class="nc" id="L591">            tmp[0] = data[off + 1];</span>
<span class="nc" id="L592">            tmp[1] = tmp[0] * tmp[0];</span>
<span class="nc" id="L593">            tmp[2] = tmp[0] * tmp[1];</span>
<span class="nc" id="L594">            tmp[3] = tmp[0] * tmp[2];</span>
<span class="nc" id="L595">            tmp[4] = tmp[0] * tmp[3];</span>
<span class="nc" id="L596">            model.addObservation(tmp, data[off]);</span>
<span class="nc" id="L597">            off += 2;</span>
        }
<span class="nc" id="L599">        RegressionResults result = model.regress();</span>
<span class="nc" id="L600">        double[] betaHat = result.getParameterEstimates();</span>
<span class="nc" id="L601">        TestUtils.assertEquals(betaHat,</span>
                new double[]{1.0,
                    1.0, 1.0,
                    1.0, 1.0,
                    1.0}, 1E-8); //
//
<span class="nc" id="L607">        double[] se = result.getStdErrorOfEstimates();</span>
<span class="nc" id="L608">        TestUtils.assertEquals(se,</span>
                new double[]{215232.624678170,
                    236355.173469681, 77934.3524331583,
                    10147.5507550350, 564.566512170752,
                    11.2324854679312}, 1E-8); //

<span class="nc" id="L614">        TestUtils.assertEquals(.957478440825662, result.getRSquared(), 1.0e-10);</span>
<span class="nc" id="L615">        TestUtils.assertEquals(55702845333.3333, result.getMeanSquareError(), 1.0e-4);</span>
<span class="nc" id="L616">        TestUtils.assertEquals(835542680000.000, result.getErrorSumSquares(), 1.0e-3);</span>

<span class="nc" id="L618">        return;</span>
    }

    /**
     * Test Longley dataset against certified values provided by NIST.
     * Data Source: J. Longley (1967) &quot;An Appraisal of Least Squares
     * Programs for the Electronic Computer from the Point of View of the User&quot;
     * Journal of the American Statistical Association, vol. 62. September,
     * pp. 819-841.
     *
     * Certified values (and data) are from NIST:
     * http://www.itl.nist.gov/div898/strd/lls/data/LINKS/DATA/Longley.dat
     */
    @Test
    public void testLongly() {
        // Y values are first, then independent vars
        // Each row is one observation
<span class="fc" id="L635">        double[] design = new double[]{</span>
            60323, 83.0, 234289, 2356, 1590, 107608, 1947,
            61122, 88.5, 259426, 2325, 1456, 108632, 1948,
            60171, 88.2, 258054, 3682, 1616, 109773, 1949,
            61187, 89.5, 284599, 3351, 1650, 110929, 1950,
            63221, 96.2, 328975, 2099, 3099, 112075, 1951,
            63639, 98.1, 346999, 1932, 3594, 113270, 1952,
            64989, 99.0, 365385, 1870, 3547, 115094, 1953,
            63761, 100.0, 363112, 3578, 3350, 116219, 1954,
            66019, 101.2, 397469, 2904, 3048, 117388, 1955,
            67857, 104.6, 419180, 2822, 2857, 118734, 1956,
            68169, 108.4, 442769, 2936, 2798, 120445, 1957,
            66513, 110.8, 444546, 4681, 2637, 121950, 1958,
            68655, 112.6, 482704, 3813, 2552, 123366, 1959,
            69564, 114.2, 502601, 3931, 2514, 125368, 1960,
            69331, 115.7, 518173, 4806, 2572, 127852, 1961,
            70551, 116.9, 554894, 4007, 2827, 130081, 1962
        };

<span class="fc" id="L654">        final int nobs = 16;</span>
<span class="fc" id="L655">        final int nvars = 6;</span>

        // Estimate the model
<span class="fc" id="L658">        MillerUpdatingRegression model = new MillerUpdatingRegression(6, true);</span>
<span class="fc" id="L659">        int off = 0;</span>
<span class="fc" id="L660">        double[] tmp = new double[6];</span>
<span class="fc bfc" id="L661" title="All 2 branches covered.">        for (int i = 0; i &lt; nobs; i++) {</span>
<span class="fc" id="L662">            System.arraycopy(design, off + 1, tmp, 0, nvars);</span>
<span class="fc" id="L663">            model.addObservation(tmp, design[off]);</span>
<span class="fc" id="L664">            off += nvars + 1;</span>
        }

        // Check expected beta values from NIST
<span class="fc" id="L668">        RegressionResults result = model.regress();</span>
<span class="fc" id="L669">        double[] betaHat = result.getParameterEstimates();</span>
<span class="fc" id="L670">        TestUtils.assertEquals(betaHat,</span>
                new double[]{-3482258.63459582, 15.0618722713733,
                    -0.358191792925910E-01, -2.02022980381683,
                    -1.03322686717359, -0.511041056535807E-01,
                    1829.15146461355}, 1E-8); //

        // Check standard errors from NIST
<span class="fc" id="L677">        double[] errors = result.getStdErrorOfEstimates();</span>
<span class="fc" id="L678">        TestUtils.assertEquals(new double[]{890420.383607373,</span>
                    84.9149257747669,
                    0.334910077722432E-01,
                    0.488399681651699,
                    0.214274163161675,
                    0.226073200069370,
                    455.478499142212}, errors, 1E-6);
//
        // Check R-Square statistics against R
<span class="fc" id="L687">        TestUtils.assertEquals(0.995479004577296, result.getRSquared(), 1E-12);</span>
<span class="fc" id="L688">        TestUtils.assertEquals(0.992465007628826, result.getAdjustedRSquared(), 1E-12);</span>
//
//
//        // Estimate model without intercept
<span class="fc" id="L692">        model = new MillerUpdatingRegression(6, false);</span>
<span class="fc" id="L693">        off = 0;</span>
<span class="fc bfc" id="L694" title="All 2 branches covered.">        for (int i = 0; i &lt; nobs; i++) {</span>
<span class="fc" id="L695">            System.arraycopy(design, off + 1, tmp, 0, nvars);</span>
<span class="fc" id="L696">            model.addObservation(tmp, design[off]);</span>
<span class="fc" id="L697">            off += nvars + 1;</span>
        }
        // Check expected beta values from R
<span class="fc" id="L700">        result = model.regress();</span>
<span class="fc" id="L701">        betaHat = result.getParameterEstimates();</span>
<span class="fc" id="L702">        TestUtils.assertEquals(betaHat,</span>
                new double[]{-52.99357013868291, 0.07107319907358,
                    -0.42346585566399, -0.57256866841929,
                    -0.41420358884978, 48.41786562001326}, 1E-11);
//
        // Check standard errors from R
<span class="fc" id="L708">        errors = result.getStdErrorOfEstimates();</span>
<span class="fc" id="L709">        TestUtils.assertEquals(new double[]{129.54486693117232, 0.03016640003786,</span>
                    0.41773654056612, 0.27899087467676, 0.32128496193363,
                    17.68948737819961}, errors, 1E-11);
//

//        // Check R-Square statistics against R
<span class="fc" id="L715">        TestUtils.assertEquals(0.9999670130706, result.getRSquared(), 1E-12);</span>
<span class="fc" id="L716">        TestUtils.assertEquals(0.999947220913, result.getAdjustedRSquared(), 1E-12);</span>

<span class="fc" id="L718">    }</span>

//    @Test
//    public void testRegressReorder() {
//        // System.out.println(&quot;testRegressReorder&quot;);
//        MillerUpdatingRegression instance = new MillerUpdatingRegression(4, false);
//        double[][] x = new double[airdata[0].length][];
//        double[] y = new double[airdata[0].length];
//        for (int i = 0; i &lt; airdata[0].length; i++) {
//            x[i] = new double[4];
//            x[i][0] = 1.0;
//            x[i][1] = FastMath.log(airdata[3][i]);
//            x[i][2] = FastMath.log(airdata[4][i]);
//            x[i][3] = airdata[5][i];
//            y[i] = FastMath.log(airdata[2][i]);
//        }
//
//        instance.addObservations(x, y);
//        RegressionResults result = instance.regress();
//        if (result == null) {
//            Assert.fail(&quot;Null result....&quot;);
//        }
//
//        instance.reorderRegressors(new int[]{3, 2}, 0);
//        RegressionResults resultInverse = instance.regress();
//
//        double[] beta = result.getParameterEstimates();
//        double[] betar = resultInverse.getParameterEstimates();
//        if (FastMath.abs(beta[0] - betar[0]) &gt; 1.0e-14) {
//            Assert.fail(&quot;Parameters not correct after reorder (0,3)&quot;);
//        }
//        if (FastMath.abs(beta[1] - betar[1]) &gt; 1.0e-14) {
//            Assert.fail(&quot;Parameters not correct after reorder (1,2)&quot;);
//        }
//        if (FastMath.abs(beta[2] - betar[2]) &gt; 1.0e-14) {
//            Assert.fail(&quot;Parameters not correct after reorder (2,1)&quot;);
//        }
//        if (FastMath.abs(beta[3] - betar[3]) &gt; 1.0e-14) {
//            Assert.fail(&quot;Parameters not correct after reorder (3,0)&quot;);
//        }
//    }

    @Test
    public void testOneRedundantColumn() {
<span class="fc" id="L762">        MillerUpdatingRegression instance = new MillerUpdatingRegression(4, false);</span>
<span class="fc" id="L763">        MillerUpdatingRegression instance2 = new MillerUpdatingRegression(5, false);</span>
<span class="fc" id="L764">        double[][] x = new double[airdata[0].length][];</span>
<span class="fc" id="L765">        double[][] x2 = new double[airdata[0].length][];</span>
<span class="fc" id="L766">        double[] y = new double[airdata[0].length];</span>
<span class="fc bfc" id="L767" title="All 2 branches covered.">        for (int i = 0; i &lt; airdata[0].length; i++) {</span>
<span class="fc" id="L768">            x[i] = new double[4];</span>
<span class="fc" id="L769">            x2[i] = new double[5];</span>
<span class="fc" id="L770">            x[i][0] = 1.0;</span>
<span class="fc" id="L771">            x[i][1] = FastMath.log(airdata[3][i]);</span>
<span class="fc" id="L772">            x[i][2] = FastMath.log(airdata[4][i]);</span>
<span class="fc" id="L773">            x[i][3] = airdata[5][i];</span>

<span class="fc" id="L775">            x2[i][0] = x[i][0];</span>
<span class="fc" id="L776">            x2[i][1] = x[i][1];</span>
<span class="fc" id="L777">            x2[i][2] = x[i][2];</span>
<span class="fc" id="L778">            x2[i][3] = x[i][3];</span>
<span class="fc" id="L779">            x2[i][4] = x[i][3];</span>

<span class="fc" id="L781">            y[i] = FastMath.log(airdata[2][i]);</span>
        }

<span class="fc" id="L784">        instance.addObservations(x, y);</span>
<span class="fc" id="L785">        RegressionResults result = instance.regress();</span>
<span class="fc" id="L786">        Assert.assertNotNull(&quot;Could not estimate initial regression&quot;, result);</span>

<span class="fc" id="L788">        instance2.addObservations(x2, y);</span>
<span class="fc" id="L789">        RegressionResults resultRedundant = instance2.regress();</span>
<span class="fc" id="L790">        Assert.assertNotNull(&quot;Could not estimate redundant regression&quot;, resultRedundant);</span>
<span class="fc" id="L791">        double[] beta = result.getParameterEstimates();</span>
<span class="fc" id="L792">        double[] betar = resultRedundant.getParameterEstimates();</span>
<span class="fc" id="L793">        double[] se = result.getStdErrorOfEstimates();</span>
<span class="fc" id="L794">        double[] ser = resultRedundant.getStdErrorOfEstimates();</span>

<span class="fc bfc" id="L796" title="All 2 branches covered.">        for (int i = 0; i &lt; beta.length; i++) {</span>
<span class="pc bpc" id="L797" title="1 of 2 branches missed.">            if (FastMath.abs(beta[i] - betar[i]) &gt; 1.0e-8) {</span>
<span class="nc" id="L798">                Assert.fail(&quot;Parameters not correctly estimated&quot;);</span>
            }
<span class="pc bpc" id="L800" title="1 of 2 branches missed.">            if (FastMath.abs(se[i] - ser[i]) &gt; 1.0e-8) {</span>
<span class="nc" id="L801">                Assert.fail(&quot;Standard errors not correctly estimated&quot;);</span>
            }
<span class="fc bfc" id="L803" title="All 2 branches covered.">            for (int j = 0; j &lt; i; j++) {</span>
<span class="pc bpc" id="L804" title="1 of 2 branches missed.">                if (FastMath.abs(result.getCovarianceOfParameters(i, j)</span>
<span class="fc" id="L805">                        - resultRedundant.getCovarianceOfParameters(i, j)) &gt; 1.0e-8) {</span>
<span class="nc" id="L806">                    Assert.fail(&quot;Variance Covariance not correct&quot;);</span>
                }
            }
        }


<span class="fc" id="L812">        TestUtils.assertEquals(result.getAdjustedRSquared(), resultRedundant.getAdjustedRSquared(), 1.0e-8);</span>
<span class="fc" id="L813">        TestUtils.assertEquals(result.getErrorSumSquares(), resultRedundant.getErrorSumSquares(), 1.0e-8);</span>
<span class="fc" id="L814">        TestUtils.assertEquals(result.getMeanSquareError(), resultRedundant.getMeanSquareError(), 1.0e-8);</span>
<span class="fc" id="L815">        TestUtils.assertEquals(result.getRSquared(), resultRedundant.getRSquared(), 1.0e-8);</span>
<span class="fc" id="L816">        return;</span>
    }

    @Test
    public void testThreeRedundantColumn() {

<span class="fc" id="L822">        MillerUpdatingRegression instance = new MillerUpdatingRegression(4, false);</span>
<span class="fc" id="L823">        MillerUpdatingRegression instance2 = new MillerUpdatingRegression(7, false);</span>
<span class="fc" id="L824">        double[][] x = new double[airdata[0].length][];</span>
<span class="fc" id="L825">        double[][] x2 = new double[airdata[0].length][];</span>
<span class="fc" id="L826">        double[] y = new double[airdata[0].length];</span>
<span class="fc bfc" id="L827" title="All 2 branches covered.">        for (int i = 0; i &lt; airdata[0].length; i++) {</span>
<span class="fc" id="L828">            x[i] = new double[4];</span>
<span class="fc" id="L829">            x2[i] = new double[7];</span>
<span class="fc" id="L830">            x[i][0] = 1.0;</span>
<span class="fc" id="L831">            x[i][1] = FastMath.log(airdata[3][i]);</span>
<span class="fc" id="L832">            x[i][2] = FastMath.log(airdata[4][i]);</span>
<span class="fc" id="L833">            x[i][3] = airdata[5][i];</span>

<span class="fc" id="L835">            x2[i][0] = x[i][0];</span>
<span class="fc" id="L836">            x2[i][1] = x[i][0];</span>
<span class="fc" id="L837">            x2[i][2] = x[i][1];</span>
<span class="fc" id="L838">            x2[i][3] = x[i][2];</span>
<span class="fc" id="L839">            x2[i][4] = x[i][1];</span>
<span class="fc" id="L840">            x2[i][5] = x[i][3];</span>
<span class="fc" id="L841">            x2[i][6] = x[i][2];</span>

<span class="fc" id="L843">            y[i] = FastMath.log(airdata[2][i]);</span>
        }

<span class="fc" id="L846">        instance.addObservations(x, y);</span>
<span class="fc" id="L847">        RegressionResults result = instance.regress();</span>
<span class="fc" id="L848">        Assert.assertNotNull(&quot;Could not estimate initial regression&quot;, result);</span>

<span class="fc" id="L850">        instance2.addObservations(x2, y);</span>
<span class="fc" id="L851">        RegressionResults resultRedundant = instance2.regress();</span>
<span class="fc" id="L852">        Assert.assertNotNull(&quot;Could not estimate redundant regression&quot;, resultRedundant);</span>
<span class="fc" id="L853">        double[] beta = result.getParameterEstimates();</span>
<span class="fc" id="L854">        double[] betar = resultRedundant.getParameterEstimates();</span>
<span class="fc" id="L855">        double[] se = result.getStdErrorOfEstimates();</span>
<span class="fc" id="L856">        double[] ser = resultRedundant.getStdErrorOfEstimates();</span>

<span class="pc bpc" id="L858" title="1 of 2 branches missed.">        if (FastMath.abs(beta[0] - betar[0]) &gt; 1.0e-8) {</span>
<span class="nc" id="L859">            Assert.fail(&quot;Parameters not correct after reorder (0,3)&quot;);</span>
        }
<span class="pc bpc" id="L861" title="1 of 2 branches missed.">        if (FastMath.abs(beta[1] - betar[2]) &gt; 1.0e-8) {</span>
<span class="nc" id="L862">            Assert.fail(&quot;Parameters not correct after reorder (1,2)&quot;);</span>
        }
<span class="pc bpc" id="L864" title="1 of 2 branches missed.">        if (FastMath.abs(beta[2] - betar[3]) &gt; 1.0e-8) {</span>
<span class="nc" id="L865">            Assert.fail(&quot;Parameters not correct after reorder (2,1)&quot;);</span>
        }
<span class="pc bpc" id="L867" title="1 of 2 branches missed.">        if (FastMath.abs(beta[3] - betar[5]) &gt; 1.0e-8) {</span>
<span class="nc" id="L868">            Assert.fail(&quot;Parameters not correct after reorder (3,0)&quot;);</span>
        }

<span class="pc bpc" id="L871" title="1 of 2 branches missed.">        if (FastMath.abs(se[0] - ser[0]) &gt; 1.0e-8) {</span>
<span class="nc" id="L872">            Assert.fail(&quot;Se not correct after reorder (0,3)&quot;);</span>
        }
<span class="pc bpc" id="L874" title="1 of 2 branches missed.">        if (FastMath.abs(se[1] - ser[2]) &gt; 1.0e-8) {</span>
<span class="nc" id="L875">            Assert.fail(&quot;Se not correct after reorder (1,2)&quot;);</span>
        }
<span class="pc bpc" id="L877" title="1 of 2 branches missed.">        if (FastMath.abs(se[2] - ser[3]) &gt; 1.0e-8) {</span>
<span class="nc" id="L878">            Assert.fail(&quot;Se not correct after reorder (2,1)&quot;);</span>
        }
<span class="pc bpc" id="L880" title="1 of 2 branches missed.">        if (FastMath.abs(se[3] - ser[5]) &gt; 1.0e-8) {</span>
<span class="nc" id="L881">            Assert.fail(&quot;Se not correct after reorder (3,0)&quot;);</span>
        }

<span class="pc bpc" id="L884" title="1 of 2 branches missed.">        if (FastMath.abs(result.getCovarianceOfParameters(0, 0)</span>
<span class="fc" id="L885">                - resultRedundant.getCovarianceOfParameters(0, 0)) &gt; 1.0e-8) {</span>
<span class="nc" id="L886">            Assert.fail(&quot;VCV not correct after reorder (0,0)&quot;);</span>
        }
<span class="pc bpc" id="L888" title="1 of 2 branches missed.">        if (FastMath.abs(result.getCovarianceOfParameters(0, 1)</span>
<span class="fc" id="L889">                - resultRedundant.getCovarianceOfParameters(0, 2)) &gt; 1.0e-8) {</span>
<span class="nc" id="L890">            Assert.fail(&quot;VCV not correct after reorder (0,1)&lt;-&gt;(0,2)&quot;);</span>
        }
<span class="pc bpc" id="L892" title="1 of 2 branches missed.">        if (FastMath.abs(result.getCovarianceOfParameters(0, 2)</span>
<span class="fc" id="L893">                - resultRedundant.getCovarianceOfParameters(0, 3)) &gt; 1.0e-8) {</span>
<span class="nc" id="L894">            Assert.fail(&quot;VCV not correct after reorder (0,2)&lt;-&gt;(0,1)&quot;);</span>
        }
<span class="pc bpc" id="L896" title="1 of 2 branches missed.">        if (FastMath.abs(result.getCovarianceOfParameters(0, 3)</span>
<span class="fc" id="L897">                - resultRedundant.getCovarianceOfParameters(0, 5)) &gt; 1.0e-8) {</span>
<span class="nc" id="L898">            Assert.fail(&quot;VCV not correct after reorder (0,3)&lt;-&gt;(0,3)&quot;);</span>
        }
<span class="pc bpc" id="L900" title="1 of 2 branches missed.">        if (FastMath.abs(result.getCovarianceOfParameters(1, 0)</span>
<span class="fc" id="L901">                - resultRedundant.getCovarianceOfParameters(2, 0)) &gt; 1.0e-8) {</span>
<span class="nc" id="L902">            Assert.fail(&quot;VCV not correct after reorder (1,0)&lt;-&gt;(2,0)&quot;);</span>
        }
<span class="pc bpc" id="L904" title="1 of 2 branches missed.">        if (FastMath.abs(result.getCovarianceOfParameters(1, 1)</span>
<span class="fc" id="L905">                - resultRedundant.getCovarianceOfParameters(2, 2)) &gt; 1.0e-8) {</span>
<span class="nc" id="L906">            Assert.fail(&quot;VCV not correct  (1,1)&lt;-&gt;(2,1)&quot;);</span>
        }
<span class="pc bpc" id="L908" title="1 of 2 branches missed.">        if (FastMath.abs(result.getCovarianceOfParameters(1, 2)</span>
<span class="fc" id="L909">                - resultRedundant.getCovarianceOfParameters(2, 3)) &gt; 1.0e-8) {</span>
<span class="nc" id="L910">            Assert.fail(&quot;VCV not correct  (1,2)&lt;-&gt;(2,2)&quot;);</span>
        }

<span class="pc bpc" id="L913" title="1 of 2 branches missed.">        if (FastMath.abs(result.getCovarianceOfParameters(2, 0)</span>
<span class="fc" id="L914">                - resultRedundant.getCovarianceOfParameters(3, 0)) &gt; 1.0e-8) {</span>
<span class="nc" id="L915">            Assert.fail(&quot;VCV not correct  (2,0)&lt;-&gt;(1,0)&quot;);</span>
        }
<span class="pc bpc" id="L917" title="1 of 2 branches missed.">        if (FastMath.abs(result.getCovarianceOfParameters(2, 1)</span>
<span class="fc" id="L918">                - resultRedundant.getCovarianceOfParameters(3, 2)) &gt; 1.0e-8) {</span>
<span class="nc" id="L919">            Assert.fail(&quot;VCV not correct  (2,1)&lt;-&gt;(1,2)&quot;);</span>
        }

<span class="pc bpc" id="L922" title="1 of 2 branches missed.">        if (FastMath.abs(result.getCovarianceOfParameters(3, 3)</span>
<span class="fc" id="L923">                - resultRedundant.getCovarianceOfParameters(5, 5)) &gt; 1.0e-8) {</span>
<span class="nc" id="L924">            Assert.fail(&quot;VCV not correct  (3,3)&lt;-&gt;(3,2)&quot;);</span>
        }

<span class="fc" id="L927">        TestUtils.assertEquals(result.getAdjustedRSquared(), resultRedundant.getAdjustedRSquared(), 1.0e-8);</span>
<span class="fc" id="L928">        TestUtils.assertEquals(result.getErrorSumSquares(), resultRedundant.getErrorSumSquares(), 1.0e-8);</span>
<span class="fc" id="L929">        TestUtils.assertEquals(result.getMeanSquareError(), resultRedundant.getMeanSquareError(), 1.0e-8);</span>
<span class="fc" id="L930">        TestUtils.assertEquals(result.getRSquared(), resultRedundant.getRSquared(), 1.0e-8);</span>
<span class="fc" id="L931">        return;</span>
    }

    @Test
    public void testPCorr() {
<span class="fc" id="L936">        MillerUpdatingRegression instance = new MillerUpdatingRegression(4, false);</span>
<span class="fc" id="L937">        double[][] x = new double[airdata[0].length][];</span>
<span class="fc" id="L938">        double[] y = new double[airdata[0].length];</span>
<span class="fc" id="L939">        double[] cp = new double[10];</span>
<span class="fc" id="L940">        double[] yxcorr = new double[4];</span>
<span class="fc" id="L941">        double[] diag = new double[4];</span>
<span class="fc" id="L942">        double sumysq = 0.0;</span>
<span class="fc" id="L943">        int off = 0;</span>
<span class="fc bfc" id="L944" title="All 2 branches covered.">        for (int i = 0; i &lt; airdata[0].length; i++) {</span>
<span class="fc" id="L945">            x[i] = new double[4];</span>
<span class="fc" id="L946">            x[i][0] = 1.0;</span>
<span class="fc" id="L947">            x[i][1] = FastMath.log(airdata[3][i]);</span>
<span class="fc" id="L948">            x[i][2] = FastMath.log(airdata[4][i]);</span>
<span class="fc" id="L949">            x[i][3] = airdata[5][i];</span>
<span class="fc" id="L950">            y[i] = FastMath.log(airdata[2][i]);</span>
<span class="fc" id="L951">            off = 0;</span>
<span class="fc bfc" id="L952" title="All 2 branches covered.">            for (int j = 0; j &lt; 4; j++) {</span>
<span class="fc" id="L953">                double tmp = x[i][j];</span>
<span class="fc bfc" id="L954" title="All 2 branches covered.">                for (int k = 0; k &lt;= j; k++, off++) {</span>
<span class="fc" id="L955">                    cp[off] += tmp * x[i][k];</span>
                }
<span class="fc" id="L957">                yxcorr[j] += tmp * y[i];</span>
            }
<span class="fc" id="L959">            sumysq += y[i] * y[i];</span>
        }
<span class="fc" id="L961">        PearsonsCorrelation pearson = new PearsonsCorrelation(x);</span>
<span class="fc" id="L962">        RealMatrix corr = pearson.getCorrelationMatrix();</span>
<span class="fc" id="L963">        off = 0;</span>
<span class="fc bfc" id="L964" title="All 2 branches covered.">        for (int i = 0; i &lt; 4; i++, off += (i + 1)) {</span>
<span class="fc" id="L965">            diag[i] = FastMath.sqrt(cp[off]);</span>
        }

<span class="fc" id="L968">        instance.addObservations(x, y);</span>
<span class="fc" id="L969">        double[] pc = instance.getPartialCorrelations(0);</span>
<span class="fc" id="L970">        int idx = 0;</span>
<span class="fc" id="L971">        off = 0;</span>
<span class="fc" id="L972">        int off2 = 6;</span>
<span class="fc bfc" id="L973" title="All 2 branches covered.">        for (int i = 0; i &lt; 4; i++) {</span>
<span class="fc bfc" id="L974" title="All 2 branches covered.">            for (int j = 0; j &lt; i; j++) {</span>
<span class="pc bpc" id="L975" title="1 of 2 branches missed.">                if (FastMath.abs(pc[idx] - cp[off] / (diag[i] * diag[j])) &gt; 1.0e-8) {</span>
<span class="nc" id="L976">                    Assert.fail(&quot;Failed cross products... i = &quot; + i + &quot; j = &quot; + j);</span>
                }
<span class="fc" id="L978">                ++idx;</span>
<span class="fc" id="L979">                ++off;</span>
            }
<span class="fc" id="L981">            ++off;</span>
<span class="pc bpc" id="L982" title="1 of 2 branches missed.">            if (FastMath.abs(pc[i+off2] - yxcorr[ i] / (FastMath.sqrt(sumysq) * diag[i])) &gt; 1.0e-8) {</span>
<span class="nc" id="L983">                Assert.fail(&quot;Assert.failed cross product i = &quot; + i + &quot; y&quot;);</span>
            }
        }
<span class="fc" id="L986">        double[] pc2 = instance.getPartialCorrelations(1);</span>

<span class="fc" id="L988">        idx = 0;</span>

<span class="fc bfc" id="L990" title="All 2 branches covered.">        for (int i = 1; i &lt; 4; i++) {</span>
<span class="fc bfc" id="L991" title="All 2 branches covered.">            for (int j = 1; j &lt; i; j++) {</span>
<span class="pc bpc" id="L992" title="1 of 2 branches missed.">                if (FastMath.abs(pc2[idx] - corr.getEntry(j, i)) &gt; 1.0e-8) {</span>
<span class="nc" id="L993">                    Assert.fail(&quot;Failed cross products... i = &quot; + i + &quot; j = &quot; + j);</span>
                }
<span class="fc" id="L995">                ++idx;</span>
            }
        }
<span class="fc" id="L998">        double[] pc3 = instance.getPartialCorrelations(2);</span>
<span class="pc bpc" id="L999" title="1 of 2 branches missed.">        if (pc3 == null) {</span>
<span class="nc" id="L1000">            Assert.fail(&quot;Should not be null&quot;);</span>
        }
<span class="fc" id="L1002">        return;</span>
    }

    @Test
    public void testHdiag() {
<span class="fc" id="L1007">        MillerUpdatingRegression instance = new MillerUpdatingRegression(4, false);</span>
<span class="fc" id="L1008">        double[][] x = new double[airdata[0].length][];</span>
<span class="fc" id="L1009">        double[] y = new double[airdata[0].length];</span>
<span class="fc bfc" id="L1010" title="All 2 branches covered.">        for (int i = 0; i &lt; airdata[0].length; i++) {</span>
<span class="fc" id="L1011">            x[i] = new double[4];</span>
<span class="fc" id="L1012">            x[i][0] = 1.0;</span>
<span class="fc" id="L1013">            x[i][1] = FastMath.log(airdata[3][i]);</span>
<span class="fc" id="L1014">            x[i][2] = FastMath.log(airdata[4][i]);</span>
<span class="fc" id="L1015">            x[i][3] = airdata[5][i];</span>
<span class="fc" id="L1016">            y[i] = FastMath.log(airdata[2][i]);</span>
        }
<span class="fc" id="L1018">        instance.addObservations(x, y);</span>
<span class="fc" id="L1019">        OLSMultipleLinearRegression ols = new OLSMultipleLinearRegression();</span>
<span class="fc" id="L1020">        ols.setNoIntercept(true);</span>
<span class="fc" id="L1021">        ols.newSampleData(y, x);</span>

<span class="fc" id="L1023">        RealMatrix rm = ols.calculateHat();</span>
<span class="fc bfc" id="L1024" title="All 2 branches covered.">        for (int i = 0; i &lt; x.length; i++) {</span>
<span class="fc" id="L1025">            TestUtils.assertEquals(instance.getDiagonalOfHatMatrix(x[i]), rm.getEntry(i, i), 1.0e-8);</span>
        }
<span class="fc" id="L1027">        return;</span>
    }
    @Test
    public void testHdiagConstant() {
<span class="fc" id="L1031">        MillerUpdatingRegression instance = new MillerUpdatingRegression(3, true);</span>
<span class="fc" id="L1032">        double[][] x = new double[airdata[0].length][];</span>
<span class="fc" id="L1033">        double[] y = new double[airdata[0].length];</span>
<span class="fc bfc" id="L1034" title="All 2 branches covered.">        for (int i = 0; i &lt; airdata[0].length; i++) {</span>
<span class="fc" id="L1035">            x[i] = new double[3];</span>
<span class="fc" id="L1036">            x[i][0] = FastMath.log(airdata[3][i]);</span>
<span class="fc" id="L1037">            x[i][1] = FastMath.log(airdata[4][i]);</span>
<span class="fc" id="L1038">            x[i][2] = airdata[5][i];</span>
<span class="fc" id="L1039">            y[i] = FastMath.log(airdata[2][i]);</span>
        }
<span class="fc" id="L1041">        instance.addObservations(x, y);</span>
<span class="fc" id="L1042">        OLSMultipleLinearRegression ols = new OLSMultipleLinearRegression();</span>
<span class="fc" id="L1043">        ols.setNoIntercept(false);</span>
<span class="fc" id="L1044">        ols.newSampleData(y, x);</span>

<span class="fc" id="L1046">        RealMatrix rm = ols.calculateHat();</span>
<span class="fc bfc" id="L1047" title="All 2 branches covered.">        for (int i = 0; i &lt; x.length; i++) {</span>
<span class="fc" id="L1048">            TestUtils.assertEquals(instance.getDiagonalOfHatMatrix(x[i]), rm.getEntry(i, i), 1.0e-8);</span>
        }
<span class="fc" id="L1050">        return;</span>
    }


    @Test
    public void testSubsetRegression() {

<span class="fc" id="L1057">        MillerUpdatingRegression instance = new MillerUpdatingRegression(3, true);</span>
<span class="fc" id="L1058">        MillerUpdatingRegression redRegression = new MillerUpdatingRegression(2, true);</span>
<span class="fc" id="L1059">        double[][] x = new double[airdata[0].length][];</span>
<span class="fc" id="L1060">        double[][] xReduced = new double[airdata[0].length][];</span>
<span class="fc" id="L1061">        double[] y = new double[airdata[0].length];</span>
<span class="fc bfc" id="L1062" title="All 2 branches covered.">        for (int i = 0; i &lt; airdata[0].length; i++) {</span>
<span class="fc" id="L1063">            x[i] = new double[3];</span>
<span class="fc" id="L1064">            x[i][0] = FastMath.log(airdata[3][i]);</span>
<span class="fc" id="L1065">            x[i][1] = FastMath.log(airdata[4][i]);</span>
<span class="fc" id="L1066">            x[i][2] = airdata[5][i];</span>

<span class="fc" id="L1068">            xReduced[i] = new double[2];</span>
<span class="fc" id="L1069">            xReduced[i][0] = FastMath.log(airdata[3][i]);</span>
<span class="fc" id="L1070">            xReduced[i][1] = FastMath.log(airdata[4][i]);</span>

<span class="fc" id="L1072">            y[i] = FastMath.log(airdata[2][i]);</span>
        }

<span class="fc" id="L1075">        instance.addObservations(x, y);</span>
<span class="fc" id="L1076">        redRegression.addObservations(xReduced, y);</span>

<span class="fc" id="L1078">        RegressionResults resultsInstance = instance.regress( new int[]{0,1,2} );</span>
<span class="fc" id="L1079">        RegressionResults resultsReduced = redRegression.regress();</span>

<span class="fc" id="L1081">        TestUtils.assertEquals(resultsInstance.getParameterEstimates(), resultsReduced.getParameterEstimates(), 1.0e-12);</span>
<span class="fc" id="L1082">        TestUtils.assertEquals(resultsInstance.getStdErrorOfEstimates(), resultsReduced.getStdErrorOfEstimates(), 1.0e-12);</span>
<span class="fc" id="L1083">    }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>