<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>IteratorUtilsTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">commons_collections4$All_in_commons_collections4.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.collections4</a> &gt; <span class="el_source">IteratorUtilsTest.java</span></div><h1>IteratorUtilsTest.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.collections4;

import static org.apache.commons.collections4.functors.EqualPredicate.equalPredicate;
import static org.easymock.EasyMock.createMock;
import static org.easymock.EasyMock.expect;
import static org.easymock.EasyMock.replay;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertNull;
import static org.junit.Assert.assertSame;
import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.Collections;
import java.util.Comparator;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.ListIterator;
import java.util.Map;
import java.util.NoSuchElementException;
import java.util.Vector;

import org.apache.commons.collections4.iterators.EmptyIterator;
import org.apache.commons.collections4.iterators.EmptyListIterator;
import org.apache.commons.collections4.iterators.EmptyMapIterator;
import org.apache.commons.collections4.iterators.EmptyOrderedIterator;
import org.apache.commons.collections4.iterators.EmptyOrderedMapIterator;
import org.apache.commons.collections4.iterators.EnumerationIterator;
import org.apache.commons.collections4.iterators.NodeListIterator;
import org.apache.commons.collections4.iterators.ObjectArrayIterator;
import org.junit.Before;
import org.junit.Test;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;

/**
 * Tests for IteratorUtils.
 */
<span class="fc" id="L59">public class IteratorUtilsTest {</span>

    /**
     * Collection of {@link Integer}s
     */
<span class="fc" id="L64">    private List&lt;Integer&gt; collectionA = null;</span>

    /**
     * Collection of even {@link Integer}s
     */
<span class="fc" id="L69">    private List&lt;Integer&gt; collectionEven = null;</span>

    /**
     * Collection of odd {@link Integer}s
     */
<span class="fc" id="L74">    private List&lt;Integer&gt; collectionOdd = null;</span>

<span class="fc" id="L76">    private final Collection&lt;Integer&gt; emptyCollection = new ArrayList&lt;&gt;(1);</span>

<span class="fc" id="L78">    private Iterable&lt;Integer&gt; iterableA = null;</span>

    /**
     * Creates a NodeList containing the specified nodes.
     */
    private NodeList createNodeList(final Node[] nodes) {
<span class="fc" id="L84">        return new NodeList() {</span>
            @Override
            public int getLength() {
<span class="fc" id="L87">                return nodes.length;</span>
            }
            @Override
            public Node item(final int index) {
<span class="fc" id="L91">                return nodes[index];</span>
            }
        };
    }

    /**
     * creates an array of four Node instances, mocked by EasyMock.
     */
    private Node[] createNodes() {
<span class="fc" id="L100">        final Node node1 = createMock(Node.class);</span>
<span class="fc" id="L101">        final Node node2 = createMock(Node.class);</span>
<span class="fc" id="L102">        final Node node3 = createMock(Node.class);</span>
<span class="fc" id="L103">        final Node node4 = createMock(Node.class);</span>
<span class="fc" id="L104">        replay(node1);</span>
<span class="fc" id="L105">        replay(node2);</span>
<span class="fc" id="L106">        replay(node3);</span>
<span class="fc" id="L107">        replay(node4);</span>

<span class="fc" id="L109">        return new Node[]{node1, node2, node3, node4};</span>
}

    /**
     * Gets an immutable Iterator operating on the elements [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;].
     */
    private Iterator&lt;String&gt; getImmutableIterator() {
<span class="fc" id="L116">        final List&lt;String&gt; list = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L117">        list.add(&quot;a&quot;);</span>
<span class="fc" id="L118">        list.add(&quot;b&quot;);</span>
<span class="fc" id="L119">        list.add(&quot;c&quot;);</span>
<span class="fc" id="L120">        list.add(&quot;d&quot;);</span>
<span class="fc" id="L121">        return IteratorUtils.unmodifiableIterator(list.iterator());</span>
    }

    /**
     * Gets an immutable ListIterator operating on the elements [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;].
     */
    private ListIterator&lt;String&gt; getImmutableListIterator() {
<span class="fc" id="L128">        final List&lt;String&gt; list = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L129">        list.add(&quot;a&quot;);</span>
<span class="fc" id="L130">        list.add(&quot;b&quot;);</span>
<span class="fc" id="L131">        list.add(&quot;c&quot;);</span>
<span class="fc" id="L132">        list.add(&quot;d&quot;);</span>
<span class="fc" id="L133">        return IteratorUtils.unmodifiableListIterator(list.listIterator());</span>
    }

    @Before
    public void setUp() {
<span class="fc" id="L138">        collectionA = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L139">        collectionA.add(1);</span>
<span class="fc" id="L140">        collectionA.add(2);</span>
<span class="fc" id="L141">        collectionA.add(2);</span>
<span class="fc" id="L142">        collectionA.add(3);</span>
<span class="fc" id="L143">        collectionA.add(3);</span>
<span class="fc" id="L144">        collectionA.add(3);</span>
<span class="fc" id="L145">        collectionA.add(4);</span>
<span class="fc" id="L146">        collectionA.add(4);</span>
<span class="fc" id="L147">        collectionA.add(4);</span>
<span class="fc" id="L148">        collectionA.add(4);</span>

<span class="fc" id="L150">        iterableA = collectionA;</span>

<span class="fc" id="L152">        collectionEven = Arrays.asList(2, 4, 6, 8, 10, 12);</span>
<span class="fc" id="L153">        collectionOdd = Arrays.asList(1, 3, 5, 7, 9, 11);</span>
<span class="fc" id="L154">    }</span>

    @Test
    public void testArrayIterator() {
<span class="fc" id="L158">        final Object[] objArray = {&quot;a&quot;, &quot;b&quot;, &quot;c&quot;};</span>
<span class="fc" id="L159">        ResettableIterator&lt;Object&gt; iterator = IteratorUtils.arrayIterator(objArray);</span>
<span class="fc" id="L160">        assertTrue(iterator.next().equals(&quot;a&quot;));</span>
<span class="fc" id="L161">        assertTrue(iterator.next().equals(&quot;b&quot;));</span>
<span class="fc" id="L162">        iterator.reset();</span>
<span class="fc" id="L163">        assertTrue(iterator.next().equals(&quot;a&quot;));</span>

        try {
<span class="nc" id="L166">            iterator = IteratorUtils.arrayIterator(Integer.valueOf(0));</span>
<span class="nc" id="L167">            fail(&quot;Expecting IllegalArgumentException&quot;);</span>
<span class="fc" id="L168">        } catch (final IllegalArgumentException ex) {</span>
                // expected
<span class="nc" id="L170">        }</span>

        try {
<span class="nc" id="L173">            iterator = IteratorUtils.arrayIterator((Object[]) null);</span>
<span class="nc" id="L174">            fail(&quot;Expecting NullPointerException&quot;);</span>
<span class="fc" id="L175">        } catch (final NullPointerException ex) {</span>
                // expected
<span class="nc" id="L177">        }</span>

<span class="fc" id="L179">        iterator = IteratorUtils.arrayIterator(objArray, 1);</span>
<span class="fc" id="L180">        assertTrue(iterator.next().equals(&quot;b&quot;));</span>

        try {
<span class="nc" id="L183">            iterator = IteratorUtils.arrayIterator(objArray, -1);</span>
<span class="nc" id="L184">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L185">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L187">        }</span>

<span class="fc" id="L189">        iterator = IteratorUtils.arrayIterator(objArray, 3);</span>
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">        assertTrue(!iterator.hasNext());</span>
<span class="fc" id="L191">        iterator.reset();</span>

        try {
<span class="nc" id="L194">            iterator = IteratorUtils.arrayIterator(objArray, 4);</span>
<span class="nc" id="L195">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L196">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L198">        }</span>

<span class="fc" id="L200">        iterator = IteratorUtils.arrayIterator(objArray, 2, 3);</span>
<span class="fc" id="L201">        assertTrue(iterator.next().equals(&quot;c&quot;));</span>

        try {
<span class="nc" id="L204">            iterator = IteratorUtils.arrayIterator(objArray, 2, 4);</span>
<span class="nc" id="L205">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L206">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L208">        }</span>

        try {
<span class="nc" id="L211">            iterator = IteratorUtils.arrayIterator(objArray, -1, 1);</span>
<span class="nc" id="L212">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L213">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L215">        }</span>

        try {
<span class="nc" id="L218">            iterator = IteratorUtils.arrayIterator(objArray, 2, 1);</span>
<span class="nc" id="L219">            fail(&quot;Expecting IllegalArgumentException&quot;);</span>
<span class="fc" id="L220">        } catch (final IllegalArgumentException ex) {</span>
            // expected
<span class="nc" id="L222">        }</span>

<span class="fc" id="L224">        final int[] intArray = {0, 1, 2};</span>
<span class="fc" id="L225">        iterator = IteratorUtils.arrayIterator(intArray);</span>
<span class="fc" id="L226">        assertTrue(iterator.next().equals(Integer.valueOf(0)));</span>
<span class="fc" id="L227">        assertTrue(iterator.next().equals(Integer.valueOf(1)));</span>
<span class="fc" id="L228">        iterator.reset();</span>
<span class="fc" id="L229">        assertTrue(iterator.next().equals(Integer.valueOf(0)));</span>

<span class="fc" id="L231">        iterator = IteratorUtils.arrayIterator(intArray, 1);</span>
<span class="fc" id="L232">        assertTrue(iterator.next().equals(Integer.valueOf(1)));</span>

        try {
<span class="nc" id="L235">            iterator = IteratorUtils.arrayIterator(intArray, -1);</span>
<span class="nc" id="L236">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L237">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L239">        }</span>

<span class="fc" id="L241">        iterator = IteratorUtils.arrayIterator(intArray, 3);</span>
<span class="pc bpc" id="L242" title="1 of 2 branches missed.">        assertTrue(!iterator.hasNext());</span>
<span class="fc" id="L243">        iterator.reset();</span>

        try {
<span class="nc" id="L246">            iterator = IteratorUtils.arrayIterator(intArray, 4);</span>
<span class="nc" id="L247">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L248">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L250">        }</span>

<span class="fc" id="L252">        iterator = IteratorUtils.arrayIterator(intArray, 2, 3);</span>
<span class="fc" id="L253">        assertTrue(iterator.next().equals(Integer.valueOf(2)));</span>

        try {
<span class="nc" id="L256">            iterator = IteratorUtils.arrayIterator(intArray, 2, 4);</span>
<span class="nc" id="L257">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L258">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L260">        }</span>

        try {
<span class="nc" id="L263">            iterator = IteratorUtils.arrayIterator(intArray, -1, 1);</span>
<span class="nc" id="L264">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L265">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L267">        }</span>

        try {
<span class="nc" id="L270">            iterator = IteratorUtils.arrayIterator(intArray, 2, 1);</span>
<span class="nc" id="L271">            fail(&quot;Expecting IllegalArgumentException&quot;);</span>
<span class="fc" id="L272">        } catch (final IllegalArgumentException ex) {</span>
            // expected
<span class="nc" id="L274">        }</span>
<span class="fc" id="L275">    }</span>

    @Test
    public void testArrayListIterator() {
<span class="fc" id="L279">        final Object[] objArray = {&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;};</span>
<span class="fc" id="L280">        ResettableListIterator&lt;Object&gt; iterator = IteratorUtils.arrayListIterator(objArray);</span>
<span class="pc bpc" id="L281" title="1 of 2 branches missed.">        assertTrue(!iterator.hasPrevious());</span>
<span class="pc bpc" id="L282" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == -1);</span>
<span class="pc bpc" id="L283" title="1 of 2 branches missed.">        assertTrue(iterator.nextIndex() == 0);</span>
<span class="fc" id="L284">        assertTrue(iterator.next().equals(&quot;a&quot;));</span>
<span class="fc" id="L285">        assertTrue(iterator.previous().equals(&quot;a&quot;));</span>
<span class="fc" id="L286">        assertTrue(iterator.next().equals(&quot;a&quot;));</span>
<span class="pc bpc" id="L287" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == 0);</span>
<span class="pc bpc" id="L288" title="1 of 2 branches missed.">        assertTrue(iterator.nextIndex() == 1);</span>
<span class="fc" id="L289">        assertTrue(iterator.next().equals(&quot;b&quot;));</span>
<span class="fc" id="L290">        assertTrue(iterator.next().equals(&quot;c&quot;));</span>
<span class="fc" id="L291">        assertTrue(iterator.next().equals(&quot;d&quot;));</span>
<span class="pc bpc" id="L292" title="1 of 2 branches missed.">        assertTrue(iterator.nextIndex() == 4); // size of list</span>
<span class="pc bpc" id="L293" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == 3);</span>

        try {
<span class="nc" id="L296">            iterator = IteratorUtils.arrayListIterator(Integer.valueOf(0));</span>
<span class="nc" id="L297">            fail(&quot;Expecting IllegalArgumentException&quot;);</span>
<span class="fc" id="L298">        } catch (final IllegalArgumentException ex) {</span>
                // expected
<span class="nc" id="L300">        }</span>

        try {
<span class="nc" id="L303">            iterator = IteratorUtils.arrayListIterator((Object[]) null);</span>
<span class="nc" id="L304">            fail(&quot;Expecting NullPointerException&quot;);</span>
<span class="fc" id="L305">        } catch (final NullPointerException ex) {</span>
                // expected
<span class="nc" id="L307">        }</span>

<span class="fc" id="L309">        iterator = IteratorUtils.arrayListIterator(objArray, 1);</span>
<span class="pc bpc" id="L310" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == -1);</span>
<span class="pc bpc" id="L311" title="1 of 2 branches missed.">        assertTrue(!iterator.hasPrevious());</span>
<span class="pc bpc" id="L312" title="1 of 2 branches missed.">        assertTrue(iterator.nextIndex() == 0);</span>
<span class="fc" id="L313">        assertTrue(iterator.next().equals(&quot;b&quot;));</span>
<span class="pc bpc" id="L314" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == 0);</span>

        try {
<span class="nc" id="L317">            iterator = IteratorUtils.arrayListIterator(objArray, -1);</span>
<span class="nc" id="L318">            fail(&quot;Expecting IndexOutOfBoundsException.&quot;);</span>
<span class="fc" id="L319">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L321">        }</span>

<span class="fc" id="L323">        iterator = IteratorUtils.arrayListIterator(objArray, 3);</span>
<span class="fc" id="L324">        assertTrue(iterator.hasNext());</span>
        try {
<span class="nc" id="L326">            iterator.previous();</span>
<span class="nc" id="L327">            fail(&quot;Expecting NoSuchElementException.&quot;);</span>
<span class="fc" id="L328">        } catch (final NoSuchElementException ex) {</span>
            // expected
<span class="nc" id="L330">        }</span>

        try {
<span class="nc" id="L333">            iterator = IteratorUtils.arrayListIterator(objArray, 5);</span>
<span class="nc" id="L334">            fail(&quot;Expecting IndexOutOfBoundsException.&quot;);</span>
<span class="fc" id="L335">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L337">        }</span>

<span class="fc" id="L339">        iterator = IteratorUtils.arrayListIterator(objArray, 2, 3);</span>
<span class="fc" id="L340">        assertTrue(iterator.next().equals(&quot;c&quot;));</span>

        try {
<span class="nc" id="L343">            iterator = IteratorUtils.arrayListIterator(objArray, 2, 5);</span>
<span class="nc" id="L344">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L345">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L347">        }</span>

        try {
<span class="nc" id="L350">            iterator = IteratorUtils.arrayListIterator(objArray, -1, 1);</span>
<span class="nc" id="L351">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L352">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L354">        }</span>

        try {
<span class="nc" id="L357">            iterator = IteratorUtils.arrayListIterator(objArray, 2, 1);</span>
<span class="nc" id="L358">            fail(&quot;Expecting IllegalArgumentException&quot;);</span>
<span class="fc" id="L359">        } catch (final IllegalArgumentException ex) {</span>
            // expected
<span class="nc" id="L361">        }</span>

<span class="fc" id="L363">        final int[] intArray = {0, 1, 2};</span>
<span class="fc" id="L364">        iterator = IteratorUtils.arrayListIterator(intArray);</span>
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == -1);</span>
<span class="pc bpc" id="L366" title="1 of 2 branches missed.">        assertTrue(!iterator.hasPrevious());</span>
<span class="pc bpc" id="L367" title="1 of 2 branches missed.">        assertTrue(iterator.nextIndex() == 0);</span>
<span class="fc" id="L368">        assertTrue(iterator.next().equals(Integer.valueOf(0)));</span>
<span class="pc bpc" id="L369" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == 0);</span>
<span class="pc bpc" id="L370" title="1 of 2 branches missed.">        assertTrue(iterator.nextIndex() == 1);</span>
<span class="fc" id="L371">        assertTrue(iterator.next().equals(Integer.valueOf(1)));</span>
<span class="pc bpc" id="L372" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == 1);</span>
<span class="pc bpc" id="L373" title="1 of 2 branches missed.">        assertTrue(iterator.nextIndex() == 2);</span>
<span class="fc" id="L374">        assertTrue(iterator.previous().equals(Integer.valueOf(1)));</span>
<span class="fc" id="L375">        assertTrue(iterator.next().equals(Integer.valueOf(1)));</span>

<span class="fc" id="L377">        iterator = IteratorUtils.arrayListIterator(intArray, 1);</span>
<span class="pc bpc" id="L378" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == -1);</span>
<span class="pc bpc" id="L379" title="1 of 2 branches missed.">        assertTrue(!iterator.hasPrevious());</span>
<span class="pc bpc" id="L380" title="1 of 2 branches missed.">        assertTrue(iterator.nextIndex() == 0);</span>
<span class="fc" id="L381">        assertTrue(iterator.next().equals(Integer.valueOf(1)));</span>
<span class="fc" id="L382">        assertTrue(iterator.previous().equals(Integer.valueOf(1)));</span>
<span class="fc" id="L383">        assertTrue(iterator.next().equals(Integer.valueOf(1)));</span>
<span class="pc bpc" id="L384" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == 0);</span>
<span class="pc bpc" id="L385" title="1 of 2 branches missed.">        assertTrue(iterator.nextIndex() == 1);</span>
<span class="fc" id="L386">        assertTrue(iterator.next().equals(Integer.valueOf(2)));</span>
<span class="pc bpc" id="L387" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == 1);</span>
<span class="pc bpc" id="L388" title="1 of 2 branches missed.">        assertTrue(iterator.nextIndex() == 2);</span>
<span class="fc" id="L389">        assertTrue(iterator.previous().equals(Integer.valueOf(2)));</span>
<span class="pc bpc" id="L390" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == 0);</span>
<span class="pc bpc" id="L391" title="1 of 2 branches missed.">        assertTrue(iterator.nextIndex() == 1);</span>

        try {
<span class="nc" id="L394">            iterator = IteratorUtils.arrayListIterator(intArray, -1);</span>
<span class="nc" id="L395">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L396">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L398">        }</span>

<span class="fc" id="L400">        iterator = IteratorUtils.arrayListIterator(intArray, 3);</span>
<span class="pc bpc" id="L401" title="1 of 2 branches missed.">        assertTrue(!iterator.hasNext());</span>

        try {
<span class="nc" id="L404">            iterator = IteratorUtils.arrayListIterator(intArray, 4);</span>
<span class="nc" id="L405">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L406">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L408">        }</span>

<span class="fc" id="L410">        iterator = IteratorUtils.arrayListIterator(intArray, 2, 3);</span>
<span class="pc bpc" id="L411" title="1 of 2 branches missed.">        assertTrue(!iterator.hasPrevious());</span>
<span class="pc bpc" id="L412" title="1 of 2 branches missed.">        assertTrue(iterator.previousIndex() == -1);</span>
<span class="fc" id="L413">        assertTrue(iterator.next().equals(Integer.valueOf(2)));</span>
<span class="fc" id="L414">        assertTrue(iterator.hasPrevious());</span>
<span class="pc bpc" id="L415" title="1 of 2 branches missed.">        assertTrue(!iterator.hasNext());</span>


        try {
<span class="nc" id="L419">            iterator = IteratorUtils.arrayListIterator(intArray, 2, 4);</span>
<span class="nc" id="L420">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L421">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L423">        }</span>

        try {
<span class="nc" id="L426">            iterator = IteratorUtils.arrayListIterator(intArray, -1, 1);</span>
<span class="nc" id="L427">            fail(&quot;Expecting IndexOutOfBoundsException&quot;);</span>
<span class="fc" id="L428">        } catch (final IndexOutOfBoundsException ex) {</span>
            // expected
<span class="nc" id="L430">        }</span>

        try {
<span class="nc" id="L433">            iterator = IteratorUtils.arrayListIterator(intArray, 2, 1);</span>
<span class="nc" id="L434">            fail(&quot;Expecting IllegalArgumentException&quot;);</span>
<span class="fc" id="L435">        } catch (final IllegalArgumentException ex) {</span>
            // expected
<span class="nc" id="L437">        }</span>
<span class="fc" id="L438">    }</span>

    @Test
    public void testAsIterable() {
<span class="fc" id="L442">        final List&lt;Integer&gt; list = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L443">        list.add(Integer.valueOf(0));</span>
<span class="fc" id="L444">        list.add(Integer.valueOf(1));</span>
<span class="fc" id="L445">        list.add(Integer.valueOf(2));</span>
<span class="fc" id="L446">        final Iterator&lt;Integer&gt; iterator = list.iterator();</span>

<span class="fc" id="L448">        final Iterable&lt;Integer&gt; iterable = IteratorUtils.asIterable(iterator);</span>
<span class="fc" id="L449">        int expected = 0;</span>
<span class="fc bfc" id="L450" title="All 2 branches covered.">        for(final Integer actual : iterable) {</span>
<span class="fc" id="L451">            assertEquals(expected, actual.intValue());</span>
<span class="fc" id="L452">            ++expected;</span>
<span class="fc" id="L453">        }</span>
        // insure iteration occurred
<span class="pc bpc" id="L455" title="1 of 2 branches missed.">        assertTrue(expected &gt; 0);</span>

        // single use iterator
<span class="fc" id="L458">        assertFalse(&quot;should not be able to iterate twice&quot;, IteratorUtils.asIterable(iterator).iterator().hasNext());</span>
<span class="fc" id="L459">    }</span>

    @Test
    public void testAsIterableNull() {
        try {
<span class="nc" id="L464">            IteratorUtils.asIterable(null);</span>
<span class="nc" id="L465">            fail(&quot;Expecting NullPointerException&quot;);</span>
<span class="fc" id="L466">        } catch (final NullPointerException ex) {</span>
            // success
<span class="nc" id="L468">        }</span>
<span class="fc" id="L469">    }</span>

    @Test
    public void testAsMultipleIterable() {
<span class="fc" id="L473">        final List&lt;Integer&gt; list = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L474">        list.add(Integer.valueOf(0));</span>
<span class="fc" id="L475">        list.add(Integer.valueOf(1));</span>
<span class="fc" id="L476">        list.add(Integer.valueOf(2));</span>
<span class="fc" id="L477">        final Iterator&lt;Integer&gt; iterator = list.iterator();</span>

<span class="fc" id="L479">        final Iterable&lt;Integer&gt; iterable = IteratorUtils.asMultipleUseIterable(iterator);</span>
<span class="fc" id="L480">        int expected = 0;</span>
<span class="fc bfc" id="L481" title="All 2 branches covered.">        for(final Integer actual : iterable) {</span>
<span class="fc" id="L482">            assertEquals(expected, actual.intValue());</span>
<span class="fc" id="L483">            ++expected;</span>
<span class="fc" id="L484">        }</span>
        // insure iteration occurred
<span class="pc bpc" id="L486" title="1 of 2 branches missed.">        assertTrue(expected &gt; 0);</span>

        // multiple use iterator
<span class="fc" id="L489">        expected = 0;</span>
<span class="fc bfc" id="L490" title="All 2 branches covered.">        for(final Integer actual : iterable) {</span>
<span class="fc" id="L491">            assertEquals(expected, actual.intValue());</span>
<span class="fc" id="L492">            ++expected;</span>
<span class="fc" id="L493">        }</span>
        // insure iteration occurred
<span class="pc bpc" id="L495" title="1 of 2 branches missed.">        assertTrue(expected &gt; 0);</span>
<span class="fc" id="L496">    }</span>


    @Test
    public void testAsMultipleIterableNull() {
        try {
<span class="nc" id="L502">            IteratorUtils.asMultipleUseIterable(null);</span>
<span class="nc" id="L503">            fail(&quot;Expecting NullPointerException&quot;);</span>
<span class="fc" id="L504">        } catch (final NullPointerException ex) {</span>
            // success
<span class="nc" id="L506">        }</span>
<span class="fc" id="L507">    }</span>

    /**
     * Tests methods collatedIterator(...)
     */
    @Test
    public void testCollatedIterator() {
        try {
<span class="nc" id="L515">            IteratorUtils.collatedIterator(null, collectionOdd.iterator(), null);</span>
<span class="nc" id="L516">            fail(&quot;expecting NullPointerException&quot;);</span>
<span class="fc" id="L517">        } catch (final NullPointerException npe) {</span>
            // expected
<span class="nc" id="L519">        }</span>

        try {
<span class="nc" id="L522">            IteratorUtils.collatedIterator(null, null, collectionEven.iterator());</span>
<span class="nc" id="L523">            fail(&quot;expecting NullPointerException&quot;);</span>
<span class="fc" id="L524">        } catch (final NullPointerException npe) {</span>
            // expected
<span class="nc" id="L526">        }</span>

        // natural ordering
<span class="fc" id="L529">        Iterator&lt;Integer&gt; it =</span>
<span class="fc" id="L530">                IteratorUtils.collatedIterator(null, collectionOdd.iterator(), collectionEven.iterator());</span>

<span class="fc" id="L532">        List&lt;Integer&gt; result = IteratorUtils.toList(it);</span>
<span class="fc" id="L533">        assertEquals(12, result.size());</span>

<span class="fc" id="L535">        final List&lt;Integer&gt; combinedList = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L536">        combinedList.addAll(collectionOdd);</span>
<span class="fc" id="L537">        combinedList.addAll(collectionEven);</span>
<span class="fc" id="L538">        Collections.sort(combinedList);</span>

<span class="fc" id="L540">        assertEquals(combinedList, result);</span>

<span class="fc" id="L542">        it = IteratorUtils.collatedIterator(null, collectionOdd.iterator(), emptyCollection.iterator());</span>
<span class="fc" id="L543">        result = IteratorUtils.toList(it);</span>
<span class="fc" id="L544">        assertEquals(collectionOdd, result);</span>

        final Comparator&lt;Integer&gt; reverseComparator =
<span class="fc" id="L547">                ComparatorUtils.reversedComparator(ComparatorUtils.&lt;Integer&gt;naturalComparator());</span>

<span class="fc" id="L549">        Collections.reverse(collectionOdd);</span>
<span class="fc" id="L550">        Collections.reverse(collectionEven);</span>
<span class="fc" id="L551">        Collections.reverse(combinedList);</span>

<span class="fc" id="L553">        it = IteratorUtils.collatedIterator(reverseComparator,</span>
<span class="fc" id="L554">                                            collectionOdd.iterator(),</span>
<span class="fc" id="L555">                                            collectionEven.iterator());</span>
<span class="fc" id="L556">        result = IteratorUtils.toList(it);</span>
<span class="fc" id="L557">        assertEquals(combinedList, result);</span>
<span class="fc" id="L558">    }</span>

    //-----------------------------------------------------------------------
    /**
     * Test empty iterator
     */
    @Test
    public void testEmptyIterator() {
<span class="fc" id="L566">        assertSame(EmptyIterator.INSTANCE, IteratorUtils.EMPTY_ITERATOR);</span>
<span class="fc" id="L567">        assertSame(EmptyIterator.RESETTABLE_INSTANCE, IteratorUtils.EMPTY_ITERATOR);</span>
<span class="fc" id="L568">        assertEquals(true, IteratorUtils.EMPTY_ITERATOR instanceof Iterator);</span>
<span class="fc" id="L569">        assertEquals(true, IteratorUtils.EMPTY_ITERATOR instanceof ResettableIterator);</span>
<span class="fc" id="L570">        assertEquals(false, IteratorUtils.EMPTY_ITERATOR instanceof OrderedIterator);</span>
<span class="fc" id="L571">        assertEquals(false, IteratorUtils.EMPTY_ITERATOR instanceof ListIterator);</span>
<span class="fc" id="L572">        assertEquals(false, IteratorUtils.EMPTY_ITERATOR instanceof MapIterator);</span>
<span class="fc" id="L573">        assertEquals(false, IteratorUtils.EMPTY_ITERATOR.hasNext());</span>
<span class="fc" id="L574">        IteratorUtils.EMPTY_ITERATOR.reset();</span>
<span class="fc" id="L575">        assertSame(IteratorUtils.EMPTY_ITERATOR, IteratorUtils.EMPTY_ITERATOR);</span>
<span class="fc" id="L576">        assertSame(IteratorUtils.EMPTY_ITERATOR, IteratorUtils.emptyIterator());</span>
        try {
<span class="nc" id="L578">            IteratorUtils.EMPTY_ITERATOR.next();</span>
<span class="nc" id="L579">            fail();</span>
<span class="pc" id="L580">        } catch (final NoSuchElementException ex) {}</span>
        try {
<span class="nc" id="L582">            IteratorUtils.EMPTY_ITERATOR.remove();</span>
<span class="nc" id="L583">            fail();</span>
<span class="pc" id="L584">        } catch (final IllegalStateException ex) {}</span>
<span class="fc" id="L585">    }</span>

    //-----------------------------------------------------------------------
    /**
     * Test empty list iterator
     */
    @Test
    public void testEmptyListIterator() {
<span class="fc" id="L593">        assertSame(EmptyListIterator.INSTANCE, IteratorUtils.EMPTY_LIST_ITERATOR);</span>
<span class="fc" id="L594">        assertSame(EmptyListIterator.RESETTABLE_INSTANCE, IteratorUtils.EMPTY_LIST_ITERATOR);</span>
<span class="fc" id="L595">        assertEquals(true, IteratorUtils.EMPTY_LIST_ITERATOR instanceof Iterator);</span>
<span class="fc" id="L596">        assertEquals(true, IteratorUtils.EMPTY_LIST_ITERATOR instanceof ListIterator);</span>
<span class="fc" id="L597">        assertEquals(true, IteratorUtils.EMPTY_LIST_ITERATOR instanceof ResettableIterator);</span>
<span class="fc" id="L598">        assertEquals(true, IteratorUtils.EMPTY_LIST_ITERATOR instanceof ResettableListIterator);</span>
<span class="fc" id="L599">        assertEquals(false, IteratorUtils.EMPTY_LIST_ITERATOR instanceof MapIterator);</span>
<span class="fc" id="L600">        assertEquals(false, IteratorUtils.EMPTY_LIST_ITERATOR.hasNext());</span>
<span class="fc" id="L601">        assertEquals(0, IteratorUtils.EMPTY_LIST_ITERATOR.nextIndex());</span>
<span class="fc" id="L602">        assertEquals(-1, IteratorUtils.EMPTY_LIST_ITERATOR.previousIndex());</span>
<span class="fc" id="L603">        IteratorUtils.EMPTY_LIST_ITERATOR.reset();</span>
<span class="fc" id="L604">        assertSame(IteratorUtils.EMPTY_LIST_ITERATOR, IteratorUtils.EMPTY_LIST_ITERATOR);</span>
<span class="fc" id="L605">        assertSame(IteratorUtils.EMPTY_LIST_ITERATOR, IteratorUtils.emptyListIterator());</span>
        try {
<span class="nc" id="L607">            IteratorUtils.EMPTY_LIST_ITERATOR.next();</span>
<span class="nc" id="L608">            fail();</span>
<span class="pc" id="L609">        } catch (final NoSuchElementException ex) {}</span>
        try {
<span class="nc" id="L611">            IteratorUtils.EMPTY_LIST_ITERATOR.previous();</span>
<span class="nc" id="L612">            fail();</span>
<span class="pc" id="L613">        } catch (final NoSuchElementException ex) {}</span>
        try {
<span class="nc" id="L615">            IteratorUtils.EMPTY_LIST_ITERATOR.remove();</span>
<span class="nc" id="L616">            fail();</span>
<span class="pc" id="L617">        } catch (final IllegalStateException ex) {}</span>
        try {
<span class="nc" id="L619">            IteratorUtils.emptyListIterator().set(null);</span>
<span class="nc" id="L620">            fail();</span>
<span class="pc" id="L621">        } catch (final IllegalStateException ex) {}</span>
        try {
<span class="nc" id="L623">            IteratorUtils.emptyListIterator().add(null);</span>
<span class="nc" id="L624">            fail();</span>
<span class="pc" id="L625">        } catch (final UnsupportedOperationException ex) {}</span>
<span class="fc" id="L626">    }</span>

    //-----------------------------------------------------------------------
    /**
     * Test empty map iterator
     */
    @Test
    @SuppressWarnings(&quot;unchecked&quot;)
    public void testEmptyMapIterator() {
<span class="fc" id="L635">        assertSame(EmptyMapIterator.INSTANCE, IteratorUtils.EMPTY_MAP_ITERATOR);</span>
<span class="fc" id="L636">        assertEquals(true, IteratorUtils.EMPTY_MAP_ITERATOR instanceof Iterator);</span>
<span class="fc" id="L637">        assertEquals(true, IteratorUtils.EMPTY_MAP_ITERATOR instanceof MapIterator);</span>
<span class="fc" id="L638">        assertEquals(true, IteratorUtils.EMPTY_MAP_ITERATOR instanceof ResettableIterator);</span>
<span class="fc" id="L639">        assertEquals(false, IteratorUtils.EMPTY_MAP_ITERATOR instanceof ListIterator);</span>
<span class="fc" id="L640">        assertEquals(false, IteratorUtils.EMPTY_MAP_ITERATOR instanceof OrderedIterator);</span>
<span class="fc" id="L641">        assertEquals(false, IteratorUtils.EMPTY_MAP_ITERATOR instanceof OrderedMapIterator);</span>
<span class="fc" id="L642">        assertEquals(false, IteratorUtils.EMPTY_MAP_ITERATOR.hasNext());</span>
<span class="fc" id="L643">        ((ResettableIterator&lt;Object&gt;) IteratorUtils.EMPTY_MAP_ITERATOR).reset();</span>
<span class="fc" id="L644">        assertSame(IteratorUtils.EMPTY_MAP_ITERATOR, IteratorUtils.EMPTY_MAP_ITERATOR);</span>
<span class="fc" id="L645">        assertSame(IteratorUtils.EMPTY_MAP_ITERATOR, IteratorUtils.emptyMapIterator());</span>
        try {
<span class="nc" id="L647">            IteratorUtils.EMPTY_MAP_ITERATOR.next();</span>
<span class="nc" id="L648">            fail();</span>
<span class="pc" id="L649">        } catch (final NoSuchElementException ex) {}</span>
        try {
<span class="nc" id="L651">            IteratorUtils.EMPTY_MAP_ITERATOR.remove();</span>
<span class="nc" id="L652">            fail();</span>
<span class="pc" id="L653">        } catch (final IllegalStateException ex) {}</span>
        try {
<span class="nc" id="L655">            IteratorUtils.EMPTY_MAP_ITERATOR.getKey();</span>
<span class="nc" id="L656">            fail();</span>
<span class="pc" id="L657">        } catch (final IllegalStateException ex) {}</span>
        try {
<span class="nc" id="L659">            IteratorUtils.EMPTY_MAP_ITERATOR.getValue();</span>
<span class="nc" id="L660">            fail();</span>
<span class="pc" id="L661">        } catch (final IllegalStateException ex) {}</span>
        try {
<span class="nc" id="L663">            IteratorUtils.EMPTY_MAP_ITERATOR.setValue(null);</span>
<span class="nc" id="L664">            fail();</span>
<span class="pc" id="L665">        } catch (final IllegalStateException ex) {}</span>
<span class="fc" id="L666">    }</span>

    //-----------------------------------------------------------------------
    /**
     * Test empty map iterator
     */
    @Test
    @SuppressWarnings(&quot;unchecked&quot;)
    public void testEmptyOrderedIterator() {
<span class="fc" id="L675">        assertSame(EmptyOrderedIterator.INSTANCE, IteratorUtils.EMPTY_ORDERED_ITERATOR);</span>
<span class="fc" id="L676">        assertEquals(true, IteratorUtils.EMPTY_ORDERED_ITERATOR instanceof Iterator);</span>
<span class="fc" id="L677">        assertEquals(true, IteratorUtils.EMPTY_ORDERED_ITERATOR instanceof OrderedIterator);</span>
<span class="fc" id="L678">        assertEquals(true, IteratorUtils.EMPTY_ORDERED_ITERATOR instanceof ResettableIterator);</span>
<span class="fc" id="L679">        assertEquals(false, IteratorUtils.EMPTY_ORDERED_ITERATOR instanceof ListIterator);</span>
<span class="fc" id="L680">        assertEquals(false, IteratorUtils.EMPTY_ORDERED_ITERATOR instanceof MapIterator);</span>
<span class="fc" id="L681">        assertEquals(false, IteratorUtils.EMPTY_ORDERED_ITERATOR.hasNext());</span>
<span class="fc" id="L682">        assertEquals(false, IteratorUtils.EMPTY_ORDERED_ITERATOR.hasPrevious());</span>
<span class="fc" id="L683">        ((ResettableIterator&lt;Object&gt;) IteratorUtils.EMPTY_ORDERED_ITERATOR).reset();</span>
<span class="fc" id="L684">        assertSame(IteratorUtils.EMPTY_ORDERED_ITERATOR, IteratorUtils.EMPTY_ORDERED_ITERATOR);</span>
<span class="fc" id="L685">        assertSame(IteratorUtils.EMPTY_ORDERED_ITERATOR, IteratorUtils.emptyOrderedIterator());</span>
        try {
<span class="nc" id="L687">            IteratorUtils.EMPTY_ORDERED_ITERATOR.next();</span>
<span class="nc" id="L688">            fail();</span>
<span class="pc" id="L689">        } catch (final NoSuchElementException ex) {}</span>
        try {
<span class="nc" id="L691">            IteratorUtils.EMPTY_ORDERED_ITERATOR.previous();</span>
<span class="nc" id="L692">            fail();</span>
<span class="pc" id="L693">        } catch (final NoSuchElementException ex) {}</span>
        try {
<span class="nc" id="L695">            IteratorUtils.EMPTY_ORDERED_ITERATOR.remove();</span>
<span class="nc" id="L696">            fail();</span>
<span class="pc" id="L697">        } catch (final IllegalStateException ex) {}</span>
<span class="fc" id="L698">    }</span>

    //-----------------------------------------------------------------------
    /**
     * Test empty map iterator
     */
    @Test
    @SuppressWarnings(&quot;unchecked&quot;)
    public void testEmptyOrderedMapIterator() {
<span class="fc" id="L707">        assertSame(EmptyOrderedMapIterator.INSTANCE, IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR);</span>
<span class="fc" id="L708">        assertEquals(true, IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR instanceof Iterator);</span>
<span class="fc" id="L709">        assertEquals(true, IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR instanceof MapIterator);</span>
<span class="fc" id="L710">        assertEquals(true, IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR instanceof OrderedMapIterator);</span>
<span class="fc" id="L711">        assertEquals(true, IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR instanceof ResettableIterator);</span>
<span class="fc" id="L712">        assertEquals(false, IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR instanceof ListIterator);</span>
<span class="fc" id="L713">        assertEquals(false, IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR.hasNext());</span>
<span class="fc" id="L714">        assertEquals(false, IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR.hasPrevious());</span>
<span class="fc" id="L715">        ((ResettableIterator&lt;Object&gt;) IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR).reset();</span>
<span class="fc" id="L716">        assertSame(IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR, IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR);</span>
<span class="fc" id="L717">        assertSame(IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR, IteratorUtils.emptyOrderedMapIterator());</span>
        try {
<span class="nc" id="L719">            IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR.next();</span>
<span class="nc" id="L720">            fail();</span>
<span class="pc" id="L721">        } catch (final NoSuchElementException ex) {}</span>
        try {
<span class="nc" id="L723">            IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR.previous();</span>
<span class="nc" id="L724">            fail();</span>
<span class="pc" id="L725">        } catch (final NoSuchElementException ex) {}</span>
        try {
<span class="nc" id="L727">            IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR.remove();</span>
<span class="nc" id="L728">            fail();</span>
<span class="pc" id="L729">        } catch (final IllegalStateException ex) {}</span>
        try {
<span class="nc" id="L731">            IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR.getKey();</span>
<span class="nc" id="L732">            fail();</span>
<span class="pc" id="L733">        } catch (final IllegalStateException ex) {}</span>
        try {
<span class="nc" id="L735">            IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR.getValue();</span>
<span class="nc" id="L736">            fail();</span>
<span class="pc" id="L737">        } catch (final IllegalStateException ex) {}</span>
        try {
<span class="nc" id="L739">            IteratorUtils.EMPTY_ORDERED_MAP_ITERATOR.setValue(null);</span>
<span class="nc" id="L740">            fail();</span>
<span class="pc" id="L741">        } catch (final IllegalStateException ex) {}</span>
<span class="fc" id="L742">    }</span>

    @Test
    public void testFind() {
<span class="fc" id="L746">        Predicate&lt;Number&gt; testPredicate = equalPredicate((Number) 4);</span>
<span class="fc" id="L747">        Integer test = IteratorUtils.find(iterableA.iterator(), testPredicate);</span>
<span class="fc" id="L748">        assertTrue(test.equals(4));</span>
<span class="fc" id="L749">        testPredicate = equalPredicate((Number) 45);</span>
<span class="fc" id="L750">        test = IteratorUtils.find(iterableA.iterator(), testPredicate);</span>
<span class="pc bpc" id="L751" title="1 of 2 branches missed.">        assertTrue(test == null);</span>
<span class="fc" id="L752">        assertNull(IteratorUtils.find(null,testPredicate));</span>
        try {
<span class="nc" id="L754">            assertNull(IteratorUtils.find(iterableA.iterator(), null));</span>
<span class="nc" id="L755">            fail(&quot;expecting NullPointerException&quot;);</span>
<span class="fc" id="L756">        } catch (final NullPointerException npe) {</span>
            // expected
<span class="nc" id="L758">        }</span>
<span class="fc" id="L759">    }</span>

    @Test
    public void testFirstFromIterator() throws Exception {
        // Iterator, entry exists
<span class="fc" id="L764">        final Iterator&lt;Integer&gt; iterator = iterableA.iterator();</span>
<span class="fc" id="L765">        assertEquals(1, (int) IteratorUtils.first(iterator));</span>
<span class="fc" id="L766">    }</span>

    // -----------------------------------------------------------------------
    @Test
    public void testForEach() {
<span class="fc" id="L771">        final List&lt;Integer&gt; listA = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L772">        listA.add(1);</span>

<span class="fc" id="L774">        final List&lt;Integer&gt; listB = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L775">        listB.add(2);</span>

<span class="fc" id="L777">        final Closure&lt;List&lt;Integer&gt;&gt; testClosure = ClosureUtils.invokerClosure(&quot;clear&quot;);</span>
<span class="fc" id="L778">        final Collection&lt;List&lt;Integer&gt;&gt; col = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L779">        col.add(listA);</span>
<span class="fc" id="L780">        col.add(listB);</span>
<span class="fc" id="L781">        IteratorUtils.forEach(col.iterator(), testClosure);</span>
<span class="pc bpc" id="L782" title="2 of 4 branches missed.">        assertTrue(listA.isEmpty() &amp;&amp; listB.isEmpty());</span>
        try {
<span class="nc" id="L784">            IteratorUtils.forEach(col.iterator(), null);</span>
<span class="nc" id="L785">            fail(&quot;expecting NullPointerException&quot;);</span>
<span class="fc" id="L786">        } catch (final NullPointerException npe) {</span>
            // expected
<span class="nc" id="L788">        }</span>

<span class="fc" id="L790">        IteratorUtils.forEach(null, testClosure);</span>

        // null should be OK
<span class="fc" id="L793">        col.add(null);</span>
<span class="fc" id="L794">        IteratorUtils.forEach(col.iterator(), testClosure);</span>
<span class="fc" id="L795">    }</span>

    @Test
    public void testForEachButLast() {
<span class="fc" id="L799">        final List&lt;Integer&gt; listA = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L800">        listA.add(1);</span>

<span class="fc" id="L802">        final List&lt;Integer&gt; listB = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L803">        listB.add(2);</span>

<span class="fc" id="L805">        final Closure&lt;List&lt;Integer&gt;&gt; testClosure = ClosureUtils.invokerClosure(&quot;clear&quot;);</span>
<span class="fc" id="L806">        final Collection&lt;List&lt;Integer&gt;&gt; col = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L807">        col.add(listA);</span>
<span class="fc" id="L808">        col.add(listB);</span>
<span class="fc" id="L809">        List&lt;Integer&gt; last = IteratorUtils.forEachButLast(col.iterator(), testClosure);</span>
<span class="pc bpc" id="L810" title="2 of 4 branches missed.">        assertTrue(listA.isEmpty() &amp;&amp; !listB.isEmpty());</span>
<span class="fc" id="L811">        assertSame(listB, last);</span>

        try {
<span class="nc" id="L814">            IteratorUtils.forEachButLast(col.iterator(), null);</span>
<span class="nc" id="L815">            fail(&quot;expecting NullPointerException&quot;);</span>
<span class="fc" id="L816">        } catch (final NullPointerException npe) {</span>
            // expected
<span class="nc" id="L818">        }</span>

<span class="fc" id="L820">        IteratorUtils.forEachButLast(null, testClosure);</span>

        // null should be OK
<span class="fc" id="L823">        col.add(null);</span>
<span class="fc" id="L824">        col.add(null);</span>
<span class="fc" id="L825">        last = IteratorUtils.forEachButLast(col.iterator(), testClosure);</span>
<span class="fc" id="L826">        assertNull(last);</span>
<span class="fc" id="L827">    }</span>

    @Test
    public void testGetAtIndexFromIterator() throws Exception {
        // Iterator, entry exists
<span class="fc" id="L832">        Iterator&lt;Integer&gt; iterator = iterableA.iterator();</span>
<span class="fc" id="L833">        assertEquals(1, (int) IteratorUtils.get(iterator, 0));</span>
<span class="fc" id="L834">        iterator = iterableA.iterator();</span>
<span class="fc" id="L835">        assertEquals(2, (int) IteratorUtils.get(iterator, 1));</span>

        // Iterator, non-existent entry
        try {
<span class="nc" id="L839">            IteratorUtils.get(iterator, 10);</span>
<span class="nc" id="L840">            fail(&quot;Expecting IndexOutOfBoundsException.&quot;);</span>
<span class="fc" id="L841">        } catch (final IndexOutOfBoundsException e) {</span>
            // expected
<span class="nc" id="L843">        }</span>
<span class="pc bpc" id="L844" title="1 of 2 branches missed.">        assertTrue(!iterator.hasNext());</span>
<span class="fc" id="L845">    }</span>
    @Test
    public void testGetIterator() {
<span class="fc" id="L848">    	final Object[] objArray = {&quot;a&quot;, &quot;b&quot;, &quot;c&quot;};</span>
<span class="fc" id="L849">        final Map&lt;String, String&gt; inMap = new HashMap&lt;&gt;();</span>
<span class="fc" id="L850">        final Node[] nodes = createNodes();</span>
<span class="fc" id="L851">        final NodeList nodeList = createNodeList(nodes);</span>

<span class="fc" id="L853">        assertTrue(&quot;returns empty iterator when null passed&quot;, IteratorUtils.getIterator(null) instanceof EmptyIterator);</span>
<span class="fc" id="L854">        assertTrue(&quot;returns Iterator when Iterator directly &quot;, IteratorUtils.getIterator(iterableA.iterator()) instanceof Iterator);</span>
<span class="fc" id="L855">        assertTrue(&quot;returns Iterator when iterable passed&quot;, IteratorUtils.getIterator(iterableA) instanceof Iterator);</span>
<span class="fc" id="L856">        assertTrue(&quot;returns ObjectArrayIterator when Object array passed&quot;, IteratorUtils.getIterator(objArray) instanceof ObjectArrayIterator);</span>
<span class="fc" id="L857">        assertTrue(&quot;returns Iterator when Map passed&quot;, IteratorUtils.getIterator(inMap) instanceof Iterator);</span>
<span class="fc" id="L858">        assertTrue(&quot;returns NodeListIterator when nodeList passed&quot;, IteratorUtils.getIterator(nodeList) instanceof NodeListIterator);</span>
<span class="fc" id="L859">        assertTrue(&quot;returns EnumerationIterator when Enumeration passed&quot;, IteratorUtils.getIterator(new Vector().elements()) instanceof EnumerationIterator);</span>

<span class="fc" id="L861">    }</span>

    @Test
    public void testIndexOf() {
<span class="fc" id="L865">        Predicate&lt;Number&gt; testPredicate = equalPredicate((Number) 4);</span>
<span class="fc" id="L866">        int index = IteratorUtils.indexOf(iterableA.iterator(), testPredicate);</span>
<span class="fc" id="L867">        assertEquals(6, index);</span>
<span class="fc" id="L868">        testPredicate = equalPredicate((Number) 45);</span>
<span class="fc" id="L869">        index = IteratorUtils.indexOf(iterableA.iterator(), testPredicate);</span>
<span class="fc" id="L870">        assertEquals(-1, index);</span>
<span class="fc" id="L871">        assertEquals(-1, IteratorUtils.indexOf(null, testPredicate));</span>
        try {
<span class="nc" id="L873">            IteratorUtils.indexOf(iterableA.iterator(), null);</span>
<span class="nc" id="L874">            fail(&quot;expecting NullPointerException&quot;);</span>
<span class="fc" id="L875">        } catch (final NullPointerException npe) {</span>
            // expected
<span class="nc" id="L877">        }</span>
<span class="fc" id="L878">    }</span>

    /**
     * Tests method nodeListIterator(Node)
     */
    @Test
    public void testNodeIterator() {
<span class="fc" id="L885">        final Node[] nodes = createNodes();</span>
<span class="fc" id="L886">        final NodeList nodeList = createNodeList(nodes);</span>
<span class="fc" id="L887">        final Node parentNode = createMock(Node.class);</span>
<span class="fc" id="L888">        expect(parentNode.getChildNodes()).andStubReturn(nodeList);</span>
<span class="fc" id="L889">        replay(parentNode);</span>

<span class="fc" id="L891">        final Iterator&lt;Node&gt; iterator = IteratorUtils.nodeListIterator(parentNode);</span>
<span class="fc" id="L892">        int expectedNodeIndex = 0;</span>
<span class="fc bfc" id="L893" title="All 2 branches covered.">        for (final Node actual : IteratorUtils.asIterable(iterator)) {</span>
<span class="fc" id="L894">            assertEquals(nodes[expectedNodeIndex], actual);</span>
<span class="fc" id="L895">            ++expectedNodeIndex;</span>
<span class="fc" id="L896">        }</span>

        // insure iteration occurred
<span class="pc bpc" id="L899" title="1 of 2 branches missed.">        assertTrue(expectedNodeIndex &gt; 0);</span>

        // single use iterator
<span class="fc" id="L902">        assertFalse(&quot;should not be able to iterate twice&quot;, IteratorUtils.asIterable(iterator).iterator().hasNext());</span>
<span class="fc" id="L903">    }</span>

    /**
     * Tests method nodeListIterator(NodeList)
     */
    @Test
    public void testNodeListIterator() {
<span class="fc" id="L910">        final Node[] nodes = createNodes();</span>
<span class="fc" id="L911">        final NodeList nodeList = createNodeList(nodes);</span>

<span class="fc" id="L913">        final Iterator&lt;Node&gt; iterator = IteratorUtils.nodeListIterator(nodeList);</span>
<span class="fc" id="L914">        int expectedNodeIndex = 0;</span>
<span class="fc bfc" id="L915" title="All 2 branches covered.">        for (final Node actual : IteratorUtils.asIterable(iterator)) {</span>
<span class="fc" id="L916">            assertEquals(nodes[expectedNodeIndex], actual);</span>
<span class="fc" id="L917">            ++expectedNodeIndex;</span>
<span class="fc" id="L918">        }</span>

        // insure iteration occurred
<span class="pc bpc" id="L921" title="1 of 2 branches missed.">        assertTrue(expectedNodeIndex &gt; 0);</span>

        // single use iterator
<span class="fc" id="L924">        assertFalse(&quot;should not be able to iterate twice&quot;, IteratorUtils.asIterable(iterator).iterator().hasNext());</span>
<span class="fc" id="L925">    }</span>

    @Test
    public void testToArray() {
<span class="fc" id="L929">        final List&lt;Object&gt; list = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L930">        list.add(Integer.valueOf(1));</span>
<span class="fc" id="L931">        list.add(&quot;Two&quot;);</span>
<span class="fc" id="L932">        list.add(null);</span>
<span class="fc" id="L933">        final Object[] result = IteratorUtils.toArray(list.iterator());</span>
<span class="fc" id="L934">        assertEquals(list, Arrays.asList(result));</span>

        try {
<span class="nc" id="L937">        	IteratorUtils.toArray(null);</span>
<span class="nc" id="L938">            fail(&quot;Expecting NullPointerException&quot;);</span>
<span class="fc" id="L939">        } catch (final NullPointerException ex) {</span>
            // success
<span class="nc" id="L941">        }</span>
<span class="fc" id="L942">    }</span>

    @Test
    public void testToArray2() {
<span class="fc" id="L946">        final List&lt;String&gt; list = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L947">        list.add(&quot;One&quot;);</span>
<span class="fc" id="L948">        list.add(&quot;Two&quot;);</span>
<span class="fc" id="L949">        list.add(null);</span>
<span class="fc" id="L950">        final String[] result = IteratorUtils.toArray(list.iterator(), String.class);</span>
<span class="fc" id="L951">        assertEquals(list, Arrays.asList(result));</span>

        try {
<span class="nc" id="L954">        	IteratorUtils.toArray(list.iterator(), null);</span>
<span class="nc" id="L955">            fail(&quot;Expecting NullPointerException&quot;);</span>
<span class="fc" id="L956">        } catch (final NullPointerException ex) {</span>
            // success
<span class="nc" id="L958">        }</span>

        try {
<span class="nc" id="L961">        	IteratorUtils.toArray(null, String.class);</span>
<span class="nc" id="L962">            fail(&quot;Expecting NullPointerException&quot;);</span>
<span class="fc" id="L963">        } catch (final NullPointerException ex) {</span>
            // success
<span class="nc" id="L965">        }</span>
<span class="fc" id="L966">    }</span>

    @Test
    public void testToList() {
<span class="fc" id="L970">        final List&lt;Object&gt; list = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L971">        list.add(Integer.valueOf(1));</span>
<span class="fc" id="L972">        list.add(&quot;Two&quot;);</span>
<span class="fc" id="L973">        list.add(null);</span>
<span class="fc" id="L974">        final List&lt;Object&gt; result = IteratorUtils.toList(list.iterator());</span>
<span class="fc" id="L975">        assertEquals(list, result);</span>
<span class="fc" id="L976">    }</span>

    @Test
    public void testToListIterator() {
<span class="fc" id="L980">        final List&lt;Integer&gt; list = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L981">        list.add(Integer.valueOf(0));</span>
<span class="fc" id="L982">        list.add(Integer.valueOf(1));</span>
<span class="fc" id="L983">        list.add(Integer.valueOf(2));</span>
<span class="fc" id="L984">        final Iterator&lt;Integer&gt; iterator = list.iterator();</span>

<span class="fc" id="L986">        final ListIterator&lt;Integer&gt; liItr = IteratorUtils.toListIterator(iterator);</span>
<span class="fc" id="L987">        int expected = 0;</span>
<span class="fc bfc" id="L988" title="All 2 branches covered.">        while(liItr.hasNext()){</span>
<span class="fc" id="L989">        	assertEquals(expected, liItr.next().intValue());</span>
<span class="fc" id="L990">        	++expected;</span>
        }
<span class="fc" id="L992">    }</span>

    @Test
    public void testToListIteratorNull() {
        try {
<span class="nc" id="L997">            IteratorUtils.toListIterator(null);</span>
<span class="nc" id="L998">            fail(&quot;Expecting NullPointerException&quot;);</span>
<span class="fc" id="L999">        } catch (final NullPointerException ex) {</span>
            // success
<span class="nc" id="L1001">        }</span>
<span class="fc" id="L1002">    }</span>

    /**
     * Test remove() for an immutable Iterator.
     */
    @Test
    public void testUnmodifiableIteratorImmutability() {
<span class="fc" id="L1009">        final Iterator&lt;String&gt; iterator = getImmutableIterator();</span>

        try {
<span class="nc" id="L1012">            iterator.remove();</span>
            // We shouldn't get to here.
<span class="nc" id="L1014">            fail(&quot;remove() should throw an UnsupportedOperationException&quot;);</span>
<span class="fc" id="L1015">        } catch (final UnsupportedOperationException e) {</span>
            // This is correct; ignore the exception.
<span class="nc" id="L1017">        }</span>

<span class="fc" id="L1019">        iterator.next();</span>

        try {
<span class="nc" id="L1022">            iterator.remove();</span>
            // We shouldn't get to here.
<span class="nc" id="L1024">            fail(&quot;remove() should throw an UnsupportedOperationException&quot;);</span>
<span class="fc" id="L1025">        } catch (final UnsupportedOperationException e) {</span>
            // This is correct; ignore the exception.
<span class="nc" id="L1027">        }</span>

<span class="fc" id="L1029">    }</span>

    //-----------------------------------------------------------------------
    /**
     * Test next() and hasNext() for an immutable Iterator.
     */
    @Test
    public void testUnmodifiableIteratorIteration() {
<span class="fc" id="L1037">        final Iterator&lt;String&gt; iterator = getImmutableIterator();</span>

<span class="fc" id="L1039">        assertTrue(iterator.hasNext());</span>

<span class="fc" id="L1041">        assertEquals(&quot;a&quot;, iterator.next());</span>

<span class="fc" id="L1043">        assertTrue(iterator.hasNext());</span>

<span class="fc" id="L1045">        assertEquals(&quot;b&quot;, iterator.next());</span>

<span class="fc" id="L1047">        assertTrue(iterator.hasNext());</span>

<span class="fc" id="L1049">        assertEquals(&quot;c&quot;, iterator.next());</span>

<span class="fc" id="L1051">        assertTrue(iterator.hasNext());</span>

<span class="fc" id="L1053">        assertEquals(&quot;d&quot;, iterator.next());</span>

<span class="pc bpc" id="L1055" title="1 of 2 branches missed.">        assertTrue(!iterator.hasNext());</span>
<span class="fc" id="L1056">    }</span>

    /**
     * Test remove() for an immutable ListIterator.
     */
    @Test
    public void testUnmodifiableListIteratorImmutability() {
<span class="fc" id="L1063">        final ListIterator&lt;String&gt; listIterator = getImmutableListIterator();</span>

        try {
<span class="nc" id="L1066">            listIterator.remove();</span>
            // We shouldn't get to here.
<span class="nc" id="L1068">            fail(&quot;remove() should throw an UnsupportedOperationException&quot;);</span>
<span class="fc" id="L1069">        } catch (final UnsupportedOperationException e) {</span>
            // This is correct; ignore the exception.
<span class="nc" id="L1071">        }</span>

        try {
<span class="nc" id="L1074">            listIterator.set(&quot;a&quot;);</span>
            // We shouldn't get to here.
<span class="nc" id="L1076">            fail(&quot;set(Object) should throw an UnsupportedOperationException&quot;);</span>
<span class="fc" id="L1077">        } catch (final UnsupportedOperationException e) {</span>
            // This is correct; ignore the exception.
<span class="nc" id="L1079">        }</span>

        try {
<span class="nc" id="L1082">            listIterator.add(&quot;a&quot;);</span>
            // We shouldn't get to here.
<span class="nc" id="L1084">            fail(&quot;add(Object) should throw an UnsupportedOperationException&quot;);</span>
<span class="fc" id="L1085">        } catch (final UnsupportedOperationException e) {</span>
            // This is correct; ignore the exception.
<span class="nc" id="L1087">        }</span>

<span class="fc" id="L1089">        listIterator.next();</span>

        try {
<span class="nc" id="L1092">            listIterator.remove();</span>
            // We shouldn't get to here.
<span class="nc" id="L1094">            fail(&quot;remove() should throw an UnsupportedOperationException&quot;);</span>
<span class="fc" id="L1095">        } catch (final UnsupportedOperationException e) {</span>
            // This is correct; ignore the exception.
<span class="nc" id="L1097">        }</span>

        try {
<span class="nc" id="L1100">            listIterator.set(&quot;a&quot;);</span>
            // We shouldn't get to here.
<span class="nc" id="L1102">            fail(&quot;set(Object) should throw an UnsupportedOperationException&quot;);</span>
<span class="fc" id="L1103">        } catch (final UnsupportedOperationException e) {</span>
            // This is correct; ignore the exception.
<span class="nc" id="L1105">        }</span>

        try {
<span class="nc" id="L1108">            listIterator.add(&quot;a&quot;);</span>
            // We shouldn't get to here.
<span class="nc" id="L1110">            fail(&quot;add(Object) should throw an UnsupportedOperationException&quot;);</span>
<span class="fc" id="L1111">        } catch (final UnsupportedOperationException e) {</span>
            // This is correct; ignore the exception.
<span class="nc" id="L1113">        }</span>
<span class="fc" id="L1114">    }</span>

    /**
     * Test next(), hasNext(), previous() and hasPrevious() for an immutable
     * ListIterator.
     */
    @Test
    public void testUnmodifiableListIteratorIteration() {
<span class="fc" id="L1122">        final ListIterator&lt;String&gt; listIterator = getImmutableListIterator();</span>

<span class="pc bpc" id="L1124" title="1 of 2 branches missed.">        assertTrue(!listIterator.hasPrevious());</span>
<span class="fc" id="L1125">        assertTrue(listIterator.hasNext());</span>

<span class="fc" id="L1127">        assertEquals(&quot;a&quot;, listIterator.next());</span>

<span class="fc" id="L1129">        assertTrue(listIterator.hasPrevious());</span>
<span class="fc" id="L1130">        assertTrue(listIterator.hasNext());</span>

<span class="fc" id="L1132">        assertEquals(&quot;b&quot;, listIterator.next());</span>

<span class="fc" id="L1134">        assertTrue(listIterator.hasPrevious());</span>
<span class="fc" id="L1135">        assertTrue(listIterator.hasNext());</span>

<span class="fc" id="L1137">        assertEquals(&quot;c&quot;, listIterator.next());</span>

<span class="fc" id="L1139">        assertTrue(listIterator.hasPrevious());</span>
<span class="fc" id="L1140">        assertTrue(listIterator.hasNext());</span>

<span class="fc" id="L1142">        assertEquals(&quot;d&quot;, listIterator.next());</span>

<span class="fc" id="L1144">        assertTrue(listIterator.hasPrevious());</span>
<span class="pc bpc" id="L1145" title="1 of 2 branches missed.">        assertTrue(!listIterator.hasNext());</span>

<span class="fc" id="L1147">        assertEquals(&quot;d&quot;, listIterator.previous());</span>

<span class="fc" id="L1149">        assertTrue(listIterator.hasPrevious());</span>
<span class="fc" id="L1150">        assertTrue(listIterator.hasNext());</span>

<span class="fc" id="L1152">        assertEquals(&quot;c&quot;, listIterator.previous());</span>

<span class="fc" id="L1154">        assertTrue(listIterator.hasPrevious());</span>
<span class="fc" id="L1155">        assertTrue(listIterator.hasNext());</span>

<span class="fc" id="L1157">        assertEquals(&quot;b&quot;, listIterator.previous());</span>

<span class="fc" id="L1159">        assertTrue(listIterator.hasPrevious());</span>
<span class="fc" id="L1160">        assertTrue(listIterator.hasNext());</span>

<span class="fc" id="L1162">        assertEquals(&quot;a&quot;, listIterator.previous());</span>

<span class="pc bpc" id="L1164" title="1 of 2 branches missed.">        assertTrue(!listIterator.hasPrevious());</span>
<span class="fc" id="L1165">        assertTrue(listIterator.hasNext());</span>
<span class="fc" id="L1166">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>