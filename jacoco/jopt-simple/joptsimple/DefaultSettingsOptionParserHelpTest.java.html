<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DefaultSettingsOptionParserHelpTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jopt_simple$All_in_jopt_simple.exec</a> &gt; <a href="index.source.html" class="el_package">joptsimple</a> &gt; <span class="el_source">DefaultSettingsOptionParserHelpTest.java</span></div><h1>DefaultSettingsOptionParserHelpTest.java</h1><pre class="source lang-java linenums">/*
 The MIT License

 Copyright (c) 2004-2016 Paul R. Holser, Jr.

 Permission is hereby granted, free of charge, to any person obtaining
 a copy of this software and associated documentation files (the
 &quot;Software&quot;), to deal in the Software without restriction, including
 without limitation the rights to use, copy, modify, merge, publish,
 distribute, sublicense, and/or sell copies of the Software, and to
 permit persons to whom the Software is furnished to do so, subject to
 the following conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

package joptsimple;

import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.StringWriter;
import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.stream.Stream;

import static java.math.BigDecimal.*;
import static java.util.Arrays.*;
import static java.util.Collections.*;
import static java.util.stream.Collectors.*;

import joptsimple.util.InetAddressConverter;
import org.junit.Before;
import org.junit.Test;

import static joptsimple.internal.Strings.*;
import static joptsimple.util.DateConverter.*;
import static org.junit.Assert.*;

/**
 * @author &lt;a href=&quot;mailto:pholser@alumni.rice.edu&quot;&gt;Paul Holser&lt;/a&gt;
 */
<span class="fc" id="L53">public class DefaultSettingsOptionParserHelpTest extends AbstractOptionParserFixture {</span>
    private StringWriter sink;

    @Before
    public final void createSink() {
<span class="fc" id="L58">        sink = new StringWriter();</span>
<span class="fc" id="L59">    }</span>

    @Test
    public void unconfiguredParser() throws Exception {
<span class="fc" id="L63">        parser.printHelpOn( sink );</span>

<span class="fc" id="L65">        assertHelpLines( &quot;No options specified  &quot;, EMPTY );</span>
<span class="fc" id="L66">    }</span>

    @Test
    public void repeatedCalls() throws Exception {
<span class="fc" id="L70">        parser.accepts( &quot;apple&quot; );</span>

<span class="fc" id="L72">        parser.printHelpOn( sink );</span>
<span class="fc" id="L73">        parser.printHelpOn( sink );</span>

<span class="fc" id="L75">        assertHelpLines(</span>
            &quot;Option   Description&quot;,
            &quot;------   -----------&quot;,
            &quot;--apple             &quot;,
            &quot;Option   Description&quot;,
            &quot;------   -----------&quot;,
            &quot;--apple             &quot;,
            EMPTY );
<span class="fc" id="L83">    }</span>

    @Test
    public void oneOptionNoArgNoDescription() throws Exception {
<span class="fc" id="L87">        parser.accepts( &quot;apple&quot; );</span>

<span class="fc" id="L89">        parser.printHelpOn( sink );</span>

<span class="fc" id="L91">        assertHelpLines(</span>
                &quot;Option   Description&quot;,
                &quot;------   -----------&quot;,
                &quot;--apple             &quot;,
                EMPTY );
<span class="fc" id="L96">    }</span>

    @Test
    public void oneOptionNoArgWithDescription() throws Exception {
<span class="fc" id="L100">        parser.accepts( &quot;a&quot;, &quot;some description&quot; );</span>

<span class="fc" id="L102">        parser.printHelpOn( sink );</span>

<span class="fc" id="L104">        assertHelpLines(</span>
            &quot;Option  Description     &quot;,
            &quot;------  -----------     &quot;,
            &quot;-a      some description&quot;,
            EMPTY );
<span class="fc" id="L109">    }</span>

    @Test
    public void twoOptionsNoArgWithDescription() throws Exception {
<span class="fc" id="L113">        parser.accepts( &quot;a&quot;, &quot;some description&quot; );</span>
<span class="fc" id="L114">        parser.accepts( &quot;verbose&quot;, &quot;even more description&quot; );</span>

<span class="fc" id="L116">        parser.printHelpOn( sink );</span>

<span class="fc" id="L118">        assertHelpLines(</span>
            &quot;Option     Description          &quot;,
            &quot;------     -----------          &quot;,
            &quot;-a         some description     &quot;,
            &quot;--verbose  even more description&quot;,
            EMPTY );
<span class="fc" id="L124">    }</span>

    @Test
    public void oneOptionRequiredArgNoDescription() throws Exception {
<span class="fc" id="L128">        parser.accepts( &quot;a&quot; ).withRequiredArg();</span>

<span class="fc" id="L130">        parser.printHelpOn( sink );</span>

<span class="fc" id="L132">        assertHelpLines(</span>
            &quot;Option       Description&quot;,
            &quot;------       -----------&quot;,
            &quot;-a &lt;String&gt;             &quot;,
            EMPTY );
<span class="fc" id="L137">    }</span>

    @Test
    public void oneOptionRequiredArgNoDescriptionWithType() throws Exception {
<span class="fc" id="L141">        parser.accepts( &quot;a&quot; ).withRequiredArg().ofType( Integer.class );</span>

<span class="fc" id="L143">        parser.printHelpOn( sink );</span>

<span class="fc" id="L145">        assertHelpLines(</span>
            &quot;Option        Description&quot;,
            &quot;------        -----------&quot;,
            &quot;-a &lt;Integer&gt;             &quot;,
            EMPTY );
<span class="fc" id="L150">    }</span>

    @Test
    public void oneOptionRequiredArgWithDescription() throws Exception {
<span class="fc" id="L154">        parser.accepts( &quot;a&quot;, &quot;some value you need&quot; ).withRequiredArg().describedAs( &quot;numerical&quot; );</span>

<span class="fc" id="L156">        parser.printHelpOn( sink );</span>

<span class="fc" id="L158">        assertHelpLines(</span>
            &quot;Option                  Description        &quot;,
            &quot;------                  -----------        &quot;,
            &quot;-a &lt;String: numerical&gt;  some value you need&quot;,
            EMPTY );
<span class="fc" id="L163">    }</span>

    @Test
    public void oneOptionRequiredArgWithDescriptionAndType() throws Exception {
<span class="fc" id="L167">        parser.accepts( &quot;a&quot;, &quot;some value you need&quot; )</span>
<span class="fc" id="L168">                .withRequiredArg().describedAs( &quot;numerical&quot; ).ofType( Integer.class );</span>

<span class="fc" id="L170">        parser.printHelpOn( sink );</span>

<span class="fc" id="L172">        assertHelpLines(</span>
            &quot;Option                   Description        &quot;,
            &quot;------                   -----------        &quot;,
            &quot;-a &lt;Integer: numerical&gt;  some value you need&quot;,
            EMPTY );
<span class="fc" id="L177">    }</span>

    @Test
    public void oneOptionOptionalArgNoDescription() throws Exception {
<span class="fc" id="L181">        parser.accepts( &quot;threshold&quot; ).withOptionalArg();</span>

<span class="fc" id="L183">        parser.printHelpOn( sink );</span>

<span class="fc" id="L185">        assertHelpLines(</span>
            &quot;Option                Description&quot;,
            &quot;------                -----------&quot;,
            &quot;--threshold [String]             &quot;,
            EMPTY );
<span class="fc" id="L190">    }</span>

    @Test
    public void oneOptionOptionalArgNoDescriptionWithType() throws Exception {
<span class="fc" id="L194">        parser.accepts( &quot;a&quot; ).withOptionalArg().ofType( Float.class );</span>

<span class="fc" id="L196">        parser.printHelpOn( sink );</span>

<span class="fc" id="L198">        assertHelpLines(</span>
            &quot;Option      Description&quot;,
            &quot;------      -----------&quot;,
            &quot;-a [Float]             &quot;,
            EMPTY );
<span class="fc" id="L203">    }</span>

    @Test
    public void oneOptionOptionalArgWithDescription() throws Exception {
<span class="fc" id="L207">        parser.accepts( &quot;threshold&quot;, &quot;some value you need&quot; ).withOptionalArg().describedAs( &quot;positive integer&quot; );</span>

<span class="fc" id="L209">        parser.printHelpOn( sink );</span>

<span class="fc" id="L211">        assertHelpLines(</span>
            &quot;Option                                  Description        &quot;,
            &quot;------                                  -----------        &quot;,
            &quot;--threshold [String: positive integer]  some value you need&quot;,
            EMPTY );
<span class="fc" id="L216">    }</span>

    @Test
    public void oneOptionOptionalArgWithDescriptionAndType() throws Exception {
<span class="fc" id="L220">        parser.accepts( &quot;threshold&quot;, &quot;some value you need&quot; )</span>
<span class="fc" id="L221">            .withOptionalArg().describedAs( &quot;positive decimal&quot; ).ofType( Double.class );</span>

<span class="fc" id="L223">        parser.printHelpOn( sink );</span>

<span class="fc" id="L225">        assertHelpLines(</span>
            &quot;Option                                  Description        &quot;,
            &quot;------                                  -----------        &quot;,
            &quot;--threshold [Double: positive decimal]  some value you need&quot;,
            EMPTY );
<span class="fc" id="L230">    }</span>

    @Test
    public void alternativeLongOptions() throws Exception {
<span class="fc" id="L234">        parser.recognizeAlternativeLongOptions( true );</span>

<span class="fc" id="L236">        parser.printHelpOn( sink );</span>

<span class="fc" id="L238">        assertHelpLines(</span>
            &quot;Option                  Description                     &quot;,
            &quot;------                  -----------                     &quot;,
            &quot;-W &lt;String: opt=value&gt;  Alternative form of long options&quot;,
            EMPTY );
<span class="fc" id="L243">    }</span>

    @Test
    public void optionSynonymsWithoutArguments() throws Exception {
<span class="fc" id="L247">        parser.acceptsAll( asList( &quot;v&quot;, &quot;chatty&quot; ), &quot;be verbose&quot; );</span>

<span class="fc" id="L249">        parser.printHelpOn( sink );</span>

<span class="fc" id="L251">        assertHelpLines(</span>
            &quot;Option        Description&quot;,
            &quot;------        -----------&quot;,
            &quot;-v, --chatty  be verbose &quot;,
            EMPTY );
<span class="fc" id="L256">    }</span>

    @Test
    public void optionSynonymsWithRequiredArgument() throws Exception {
<span class="fc" id="L260">        parser.acceptsAll( asList( &quot;L&quot;, &quot;index&quot; ), &quot;set level&quot; ).withRequiredArg().ofType( Integer.class );</span>

<span class="fc" id="L262">        parser.printHelpOn( sink );</span>

<span class="fc" id="L264">        assertHelpLines(</span>
            &quot;Option                 Description&quot;,
            &quot;------                 -----------&quot;,
            &quot;-L, --index &lt;Integer&gt;  set level  &quot;,
            EMPTY );
<span class="fc" id="L269">    }</span>

    @Test
    public void optionSynonymsWithOptionalArgument() throws Exception {
<span class="fc" id="L273">        parser.acceptsAll( asList( &quot;d&quot;, &quot;since&quot; ), &quot;date filter&quot; )</span>
<span class="fc" id="L274">            .withOptionalArg().describedAs( &quot;yyyyMMdd&quot; ).ofType( Date.class );</span>

<span class="fc" id="L276">        parser.printHelpOn( sink );</span>

<span class="fc" id="L278">        assertHelpLines(</span>
            &quot;Option                        Description&quot;,
            &quot;------                        -----------&quot;,
            &quot;-d, --since [Date: yyyyMMdd]  date filter&quot;,
            EMPTY );
<span class="fc" id="L283">    }</span>

    @Test
    public void optionSynonymsSortedByShortOptionThenLexicographical() throws Exception {
<span class="fc" id="L287">        parser.acceptsAll( asList( &quot;v&quot;, &quot;prolix&quot;, &quot;chatty&quot; ) );</span>

<span class="fc" id="L289">        parser.printHelpOn( sink );</span>

<span class="fc" id="L291">        assertHelpLines(</span>
            &quot;Option                  Description&quot;,
            &quot;------                  -----------&quot;,
            &quot;-v, --chatty, --prolix             &quot;,
            EMPTY );
<span class="fc" id="L296">    }</span>

    @Test
    public void writingToOutputStream() throws Exception {
<span class="fc" id="L300">        ByteArrayOutputStream bytesOut = new ByteArrayOutputStream();</span>

<span class="fc" id="L302">        parser.printHelpOn( bytesOut );</span>

<span class="fc" id="L304">        assertEquals( &quot;No options specified  &quot; + LINE_SEPARATOR, bytesOut.toString() );</span>
<span class="fc" id="L305">    }</span>

    // Bug 1956418
    @Test
    public void outputStreamFlushedButNotClosedWhenPrintingHelp() throws Exception {
<span class="fc" id="L310">        FakeOutputStream fake = new FakeOutputStream();</span>

<span class="fc" id="L312">        parser.printHelpOn( fake );</span>

<span class="fc" id="L314">        assertTrue( fake.flushed );</span>
<span class="fc" id="L315">        assertFalse( fake.closed );</span>
<span class="fc" id="L316">    }</span>

    @Test
    public void bothColumnsExceedingAllocatedWidths() throws Exception {
<span class="fc" id="L320">        parser.acceptsAll( asList( &quot;t&quot;, &quot;threshold&quot;, &quot;cutoff&quot; ),</span>
            &quot;a threshold value beyond which a certain level of the application should cease to write logs&quot; )
<span class="fc" id="L322">            .withRequiredArg()</span>
<span class="fc" id="L323">            .describedAs( &quot;a positive decimal number that will represent the threshold that has been outlined&quot; )</span>
<span class="fc" id="L324">            .ofType( Double.class );</span>

<span class="fc" id="L326">        parser.printHelpOn( sink );</span>

<span class="fc" id="L328">        assertHelpLines(</span>
            &quot;Option                                Description                       &quot;,
            &quot;------                                -----------                       &quot;,
            &quot;-t, --cutoff, --threshold &lt;Double: a  a threshold value beyond which a  &quot;,
            &quot;  positive decimal number that will     certain level of the application&quot;,
            &quot;  represent the threshold that has      should cease to write logs      &quot;,
            &quot;  been outlined&gt;                                                        &quot;,
            EMPTY );
<span class="fc" id="L336">    }</span>

    // Bug 2018262
    @Test
    public void gradleHelp() throws Exception {
<span class="fc" id="L341">        parser.acceptsAll( asList( &quot;n&quot;, &quot;non-recursive&quot; ),</span>
            &quot;Do not execute primary tasks of child projects.&quot; );
<span class="fc" id="L343">        parser.acceptsAll( singletonList( &quot;S&quot; ),</span>
            &quot;Don't trigger a System.exit(0) for normal termination. Used for Gradle's internal testing.&quot; );
<span class="fc" id="L345">        parser.acceptsAll( asList( &quot;I&quot;, &quot;no-imports&quot; ),</span>
            &quot;Disable usage of default imports for build script files.&quot; );
<span class="fc" id="L347">        parser.acceptsAll( asList( &quot;u&quot;, &quot;no-search-upward&quot; ),</span>
            &quot;Don't search in parent folders for a settings.gradle file.&quot; );
<span class="fc" id="L349">        parser.acceptsAll( asList( &quot;x&quot;, &quot;cache-off&quot; ),</span>
            &quot;No caching of compiled build scripts.&quot; );
<span class="fc" id="L351">        parser.acceptsAll( asList( &quot;r&quot;, &quot;rebuild-cache&quot; ),</span>
            &quot;Rebuild the cache of compiled build scripts.&quot; );
<span class="fc" id="L353">        parser.acceptsAll( asList( &quot;v&quot;, &quot;version&quot; ), &quot;Print version info.&quot; );</span>
<span class="fc" id="L354">        parser.acceptsAll( asList( &quot;d&quot;, &quot;debug&quot; ),</span>
            &quot;Log in debug mode (includes normal stacktrace).&quot; );
<span class="fc" id="L356">        parser.acceptsAll( asList( &quot;q&quot;, &quot;quiet&quot; ), &quot;Log errors only.&quot; );</span>
<span class="fc" id="L357">        parser.acceptsAll( asList( &quot;j&quot;, &quot;ivy-debug&quot; ),</span>
            &quot;Set Ivy log level to debug (very verbose).&quot; );
<span class="fc" id="L359">        parser.acceptsAll( asList( &quot;i&quot;, &quot;ivy-quiet&quot; ), &quot;Set Ivy log level to quiet.&quot; );</span>
<span class="fc" id="L360">        parser.acceptsAll( asList( &quot;s&quot;, &quot;stacktrace&quot; ),</span>
            &quot;Print out the stacktrace also for user exceptions (e.g. compile error).&quot; );
<span class="fc" id="L362">        parser.acceptsAll( asList( &quot;f&quot;, &quot;full-stacktrace&quot; ),</span>
            &quot;Print out the full (very verbose) stacktrace for any exceptions.&quot; );
<span class="fc" id="L364">        parser.acceptsAll( asList( &quot;t&quot;, &quot;tasks&quot; ),</span>
            &quot;Show list of all available tasks and their dependencies.&quot; );
<span class="fc" id="L366">        parser.acceptsAll( asList( &quot;p&quot;, &quot;project-dir&quot; ),</span>
            &quot;Specifies the start dir for Gradle. Defaults to current dir.&quot; )
<span class="fc" id="L368">            .withRequiredArg().ofType( String.class );</span>
<span class="fc" id="L369">        parser.acceptsAll( asList( &quot;g&quot;, &quot;gradle-user-home&quot; ),</span>
            &quot;Specifies the gradle user home dir.&quot; )
<span class="fc" id="L371">            .withRequiredArg().ofType( String.class );</span>
<span class="fc" id="L372">        parser.acceptsAll( asList( &quot;l&quot;, &quot;plugin-properties-file&quot; ),</span>
            &quot;Specifies the plugin.properties file.&quot; )
<span class="fc" id="L374">            .withRequiredArg().ofType( String.class );</span>
<span class="fc" id="L375">        parser.acceptsAll( asList( &quot;b&quot;, &quot;buildfile&quot; ),</span>
            &quot;Specifies the build file name (also for subprojects). Defaults to build.gradle.&quot; )
<span class="fc" id="L377">            .withRequiredArg().ofType( String.class );</span>
<span class="fc" id="L378">        parser.acceptsAll( asList( &quot;D&quot;, &quot;systemprop&quot; ),</span>
            &quot;Set system property of the JVM (e.g. -Dmyprop=myvalue).&quot; )
<span class="fc" id="L380">            .withRequiredArg().ofType( String.class );</span>
<span class="fc" id="L381">        parser.acceptsAll( asList( &quot;P&quot;, &quot;projectprop&quot; ),</span>
            &quot;Set project property for the build script (e.g. -Pmyprop=myvalue).&quot; )
<span class="fc" id="L383">            .withRequiredArg().ofType( String.class );</span>
<span class="fc" id="L384">        parser.acceptsAll( asList( &quot;e&quot;, &quot;embedded&quot; ),</span>
            &quot;Specify an embedded build script.&quot; )
<span class="fc" id="L386">            .withRequiredArg().ofType( String.class );</span>
<span class="fc" id="L387">        parser.acceptsAll( asList( &quot;B&quot;, &quot;bootstrap-debug&quot; ),</span>
            &quot;Specify a text to be logged at the beginning (e.g. used by Gradle's bootstrap class).&quot; )
<span class="fc" id="L389">            .withRequiredArg().ofType( String.class );</span>
<span class="fc" id="L390">        parser.acceptsAll( asList( &quot;h&quot;, &quot;?&quot; ), &quot;Shows this help message&quot; ).forHelp();</span>

<span class="fc" id="L392">        parser.printHelpOn( sink );</span>

<span class="fc" id="L394">        assertHelpLines(</span>
            &quot;Option                                 Description                              &quot;,
            &quot;------                                 -----------                              &quot;,
            &quot;-?, -h                                 Shows this help message                  &quot;,
            &quot;-B, --bootstrap-debug &lt;String&gt;         Specify a text to be logged at the       &quot;,
            &quot;                                         beginning (e.g. used by Gradle's       &quot;,
            &quot;                                         bootstrap class).                      &quot;,
            &quot;-D, --systemprop &lt;String&gt;              Set system property of the JVM (e.g. -   &quot;,
            &quot;                                         Dmyprop=myvalue).                      &quot;,
            &quot;-I, --no-imports                       Disable usage of default imports for     &quot;,
            &quot;                                         build script files.                    &quot;,
            &quot;-P, --projectprop &lt;String&gt;             Set project property for the build       &quot;,
            &quot;                                         script (e.g. -Pmyprop=myvalue).        &quot;,
            &quot;-S                                     Don't trigger a System.exit(0) for       &quot;,
            &quot;                                         normal termination. Used for Gradle's  &quot;,
            &quot;                                         internal testing.                      &quot;,
            &quot;-b, --buildfile &lt;String&gt;               Specifies the build file name (also for  &quot;,
            &quot;                                         subprojects). Defaults to build.gradle.&quot;,
            &quot;-d, --debug                            Log in debug mode (includes normal       &quot;,
            &quot;                                         stacktrace).                           &quot;,
            &quot;-e, --embedded &lt;String&gt;                Specify an embedded build script.        &quot;,
            &quot;-f, --full-stacktrace                  Print out the full (very verbose)        &quot;,
            &quot;                                         stacktrace for any exceptions.         &quot;,
            &quot;-g, --gradle-user-home &lt;String&gt;        Specifies the gradle user home dir.      &quot;,
            &quot;-i, --ivy-quiet                        Set Ivy log level to quiet.              &quot;,
            &quot;-j, --ivy-debug                        Set Ivy log level to debug (very         &quot;,
            &quot;                                         verbose).                              &quot;,
            &quot;-l, --plugin-properties-file &lt;String&gt;  Specifies the plugin.properties file.    &quot;,
            &quot;-n, --non-recursive                    Do not execute primary tasks of child    &quot;,
            &quot;                                         projects.                              &quot;,
            &quot;-p, --project-dir &lt;String&gt;             Specifies the start dir for Gradle.      &quot;,
            &quot;                                         Defaults to current dir.               &quot;,
            &quot;-q, --quiet                            Log errors only.                         &quot;,
            &quot;-r, --rebuild-cache                    Rebuild the cache of compiled build      &quot;,
            &quot;                                         scripts.                               &quot;,
            &quot;-s, --stacktrace                       Print out the stacktrace also for user   &quot;,
            &quot;                                         exceptions (e.g. compile error).       &quot;,
            &quot;-t, --tasks                            Show list of all available tasks and     &quot;,
            &quot;                                         their dependencies.                    &quot;,
            &quot;-u, --no-search-upward                 Don't search in parent folders for a     &quot;,
            &quot;                                         settings.gradle file.                  &quot;,
            &quot;-v, --version                          Print version info.                      &quot;,
            &quot;-x, --cache-off                        No caching of compiled build scripts.    &quot;,
            EMPTY );
<span class="fc" id="L438">    }</span>

    @Test
    public void dateConverterShowsDatePattern() throws Exception {
<span class="fc" id="L442">        parser.accepts( &quot;date&quot;, &quot;a date&quot; )</span>
<span class="fc" id="L443">            .withRequiredArg()</span>
<span class="fc" id="L444">            .withValuesConvertedBy( datePattern( &quot;MM/dd/yy&quot; ) );</span>

<span class="fc" id="L446">        parser.printHelpOn( sink );</span>

<span class="fc" id="L448">        assertHelpLines(</span>
            &quot;Option             Description&quot;,
            &quot;------             -----------&quot;,
            &quot;--date &lt;MM/dd/yy&gt;  a date     &quot;,
            EMPTY );
<span class="fc" id="L453">    }</span>

    @Test
    public void dateConverterShowsDatePatternInCombinationWithDescription() throws Exception {
<span class="fc" id="L457">        parser.accepts( &quot;date&quot;, &quot;a date&quot; ).withOptionalArg()</span>
<span class="fc" id="L458">            .describedAs( &quot;your basic date pattern&quot; )</span>
<span class="fc" id="L459">            .withValuesConvertedBy( datePattern( &quot;MM/dd/yy&quot; ) );</span>

<span class="fc" id="L461">        parser.printHelpOn( sink );</span>

<span class="fc" id="L463">        assertHelpLines(</span>
            &quot;Option                             Description&quot;,
            &quot;------                             -----------&quot;,
            &quot;--date [MM/dd/yy: your basic date  a date     &quot;,
            &quot;  pattern]                                    &quot;,
            EMPTY );
<span class="fc" id="L469">    }</span>

    @Test
    public void inetAddressConverterShowsType() throws Exception {
<span class="fc" id="L473">        parser.accepts( &quot;addr&quot;, &quot;an internet address&quot; )</span>
<span class="fc" id="L474">            .withRequiredArg()</span>
<span class="fc" id="L475">            .withValuesConvertedBy( new InetAddressConverter() );</span>

<span class="fc" id="L477">        parser.printHelpOn( sink );</span>

<span class="fc" id="L479">        assertHelpLines(</span>
            &quot;Option                Description        &quot;,
            &quot;------                -----------        &quot;,
            &quot;--addr &lt;InetAddress&gt;  an internet address&quot;,
            EMPTY );
<span class="fc" id="L484">    }</span>

    @Test
    public void leavesEmbeddedNewlinesInDescriptionsAlone() throws Exception {
<span class="fc" id="L488">        List&lt;String&gt; descriptionPieces =</span>
<span class="fc" id="L489">            asList( &quot;Specify the output type.&quot;, &quot;'raw' = raw data.&quot;, &quot;'java' = java class&quot; );</span>
<span class="fc" id="L490">        parser.accepts(</span>
            &quot;type&quot;,
<span class="fc" id="L492">            descriptionPieces.stream().collect( joining( LINE_SEPARATOR ) ) );</span>

<span class="fc" id="L494">        parser.printHelpOn( sink );</span>

<span class="fc" id="L496">        assertHelpLines(</span>
            &quot;Option  Description             &quot;,
            &quot;------  -----------             &quot;,
            &quot;--type  Specify the output type.&quot;,
            &quot;        'raw' = raw data.       &quot;,
            &quot;        'java' = java class     &quot;,
            EMPTY );
<span class="fc" id="L503">    }</span>

    @Test
    public void includesDefaultValueForRequiredOptionArgument() throws Exception {
<span class="fc" id="L507">        parser.accepts( &quot;a&quot; ).withRequiredArg().defaultsTo( &quot;boo&quot; );</span>

<span class="fc" id="L509">        parser.printHelpOn( sink );</span>

<span class="fc" id="L511">        assertHelpLines(</span>
            &quot;Option       Description   &quot;,
            &quot;------       -----------   &quot;,
            &quot;-a &lt;String&gt;  (default: boo)&quot;,
            EMPTY );
<span class="fc" id="L516">    }</span>

    @Test
    public void includesDefaultValueForOptionalOptionArgument() throws Exception {
<span class="fc" id="L520">        parser.accepts( &quot;b&quot; ).withOptionalArg().ofType( Integer.class ).defaultsTo( 5 );</span>

<span class="fc" id="L522">        parser.printHelpOn( sink );</span>

<span class="fc" id="L524">        assertHelpLines(</span>
            &quot;Option        Description &quot;,
            &quot;------        ----------- &quot;,
            &quot;-b [Integer]  (default: 5)&quot;,
            EMPTY );
<span class="fc" id="L529">    }</span>

    @Test
    public void includesDefaultValueForArgumentWithDescription() throws Exception {
<span class="fc" id="L533">        parser.accepts( &quot;c&quot;, &quot;a quantity&quot; ).withOptionalArg().ofType( BigDecimal.class )</span>
<span class="fc" id="L534">            .describedAs( &quot;quantity&quot; ).defaultsTo( TEN );</span>

<span class="fc" id="L536">        parser.printHelpOn( sink );</span>

<span class="fc" id="L538">        assertHelpLines(</span>
            &quot;Option                     Description             &quot;,
            &quot;------                     -----------             &quot;,
            &quot;-c [BigDecimal: quantity]  a quantity (default: 10)&quot;,
            EMPTY );
<span class="fc" id="L543">    }</span>

    @Test
    public void includesListOfDefaultsForArgumentWithDescription() throws Exception {
<span class="fc" id="L547">        parser.accepts( &quot;d&quot;, &quot;dizzle&quot; ).withOptionalArg().ofType( Integer.class )</span>
<span class="fc" id="L548">            .describedAs( &quot;double dizzle&quot; ).defaultsTo( 2, 3, 5, 7 );</span>

<span class="fc" id="L550">        parser.printHelpOn( sink );</span>

<span class="fc" id="L552">        assertHelpLines(</span>
            &quot;Option                       Description                   &quot;,
            &quot;------                       -----------                   &quot;,
            &quot;-d [Integer: double dizzle]  dizzle (default: [2, 3, 5, 7])&quot;,
            EMPTY );
<span class="fc" id="L557">    }</span>

    @Test
    public void marksRequiredOptionsSpecially() throws Exception {
<span class="fc" id="L561">        parser.accepts( &quot;e&quot; ).withRequiredArg().required();</span>

<span class="fc" id="L563">        parser.printHelpOn( sink );</span>

<span class="fc" id="L565">        assertHelpLines(</span>
            &quot;Option (* = required)  Description&quot;,
            &quot;---------------------  -----------&quot;,
            &quot;* -e &lt;String&gt;                     &quot;,
            EMPTY );
<span class="fc" id="L570">    }</span>

    @Test
    public void showsNonOptionArgumentDescription() throws Exception {
<span class="fc" id="L574">        parser.nonOptions( &quot;stuff&quot; );</span>

<span class="fc" id="L576">        parser.printHelpOn( sink );</span>

<span class="fc" id="L578">        assertHelpLines(</span>
            &quot;Non-option arguments:&quot;,
            &quot;[String] -- stuff    &quot;,
            EMPTY,
            &quot;No options specified  &quot;,
            EMPTY );
<span class="fc" id="L584">    }</span>

    @Test
    public void showsNonOptionArgumentType() throws Exception {
<span class="fc" id="L588">        parser.nonOptions().ofType( File.class );</span>

<span class="fc" id="L590">        parser.printHelpOn( sink );</span>

<span class="fc" id="L592">        assertHelpLines(</span>
            &quot;Non-option arguments:&quot;,
            &quot;[File]               &quot;,
            EMPTY,
            &quot;No options specified  &quot;,
            EMPTY );
<span class="fc" id="L598">    }</span>

    @Test
    public void showsNonOptionArgumentTypeDescribedAs() throws Exception {
<span class="fc" id="L602">        parser.nonOptions().describedAs( &quot;files&quot; );</span>

<span class="fc" id="L604">        parser.printHelpOn( sink );</span>

<span class="fc" id="L606">        assertHelpLines(</span>
            &quot;Non-option arguments:&quot;,
            &quot;[String: files]      &quot;,
            EMPTY,
            &quot;No options specified  &quot;,
            EMPTY );
<span class="fc" id="L612">    }</span>

    @Test
    public void showsNonOptionArgumentTypeAndArgumentDescription() throws Exception {
<span class="fc" id="L616">        parser.nonOptions().ofType( File.class ).describedAs( &quot;files&quot; );</span>

<span class="fc" id="L618">        parser.printHelpOn( sink );</span>

<span class="fc" id="L620">        assertHelpLines(</span>
            &quot;Non-option arguments:&quot;,
            &quot;[File: files]        &quot;,
            EMPTY,
            &quot;No options specified  &quot;,
            EMPTY );
<span class="fc" id="L626">    }</span>

    @Test
    public void showsNonOptionArgumentTypeAndDescription() throws Exception {
<span class="fc" id="L630">        parser.nonOptions( &quot;some files to operate on&quot; ).ofType( File.class );</span>

<span class="fc" id="L632">        parser.printHelpOn( sink );</span>

<span class="fc" id="L634">        assertHelpLines(</span>
            &quot;Non-option arguments:             &quot;,
            &quot;[File] -- some files to operate on&quot;,
            EMPTY,
            &quot;No options specified  &quot;,
            EMPTY );
<span class="fc" id="L640">    }</span>

    @Test
    public void showsNonOptionArgumentTypeAndDescriptionAndArgumentDescription() throws Exception {
<span class="fc" id="L644">        parser.nonOptions( &quot;some files to operate on&quot; ).ofType( File.class ).describedAs( &quot;files&quot; );</span>

<span class="fc" id="L646">        parser.printHelpOn( sink );</span>

<span class="fc" id="L648">        assertHelpLines(</span>
            &quot;Non-option arguments:                    &quot;,
            &quot;[File: files] -- some files to operate on&quot;,
            EMPTY,
            &quot;No options specified  &quot;,
            EMPTY );
<span class="fc" id="L654">    }</span>

    @Test
    public void canUseCustomHelpFormatter() {
<span class="fc" id="L658">        parser.accepts( &quot;f&quot; );</span>

<span class="fc" id="L660">        parser.formatHelpWith(options -&gt; {</span>
<span class="nc" id="L661">            assertEquals( 1, options.size() );</span>

<span class="nc" id="L663">            OptionDescriptor only = options.get( &quot;f&quot; );</span>
<span class="nc" id="L664">            assertEquals( singletonList( &quot;f&quot; ), new ArrayList&lt;&gt;( only.options() ) );</span>
<span class="nc" id="L665">            assertFalse( only.acceptsArguments() );</span>
<span class="nc" id="L666">            assertEquals( &quot;&quot;, only.argumentDescription() );</span>
<span class="nc" id="L667">            assertEquals( &quot;&quot;, only.argumentTypeIndicator() );</span>
<span class="nc" id="L668">            assertEquals( emptyList(), only.defaultValues() );</span>
<span class="nc" id="L669">            assertEquals( &quot;&quot;, only.description() );</span>
<span class="nc" id="L670">            assertFalse( only.isRequired() );</span>
<span class="nc" id="L671">            assertFalse( only.requiresArgument() );</span>

<span class="nc" id="L673">            return null;</span>
        });
<span class="fc" id="L675">    }</span>

    @Test( expected = NullPointerException.class )
    public void rejectsNullHelpFormatter() {
<span class="nc" id="L679">        parser.formatHelpWith( null );</span>
<span class="nc" id="L680">    }</span>

    @Test
    public void fixForIssue56() throws Exception {
<span class="fc" id="L684">        parser.accepts( &quot;password&quot;, &quot;Server Password&quot; ).withRequiredArg().ofType( String.class );</span>
<span class="fc" id="L685">        parser.accepts( &quot;F&quot;, &quot;Forward port mapping (ie: localhost:5900:localhost:5900)&quot; ).withRequiredArg();</span>
<span class="fc" id="L686">        parser.accepts( &quot;R&quot;, &quot;Reverse port mapping (ie: localhost:5900:localhost:5900)&quot; ).withRequiredArg();</span>

<span class="fc" id="L688">        parser.printHelpOn( sink );</span>

<span class="fc" id="L690">        assertHelpLines(</span>
            &quot;Option               Description                                             &quot;,
            &quot;------               -----------                                             &quot;,
            &quot;-F &lt;String&gt;          Forward port mapping (ie: localhost:5900:localhost:5900)&quot;,
            &quot;-R &lt;String&gt;          Reverse port mapping (ie: localhost:5900:localhost:5900)&quot;,
            &quot;--password &lt;String&gt;  Server Password                                         &quot;,
            EMPTY );
<span class="fc" id="L697">    }</span>

    @Test
    public void fixForIssue85() throws Exception {
<span class="fc" id="L701">        parser.acceptsAll( asList( &quot;?&quot;, &quot;help&quot; ), &quot;Display this help text&quot; ).forHelp();</span>
<span class="fc" id="L702">        parser.acceptsAll( asList( &quot;c&quot;, &quot;check-avail&quot; ),</span>
            &quot;Check Galileo homepage for available books, compare with known ones&quot; );
<span class="fc" id="L704">        parser.acceptsAll( asList( &quot;d&quot;, &quot;download-dir&quot; ),</span>
            &quot;Download directory for openbooks; must exist&quot; )
<span class="fc" id="L706">            .withRequiredArg().ofType( File.class ).defaultsTo( new File( &quot;.&quot; ) );</span>
<span class="fc" id="L707">        parser.acceptsAll( asList( &quot;l&quot;, &quot;log-level&quot; ),</span>
            &quot;Log level (0=normal, 1=verbose, 2=debug, 3=trace&quot; )
<span class="fc" id="L709">            .withRequiredArg().ofType( int.class ).defaultsTo( 0 );</span>
<span class="fc" id="L710">        parser.acceptsAll( asList( &quot;m&quot;, &quot;check-md5&quot; ),</span>
            &quot;Download all known books without storing them, verifying their MD5 checksum (slow! &gt;1 Gb download)&quot; );
<span class="fc" id="L712">        parser.acceptsAll( asList( &quot;t&quot;, &quot;threading&quot; ),</span>
            &quot;Threading mode (0=single, 1=multi); single is slower, but better for diagnostics)&quot; )
<span class="fc" id="L714">            .withRequiredArg().ofType( int.class ).defaultsTo( 1 );</span>
<span class="fc" id="L715">        parser.acceptsAll( asList( &quot;w&quot;, &quot;write-config&quot; ),</span>
            &quot;Write editable book list to config.xml, enabling you to update MD5 checksums or add new books&quot; );

<span class="fc" id="L718">        parser.printHelpOn( sink );</span>

<span class="fc" id="L720">        assertHelpLines(</span>
            &quot;Option                     Description                                          &quot;,
            &quot;------                     -----------                                          &quot;,
            &quot;-?, --help                 Display this help text                               &quot;,
            &quot;-c, --check-avail          Check Galileo homepage for available books, compare  &quot;,
            &quot;                             with known ones                                    &quot;,
            &quot;-d, --download-dir &lt;File&gt;  Download directory for openbooks; must exist         &quot;,
            &quot;                             (default: .)                                       &quot;,
            &quot;-l, --log-level &lt;Integer&gt;  Log level (0=normal, 1=verbose, 2=debug, 3=trace     &quot;,
            &quot;                             (default: 0)                                       &quot;,
            &quot;-m, --check-md5            Download all known books without storing them,       &quot;,
            &quot;                             verifying their MD5 checksum (slow! &gt;1 Gb download)&quot;,
            &quot;-t, --threading &lt;Integer&gt;  Threading mode (0=single, 1=multi); single is        &quot;,
            &quot;                             slower, but better for diagnostics) (default: 1)   &quot;,
            &quot;-w, --write-config         Write editable book list to config.xml, enabling you &quot;,
            &quot;                             to update MD5 checksums or add new books           &quot;,
            EMPTY );
<span class="fc" id="L737">    }</span>

    private void assertHelpLines( String... expectedLines ) {
<span class="fc" id="L740">        assertEquals(</span>
<span class="fc" id="L741">            Stream.of( expectedLines ).collect( joining( LINE_SEPARATOR ) ),</span>
<span class="fc" id="L742">            sink.toString() );</span>
<span class="fc" id="L743">    }</span>

    private static class FakeOutputStream extends ByteArrayOutputStream {
        boolean closed;
        boolean flushed;

        @Override
        public void close() {
<span class="nc" id="L751">            this.closed = true;</span>
<span class="nc" id="L752">        }</span>

        @Override
        public void flush() {
<span class="fc" id="L756">            this.flushed = true;</span>
<span class="fc" id="L757">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>