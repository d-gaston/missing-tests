<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VisibilityModifierCheckTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">checkstyle$java_in_checkstyle.exec</a> &gt; <a href="index.source.html" class="el_package">com.puppycrawl.tools.checkstyle.checks.design</a> &gt; <span class="el_source">VisibilityModifierCheckTest.java</span></div><h1>VisibilityModifierCheckTest.java</h1><pre class="source lang-java linenums">////////////////////////////////////////////////////////////////////////////////
// checkstyle: Checks Java source code for adherence to a set of rules.
// Copyright (C) 2001-2019 the original author or authors.
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; either
// version 2.1 of the License, or (at your option) any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
// Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
////////////////////////////////////////////////////////////////////////////////

package com.puppycrawl.tools.checkstyle.checks.design;

import static com.puppycrawl.tools.checkstyle.checks.design.VisibilityModifierCheck.MSG_KEY;
import static org.junit.Assert.assertArrayEquals;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;

import java.io.File;
import java.lang.reflect.Method;

import org.junit.Test;
import org.powermock.reflect.Whitebox;

import antlr.CommonHiddenStreamToken;
import com.puppycrawl.tools.checkstyle.AbstractModuleTestSupport;
import com.puppycrawl.tools.checkstyle.DefaultConfiguration;
import com.puppycrawl.tools.checkstyle.DetailAstImpl;
import com.puppycrawl.tools.checkstyle.JavaParser;
import com.puppycrawl.tools.checkstyle.api.DetailAST;
import com.puppycrawl.tools.checkstyle.api.TokenTypes;
import com.puppycrawl.tools.checkstyle.utils.CommonUtil;

<span class="fc" id="L43">public class VisibilityModifierCheckTest</span>
    extends AbstractModuleTestSupport {

    @Override
    protected String getPackageLocation() {
<span class="fc" id="L48">        return &quot;com/puppycrawl/tools/checkstyle/checks/design/visibilitymodifier&quot;;</span>
    }

    @Test
    public void testGetRequiredTokens() {
<span class="fc" id="L53">        final VisibilityModifierCheck checkObj = new VisibilityModifierCheck();</span>
<span class="fc" id="L54">        final int[] expected = {</span>
            TokenTypes.VARIABLE_DEF,
            TokenTypes.IMPORT,
        };
<span class="fc" id="L58">        assertArrayEquals(&quot;Default required tokens are invalid&quot;,</span>
<span class="fc" id="L59">            expected, checkObj.getRequiredTokens());</span>
<span class="fc" id="L60">    }</span>

    @Test
    public void testInner()
            throws Exception {
<span class="fc" id="L65">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L66">                createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L67">        checkConfig.addAttribute(&quot;publicMemberPattern&quot;, &quot;^f[A-Z][a-zA-Z0-9]*$&quot;);</span>
<span class="fc" id="L68">        final String[] expected = {</span>
<span class="fc" id="L69">            &quot;30:24: &quot; + getCheckMessage(MSG_KEY, &quot;rData&quot;),</span>
<span class="fc" id="L70">            &quot;33:27: &quot; + getCheckMessage(MSG_KEY, &quot;protectedVariable&quot;),</span>
<span class="fc" id="L71">            &quot;36:17: &quot; + getCheckMessage(MSG_KEY, &quot;packageVariable&quot;),</span>
<span class="fc" id="L72">            &quot;41:29: &quot; + getCheckMessage(MSG_KEY, &quot;sWeird&quot;),</span>
<span class="fc" id="L73">            &quot;43:19: &quot; + getCheckMessage(MSG_KEY, &quot;sWeird2&quot;),</span>
<span class="fc" id="L74">            &quot;77:20: &quot; + getCheckMessage(MSG_KEY, &quot;someValue&quot;),</span>
<span class="fc" id="L75">            &quot;80:11: &quot; + getCheckMessage(MSG_KEY, &quot;fSerialVersionUID&quot;),</span>
        };
<span class="fc" id="L77">        verify(checkConfig, getPath(&quot;InputVisibilityModifierInner.java&quot;), expected);</span>
<span class="fc" id="L78">    }</span>

    @Test
    public void testIgnoreAccess()
            throws Exception {
<span class="fc" id="L83">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L84">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L85">        checkConfig.addAttribute(&quot;publicMemberPattern&quot;, &quot;^r[A-Z]&quot;);</span>
<span class="fc" id="L86">        checkConfig.addAttribute(&quot;protectedAllowed&quot;, &quot;true&quot;);</span>
<span class="fc" id="L87">        checkConfig.addAttribute(&quot;packageAllowed&quot;, &quot;true&quot;);</span>
<span class="fc" id="L88">        final String[] expected = {</span>
<span class="fc" id="L89">            &quot;17:20: &quot; + getCheckMessage(MSG_KEY, &quot;fData&quot;),</span>
<span class="fc" id="L90">            &quot;77:20: &quot; + getCheckMessage(MSG_KEY, &quot;someValue&quot;),</span>
        };
<span class="fc" id="L92">        verify(checkConfig, getPath(&quot;InputVisibilityModifierInner.java&quot;), expected);</span>
<span class="fc" id="L93">    }</span>

    @Test
    public void testSimple() throws Exception {
<span class="fc" id="L97">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L98">                createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L99">        checkConfig.addAttribute(&quot;publicMemberPattern&quot;, &quot;^f[A-Z][a-zA-Z0-9]*$&quot;);</span>
<span class="fc" id="L100">        final String[] expected = {</span>
<span class="fc" id="L101">            &quot;33:19: &quot; + getCheckMessage(MSG_KEY, &quot;mNumCreated2&quot;),</span>
<span class="fc" id="L102">            &quot;43:23: &quot; + getCheckMessage(MSG_KEY, &quot;sTest1&quot;),</span>
<span class="fc" id="L103">            &quot;45:26: &quot; + getCheckMessage(MSG_KEY, &quot;sTest3&quot;),</span>
<span class="fc" id="L104">            &quot;47:16: &quot; + getCheckMessage(MSG_KEY, &quot;sTest2&quot;),</span>
<span class="fc" id="L105">            &quot;50:9: &quot; + getCheckMessage(MSG_KEY, &quot;mTest1&quot;),</span>
<span class="fc" id="L106">            &quot;52:16: &quot; + getCheckMessage(MSG_KEY, &quot;mTest2&quot;),</span>
        };
<span class="fc" id="L108">        verify(checkConfig, getPath(&quot;InputVisibilityModifierSimple.java&quot;), expected);</span>
<span class="fc" id="L109">    }</span>

    @Test
    public void testStrictJavadoc() throws Exception {
<span class="fc" id="L113">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L114">                createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L115">        checkConfig.addAttribute(&quot;publicMemberPattern&quot;, &quot;^f[A-Z][a-zA-Z0-9]*$&quot;);</span>
<span class="fc" id="L116">        final String[] expected = {</span>
<span class="fc" id="L117">            &quot;32:9: &quot; + getCheckMessage(MSG_KEY, &quot;mLen&quot;),</span>
<span class="fc" id="L118">            &quot;33:19: &quot; + getCheckMessage(MSG_KEY, &quot;mDeer&quot;),</span>
<span class="fc" id="L119">            &quot;34:16: &quot; + getCheckMessage(MSG_KEY, &quot;aFreddo&quot;),</span>
        };
<span class="fc" id="L121">        verify(checkConfig, getPath(&quot;InputVisibilityModifierPublicOnly.java&quot;), expected);</span>
<span class="fc" id="L122">    }</span>

    @Test
    public void testAllowPublicFinalFieldsInImmutableClass() throws Exception {
<span class="fc" id="L126">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L127">                createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L128">        checkConfig.addAttribute(&quot;allowPublicImmutableFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L129">        final String[] expected = {</span>
<span class="fc" id="L130">            &quot;12:39: &quot; + getCheckMessage(MSG_KEY, &quot;includes&quot;),</span>
<span class="fc" id="L131">            &quot;13:39: &quot; + getCheckMessage(MSG_KEY, &quot;excludes&quot;),</span>
<span class="fc" id="L132">            &quot;16:23: &quot; + getCheckMessage(MSG_KEY, &quot;list&quot;),</span>
<span class="fc" id="L133">            &quot;34:20: &quot; + getCheckMessage(MSG_KEY, &quot;value&quot;),</span>
<span class="fc" id="L134">            &quot;36:24: &quot; + getCheckMessage(MSG_KEY, &quot;bValue&quot;),</span>
<span class="fc" id="L135">            &quot;37:31: &quot; + getCheckMessage(MSG_KEY, &quot;longValue&quot;),</span>
<span class="fc" id="L136">            &quot;41:19: &quot; + getCheckMessage(MSG_KEY, &quot;C_D_E&quot;),</span>
        };
<span class="fc" id="L138">        verify(checkConfig, getPath(&quot;InputVisibilityModifierImmutable.java&quot;), expected);</span>
<span class="fc" id="L139">    }</span>

    @Test
    public void testAllowPublicFinalFieldsInImmutableClassWithNonCanonicalClasses()
            throws Exception {
<span class="fc" id="L144">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L145">                createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L146">        checkConfig.addAttribute(&quot;allowPublicImmutableFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L147">        checkConfig.addAttribute(&quot;immutableClassCanonicalNames&quot;, &quot;String, Integer, Byte, &quot;</span>
                + &quot;Character, Short, Boolean, Long, Double, Float, StackTraceElement, BigInteger, &quot;
                + &quot;BigDecimal, File, Locale, UUID, URL, URI, Inet4Address, Inet6Address, &quot;
                + &quot;InetSocketAddress&quot;);
<span class="fc" id="L151">        final String[] expected = {</span>
<span class="fc" id="L152">            &quot;12:39: &quot; + getCheckMessage(MSG_KEY, &quot;includes&quot;),</span>
<span class="fc" id="L153">            &quot;13:39: &quot; + getCheckMessage(MSG_KEY, &quot;excludes&quot;),</span>
<span class="fc" id="L154">            &quot;14:35: &quot; + getCheckMessage(MSG_KEY, &quot;notes&quot;),</span>
<span class="fc" id="L155">            &quot;15:29: &quot; + getCheckMessage(MSG_KEY, &quot;money&quot;),</span>
<span class="fc" id="L156">            &quot;16:23: &quot; + getCheckMessage(MSG_KEY, &quot;list&quot;),</span>
<span class="fc" id="L157">            &quot;32:35: &quot; + getCheckMessage(MSG_KEY, &quot;uri&quot;),</span>
<span class="fc" id="L158">            &quot;33:35: &quot; + getCheckMessage(MSG_KEY, &quot;file&quot;),</span>
<span class="fc" id="L159">            &quot;34:20: &quot; + getCheckMessage(MSG_KEY, &quot;value&quot;),</span>
<span class="fc" id="L160">            &quot;35:35: &quot; + getCheckMessage(MSG_KEY, &quot;url&quot;),</span>
<span class="fc" id="L161">            &quot;36:24: &quot; + getCheckMessage(MSG_KEY, &quot;bValue&quot;),</span>
<span class="fc" id="L162">            &quot;37:31: &quot; + getCheckMessage(MSG_KEY, &quot;longValue&quot;),</span>
<span class="fc" id="L163">            &quot;41:19: &quot; + getCheckMessage(MSG_KEY, &quot;C_D_E&quot;),</span>
        };
<span class="fc" id="L165">        verify(checkConfig, getPath(&quot;InputVisibilityModifierImmutable.java&quot;), expected);</span>
<span class="fc" id="L166">    }</span>

    @Test
    public void testDisAllowPublicFinalAndImmutableFieldsInImmutableClass() throws Exception {
<span class="fc" id="L170">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L171">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L172">        final String[] expected = {</span>
<span class="fc" id="L173">            &quot;11:22: &quot; + getCheckMessage(MSG_KEY, &quot;someIntValue&quot;),</span>
<span class="fc" id="L174">            &quot;12:39: &quot; + getCheckMessage(MSG_KEY, &quot;includes&quot;),</span>
<span class="fc" id="L175">            &quot;13:39: &quot; + getCheckMessage(MSG_KEY, &quot;excludes&quot;),</span>
<span class="fc" id="L176">            &quot;14:35: &quot; + getCheckMessage(MSG_KEY, &quot;notes&quot;),</span>
<span class="fc" id="L177">            &quot;15:29: &quot; + getCheckMessage(MSG_KEY, &quot;money&quot;),</span>
<span class="fc" id="L178">            &quot;16:23: &quot; + getCheckMessage(MSG_KEY, &quot;list&quot;),</span>
<span class="fc" id="L179">            &quot;30:28: &quot; + getCheckMessage(MSG_KEY, &quot;f&quot;),</span>
<span class="fc" id="L180">            &quot;31:30: &quot; + getCheckMessage(MSG_KEY, &quot;bool&quot;),</span>
<span class="fc" id="L181">            &quot;32:35: &quot; + getCheckMessage(MSG_KEY, &quot;uri&quot;),</span>
<span class="fc" id="L182">            &quot;33:35: &quot; + getCheckMessage(MSG_KEY, &quot;file&quot;),</span>
<span class="fc" id="L183">            &quot;34:20: &quot; + getCheckMessage(MSG_KEY, &quot;value&quot;),</span>
<span class="fc" id="L184">            &quot;35:35: &quot; + getCheckMessage(MSG_KEY, &quot;url&quot;),</span>
<span class="fc" id="L185">            &quot;36:24: &quot; + getCheckMessage(MSG_KEY, &quot;bValue&quot;),</span>
<span class="fc" id="L186">            &quot;37:31: &quot; + getCheckMessage(MSG_KEY, &quot;longValue&quot;),</span>
<span class="fc" id="L187">            &quot;41:19: &quot; + getCheckMessage(MSG_KEY, &quot;C_D_E&quot;),</span>
            };
<span class="fc" id="L189">        verify(checkConfig, getPath(&quot;InputVisibilityModifierImmutable.java&quot;), expected);</span>
<span class="fc" id="L190">    }</span>

    @Test
    public void testAllowPublicFinalFieldsInNonFinalClass() throws Exception {
<span class="fc" id="L194">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L195">                createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L196">        checkConfig.addAttribute(&quot;allowPublicFinalFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L197">        final String[] expected = {</span>
<span class="fc" id="L198">            &quot;34:20: &quot; + getCheckMessage(MSG_KEY, &quot;value&quot;),</span>
<span class="fc" id="L199">            &quot;36:24: &quot; + getCheckMessage(MSG_KEY, &quot;bValue&quot;),</span>
<span class="fc" id="L200">            &quot;37:31: &quot; + getCheckMessage(MSG_KEY, &quot;longValue&quot;),</span>
        };
<span class="fc" id="L202">        verify(checkConfig, getPath(&quot;InputVisibilityModifierImmutable.java&quot;), expected);</span>
<span class="fc" id="L203">    }</span>

    @Test
    public void testUserSpecifiedImmutableClassesList() throws Exception {
<span class="fc" id="L207">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L208">                createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L209">        checkConfig.addAttribute(&quot;allowPublicImmutableFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L210">        checkConfig.addAttribute(&quot;immutableClassCanonicalNames&quot;, &quot;java.util.List,&quot;</span>
                + &quot;com.google.common.collect.ImmutableSet, java.lang.String&quot;);
<span class="fc" id="L212">        final String[] expected = {</span>
<span class="fc" id="L213">            &quot;15:29: &quot; + getCheckMessage(MSG_KEY, &quot;money&quot;),</span>
<span class="fc" id="L214">            &quot;32:35: &quot; + getCheckMessage(MSG_KEY, &quot;uri&quot;),</span>
<span class="fc" id="L215">            &quot;33:35: &quot; + getCheckMessage(MSG_KEY, &quot;file&quot;),</span>
<span class="fc" id="L216">            &quot;34:20: &quot; + getCheckMessage(MSG_KEY, &quot;value&quot;),</span>
<span class="fc" id="L217">            &quot;35:35: &quot; + getCheckMessage(MSG_KEY, &quot;url&quot;),</span>
<span class="fc" id="L218">            &quot;36:24: &quot; + getCheckMessage(MSG_KEY, &quot;bValue&quot;),</span>
<span class="fc" id="L219">            &quot;37:31: &quot; + getCheckMessage(MSG_KEY, &quot;longValue&quot;),</span>
<span class="fc" id="L220">            &quot;41:19: &quot; + getCheckMessage(MSG_KEY, &quot;C_D_E&quot;),</span>
        };
<span class="fc" id="L222">        verify(checkConfig, getPath(&quot;InputVisibilityModifierImmutable.java&quot;), expected);</span>
<span class="fc" id="L223">    }</span>

    @Test
    public void testImmutableSpecifiedSameTypeName() throws Exception {
<span class="fc" id="L227">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L228">                createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L229">        checkConfig.addAttribute(&quot;allowPublicImmutableFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L230">        checkConfig.addAttribute(&quot;immutableClassCanonicalNames&quot;,</span>
                 &quot;com.puppycrawl.tools.checkstyle.checks.design.&quot;
                         + &quot;visibilitymodifier.InputVisibilityModifierGregorianCalendar,&quot;
                 + &quot;com.puppycrawl.tools.checkstyle.checks.design.&quot;
                         + &quot;visibilitymodifier.inputs.InetSocketAddress&quot;);
<span class="fc" id="L235">        final String[] expected = {</span>
<span class="fc" id="L236">            &quot;7:46: &quot; + getCheckMessage(MSG_KEY, &quot;calendar&quot;),</span>
<span class="fc" id="L237">            &quot;12:45: &quot; + getCheckMessage(MSG_KEY, &quot;adr&quot;),</span>
        };
<span class="fc" id="L239">        verify(checkConfig, getPath(&quot;InputVisibilityModifierImmutableSameTypeName.java&quot;),</span>
                expected);
<span class="fc" id="L241">    }</span>

    @Test
    public void testImmutableValueSameTypeName() throws Exception {
<span class="fc" id="L245">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L246">                createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L247">        checkConfig.addAttribute(&quot;allowPublicImmutableFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L248">        final String[] expected = {</span>
<span class="fc" id="L249">            &quot;7:46: &quot; + getCheckMessage(MSG_KEY, &quot;calendar&quot;),</span>
<span class="fc" id="L250">            &quot;8:59: &quot; + getCheckMessage(MSG_KEY, &quot;calendar2&quot;),</span>
<span class="fc" id="L251">            &quot;10:73: &quot; + getCheckMessage(MSG_KEY, &quot;calendar3&quot;),</span>
<span class="fc" id="L252">            &quot;11:36: &quot; + getCheckMessage(MSG_KEY, &quot;address&quot;),</span>
        };
<span class="fc" id="L254">        verify(checkConfig, getPath(&quot;InputVisibilityModifierImmutableSameTypeName.java&quot;),</span>
                expected);
<span class="fc" id="L256">    }</span>

    @Test
    public void testImmutableStarImportFalseNegative() throws Exception {
<span class="fc" id="L260">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L261">                createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L262">        checkConfig.addAttribute(&quot;allowPublicImmutableFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L263">        checkConfig.addAttribute(&quot;immutableClassCanonicalNames&quot;, &quot;java.util.Arrays&quot;);</span>
<span class="fc" id="L264">        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L265">        verify(checkConfig, getPath(&quot;InputVisibilityModifierImmutableStarImport.java&quot;), expected);</span>
<span class="fc" id="L266">    }</span>

    @Test
    public void testImmutableStarImportNoWarn() throws Exception {
<span class="fc" id="L270">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L271">                createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L272">        checkConfig.addAttribute(&quot;allowPublicImmutableFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L273">        checkConfig.addAttribute(&quot;immutableClassCanonicalNames&quot;,</span>
            &quot;java.lang.String, com.google.common.collect.ImmutableSet&quot;);
<span class="fc" id="L275">        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L276">        verify(checkConfig, getPath(&quot;InputVisibilityModifierImmutableStarImport2.java&quot;),</span>
                expected);
<span class="fc" id="L278">    }</span>

    @Test
    public void testDefaultAnnotationPatterns() throws Exception {
<span class="fc" id="L282">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L283">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L284">        final String[] expected = {</span>
<span class="fc" id="L285">            &quot;40:19: &quot; + getCheckMessage(MSG_KEY, &quot;customAnnotatedPublic&quot;),</span>
<span class="fc" id="L286">            &quot;43:12: &quot; + getCheckMessage(MSG_KEY, &quot;customAnnotatedPackage&quot;),</span>
<span class="fc" id="L287">            &quot;46:22: &quot; + getCheckMessage(MSG_KEY, &quot;customAnnotatedProtected&quot;),</span>
<span class="fc" id="L288">            &quot;48:19: &quot; + getCheckMessage(MSG_KEY, &quot;unannotatedPublic&quot;),</span>
<span class="fc" id="L289">            &quot;49:12: &quot; + getCheckMessage(MSG_KEY, &quot;unannotatedPackage&quot;),</span>
<span class="fc" id="L290">            &quot;50:22: &quot; + getCheckMessage(MSG_KEY, &quot;unannotatedProtected&quot;),</span>
        };
<span class="fc" id="L292">        verify(checkConfig, getPath(&quot;InputVisibilityModifierAnnotated.java&quot;), expected);</span>
<span class="fc" id="L293">    }</span>

    @Test
    public void testCustomAnnotationPatterns() throws Exception {
<span class="fc" id="L297">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L298">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L299">        checkConfig.addAttribute(&quot;ignoreAnnotationCanonicalNames&quot;,</span>
                &quot;com.puppycrawl.tools.checkstyle.checks.design.&quot;
                    + &quot;InputVisibilityModifierAnnotated.CustomAnnotation&quot;);
<span class="fc" id="L302">        final String[] expected = {</span>
<span class="fc" id="L303">            &quot;16:28: &quot; + getCheckMessage(MSG_KEY, &quot;publicJUnitRule&quot;),</span>
<span class="fc" id="L304">            &quot;19:28: &quot; + getCheckMessage(MSG_KEY, &quot;fqPublicJUnitRule&quot;),</span>
<span class="fc" id="L305">            &quot;22:19: &quot; + getCheckMessage(MSG_KEY, &quot;googleCommonsAnnotatedPublic&quot;),</span>
<span class="fc" id="L306">            &quot;25:12: &quot; + getCheckMessage(MSG_KEY, &quot;googleCommonsAnnotatedPackage&quot;),</span>
<span class="fc" id="L307">            &quot;28:22: &quot; + getCheckMessage(MSG_KEY, &quot;googleCommonsAnnotatedProtected&quot;),</span>
<span class="fc" id="L308">            &quot;31:19: &quot; + getCheckMessage(MSG_KEY, &quot;fqGoogleCommonsAnnotatedPublic&quot;),</span>
<span class="fc" id="L309">            &quot;34:12: &quot; + getCheckMessage(MSG_KEY, &quot;fqGoogleCommonsAnnotatedPackage&quot;),</span>
<span class="fc" id="L310">            &quot;37:22: &quot; + getCheckMessage(MSG_KEY, &quot;fqGoogleCommonsAnnotatedProtected&quot;),</span>
<span class="fc" id="L311">            &quot;48:19: &quot; + getCheckMessage(MSG_KEY, &quot;unannotatedPublic&quot;),</span>
<span class="fc" id="L312">            &quot;49:12: &quot; + getCheckMessage(MSG_KEY, &quot;unannotatedPackage&quot;),</span>
<span class="fc" id="L313">            &quot;50:22: &quot; + getCheckMessage(MSG_KEY, &quot;unannotatedProtected&quot;),</span>
<span class="fc" id="L314">            &quot;59:35: &quot; + getCheckMessage(MSG_KEY, &quot;publicJUnitClassRule&quot;),</span>
<span class="fc" id="L315">            &quot;62:35: &quot; + getCheckMessage(MSG_KEY, &quot;fqPublicJUnitClassRule&quot;),</span>
        };
<span class="fc" id="L317">        verify(checkConfig, getPath(&quot;InputVisibilityModifierAnnotated.java&quot;), expected);</span>
<span class="fc" id="L318">    }</span>

    @Test
    public void testIgnoreAnnotationNoPattern() throws Exception {
<span class="fc" id="L322">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L323">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L324">        checkConfig.addAttribute(&quot;ignoreAnnotationCanonicalNames&quot;, &quot;&quot;);</span>
<span class="fc" id="L325">        final String[] expected = {</span>
<span class="fc" id="L326">            &quot;16:28: &quot; + getCheckMessage(MSG_KEY, &quot;publicJUnitRule&quot;),</span>
<span class="fc" id="L327">            &quot;19:28: &quot; + getCheckMessage(MSG_KEY, &quot;fqPublicJUnitRule&quot;),</span>
<span class="fc" id="L328">            &quot;22:19: &quot; + getCheckMessage(MSG_KEY, &quot;googleCommonsAnnotatedPublic&quot;),</span>
<span class="fc" id="L329">            &quot;25:12: &quot; + getCheckMessage(MSG_KEY, &quot;googleCommonsAnnotatedPackage&quot;),</span>
<span class="fc" id="L330">            &quot;28:22: &quot; + getCheckMessage(MSG_KEY, &quot;googleCommonsAnnotatedProtected&quot;),</span>
<span class="fc" id="L331">            &quot;31:19: &quot; + getCheckMessage(MSG_KEY, &quot;fqGoogleCommonsAnnotatedPublic&quot;),</span>
<span class="fc" id="L332">            &quot;34:12: &quot; + getCheckMessage(MSG_KEY, &quot;fqGoogleCommonsAnnotatedPackage&quot;),</span>
<span class="fc" id="L333">            &quot;37:22: &quot; + getCheckMessage(MSG_KEY, &quot;fqGoogleCommonsAnnotatedProtected&quot;),</span>
<span class="fc" id="L334">            &quot;40:19: &quot; + getCheckMessage(MSG_KEY, &quot;customAnnotatedPublic&quot;),</span>
<span class="fc" id="L335">            &quot;43:12: &quot; + getCheckMessage(MSG_KEY, &quot;customAnnotatedPackage&quot;),</span>
<span class="fc" id="L336">            &quot;46:22: &quot; + getCheckMessage(MSG_KEY, &quot;customAnnotatedProtected&quot;),</span>
<span class="fc" id="L337">            &quot;48:19: &quot; + getCheckMessage(MSG_KEY, &quot;unannotatedPublic&quot;),</span>
<span class="fc" id="L338">            &quot;49:12: &quot; + getCheckMessage(MSG_KEY, &quot;unannotatedPackage&quot;),</span>
<span class="fc" id="L339">            &quot;50:22: &quot; + getCheckMessage(MSG_KEY, &quot;unannotatedProtected&quot;),</span>
<span class="fc" id="L340">            &quot;59:35: &quot; + getCheckMessage(MSG_KEY, &quot;publicJUnitClassRule&quot;),</span>
<span class="fc" id="L341">            &quot;62:35: &quot; + getCheckMessage(MSG_KEY, &quot;fqPublicJUnitClassRule&quot;),</span>
        };
<span class="fc" id="L343">        verify(checkConfig, getPath(&quot;InputVisibilityModifierAnnotated.java&quot;), expected);</span>
<span class="fc" id="L344">    }</span>

    @Test
    public void testIgnoreAnnotationSameName() throws Exception {
<span class="fc" id="L348">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L349">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L350">        final String[] expected = {</span>
<span class="fc" id="L351">            &quot;11:28: &quot; + getCheckMessage(MSG_KEY, &quot;publicJUnitRule&quot;),</span>
<span class="fc" id="L352">            &quot;14:28: &quot; + getCheckMessage(MSG_KEY, &quot;publicJUnitClassRule&quot;),</span>
        };
<span class="fc" id="L354">        verify(checkConfig, getPath(&quot;InputVisibilityModifierAnnotatedSameTypeName.java&quot;),</span>
                expected);
<span class="fc" id="L356">    }</span>

    @Test
    public void testGetAcceptableTokens() {
<span class="fc" id="L360">        final VisibilityModifierCheck obj = new VisibilityModifierCheck();</span>
<span class="fc" id="L361">        final int[] expected = {</span>
            TokenTypes.VARIABLE_DEF,
            TokenTypes.IMPORT,
        };
<span class="fc" id="L365">        assertArrayEquals(&quot;Default acceptable tokens are invalid&quot;,</span>
<span class="fc" id="L366">            expected, obj.getAcceptableTokens());</span>
<span class="fc" id="L367">    }</span>

    @Test
    public void testPublicImmutableFieldsNotAllowed() throws Exception {
<span class="fc" id="L371">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L372">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L373">        final String[] expected = {</span>
<span class="fc" id="L374">            &quot;10:22: &quot; + getCheckMessage(MSG_KEY, &quot;someIntValue&quot;),</span>
<span class="fc" id="L375">            &quot;11:39: &quot; + getCheckMessage(MSG_KEY, &quot;includes&quot;),</span>
<span class="fc" id="L376">            &quot;12:35: &quot; + getCheckMessage(MSG_KEY, &quot;notes&quot;),</span>
<span class="fc" id="L377">            &quot;13:29: &quot; + getCheckMessage(MSG_KEY, &quot;value&quot;),</span>
<span class="fc" id="L378">            &quot;14:23: &quot; + getCheckMessage(MSG_KEY, &quot;list&quot;),</span>
        };
<span class="fc" id="L380">        verify(checkConfig, getPath(&quot;InputVisibilityModifiersPublicImmutable.java&quot;), expected);</span>
<span class="fc" id="L381">    }</span>

    @Test
    public void testPublicFinalFieldsNotAllowed() throws Exception {
<span class="fc" id="L385">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L386">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L387">        final String[] expected = {</span>
<span class="fc" id="L388">            &quot;10:22: &quot; + getCheckMessage(MSG_KEY, &quot;someIntValue&quot;),</span>
<span class="fc" id="L389">            &quot;11:39: &quot; + getCheckMessage(MSG_KEY, &quot;includes&quot;),</span>
<span class="fc" id="L390">            &quot;12:35: &quot; + getCheckMessage(MSG_KEY, &quot;notes&quot;),</span>
<span class="fc" id="L391">            &quot;13:29: &quot; + getCheckMessage(MSG_KEY, &quot;value&quot;),</span>
<span class="fc" id="L392">            &quot;14:23: &quot; + getCheckMessage(MSG_KEY, &quot;list&quot;),</span>
        };
<span class="fc" id="L394">        verify(checkConfig, getPath(&quot;InputVisibilityModifiersPublicImmutable.java&quot;), expected);</span>
<span class="fc" id="L395">    }</span>

    @Test
    public void testPublicFinalFieldsAllowed() throws Exception {
<span class="fc" id="L399">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L400">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L401">        checkConfig.addAttribute(&quot;allowPublicFinalFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L402">        checkConfig.addAttribute(&quot;immutableClassCanonicalNames&quot;,</span>
            &quot;com.google.common.collect.ImmutableSet&quot;);
<span class="fc" id="L404">        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L405">        verify(checkConfig, getPath(&quot;InputVisibilityModifiersPublicImmutable.java&quot;), expected);</span>
<span class="fc" id="L406">    }</span>

    @Test
    public void testPublicFinalFieldInEnum() throws Exception {
<span class="fc" id="L410">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L411">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L412">        checkConfig.addAttribute(&quot;allowPublicImmutableFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L413">        final String[] expected = {</span>
<span class="fc" id="L414">            &quot;15:23: &quot; + getCheckMessage(MSG_KEY, &quot;hole&quot;),</span>
        };
<span class="fc" id="L416">        verify(checkConfig, getPath(&quot;InputVisibilityModifiersEnumIsSealed.java&quot;), expected);</span>
<span class="fc" id="L417">    }</span>

    @Test
    public void testWrongTokenType() {
<span class="fc" id="L421">        final VisibilityModifierCheck obj = new VisibilityModifierCheck();</span>
<span class="fc" id="L422">        final DetailAstImpl ast = new DetailAstImpl();</span>
<span class="fc" id="L423">        ast.initialize(new CommonHiddenStreamToken(TokenTypes.CLASS_DEF, &quot;class&quot;));</span>
        try {
<span class="nc" id="L425">            obj.visitToken(ast);</span>
<span class="nc" id="L426">            fail(&quot;exception expected&quot;);</span>
        }
<span class="fc" id="L428">        catch (IllegalArgumentException ex) {</span>
<span class="fc" id="L429">            assertEquals(&quot;Invalid exception message&quot;,</span>
<span class="fc" id="L430">                &quot;Unexpected token type: class&quot;, ex.getMessage());</span>
<span class="nc" id="L431">        }</span>
<span class="fc" id="L432">    }</span>

    @Test
    public void testNullModifiers() throws Exception {
<span class="fc" id="L436">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L437">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L438">        checkConfig.addAttribute(&quot;allowPublicImmutableFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L439">        final String[] expected = {</span>
<span class="fc" id="L440">            &quot;11:50: &quot; + getCheckMessage(MSG_KEY, &quot;i&quot;),</span>
        };
<span class="fc" id="L442">        verify(checkConfig, getPath(&quot;InputVisibilityModifiersNullModifiers.java&quot;), expected);</span>
<span class="fc" id="L443">    }</span>

    @Test
    public void testVisibilityModifiersOfGenericFields() throws Exception {
<span class="fc" id="L447">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L448">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L449">        checkConfig.addAttribute(&quot;allowPublicImmutableFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L450">        checkConfig.addAttribute(&quot;immutableClassCanonicalNames&quot;,</span>
            &quot;com.google.common.collect.ImmutableMap,&quot;
            + &quot;java.lang.String,&quot;
            + &quot;java.util.Optional,&quot;
            + &quot;java.math.BigDecimal&quot;);
<span class="fc" id="L455">        final String[] expected = {</span>
<span class="fc" id="L456">            &quot;16:56: &quot; + getCheckMessage(MSG_KEY, &quot;perfSeries&quot;),</span>
<span class="fc" id="L457">            &quot;17:66: &quot; + getCheckMessage(MSG_KEY, &quot;peopleMap&quot;),</span>
<span class="fc" id="L458">            &quot;18:66: &quot; + getCheckMessage(MSG_KEY, &quot;someMap&quot;),</span>
<span class="fc" id="L459">            &quot;19:76: &quot; + getCheckMessage(MSG_KEY, &quot;newMap&quot;),</span>
<span class="fc" id="L460">            &quot;21:45: &quot; + getCheckMessage(MSG_KEY, &quot;optionalOfObject&quot;),</span>
<span class="fc" id="L461">            &quot;22:35: &quot; + getCheckMessage(MSG_KEY, &quot;obj&quot;),</span>
<span class="fc" id="L462">            &quot;24:19: &quot; + getCheckMessage(MSG_KEY, &quot;rqUID&quot;),</span>
<span class="fc" id="L463">            &quot;25:29: &quot; + getCheckMessage(MSG_KEY, &quot;rqTime&quot;),</span>
<span class="fc" id="L464">            &quot;26:45: &quot; + getCheckMessage(MSG_KEY, &quot;rates&quot;),</span>
<span class="fc" id="L465">            &quot;27:50: &quot; + getCheckMessage(MSG_KEY, &quot;loans&quot;),</span>
<span class="fc" id="L466">            &quot;28:60: &quot; + getCheckMessage(MSG_KEY, &quot;cards&quot;),</span>
<span class="fc" id="L467">            &quot;29:60: &quot; + getCheckMessage(MSG_KEY, &quot;values&quot;),</span>
<span class="fc" id="L468">            &quot;30:70: &quot; + getCheckMessage(MSG_KEY, &quot;permissions&quot;),</span>
<span class="fc" id="L469">            &quot;32:38: &quot; + getCheckMessage(MSG_KEY, &quot;mapOfStrings&quot;),</span>
<span class="fc" id="L470">            &quot;33:48: &quot; + getCheckMessage(MSG_KEY, &quot;names&quot;),</span>
<span class="fc" id="L471">            &quot;34:48: &quot; + getCheckMessage(MSG_KEY, &quot;links&quot;),</span>
<span class="fc" id="L472">            &quot;35:38: &quot; + getCheckMessage(MSG_KEY, &quot;presentations&quot;),</span>
<span class="fc" id="L473">            &quot;36:48: &quot; + getCheckMessage(MSG_KEY, &quot;collection&quot;),</span>
<span class="fc" id="L474">            &quot;39:73: &quot; + getCheckMessage(MSG_KEY, &quot;exceptions&quot;),</span>
        };
<span class="fc" id="L476">        verify(checkConfig, getPath(&quot;InputVisibilityModifierGenerics.java&quot;), expected);</span>
<span class="fc" id="L477">    }</span>

    /**
     * We can not cover this mutation because it force all imports to be non static,
     * but static imports are ignored, so we will not see any affect on validation.
     * We could remove this method at all, and it will work correctly as we can not use
     * class with name &quot;&quot;, but in this case internal collection will have short names
     * as &quot;&quot; that will not make problems, but will be weird in debug.
     *
     * @throws Exception when exception occurred during execution.
     */
    @Test
    public void testIsStarImportNullAst() throws Exception {
<span class="fc" id="L490">        final DetailAST importAst = JavaParser.parseFile(</span>
<span class="fc" id="L491">            new File(getPath(&quot;InputVisibilityModifierIsStarImport.java&quot;)),</span>
<span class="fc" id="L492">            JavaParser.Options.WITHOUT_COMMENTS).getNextSibling();</span>
<span class="fc" id="L493">        final VisibilityModifierCheck check = new VisibilityModifierCheck();</span>
<span class="fc" id="L494">        final Method method = Whitebox.getMethod(VisibilityModifierCheck.class,</span>
            &quot;isStarImport&quot;, DetailAST.class);

<span class="fc" id="L497">        assertTrue(&quot;Should return true when star import is passed&quot;,</span>
<span class="fc" id="L498">            (boolean) method.invoke(check, importAst));</span>
<span class="fc" id="L499">    }</span>

    @Test
    public void testPackageClassName() throws Exception {
<span class="fc" id="L503">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L504">            createModuleConfig(VisibilityModifierCheck.class);</span>
<span class="fc" id="L505">        checkConfig.addAttribute(&quot;immutableClassCanonicalNames&quot;, &quot;PackageClass&quot;);</span>
<span class="fc" id="L506">        checkConfig.addAttribute(&quot;allowPublicImmutableFields&quot;, &quot;true&quot;);</span>
<span class="fc" id="L507">        final String[] expected = {</span>
        };
<span class="fc" id="L509">        verify(checkConfig, getNonCompilablePath(&quot;InputVisibilityModifierPackageClassName.java&quot;),</span>
                expected);
<span class="fc" id="L511">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>