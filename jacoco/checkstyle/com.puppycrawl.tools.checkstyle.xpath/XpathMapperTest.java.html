<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>XpathMapperTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">checkstyle$java_in_checkstyle.exec</a> &gt; <a href="index.source.html" class="el_package">com.puppycrawl.tools.checkstyle.xpath</a> &gt; <span class="el_source">XpathMapperTest.java</span></div><h1>XpathMapperTest.java</h1><pre class="source lang-java linenums">////////////////////////////////////////////////////////////////////////////////
// checkstyle: Checks Java source code for adherence to a set of rules.
// Copyright (C) 2001-2019 the original author or authors.
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; either
// version 2.1 of the License, or (at your option) any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
// Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
////////////////////////////////////////////////////////////////////////////////

package com.puppycrawl.tools.checkstyle.xpath;

import static com.puppycrawl.tools.checkstyle.internal.utils.XpathUtil.getXpathItems;
import static org.junit.Assert.assertArrayEquals;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertNull;
import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;

import java.io.File;
import java.util.List;

import org.junit.Test;

import com.puppycrawl.tools.checkstyle.AbstractPathTestSupport;
import com.puppycrawl.tools.checkstyle.JavaParser;
import com.puppycrawl.tools.checkstyle.api.DetailAST;
import com.puppycrawl.tools.checkstyle.api.TokenTypes;
import net.sf.saxon.om.AxisInfo;
import net.sf.saxon.om.NodeInfo;
import net.sf.saxon.tree.iter.EmptyIterator;

<span class="fc" id="L43">public class XpathMapperTest extends AbstractPathTestSupport {</span>

    @Override
    protected String getPackageLocation() {
<span class="fc" id="L47">        return &quot;com/puppycrawl/tools/checkstyle/xpath/xpathmapper&quot;;</span>
    }

    @Test
    public void testFullPath() throws Exception {
<span class="fc" id="L52">        final String xpath = &quot;/CLASS_DEF/OBJBLOCK/METHOD_DEF[1]/SLIST/VARIABLE_DEF[2]&quot;;</span>
<span class="fc" id="L53">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L54">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L55">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L57">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L58">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L59">                .findFirstToken(TokenTypes.SLIST)</span>
<span class="fc" id="L60">                .findFirstToken(TokenTypes.VARIABLE_DEF)</span>
<span class="fc" id="L61">                .getNextSibling()</span>
<span class="fc" id="L62">                .getNextSibling();</span>
<span class="fc" id="L63">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L64">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L65">    }</span>

    @Test
    public void testParent() throws Exception {
<span class="fc" id="L69">        final String xpath = &quot;(//VARIABLE_DEF)[1]/..&quot;;</span>
<span class="fc" id="L70">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L71">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L72">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L74">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L75">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L76">                .findFirstToken(TokenTypes.SLIST);</span>
<span class="fc" id="L77">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L78">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L79">    }</span>

    @Test
    public void testCurlyBrackets() throws Exception {
<span class="fc" id="L83">        final String xpath = &quot;(//RCURLY)[2]&quot;;</span>
<span class="fc" id="L84">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L85">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L86">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L88">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L89">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L90">                .findFirstToken(TokenTypes.SLIST)</span>
<span class="fc" id="L91">                .findFirstToken(TokenTypes.RCURLY);</span>
<span class="fc" id="L92">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L93">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L94">    }</span>

    @Test
    public void testOr() throws Exception {
<span class="fc" id="L98">        final String xpath = &quot;//CLASS_DEF | //METHOD_DEF&quot;;</span>
<span class="fc" id="L99">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L100">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L101">        final DetailAST expectedClassDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF);
<span class="fc" id="L103">        final DetailAST expectedMethodDefNode1 = expectedClassDefNode</span>
<span class="fc" id="L104">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L105">                .findFirstToken(TokenTypes.METHOD_DEF);</span>
<span class="fc" id="L106">        final DetailAST expectedMethodDefNode2 = expectedMethodDefNode1.getNextSibling();</span>
<span class="fc" id="L107">        final DetailAST[] expected = {expectedClassDefNode, expectedMethodDefNode1,</span>
            expectedMethodDefNode2};
<span class="fc" id="L109">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L110">    }</span>

    @Test
    public void testComplexQueryOne() throws Exception {
<span class="fc" id="L114">        final String xpath = &quot;/CLASS_DEF | /CLASS_DEF/OBJBLOCK&quot;;</span>
<span class="fc" id="L115">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L116">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L117">        final DetailAST expectedClassDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF);
<span class="fc" id="L119">        final DetailAST expectedObjblockNode = expectedClassDefNode</span>
<span class="fc" id="L120">                .findFirstToken(TokenTypes.OBJBLOCK);</span>
<span class="fc" id="L121">        final DetailAST[] expected = {expectedClassDefNode, expectedObjblockNode};</span>
<span class="fc" id="L122">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L123">    }</span>

    @Test
    public void testComplexQueryTwo() throws Exception {
<span class="fc" id="L127">        final String xpath = &quot;/PACKAGE_DEF | /PACKAGE_DEF/ANNOTATIONS&quot;;</span>
<span class="fc" id="L128">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAnnotation.java&quot;);</span>
<span class="fc" id="L129">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L130">        final DetailAST expectedPackageDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.PACKAGE_DEF);
<span class="fc" id="L132">        final DetailAST expectedAnnotationsNode = expectedPackageDefNode</span>
<span class="fc" id="L133">                .findFirstToken(TokenTypes.ANNOTATIONS);</span>
<span class="fc" id="L134">        final DetailAST[] expected = {expectedAnnotationsNode, expectedPackageDefNode};</span>
<span class="fc" id="L135">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L136">    }</span>

    @Test
    public void testComplexQueryThree() throws Exception {
<span class="fc" id="L140">        final String xpath = &quot;//CLASS_DEF | //CLASS_DEF//METHOD_DEF | /CLASS_DEF/OBJBLOCK&quot;;</span>
<span class="fc" id="L141">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L142">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L143">        final DetailAST expectedClassDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF);
<span class="fc" id="L145">        final DetailAST expectedObjblockNode = expectedClassDefNode</span>
<span class="fc" id="L146">                .findFirstToken(TokenTypes.OBJBLOCK);</span>
<span class="fc" id="L147">        final DetailAST expectedMethodDefNode = expectedObjblockNode</span>
<span class="fc" id="L148">                .findFirstToken(TokenTypes.METHOD_DEF);</span>
<span class="fc" id="L149">        final DetailAST expectedMethodDefNode2 = expectedObjblockNode</span>
<span class="fc" id="L150">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L151">                .getNextSibling();</span>
<span class="fc" id="L152">        final DetailAST[] expected = {expectedClassDefNode, expectedMethodDefNode,</span>
            expectedMethodDefNode2, expectedObjblockNode};
<span class="fc" id="L154">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L155">    }</span>

    @Test
    public void testAttributeOr() throws Exception {
<span class="fc" id="L159">        final String xpath = &quot;//METHOD_DEF[./IDENT[@text='getSomeMethod'] &quot;</span>
                + &quot;or ./IDENT[@text='nonExistentMethod']]&quot;;
<span class="fc" id="L161">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L162">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L163">        final DetailAST expectedClassDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF);
<span class="fc" id="L165">        final DetailAST expectedMethodDefNode = expectedClassDefNode</span>
<span class="fc" id="L166">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L167">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L168">                .getNextSibling();</span>
<span class="fc" id="L169">        final DetailAST[] expected = {expectedMethodDefNode};</span>
<span class="fc" id="L170">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L171">    }</span>

    @Test
    public void testAttributeAnd() throws Exception {
<span class="fc" id="L175">        final String xpath = &quot;//METHOD_DEF[./IDENT[@text='callSomeMethod'] and &quot;</span>
                + &quot;../..[./IDENT[@text='InputXpathMapperAst']]]&quot;;
<span class="fc" id="L177">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L178">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L179">        final DetailAST expectedClassDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF);
<span class="fc" id="L181">        final DetailAST expectedMethodDefNode = expectedClassDefNode</span>
<span class="fc" id="L182">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L183">                .findFirstToken(TokenTypes.METHOD_DEF);</span>
<span class="fc" id="L184">        final DetailAST[] expected = {expectedMethodDefNode};</span>
<span class="fc" id="L185">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L186">    }</span>

    @Test
    public void testQueryAllElementsWithAttribute() throws Exception {
<span class="fc" id="L190">        final String xpath = &quot;//*[./IDENT[@text]]&quot;;</span>
<span class="fc" id="L191">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L192">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L193">        assertEquals(&quot;Invalid number of nodes&quot;, 18, nodes.size());</span>
<span class="fc" id="L194">    }</span>

    @Test
    public void testQueryElementByIndex() throws Exception {
<span class="fc" id="L198">        final String xpath = &quot;(//VARIABLE_DEF)[1]&quot;;</span>
<span class="fc" id="L199">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L200">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L201">        assertEquals(&quot;Invalid number of nodes&quot;, 1, actual.length);</span>
<span class="fc" id="L202">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L204">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L205">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L206">                .findFirstToken(TokenTypes.SLIST)</span>
<span class="fc" id="L207">                .findFirstToken(TokenTypes.VARIABLE_DEF);</span>
<span class="fc" id="L208">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L209">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L210">    }</span>

    @Test
    public void testQueryAllVariableDefinitionsWithAttribute() throws Exception {
<span class="fc" id="L214">        final String xpath = &quot;//VARIABLE_DEF[./IDENT[@*]]&quot;;</span>
<span class="fc" id="L215">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L216">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L217">        assertEquals(&quot;Invalid number of nodes&quot;, 4, nodes.size());</span>
<span class="fc" id="L218">    }</span>

    @Test
    public void testQueryAllVariableDefWrongAttribute() throws Exception {
<span class="fc" id="L222">        final String xpath = &quot;//VARIABLE_DEF[@qwe]&quot;;</span>
<span class="fc" id="L223">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L224">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L225">        assertEquals(&quot;Invalid number of nodes&quot;, 0, nodes.size());</span>
<span class="fc" id="L226">    }</span>

    @Test
    public void testQueryAllMethodDefinitionsInContext() throws Exception {
<span class="fc" id="L230">        final String objectXpath = &quot;/CLASS_DEF[./IDENT[@text='InputXpathMapperAst']]//OBJBLOCK&quot;;</span>
<span class="fc" id="L231">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L232">        final List&lt;NodeInfo&gt; objectNodes = getXpathItems(objectXpath, rootNode);</span>
<span class="fc" id="L233">        assertEquals(&quot;Invalid number of nodes&quot;, 1, objectNodes.size());</span>
<span class="fc" id="L234">        final AbstractNode objNode = (AbstractNode) objectNodes.get(0);</span>
<span class="fc" id="L235">        final String methodsXpath = &quot;METHOD_DEF&quot;;</span>
<span class="fc" id="L236">        final List&lt;NodeInfo&gt; methodsNodes = getXpathItems(methodsXpath, objNode);</span>
<span class="fc" id="L237">        assertEquals(&quot;Invalid number of nodes&quot;, 2, methodsNodes.size());</span>
<span class="fc" id="L238">        final DetailAST[] actual = convertToArray(methodsNodes);</span>
<span class="fc" id="L239">        final DetailAST expectedMethodDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L241">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L242">                .findFirstToken(TokenTypes.METHOD_DEF);</span>
<span class="fc" id="L243">        final DetailAST[] expected = {expectedMethodDefNode,</span>
<span class="fc" id="L244">            expectedMethodDefNode.getNextSibling()};</span>
<span class="fc" id="L245">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L246">    }</span>

    @Test
    public void testQueryAllClassDefinitions() throws Exception {
<span class="fc" id="L250">        final String xpath = &quot;CLASS_DEF&quot;;</span>
<span class="fc" id="L251">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L252">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L253">        assertEquals(&quot;Invalid number of nodes&quot;, 1, nodes.size());</span>
<span class="fc" id="L254">        final AbstractNode classDefNode = (AbstractNode) nodes.get(0);</span>
<span class="fc" id="L255">        assertEquals(&quot;Invalid number of nodes&quot;, 3, classDefNode.getLineNumber());</span>
<span class="fc" id="L256">        assertEquals(&quot;Invalid number of nodes&quot;, 0, classDefNode.getColumnNumber());</span>
<span class="fc" id="L257">        final DetailAST[] actual = convertToArray(nodes);</span>
<span class="fc" id="L258">        final DetailAST expectedClassDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF);
<span class="fc" id="L260">        final DetailAST[] expected = {expectedClassDefNode};</span>
<span class="fc" id="L261">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L262">    }</span>

    @Test
    public void testQueryByMethodName() throws Exception {
<span class="fc" id="L266">        final String xpath = &quot;//METHOD_DEF[./IDENT[@text='getSomeMethod']]&quot;;</span>
<span class="fc" id="L267">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L268">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L269">        final DetailAST expectedMethodDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L271">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L272">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L273">                .getNextSibling();</span>
<span class="fc" id="L274">        final DetailAST[] expected = {expectedMethodDefNode};</span>
<span class="fc" id="L275">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L276">    }</span>

    @Test
    public void testQueryMethodDefinitionsByClassName() throws Exception {
<span class="fc" id="L280">        final String xpath = &quot;/CLASS_DEF[./IDENT[@text='InputXpathMapperAst']]&quot;</span>
                + &quot;//OBJBLOCK//METHOD_DEF&quot;;
<span class="fc" id="L282">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L283">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L284">        final DetailAST expectedMethodDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L286">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L287">                .findFirstToken(TokenTypes.METHOD_DEF);</span>
<span class="fc" id="L288">        final DetailAST[] expected = {expectedMethodDefNode,</span>
<span class="fc" id="L289">            expectedMethodDefNode.getNextSibling()};</span>
<span class="fc" id="L290">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L291">    }</span>

    @Test
    public void testQueryByClassNameAndMethodName() throws Exception {
<span class="fc" id="L295">        final String xpath = &quot;/CLASS_DEF[./IDENT[@text='InputXpathMapperAst']]//OBJBLOCK&quot;</span>
                + &quot;//METHOD_DEF[./IDENT[@text='getSomeMethod']]&quot;;
<span class="fc" id="L297">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L298">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L299">        final DetailAST expectedMethodDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L301">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L302">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L303">                .getNextSibling();</span>
<span class="fc" id="L304">        final DetailAST[] expected = {expectedMethodDefNode};</span>
<span class="fc" id="L305">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L306">    }</span>

    @Test
    public void testQueryClassDefinitionByClassName() throws Exception {
<span class="fc" id="L310">        final String xpath = &quot;/CLASS_DEF[./IDENT[@text='InputXpathMapperAst']]&quot;;</span>
<span class="fc" id="L311">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L312">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L313">        final DetailAST[] actual = convertToArray(nodes);</span>
<span class="fc" id="L314">        final DetailAST expectedClassDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF);
<span class="fc" id="L316">        final DetailAST[] expected = {expectedClassDefNode};</span>
<span class="fc" id="L317">        final ElementNode classDefNode = (ElementNode) nodes.get(0);</span>
<span class="fc" id="L318">        assertEquals(&quot;Invalid number of nodes&quot;, &quot;CLASS_DEF&quot;, classDefNode.getStringValue());</span>
<span class="fc" id="L319">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L320">    }</span>

    @Test
    public void testQueryWrongClassName() throws Exception {
<span class="fc" id="L324">        final String xpath = &quot;/CLASS_DEF[@text='WrongName']&quot;;</span>
<span class="fc" id="L325">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L326">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L327">        assertTrue(&quot;Should return true, because no item matches xpath&quot;, nodes.isEmpty());</span>
<span class="fc" id="L328">    }</span>

    @Test
    public void testQueryWrongXpath() throws Exception {
<span class="fc" id="L332">        final String xpath = &quot;/WRONG_XPATH&quot;;</span>
<span class="fc" id="L333">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L334">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L335">        assertTrue(&quot;Should return true, because no item matches xpath&quot;, nodes.isEmpty());</span>
<span class="fc" id="L336">    }</span>

    @Test
    public void testQueryAncestor() throws Exception {
<span class="fc" id="L340">        final String xpath = &quot;//VARIABLE_DEF[./IDENT[@text='another']]/ancestor::METHOD_DEF&quot;;</span>
<span class="fc" id="L341">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L342">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L343">        final DetailAST expectedMethodDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L345">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L346">                .findFirstToken(TokenTypes.METHOD_DEF);</span>
<span class="fc" id="L347">        final DetailAST[] expected = {expectedMethodDefNode};</span>
<span class="fc" id="L348">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L349">    }</span>

    @Test
    public void testQueryAncestorOrSelf() throws Exception {
<span class="fc" id="L353">        final String xpath = &quot;//VARIABLE_DEF[./IDENT[@text='another']]&quot;</span>
                + &quot;/ancestor-or-self::VARIABLE_DEF&quot;;
<span class="fc" id="L355">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L356">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L357">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L359">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L360">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L361">                .findFirstToken(TokenTypes.SLIST)</span>
<span class="fc" id="L362">                .findFirstToken(TokenTypes.VARIABLE_DEF)</span>
<span class="fc" id="L363">                .getNextSibling()</span>
<span class="fc" id="L364">                .getNextSibling();</span>
<span class="fc" id="L365">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L366">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L367">    }</span>

    @Test
    public void testQueryDescendant() throws Exception {
<span class="fc" id="L371">        final String xpath = &quot;//METHOD_DEF/descendant::EXPR&quot;;</span>
<span class="fc" id="L372">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L373">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L374">        assertEquals(&quot;Invalid number of nodes&quot;, 6, nodes.size());</span>
<span class="fc" id="L375">    }</span>

    @Test
    public void testQueryDescendantOrSelf() throws Exception {
<span class="fc" id="L379">        final String xpath = &quot;//METHOD_DEF/descendant-or-self::METHOD_DEF&quot;;</span>
<span class="fc" id="L380">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L381">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L382">        final DetailAST expectedMethodDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L384">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L385">                .findFirstToken(TokenTypes.METHOD_DEF);</span>
<span class="fc" id="L386">        final DetailAST[] expected = {expectedMethodDefNode,</span>
<span class="fc" id="L387">            expectedMethodDefNode.getNextSibling()};</span>
<span class="fc" id="L388">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L389">    }</span>

    @Test
    public void testQueryNoChild() throws Exception {
<span class="fc" id="L393">        final String xpath = &quot;//RCURLY/METHOD_DEF&quot;;</span>
<span class="fc" id="L394">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L395">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L396">        assertTrue(&quot;Should return true, because no item matches xpath&quot;, nodes.isEmpty());</span>
<span class="fc" id="L397">    }</span>

    @Test
    public void testQueryNoDescendant() throws Exception {
<span class="fc" id="L401">        final String xpath = &quot;//RCURLY/descendant::METHOD_DEF&quot;;</span>
<span class="fc" id="L402">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L403">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L404">        assertTrue(&quot;Should return true, because no item matches xpath&quot;, nodes.isEmpty());</span>
<span class="fc" id="L405">    }</span>

    @Test
    public void testQueryRootNotImplementedAxis() throws Exception {
<span class="fc" id="L409">        final String xpath = &quot;//following-sibling::METHOD_DEF&quot;;</span>
<span class="fc" id="L410">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
        try {
<span class="nc" id="L412">            getXpathItems(xpath, rootNode);</span>
<span class="nc" id="L413">            fail(&quot;Exception is excepted&quot;);</span>
        }
<span class="fc" id="L415">        catch (UnsupportedOperationException ex) {</span>
<span class="fc" id="L416">            assertEquals(&quot;Invalid number of nodes&quot;, &quot;Operation is not supported&quot;, ex.getMessage());</span>
<span class="nc" id="L417">        }</span>
<span class="fc" id="L418">    }</span>

    @Test
    public void testQueryElementNotImplementedAxis() throws Exception {
<span class="fc" id="L422">        final String xpath = &quot;/CLASS_DEF//following-sibling::METHOD_DEF&quot;;</span>
<span class="fc" id="L423">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
        try {
<span class="nc" id="L425">            getXpathItems(xpath, rootNode);</span>
<span class="nc" id="L426">            fail(&quot;Exception is excepted&quot;);</span>
        }
<span class="fc" id="L428">        catch (UnsupportedOperationException ex) {</span>
<span class="fc" id="L429">            assertEquals(&quot;Invalid number of nodes&quot;, &quot;Operation is not supported&quot;, ex.getMessage());</span>
<span class="nc" id="L430">        }</span>
<span class="fc" id="L431">    }</span>

    @Test
    public void testQuerySelf() throws Exception {
<span class="fc" id="L435">        final String objectXpath = &quot;/CLASS_DEF[./IDENT[@text='InputXpathMapperAst']]//OBJBLOCK&quot;;</span>
<span class="fc" id="L436">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L437">        final List&lt;NodeInfo&gt; objectNodes = getXpathItems(objectXpath, rootNode);</span>
<span class="fc" id="L438">        assertEquals(&quot;Invalid number of nodes&quot;, 1, objectNodes.size());</span>
<span class="fc" id="L439">        final AbstractNode objNode = (AbstractNode) objectNodes.get(0);</span>
<span class="fc" id="L440">        final String methodsXpath = &quot;self::OBJBLOCK&quot;;</span>
<span class="fc" id="L441">        final DetailAST[] actual = convertToArray(getXpathItems(methodsXpath, objNode));</span>
<span class="fc" id="L442">        final DetailAST expectedObjBlockNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L444">                .findFirstToken(TokenTypes.OBJBLOCK);</span>
<span class="fc" id="L445">        final DetailAST[] expected = {expectedObjBlockNode};</span>
<span class="fc" id="L446">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L447">    }</span>

    @Test
    public void testRootWithNullDetailAst() {
<span class="fc" id="L451">        final RootNode emptyRootNode = new RootNode(null);</span>
<span class="fc" id="L452">        assertFalse(&quot;Empty node should not have children&quot;, emptyRootNode.hasChildNodes());</span>
<span class="fc" id="L453">        assertEquals(&quot;Invalid number of nodes&quot;, EmptyIterator.OfNodes.THE_INSTANCE,</span>
<span class="fc" id="L454">                emptyRootNode.iterateAxis(</span>
                AxisInfo.DESCENDANT));
<span class="fc" id="L456">        assertEquals(&quot;Invalid number of nodes&quot;, EmptyIterator.OfNodes.THE_INSTANCE,</span>
<span class="fc" id="L457">                emptyRootNode.iterateAxis(AxisInfo.CHILD));</span>
<span class="fc" id="L458">    }</span>

    @Test
    public void testQueryNonExistentAttribute() throws Exception {
<span class="fc" id="L462">        final String xpath = &quot;/CLASS_DEF[./IDENT[@text='InputXpathMapperAst']]&quot;;</span>
<span class="fc" id="L463">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L464">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L465">        final ElementNode classDefNode = (ElementNode) nodes.get(0);</span>
<span class="fc" id="L466">        assertNull(&quot;Not existing attribute should have null value&quot;,</span>
<span class="fc" id="L467">                classDefNode.getAttributeValue(&quot;&quot;, &quot;noneExistingAttribute&quot;));</span>
<span class="fc" id="L468">    }</span>

    @Test
    public void testQueryRootSelf() throws Exception {
<span class="fc" id="L472">        final String xpath = &quot;self::node()&quot;;</span>
<span class="fc" id="L473">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L474">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L475">        assertEquals(&quot;Invalid number of nodes&quot;, 1, nodes.size());</span>
<span class="fc" id="L476">    }</span>

    @Test
    public void testQueryAnnotation() throws Exception {
<span class="fc" id="L480">        final String xpath = &quot;//ANNOTATION[./IDENT[@text='Deprecated']]&quot;;</span>
<span class="fc" id="L481">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAnnotation.java&quot;);</span>
<span class="fc" id="L482">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L483">        final DetailAST expectedAnnotationNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L485">                .findFirstToken(TokenTypes.MODIFIERS)</span>
<span class="fc" id="L486">                .findFirstToken(TokenTypes.ANNOTATION);</span>
<span class="fc" id="L487">        final DetailAST[] expected = {expectedAnnotationNode};</span>
<span class="fc" id="L488">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L489">    }</span>

    @Test
    public void testQueryNonExistentAnnotation() throws Exception {
<span class="fc" id="L493">        final String xpath = &quot;//ANNOTATION[@text='SpringBootApplication']&quot;;</span>
<span class="fc" id="L494">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAnnotation.java&quot;);</span>
<span class="fc" id="L495">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L496">        assertEquals(&quot;Invalid number of nodes&quot;, 0, nodes.size());</span>
<span class="fc" id="L497">    }</span>

    @Test
    public void testQueryEnumDef() throws Exception {
<span class="fc" id="L501">        final String xpath = &quot;/ENUM_DEF&quot;;</span>
<span class="fc" id="L502">        final RootNode enumRootNode = getRootNode(&quot;InputXpathMapperEnum.java&quot;);</span>
<span class="fc" id="L503">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, enumRootNode));</span>
<span class="fc" id="L504">        final DetailAST expectedEnumDefNode = getSiblingByType(enumRootNode.getUnderlyingNode(),</span>
                TokenTypes.ENUM_DEF);
<span class="fc" id="L506">        final DetailAST[] expected = {expectedEnumDefNode};</span>
<span class="fc" id="L507">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L508">    }</span>

    @Test
    public void testQueryEnumElementsNumber() throws Exception {
<span class="fc" id="L512">        final String xpath = &quot;/ENUM_DEF/OBJBLOCK/ENUM_CONSTANT_DEF&quot;;</span>
<span class="fc" id="L513">        final RootNode enumRootNode = getRootNode(&quot;InputXpathMapperEnum.java&quot;);</span>
<span class="fc" id="L514">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, enumRootNode);</span>
<span class="fc" id="L515">        assertEquals(&quot;Invalid number of nodes&quot;, 3, nodes.size());</span>
<span class="fc" id="L516">    }</span>

    @Test
    public void testQueryEnumElementByName() throws Exception {
<span class="fc" id="L520">        final String xpath = &quot;//*[./IDENT[@text='TWO']]&quot;;</span>
<span class="fc" id="L521">        final RootNode enumRootNode = getRootNode(&quot;InputXpathMapperEnum.java&quot;);</span>
<span class="fc" id="L522">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, enumRootNode));</span>
<span class="fc" id="L523">        final DetailAST expectedEnumConstantDefNode = getSiblingByType(</span>
<span class="fc" id="L524">                enumRootNode.getUnderlyingNode(),</span>
                TokenTypes.ENUM_DEF)
<span class="fc" id="L526">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L527">                .findFirstToken(TokenTypes.ENUM_CONSTANT_DEF)</span>
<span class="fc" id="L528">                .getNextSibling()</span>
<span class="fc" id="L529">                .getNextSibling();</span>
<span class="fc" id="L530">        final DetailAST[] expected = {expectedEnumConstantDefNode};</span>
<span class="fc" id="L531">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L532">    }</span>

    @Test
    public void testQueryInterfaceDef() throws Exception {
<span class="fc" id="L536">        final String xpath = &quot;/INTERFACE_DEF&quot;;</span>
<span class="fc" id="L537">        final RootNode interfaceRootNode = getRootNode(&quot;InputXpathMapperInterface.java&quot;);</span>
<span class="fc" id="L538">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, interfaceRootNode));</span>
<span class="fc" id="L539">        final DetailAST expectedInterfaceDefNode = getSiblingByType(</span>
<span class="fc" id="L540">                interfaceRootNode.getUnderlyingNode(),</span>
                TokenTypes.INTERFACE_DEF);
<span class="fc" id="L542">        final DetailAST[] expected = {expectedInterfaceDefNode};</span>
<span class="fc" id="L543">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L544">    }</span>

    @Test
    public void testQueryInterfaceMethodDefNumber() throws Exception {
<span class="fc" id="L548">        final String xpath = &quot;/INTERFACE_DEF/OBJBLOCK/METHOD_DEF&quot;;</span>
<span class="fc" id="L549">        final RootNode interfaceRootNode = getRootNode(&quot;InputXpathMapperInterface.java&quot;);</span>
<span class="fc" id="L550">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, interfaceRootNode);</span>
<span class="fc" id="L551">        assertEquals(&quot;Invalid number of nodes&quot;, 4, nodes.size());</span>
<span class="fc" id="L552">    }</span>

    @Test
    public void testQueryInterfaceParameterDef() throws Exception {
<span class="fc" id="L556">        final String xpath = &quot;//PARAMETER_DEF[./IDENT[@text='someVariable']]/../..&quot;;</span>
<span class="fc" id="L557">        final RootNode interfaceRootNode = getRootNode(&quot;InputXpathMapperInterface.java&quot;);</span>
<span class="fc" id="L558">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, interfaceRootNode));</span>
<span class="fc" id="L559">        final DetailAST expectedMethodDefNode = getSiblingByType(</span>
<span class="fc" id="L560">                interfaceRootNode.getUnderlyingNode(),</span>
                TokenTypes.INTERFACE_DEF)
<span class="fc" id="L562">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L563">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L564">                .getNextSibling();</span>
<span class="fc" id="L565">        final DetailAST[] expected = {expectedMethodDefNode};</span>
<span class="fc" id="L566">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L567">    }</span>

    @Test
    public void testIdent() throws Exception {
<span class="fc" id="L571">        final String xpath = &quot;/CLASS_DEF/IDENT[@text='InputXpathMapperAst']&quot;;</span>
<span class="fc" id="L572">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L573">        final List&lt;NodeInfo&gt; nodes = getXpathItems(xpath, rootNode);</span>
<span class="fc" id="L574">        final DetailAST[] actual = convertToArray(nodes);</span>
<span class="fc" id="L575">        final DetailAST expectedIdentNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L577">                .findFirstToken(TokenTypes.IDENT);</span>

<span class="fc" id="L579">        final DetailAST[] expected = {expectedIdentNode};</span>
<span class="fc" id="L580">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L581">    }</span>

    @Test
    public void testIdentByText() throws Exception {
<span class="fc" id="L585">        final String xpath = &quot;//IDENT[@text='puppycrawl']&quot;;</span>
<span class="fc" id="L586">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L587">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L588">        final DetailAST expectedMethodDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.PACKAGE_DEF)
<span class="fc" id="L590">                .findFirstToken(TokenTypes.DOT)</span>
<span class="fc" id="L591">                .findFirstToken(TokenTypes.DOT)</span>
<span class="fc" id="L592">                .findFirstToken(TokenTypes.DOT)</span>
<span class="fc" id="L593">                .findFirstToken(TokenTypes.DOT)</span>
<span class="fc" id="L594">                .findFirstToken(TokenTypes.DOT)</span>
<span class="fc" id="L595">                .findFirstToken(TokenTypes.IDENT)</span>
<span class="fc" id="L596">                .getNextSibling();</span>
<span class="fc" id="L597">        final DetailAST[] expected = {expectedMethodDefNode};</span>
<span class="fc" id="L598">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L599">    }</span>

    @Test
    public void testNumVariableByItsValue() throws Exception {
<span class="fc" id="L603">        final String xpath = &quot;//VARIABLE_DEF[.//NUM_INT[@text=123]]&quot;;</span>
<span class="fc" id="L604">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L605">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L606">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L608">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L609">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L610">                .findFirstToken(TokenTypes.SLIST)</span>
<span class="fc" id="L611">                .findFirstToken(TokenTypes.VARIABLE_DEF);</span>
<span class="fc" id="L612">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L613">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L614">    }</span>

    @Test
    public void testStringVariableByItsValue() throws Exception {
<span class="fc" id="L618">        final String xpath = &quot;//VARIABLE_DEF[./ASSIGN/EXPR&quot;</span>
                + &quot;/STRING_LITERAL[@text='HelloWorld']]&quot;;
<span class="fc" id="L620">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L621">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L622">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L624">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L625">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L626">                .findFirstToken(TokenTypes.SLIST)</span>
<span class="fc" id="L627">                .findFirstToken(TokenTypes.VARIABLE_DEF)</span>
<span class="fc" id="L628">                .getNextSibling()</span>
<span class="fc" id="L629">                .getNextSibling();</span>
<span class="fc" id="L630">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L631">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L632">    }</span>

    @Test
    public void testSameNodesByNameAndByText() throws Exception {
<span class="fc" id="L636">        final String xpath1 = &quot;//VARIABLE_DEF[./IDENT[@text='another']]/ASSIGN/EXPR/STRING_LITERAL&quot;;</span>
<span class="fc" id="L637">        final String xpath2 = &quot;//VARIABLE_DEF/ASSIGN/EXPR/STRING_LITERAL[@text='HelloWorld']&quot;;</span>
<span class="fc" id="L638">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAst.java&quot;);</span>
<span class="fc" id="L639">        final DetailAST[] actual1 = convertToArray(getXpathItems(xpath1, rootNode));</span>
<span class="fc" id="L640">        final DetailAST[] actual2 = convertToArray(getXpathItems(xpath2, rootNode));</span>
<span class="fc" id="L641">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, actual1, actual2);</span>
<span class="fc" id="L642">    }</span>

    @Test
    public void testMethodDefByAnnotationValue() throws Exception {
<span class="fc" id="L646">        final String xpath = &quot;//METHOD_DEF[.//ANNOTATION[./IDENT[@text='SuppressWarnings']&quot;</span>
                + &quot; and .//*[@text='good']]]&quot;;
<span class="fc" id="L648">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperAnnotation.java&quot;);</span>
<span class="fc" id="L649">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L650">        final DetailAST expectedAnnotationNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L652">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L653">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L654">                .getNextSibling();</span>
<span class="fc" id="L655">        final DetailAST[] expected = {expectedAnnotationNode};</span>
<span class="fc" id="L656">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L657">    }</span>

    @Test
    public void testFirstImport() throws Exception {
<span class="fc" id="L661">        final String xpath = &quot;/IMPORT[1]&quot;;</span>
<span class="fc" id="L662">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperPositions.java&quot;);</span>
<span class="fc" id="L663">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L664">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.IMPORT);
<span class="fc" id="L666">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L667">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L668">    }</span>

    @Test
    public void testSecondImport() throws Exception {
<span class="fc" id="L672">        final String xpath = &quot;/IMPORT[2]&quot;;</span>
<span class="fc" id="L673">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperPositions.java&quot;);</span>
<span class="fc" id="L674">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L675">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
<span class="fc" id="L676">                TokenTypes.IMPORT).getNextSibling();</span>
<span class="fc" id="L677">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L678">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L679">    }</span>

    @Test
    public void testThirdImport() throws Exception {
<span class="fc" id="L683">        final String xpath = &quot;/IMPORT[3]&quot;;</span>
<span class="fc" id="L684">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperPositions.java&quot;);</span>
<span class="fc" id="L685">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L686">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
<span class="fc" id="L687">                TokenTypes.IMPORT).getNextSibling().getNextSibling();</span>
<span class="fc" id="L688">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L689">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L690">    }</span>

    @Test
    public void testLastImport() throws Exception {
<span class="fc" id="L694">        final String xpath = &quot;/IMPORT[9]&quot;;</span>
<span class="fc" id="L695">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperPositions.java&quot;);</span>
<span class="fc" id="L696">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L697">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.IMPORT)
<span class="fc" id="L699">                .getNextSibling()</span>
<span class="fc" id="L700">                .getNextSibling()</span>
<span class="fc" id="L701">                .getNextSibling()</span>
<span class="fc" id="L702">                .getNextSibling()</span>
<span class="fc" id="L703">                .getNextSibling()</span>
<span class="fc" id="L704">                .getNextSibling()</span>
<span class="fc" id="L705">                .getNextSibling()</span>
<span class="fc" id="L706">                .getNextSibling();</span>
<span class="fc" id="L707">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L708">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L709">    }</span>

    @Test
    public void testFirstCaseGroup() throws Exception {
<span class="fc" id="L713">        final String xpath = &quot;/CLASS_DEF[./IDENT[@text='InputXpathMapperPositions']]&quot;</span>
                + &quot;/OBJBLOCK/METHOD_DEF[./IDENT[@text='switchMethod']]&quot;
                + &quot;/SLIST/LITERAL_SWITCH/CASE_GROUP[1]&quot;;
<span class="fc" id="L716">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperPositions.java&quot;);</span>
<span class="fc" id="L717">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L718">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L720">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L721">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L722">                .findFirstToken(TokenTypes.SLIST)</span>
<span class="fc" id="L723">                .findFirstToken(TokenTypes.LITERAL_SWITCH)</span>
<span class="fc" id="L724">                .findFirstToken(TokenTypes.CASE_GROUP);</span>
<span class="fc" id="L725">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L726">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L727">    }</span>

    @Test
    public void testSecondCaseGroup() throws Exception {
<span class="fc" id="L731">        final String xpath = &quot;/CLASS_DEF[./IDENT[@text='InputXpathMapperPositions']]&quot;</span>
                + &quot;/OBJBLOCK/METHOD_DEF[./IDENT[@text='switchMethod']]&quot;
                + &quot;/SLIST/LITERAL_SWITCH/CASE_GROUP[2]&quot;;
<span class="fc" id="L734">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperPositions.java&quot;);</span>
<span class="fc" id="L735">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L736">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L738">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L739">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L740">                .findFirstToken(TokenTypes.SLIST)</span>
<span class="fc" id="L741">                .findFirstToken(TokenTypes.LITERAL_SWITCH)</span>
<span class="fc" id="L742">                .findFirstToken(TokenTypes.CASE_GROUP)</span>
<span class="fc" id="L743">                .getNextSibling();</span>
<span class="fc" id="L744">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L745">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L746">    }</span>

    @Test
    public void testThirdCaseGroup() throws Exception {
<span class="fc" id="L750">        final String xpath = &quot;/CLASS_DEF[./IDENT[@text='InputXpathMapperPositions']]&quot;</span>
                + &quot;/OBJBLOCK/METHOD_DEF[./IDENT[@text='switchMethod']]&quot;
                + &quot;/SLIST/LITERAL_SWITCH/CASE_GROUP[3]&quot;;
<span class="fc" id="L753">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperPositions.java&quot;);</span>
<span class="fc" id="L754">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L755">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L757">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L758">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L759">                .findFirstToken(TokenTypes.SLIST)</span>
<span class="fc" id="L760">                .findFirstToken(TokenTypes.LITERAL_SWITCH)</span>
<span class="fc" id="L761">                .findFirstToken(TokenTypes.CASE_GROUP)</span>
<span class="fc" id="L762">                .getNextSibling()</span>
<span class="fc" id="L763">                .getNextSibling();</span>
<span class="fc" id="L764">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L765">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L766">    }</span>

    @Test
    public void testFourthCaseGroup() throws Exception {
<span class="fc" id="L770">        final String xpath = &quot;/CLASS_DEF[./IDENT[@text='InputXpathMapperPositions']]&quot;</span>
                + &quot;/OBJBLOCK/METHOD_DEF[./IDENT[@text='switchMethod']]&quot;
                + &quot;/SLIST/LITERAL_SWITCH/CASE_GROUP[4]&quot;;
<span class="fc" id="L773">        final RootNode rootNode = getRootNode(&quot;InputXpathMapperPositions.java&quot;);</span>
<span class="fc" id="L774">        final DetailAST[] actual = convertToArray(getXpathItems(xpath, rootNode));</span>
<span class="fc" id="L775">        final DetailAST expectedVariableDefNode = getSiblingByType(rootNode.getUnderlyingNode(),</span>
                TokenTypes.CLASS_DEF)
<span class="fc" id="L777">                .findFirstToken(TokenTypes.OBJBLOCK)</span>
<span class="fc" id="L778">                .findFirstToken(TokenTypes.METHOD_DEF)</span>
<span class="fc" id="L779">                .findFirstToken(TokenTypes.SLIST)</span>
<span class="fc" id="L780">                .findFirstToken(TokenTypes.LITERAL_SWITCH)</span>
<span class="fc" id="L781">                .findFirstToken(TokenTypes.CASE_GROUP)</span>
<span class="fc" id="L782">                .getNextSibling()</span>
<span class="fc" id="L783">                .getNextSibling()</span>
<span class="fc" id="L784">                .getNextSibling();</span>
<span class="fc" id="L785">        final DetailAST[] expected = {expectedVariableDefNode};</span>
<span class="fc" id="L786">        assertArrayEquals(&quot;Result nodes differ from expected&quot;, expected, actual);</span>
<span class="fc" id="L787">    }</span>

    private RootNode getRootNode(String fileName) throws Exception {
<span class="fc" id="L790">        final File file = new File(getPath(fileName));</span>
<span class="fc" id="L791">        final DetailAST rootAst = JavaParser.parseFile(file, JavaParser.Options.WITHOUT_COMMENTS);</span>
<span class="fc" id="L792">        return new RootNode(rootAst);</span>
    }

    private static DetailAST[] convertToArray(List&lt;NodeInfo&gt; nodes) {
<span class="fc" id="L796">        final DetailAST[] result = new DetailAST[nodes.size()];</span>
<span class="fc bfc" id="L797" title="All 2 branches covered.">        for (int i = 0; i &lt; nodes.size(); i++) {</span>
<span class="fc" id="L798">            final AbstractNode abstractNode = (AbstractNode) nodes.get(i);</span>
<span class="fc" id="L799">            result[i] = abstractNode.getUnderlyingNode();</span>
        }
<span class="fc" id="L801">        return result;</span>
    }

    private static DetailAST getSiblingByType(DetailAST node, int type) {
<span class="fc" id="L805">        DetailAST returnValue = null;</span>
<span class="pc bpc" id="L806" title="1 of 2 branches missed.">        for (DetailAST ast = node; ast != null; ast = ast.getNextSibling()) {</span>
<span class="fc bfc" id="L807" title="All 2 branches covered.">            if (ast.getType() == type) {</span>
<span class="fc" id="L808">                returnValue = ast;</span>
<span class="fc" id="L809">                break;</span>
            }
        }
<span class="fc" id="L812">        return returnValue;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>