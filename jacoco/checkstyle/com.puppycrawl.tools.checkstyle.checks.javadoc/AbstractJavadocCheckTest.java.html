<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractJavadocCheckTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">checkstyle$java_in_checkstyle.exec</a> &gt; <a href="index.source.html" class="el_package">com.puppycrawl.tools.checkstyle.checks.javadoc</a> &gt; <span class="el_source">AbstractJavadocCheckTest.java</span></div><h1>AbstractJavadocCheckTest.java</h1><pre class="source lang-java linenums">////////////////////////////////////////////////////////////////////////////////
// checkstyle: Checks Java source code for adherence to a set of rules.
// Copyright (C) 2001-2019 the original author or authors.
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; either
// version 2.1 of the License, or (at your option) any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
// Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
////////////////////////////////////////////////////////////////////////////////

package com.puppycrawl.tools.checkstyle.checks.javadoc;

import static com.puppycrawl.tools.checkstyle.JavadocDetailNodeParser.MSG_JAVADOC_PARSE_RULE_ERROR;
import static com.puppycrawl.tools.checkstyle.JavadocDetailNodeParser.MSG_UNCLOSED_HTML_TAG;
import static com.puppycrawl.tools.checkstyle.checks.javadoc.AbstractJavadocCheck.MSG_JAVADOC_MISSED_HTML_CLOSE;
import static com.puppycrawl.tools.checkstyle.checks.javadoc.AbstractJavadocCheck.MSG_JAVADOC_WRONG_SINGLETON_TAG;
import static com.puppycrawl.tools.checkstyle.checks.javadoc.SummaryJavadocCheck.MSG_SUMMARY_FIRST_SENTENCE;
import static java.util.Arrays.asList;
import static java.util.Collections.singletonList;
import static org.junit.Assert.assertEquals;

import java.io.File;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

import org.junit.Assert;
import org.junit.Rule;
import org.junit.Test;
import org.junit.contrib.java.lang.system.SystemErrRule;
import org.junit.rules.TemporaryFolder;

import com.puppycrawl.tools.checkstyle.AbstractModuleTestSupport;
import com.puppycrawl.tools.checkstyle.DefaultConfiguration;
import com.puppycrawl.tools.checkstyle.TreeWalker;
import com.puppycrawl.tools.checkstyle.api.DetailNode;
import com.puppycrawl.tools.checkstyle.api.JavadocTokenTypes;
import com.puppycrawl.tools.checkstyle.utils.CommonUtil;
import com.puppycrawl.tools.checkstyle.utils.JavadocUtil;

<span class="fc" id="L50">public class AbstractJavadocCheckTest extends AbstractModuleTestSupport {</span>

<span class="fc" id="L52">    @Rule</span>
<span class="fc" id="L53">    public final SystemErrRule systemErr = new SystemErrRule().enableLog().mute();</span>

<span class="fc" id="L55">    @Rule</span>
    public final TemporaryFolder temporaryFolder = new TemporaryFolder();

    @Override
    protected String getPackageLocation() {
<span class="fc" id="L60">        return &quot;com/puppycrawl/tools/checkstyle/checks/javadoc/abstractjavadoc&quot;;</span>
    }

    @Test
    public void testJavadocTagsWithoutArgs() throws Exception {
<span class="fc" id="L65">        final DefaultConfiguration checkconfig = createModuleConfig(TempCheck.class);</span>
<span class="fc" id="L66">        final String[] expected = {</span>
<span class="fc" id="L67">            &quot;5: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 7,</span>
                    &quot;mismatched input '&lt;EOF&gt;' expecting {WS, NEWLINE}&quot;, &quot;JAVADOC_TAG&quot;),
<span class="fc" id="L69">            &quot;10: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 4,</span>
                    &quot;no viable alternative at input '&lt;EOF&gt;'&quot;, &quot;JAVADOC_TAG&quot;),
<span class="fc" id="L71">            &quot;13: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 6,</span>
                    &quot;mismatched input '&lt;EOF&gt;' expecting {WS, NEWLINE}&quot;, &quot;JAVADOC_TAG&quot;),
<span class="fc" id="L73">            &quot;16: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 8,</span>
                    &quot;mismatched input '&lt;EOF&gt;' expecting {WS, NEWLINE}&quot;, &quot;JAVADOC_TAG&quot;),
<span class="fc" id="L75">            &quot;22: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 10,</span>
                    &quot;no viable alternative at input '&lt;EOF&gt;'&quot;, &quot;JAVADOC_TAG&quot;),
<span class="fc" id="L77">            &quot;27: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 7,</span>
                    &quot;no viable alternative at input '&lt;EOF&gt;'&quot;, &quot;JAVADOC_TAG&quot;),
<span class="fc" id="L79">            &quot;32: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 7,</span>
                    &quot;mismatched input '&lt;EOF&gt;' expecting {WS, NEWLINE}&quot;, &quot;JAVADOC_TAG&quot;),
<span class="fc" id="L81">            &quot;37: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 6,</span>
                    &quot;no viable alternative at input '&lt;EOF&gt;'&quot;, &quot;JAVADOC_TAG&quot;),
<span class="fc" id="L83">            &quot;58: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 13,</span>
                    &quot;mismatched input '}' expecting {LEADING_ASTERISK, WS, NEWLINE}&quot;,
                    &quot;JAVADOC_INLINE_TAG&quot;),
<span class="fc" id="L86">            &quot;65: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 19,</span>
                    &quot;no viable alternative at input '}'&quot;, &quot;REFERENCE&quot;),
        };
<span class="fc" id="L89">        verify(checkconfig, getPath(&quot;InputAbstractJavadocJavadocTagsWithoutArgs.java&quot;), expected);</span>
<span class="fc" id="L90">    }</span>

    @Test
    public void testNumberFormatException() throws Exception {
<span class="fc" id="L94">        final DefaultConfiguration checkConfig = createModuleConfig(TempCheck.class);</span>
<span class="fc" id="L95">        final String[] expected = {</span>
<span class="fc" id="L96">            &quot;3: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 52,</span>
                    &quot;mismatched input ';' expecting MEMBER&quot;, &quot;REFERENCE&quot;),
        };
<span class="fc" id="L99">        verify(checkConfig, getPath(&quot;InputAbstractJavadocNumberFormatException.java&quot;), expected);</span>
<span class="fc" id="L100">    }</span>

    @Test
    public void testCustomTag() throws Exception {
<span class="fc" id="L104">        final DefaultConfiguration checkConfig = createModuleConfig(TempCheck.class);</span>
<span class="fc" id="L105">        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L106">        verify(checkConfig, getPath(&quot;InputAbstractJavadocCustomTag.java&quot;), expected);</span>
<span class="fc" id="L107">    }</span>

    @Test
    public void testParsingErrors() throws Exception {
<span class="fc" id="L111">        final DefaultConfiguration checkConfig = createModuleConfig(TempCheck.class);</span>
<span class="fc" id="L112">        final String[] expected = {</span>
<span class="fc" id="L113">            &quot;4: &quot; + getCheckMessage(MSG_JAVADOC_MISSED_HTML_CLOSE, 4, &quot;unclosedTag&quot;),</span>
<span class="fc" id="L114">            &quot;8: &quot; + getCheckMessage(MSG_JAVADOC_WRONG_SINGLETON_TAG, 35, &quot;img&quot;),</span>
        };
<span class="fc" id="L116">        verify(checkConfig, getPath(&quot;InputAbstractJavadocParsingErrors.java&quot;), expected);</span>
<span class="fc" id="L117">        assertEquals(&quot;Error is unexpected&quot;, &quot;&quot;, systemErr.getLog());</span>
<span class="fc" id="L118">    }</span>

    @Test
    public void testWithMultipleChecks() throws Exception {
<span class="fc" id="L122">        final DefaultConfiguration checksConfig = createModuleConfig(TreeWalker.class);</span>
<span class="fc" id="L123">        checksConfig.addChild(createModuleConfig(AtclauseOrderCheck.class));</span>
<span class="fc" id="L124">        checksConfig.addChild(createModuleConfig(JavadocParagraphCheck.class));</span>

<span class="fc" id="L126">        final DefaultConfiguration checkerConfig = createRootConfig(checksConfig);</span>

<span class="fc" id="L128">        verify(checkerConfig, getPath(&quot;InputAbstractJavadocCorrectParagraph.java&quot;));</span>
<span class="fc" id="L129">    }</span>

    @Test
    public void testAntlrError() throws Exception {
<span class="fc" id="L133">        final DefaultConfiguration checkConfig = createModuleConfig(TempCheck.class);</span>
<span class="fc" id="L134">        final String[] expected = {</span>
<span class="fc" id="L135">            &quot;4: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 78,</span>
                    &quot;mismatched input '(' expecting &lt;EOF&gt;&quot;, &quot;JAVADOC&quot;),
        };
<span class="fc" id="L138">        verify(checkConfig, getPath(&quot;InputAbstractJavadocInvalidAtSeeReference.java&quot;), expected);</span>
<span class="fc" id="L139">        assertEquals(&quot;Error is unexpected&quot;, &quot;&quot;, systemErr.getLog());</span>
<span class="fc" id="L140">    }</span>

    @Test
    public void testCheckReuseAfterParseErrorWithFollowingAntlrErrorInTwoFiles() throws Exception {
<span class="fc" id="L144">        final DefaultConfiguration checkConfig = createModuleConfig(TempCheck.class);</span>
<span class="fc" id="L145">        final Map&lt;String, List&lt;String&gt;&gt; expectedMessages = new LinkedHashMap&lt;&gt;(2);</span>
<span class="fc" id="L146">        expectedMessages.put(getPath(&quot;InputAbstractJavadocParsingErrors.java&quot;), asList(</span>
<span class="fc" id="L147">            &quot;4: &quot; + getCheckMessage(MSG_JAVADOC_MISSED_HTML_CLOSE, 4, &quot;unclosedTag&quot;),</span>
<span class="fc" id="L148">            &quot;8: &quot; + getCheckMessage(MSG_JAVADOC_WRONG_SINGLETON_TAG, 35, &quot;img&quot;)</span>
        ));
<span class="fc" id="L150">        expectedMessages.put(getPath(&quot;InputAbstractJavadocInvalidAtSeeReference.java&quot;),</span>
<span class="fc" id="L151">            singletonList(&quot;4: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 78,</span>
                    &quot;mismatched input '(' expecting &lt;EOF&gt;&quot;, &quot;JAVADOC&quot;)
        ));
<span class="fc" id="L154">        verify(createChecker(checkConfig), new File[] {</span>
<span class="fc" id="L155">            new File(getPath(&quot;InputAbstractJavadocParsingErrors.java&quot;)),</span>
<span class="fc" id="L156">            new File(getPath(&quot;InputAbstractJavadocInvalidAtSeeReference.java&quot;)), },</span>
                expectedMessages);
<span class="fc" id="L158">        assertEquals(&quot;Error is unexpected&quot;, &quot;&quot;, systemErr.getLog());</span>
<span class="fc" id="L159">    }</span>

    @Test
    public void testCheckReuseAfterParseErrorWithFollowingAntlrErrorInSingleFile()
            throws Exception {
<span class="fc" id="L164">        final DefaultConfiguration checkConfig = createModuleConfig(TempCheck.class);</span>
<span class="fc" id="L165">        final String[] expected = {</span>
<span class="fc" id="L166">            &quot;4: &quot; + getCheckMessage(MSG_JAVADOC_MISSED_HTML_CLOSE, 4, &quot;unclosedTag&quot;),</span>
<span class="fc" id="L167">            &quot;8: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR, 82,</span>
                    &quot;mismatched input '(' expecting &lt;EOF&gt;&quot;, &quot;JAVADOC&quot;),
        };
<span class="fc" id="L170">        verify(checkConfig,</span>
<span class="fc" id="L171">            getPath(&quot;InputAbstractJavadocUnclosedTagAndInvalidAtSeeReference.java&quot;), expected);</span>
<span class="fc" id="L172">    }</span>

    @Test
    public void testPosition()
            throws Exception {
<span class="fc" id="L177">        JavadocCatchCheck.clearCounter();</span>
<span class="fc" id="L178">        final DefaultConfiguration checkConfig = createModuleConfig(JavadocCatchCheck.class);</span>
<span class="fc" id="L179">        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L180">        verify(checkConfig, getPath(&quot;InputAbstractJavadocPosition.java&quot;), expected);</span>
<span class="fc" id="L181">        assertEquals(&quot;Invalid number of javadocs&quot;,</span>
<span class="fc" id="L182">            65, JavadocCatchCheck.javadocsNumber);</span>
<span class="fc" id="L183">    }</span>

    @Test
    public void testPositionWithSinglelineComments()
            throws Exception {
<span class="fc" id="L188">        JavadocCatchCheck.clearCounter();</span>
<span class="fc" id="L189">        final DefaultConfiguration checkConfig = createModuleConfig(JavadocCatchCheck.class);</span>
<span class="fc" id="L190">        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L191">        verify(checkConfig,</span>
<span class="fc" id="L192">            getPath(&quot;InputAbstractJavadocPositionWithSinglelineComments.java&quot;), expected);</span>
<span class="fc" id="L193">        assertEquals(&quot;Invalid number of javadocs&quot;,</span>
<span class="fc" id="L194">                65, JavadocCatchCheck.javadocsNumber);</span>
<span class="fc" id="L195">    }</span>

    @Test
    public void testPositionOnlyComments()
            throws Exception {
<span class="fc" id="L200">        JavadocCatchCheck.clearCounter();</span>
<span class="fc" id="L201">        final DefaultConfiguration checkConfig = createModuleConfig(JavadocCatchCheck.class);</span>
<span class="fc" id="L202">        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L203">        verify(checkConfig, getPath(&quot;InputAbstractJavadocPositionOnlyComments.java&quot;), expected);</span>
<span class="fc" id="L204">        assertEquals(&quot;Invalid number of javadocs&quot;,</span>
<span class="fc" id="L205">                0, JavadocCatchCheck.javadocsNumber);</span>
<span class="fc" id="L206">    }</span>

    @Test
    public void testTokens() {
<span class="fc" id="L210">        final int[] defaultJavadocTokens = {JavadocTokenTypes.JAVADOC};</span>
<span class="fc" id="L211">        final AbstractJavadocCheck check = new AbstractJavadocCheck() {</span>
            @Override
            public void visitJavadocToken(DetailNode ast) {
                // no code necessary
<span class="nc" id="L215">            }</span>

            @Override
            public int[] getDefaultJavadocTokens() {
<span class="fc" id="L219">                return defaultJavadocTokens;</span>
            }
        };

<span class="fc" id="L223">        Assert.assertNotNull(&quot;Default tokens should not be null&quot;, check.getDefaultTokens());</span>
<span class="fc" id="L224">        Assert.assertArrayEquals(&quot;Acceptable tokens should be equal to default&quot;,</span>
<span class="fc" id="L225">                check.getDefaultTokens(), check.getAcceptableTokens());</span>
<span class="fc" id="L226">        Assert.assertArrayEquals(&quot;Required tokens should be equal to default&quot;,</span>
<span class="fc" id="L227">                check.getDefaultTokens(), check.getRequiredTokens());</span>
<span class="fc" id="L228">        Assert.assertArrayEquals(&quot;Invalid default javadoc tokens&quot;,</span>
<span class="fc" id="L229">                defaultJavadocTokens, check.getDefaultJavadocTokens());</span>
<span class="fc" id="L230">        Assert.assertArrayEquals(&quot;Invalid acceptable javadoc tokens&quot;,</span>
<span class="fc" id="L231">                defaultJavadocTokens, check.getAcceptableJavadocTokens());</span>
<span class="fc" id="L232">        Assert.assertNotEquals(&quot;Invalid required javadoc tokens&quot;,</span>
<span class="fc" id="L233">                defaultJavadocTokens, check.getRequiredJavadocTokens());</span>
<span class="fc" id="L234">    }</span>

    @Test
    public void testAcceptableTokensFail()
            throws Exception {
<span class="fc" id="L239">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L240">            createModuleConfig(TokenIsNotInAcceptablesJavadocCheck.class);</span>
<span class="fc" id="L241">        checkConfig.addAttribute(&quot;javadocTokens&quot;, &quot;RETURN_LITERAL&quot;);</span>
        try {
<span class="fc" id="L243">            final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="nc" id="L244">            verify(checkConfig, getPath(&quot;InputAbstractJavadocMain.java&quot;), expected);</span>
<span class="nc" id="L245">            Assert.fail(&quot;CheckstyleException is expected&quot;);</span>
        }
<span class="fc" id="L247">        catch (IllegalStateException ex) {</span>
<span class="fc" id="L248">            final String expected = &quot;Javadoc Token &quot;</span>
                    + &quot;\&quot;RETURN_LITERAL\&quot; was not found in &quot;
                    + &quot;Acceptable javadoc tokens list in check&quot;;
<span class="fc" id="L251">            Assert.assertTrue(&quot;Invalid exception, should start with: &quot; + expected,</span>
<span class="fc" id="L252">                    ex.getMessage().startsWith(expected));</span>
<span class="nc" id="L253">        }</span>
<span class="fc" id="L254">    }</span>

    @Test
    public void testAcceptableTokensPass()
            throws Exception {
<span class="fc" id="L259">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L260">            createModuleConfig(TokenIsNotInAcceptablesJavadocCheck.class);</span>
<span class="fc" id="L261">        checkConfig.addAttribute(&quot;javadocTokens&quot;, &quot;DEPRECATED_LITERAL&quot;);</span>

<span class="fc" id="L263">        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L264">        verify(checkConfig, getPath(&quot;InputAbstractJavadocMain.java&quot;), expected);</span>
<span class="fc" id="L265">    }</span>

    @Test
    public void testRequiredTokenIsNotInDefaultTokens() throws Exception {
<span class="fc" id="L269">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L270">            createModuleConfig(RequiredTokenIsNotInDefaultsJavadocCheck.class);</span>
<span class="fc" id="L271">        final String pathToEmptyFile = temporaryFolder.newFile(&quot;file.java&quot;).getPath();</span>

        try {
<span class="fc" id="L274">            final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="nc" id="L275">            verify(checkConfig, pathToEmptyFile, expected);</span>
<span class="nc" id="L276">            Assert.fail(&quot;CheckstyleException is expected&quot;);</span>
        }
<span class="fc" id="L278">        catch (IllegalStateException ex) {</span>
<span class="fc" id="L279">            final String expected = &quot;Javadoc Token \&quot;&quot;</span>
                    + JavadocTokenTypes.RETURN_LITERAL + &quot;\&quot; from required&quot;
                    + &quot; javadoc tokens was not found in default javadoc tokens list in check&quot;;
<span class="fc" id="L282">            Assert.assertTrue(&quot;Invalid exception, should start with: &quot; + expected,</span>
<span class="fc" id="L283">                    ex.getMessage().startsWith(expected));</span>
<span class="nc" id="L284">        }</span>
<span class="fc" id="L285">    }</span>

    @Test
    public void testVisitLeaveToken()
            throws Exception {
<span class="fc" id="L290">        JavadocVisitLeaveCheck.clearCounter();</span>
<span class="fc" id="L291">        final DefaultConfiguration checkConfig = createModuleConfig(JavadocVisitLeaveCheck.class);</span>
<span class="fc" id="L292">        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L293">        verify(checkConfig, getPath(&quot;InputAbstractJavadocPosition.java&quot;), expected);</span>
<span class="fc" id="L294">        Assert.assertTrue(&quot;Javadoc visit count should be greater than zero&quot;,</span>
<span class="pc bpc" id="L295" title="1 of 2 branches missed.">                JavadocVisitLeaveCheck.visitCount &gt; 0);</span>
<span class="fc" id="L296">        assertEquals(&quot;Javadoc visit and leave count should be equal&quot;,</span>
<span class="fc" id="L297">                JavadocVisitLeaveCheck.visitCount, JavadocVisitLeaveCheck.leaveCount);</span>
<span class="fc" id="L298">    }</span>

    @Test
    public void testNoWsBeforeDescriptionInJavadocTags() throws Exception {
<span class="fc" id="L302">        final DefaultConfiguration checkConfig = createModuleConfig(TempCheck.class);</span>
<span class="fc" id="L303">        final String[] expected = {</span>
<span class="fc" id="L304">            &quot;13: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR,</span>
<span class="fc" id="L305">                    23, &quot;mismatched input 'd' expecting &lt;EOF&gt;&quot;, &quot;JAVADOC&quot;),</span>
<span class="fc" id="L306">            &quot;22: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR,</span>
<span class="fc" id="L307">                    30, &quot;mismatched input '-' expecting &lt;EOF&gt;&quot;, &quot;JAVADOC&quot;),</span>
<span class="fc" id="L308">            &quot;28: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR,</span>
<span class="fc" id="L309">                    39, &quot;mismatched input '-' expecting &lt;EOF&gt;&quot;, &quot;JAVADOC&quot;),</span>
<span class="fc" id="L310">            &quot;40: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR,</span>
<span class="fc" id="L311">                    34, &quot;mismatched input '-' expecting &lt;EOF&gt;&quot;, &quot;JAVADOC&quot;),</span>
<span class="fc" id="L312">            &quot;48: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR,</span>
<span class="fc" id="L313">                    31, &quot;mismatched input '-' expecting &lt;EOF&gt;&quot;, &quot;JAVADOC&quot;),</span>
<span class="fc" id="L314">            &quot;57: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR,</span>
<span class="fc" id="L315">                    15, &quot;mismatched input '-' expecting &lt;EOF&gt;&quot;, &quot;JAVADOC&quot;),</span>
<span class="fc" id="L316">            &quot;64: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR,</span>
<span class="fc" id="L317">                    32, &quot;mismatched input '-' expecting &lt;EOF&gt;&quot;, &quot;JAVADOC&quot;),</span>
<span class="fc" id="L318">            &quot;71: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR,</span>
<span class="fc" id="L319">                    17, &quot;mismatched input '&lt;' expecting &lt;EOF&gt;&quot;, &quot;JAVADOC&quot;),</span>
<span class="fc" id="L320">            &quot;78: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR,</span>
<span class="fc" id="L321">                    34, &quot;no viable alternative at input '-'&quot;, &quot;JAVADOC_INLINE_TAG&quot;),</span>
<span class="fc" id="L322">            &quot;85: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR,</span>
<span class="fc" id="L323">                    39, &quot;no viable alternative at input '-'&quot;, &quot;JAVADOC_INLINE_TAG&quot;),</span>
<span class="fc" id="L324">            &quot;92: &quot; + getCheckMessage(MSG_JAVADOC_PARSE_RULE_ERROR,</span>
<span class="fc" id="L325">                    19, &quot;no viable alternative at input '&lt;'&quot;, &quot;JAVADOC_INLINE_TAG&quot;),</span>
        };
<span class="fc" id="L327">        verify(checkConfig, getPath(&quot;InputAbstractJavadocNoWsBeforeDescriptionInJavadocTags.java&quot;),</span>
                expected);
<span class="fc" id="L329">    }</span>

    @Test
    public void testWrongSingletonTagInJavadoc() throws Exception {
<span class="fc" id="L333">        final DefaultConfiguration checkConfig = createModuleConfig(TempCheck.class);</span>
<span class="fc" id="L334">        final String[] expected = {</span>
<span class="fc" id="L335">            &quot;5: &quot; + getCheckMessage(MSG_JAVADOC_WRONG_SINGLETON_TAG, 9, &quot;embed&quot;),</span>
<span class="fc" id="L336">            &quot;10: &quot; + getCheckMessage(MSG_JAVADOC_WRONG_SINGLETON_TAG, 9, &quot;keygen&quot;),</span>
<span class="fc" id="L337">            &quot;15: &quot; + getCheckMessage(MSG_JAVADOC_WRONG_SINGLETON_TAG, 9, &quot;SOURCE&quot;),</span>
<span class="fc" id="L338">            &quot;20: &quot; + getCheckMessage(MSG_JAVADOC_WRONG_SINGLETON_TAG, 9, &quot;TRACK&quot;),</span>
<span class="fc" id="L339">            &quot;25: &quot; + getCheckMessage(MSG_JAVADOC_WRONG_SINGLETON_TAG, 9, &quot;WBR&quot;),</span>
        };
<span class="fc" id="L341">        verify(checkConfig, getPath(&quot;InputAbstractJavadocWrongSingletonTagInJavadoc.java&quot;),</span>
                expected);
<span class="fc" id="L343">    }</span>

    @Test
    public void testNonTightHtmlTagIntolerantCheck() throws Exception {
<span class="fc" id="L347">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L348">                createModuleConfig(NonTightHtmlTagIntolerantCheck.class);</span>
<span class="fc" id="L349">        checkConfig.addAttribute(&quot;violateExecutionOnNonTightHtml&quot;, &quot;true&quot;);</span>
<span class="fc" id="L350">        final String[] expected = {</span>
<span class="fc" id="L351">            &quot;6: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L352">            &quot;13: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L353">            &quot;16: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;li&quot;),</span>
<span class="fc" id="L354">            &quot;21: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L355">            &quot;27: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;tr&quot;),</span>
<span class="fc" id="L356">            &quot;34: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;li&quot;),</span>
<span class="fc" id="L357">            &quot;54: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;li&quot;),</span>
<span class="fc" id="L358">            &quot;71: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L359">            &quot;80: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;tr&quot;),</span>
<span class="fc" id="L360">            &quot;124: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
        };
<span class="fc" id="L362">        verify(checkConfig, getPath(&quot;InputAbstractJavadocNonTightHtmlTags.java&quot;), expected);</span>
<span class="fc" id="L363">    }</span>

    @Test
    public void testNonTightHtmlTagIntolerantCheckReportingNoViolation() throws Exception {
<span class="fc" id="L367">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L368">                createModuleConfig(NonTightHtmlTagIntolerantCheck.class);</span>
<span class="fc" id="L369">        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L370">        verify(checkConfig, getPath(&quot;InputAbstractJavadocNonTightHtmlTags.java&quot;), expected);</span>
<span class="fc" id="L371">    }</span>

    @Test
    public void testNonTightHtmlTagIntolerantCheckVisitCount()
            throws Exception {
<span class="fc" id="L376">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L377">                createModuleConfig(NonTightHtmlTagIntolerantCheck.class);</span>
<span class="fc" id="L378">        checkConfig.addAttribute(&quot;violateExecutionOnNonTightHtml&quot;, &quot;true&quot;);</span>
<span class="fc" id="L379">        checkConfig.addAttribute(&quot;reportVisitJavadocToken&quot;, &quot;true&quot;);</span>
<span class="fc" id="L380">        final String[] expected = {</span>
<span class="fc" id="L381">            &quot;6: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L382">            &quot;13: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L383">            &quot;16: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;li&quot;),</span>
<span class="fc" id="L384">            &quot;21: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L385">            &quot;27: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;tr&quot;),</span>
<span class="fc" id="L386">            &quot;34: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;li&quot;),</span>
<span class="fc" id="L387">            &quot;41:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L388">            &quot;54: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;li&quot;),</span>
<span class="fc" id="L389">            &quot;62:13: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L390">            &quot;71: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L391">            &quot;80: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;tr&quot;),</span>
<span class="fc" id="L392">            &quot;99:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L393">            &quot;105:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L394">            &quot;109:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L395">            &quot;124: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
        };
<span class="fc" id="L397">        verify(checkConfig, getPath(&quot;InputAbstractJavadocNonTightHtmlTags.java&quot;), expected);</span>
<span class="fc" id="L398">    }</span>

    @Test
    public void testVisitCountForCheckAcceptingJavadocWithNonTightHtml()
            throws Exception {
<span class="fc" id="L403">        final DefaultConfiguration checkConfig =</span>
<span class="fc" id="L404">                createModuleConfig(NonTightHtmlTagTolerantCheck.class);</span>
<span class="fc" id="L405">        checkConfig.addAttribute(&quot;violateExecutionOnNonTightHtml&quot;, &quot;true&quot;);</span>
<span class="fc" id="L406">        checkConfig.addAttribute(&quot;reportVisitJavadocToken&quot;, &quot;true&quot;);</span>
<span class="fc" id="L407">        final String[] expected = {</span>
<span class="fc" id="L408">            &quot;4:4: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L409">            &quot;5:4: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L410">            &quot;6: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L411">            &quot;6:4: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L412">            &quot;7:4: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L413">            &quot;7:39: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L414">            &quot;13: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L415">            &quot;13:9: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L416">            &quot;13:13: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L417">            &quot;16: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;li&quot;),</span>
<span class="fc" id="L418">            &quot;16:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L419">            &quot;20:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L420">            &quot;21: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L421">            &quot;21:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L422">            &quot;21:30: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L423">            &quot;26:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L424">            &quot;26:22: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L425">            &quot;27: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;tr&quot;),</span>
<span class="fc" id="L426">            &quot;32:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L427">            &quot;33:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L428">            &quot;34: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;li&quot;),</span>
<span class="fc" id="L429">            &quot;34:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L430">            &quot;34:23: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L431">            &quot;39:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L432">            &quot;39:20: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L433">            &quot;39:34: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L434">            &quot;41: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;li&quot;),</span>
<span class="fc" id="L435">            &quot;41:16: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L436">            &quot;41:21: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L437">            &quot;49:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L438">            &quot;51: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L439">            &quot;51:22: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L440">            &quot;56:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L441">            &quot;57:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L442">            &quot;60: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;tr&quot;),</span>
<span class="fc" id="L443">            &quot;79:8: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L444">            &quot;85: &quot; + getCheckMessage(MSG_UNCLOSED_HTML_TAG, &quot;p&quot;),</span>
<span class="fc" id="L445">            &quot;85:9: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L446">            &quot;85:13: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
<span class="fc" id="L447">            &quot;85:33: &quot; + getCheckMessage(MSG_SUMMARY_FIRST_SENTENCE),</span>
        };
<span class="fc" id="L449">        verify(checkConfig, getPath(&quot;InputAbstractJavadocNonTightHtmlTags2.java&quot;), expected);</span>
<span class="fc" id="L450">    }</span>

    private static class TempCheck extends AbstractJavadocCheck {

        @Override
        public int[] getDefaultJavadocTokens() {
<span class="fc" id="L456">            return CommonUtil.EMPTY_INT_ARRAY;</span>
        }

        @Override
        public void visitJavadocToken(DetailNode ast) {
            // do nothing
<span class="nc" id="L462">        }</span>

    }

    private static class JavadocCatchCheck extends AbstractJavadocCheck {

        private static int javadocsNumber;

        public static void clearCounter() {
<span class="fc" id="L471">            javadocsNumber = 0;</span>
<span class="fc" id="L472">        }</span>

        @Override
        public int[] getDefaultJavadocTokens() {
<span class="fc" id="L476">            return new int[] {JavadocTokenTypes.JAVADOC};</span>
        }

        @Override
        public void visitJavadocToken(DetailNode ast) {
<span class="fc" id="L481">            assertEquals(ast.toString(), &quot;JAVADOC&quot;, ast.getText());</span>
<span class="fc" id="L482">            final DetailNode text = JavadocUtil.findFirstToken(ast, JavadocTokenTypes.TEXT);</span>
<span class="fc" id="L483">            Assert.assertNotNull(&quot;Empty javadoc text at &quot; + ast, text);</span>
<span class="fc" id="L484">            assertEquals(ast.toString(), &quot;Javadoc&quot;, text.getText());</span>
<span class="fc" id="L485">            javadocsNumber++;</span>
<span class="fc" id="L486">        }</span>

    }

    private static class RequiredTokenIsNotInDefaultsJavadocCheck extends AbstractJavadocCheck {

        @Override
        public int[] getRequiredJavadocTokens() {
<span class="fc" id="L494">            return new int[] {JavadocTokenTypes.RETURN_LITERAL};</span>
        }

        @Override
        public int[] getDefaultJavadocTokens() {
<span class="fc" id="L499">            return new int[] {JavadocTokenTypes.DEPRECATED_LITERAL};</span>
        }

        @Override
        public int[] getAcceptableJavadocTokens() {
<span class="nc" id="L504">            return CommonUtil.EMPTY_INT_ARRAY;</span>
        }

        @Override
        public void visitJavadocToken(DetailNode ast) {
            // not used
<span class="nc" id="L510">        }</span>

    }

    private static class TokenIsNotInAcceptablesJavadocCheck extends AbstractJavadocCheck {

        @Override
        public int[] getRequiredJavadocTokens() {
<span class="fc" id="L518">            return new int[] {JavadocTokenTypes.DEPRECATED_LITERAL};</span>
        }

        @Override
        public int[] getDefaultJavadocTokens() {
<span class="fc" id="L523">            return new int[] {JavadocTokenTypes.DEPRECATED_LITERAL};</span>
        }

        @Override
        public int[] getAcceptableJavadocTokens() {
<span class="fc" id="L528">            return new int[] {JavadocTokenTypes.DEPRECATED_LITERAL};</span>
        }

        @Override
        public void visitJavadocToken(DetailNode ast) {
            // not used
<span class="nc" id="L534">        }</span>

    }

    private static class JavadocVisitLeaveCheck extends AbstractJavadocCheck {

        private static int visitCount;
        private static int leaveCount;

        public static void clearCounter() {
<span class="fc" id="L544">            visitCount = 0;</span>
<span class="fc" id="L545">            leaveCount = 0;</span>
<span class="fc" id="L546">        }</span>

        @Override
        public int[] getRequiredJavadocTokens() {
<span class="fc" id="L550">            return new int[] {JavadocTokenTypes.TEXT};</span>
        }

        @Override
        public int[] getDefaultJavadocTokens() {
<span class="fc" id="L555">            return getRequiredJavadocTokens();</span>
        }

        @Override
        public int[] getAcceptableJavadocTokens() {
<span class="nc" id="L560">            return getRequiredJavadocTokens();</span>
        }

        @Override
        public void visitJavadocToken(DetailNode ast) {
<span class="fc" id="L565">            visitCount++;</span>
<span class="fc" id="L566">        }</span>

        @Override
        public void leaveJavadocToken(DetailNode ast) {
<span class="fc" id="L570">            leaveCount++;</span>
<span class="fc" id="L571">        }</span>

    }

<span class="fc" id="L575">    public static class NonTightHtmlTagIntolerantCheck extends AbstractJavadocCheck {</span>

        private boolean reportVisitJavadocToken;

        public final void setReportVisitJavadocToken(boolean reportVisitJavadocToken) {
<span class="fc" id="L580">            this.reportVisitJavadocToken = reportVisitJavadocToken;</span>
<span class="fc" id="L581">        }</span>

        @Override
        public int[] getDefaultJavadocTokens() {
<span class="fc" id="L585">            return new int[] {</span>
                JavadocTokenTypes.P_TAG_START,
                JavadocTokenTypes.LI_TAG_START,
                JavadocTokenTypes.BODY_TAG_START,
            };
        }

        @Override
        public void visitJavadocToken(DetailNode ast) {
<span class="fc bfc" id="L594" title="All 2 branches covered.">            if (reportVisitJavadocToken) {</span>
<span class="fc" id="L595">                log(ast.getLineNumber(), ast.getColumnNumber(), MSG_SUMMARY_FIRST_SENTENCE);</span>
            }
<span class="fc" id="L597">        }</span>

        @Override
        public boolean acceptJavadocWithNonTightHtml() {
<span class="fc" id="L601">            return false;</span>
        }

    }

<span class="fc" id="L606">    public static class NonTightHtmlTagTolerantCheck extends AbstractJavadocCheck {</span>

        private boolean reportVisitJavadocToken;

        public final void setReportVisitJavadocToken(boolean reportVisitJavadocToken) {
<span class="fc" id="L611">            this.reportVisitJavadocToken = reportVisitJavadocToken;</span>
<span class="fc" id="L612">        }</span>

        @Override
        public int[] getDefaultJavadocTokens() {
<span class="fc" id="L616">            return new int[] {</span>
                JavadocTokenTypes.P_TAG_START,
                JavadocTokenTypes.LI_TAG_START,
                JavadocTokenTypes.BODY_TAG_START,
            };
        }

        @Override
        public void visitJavadocToken(DetailNode ast) {
<span class="pc bpc" id="L625" title="1 of 2 branches missed.">            if (reportVisitJavadocToken) {</span>
<span class="fc" id="L626">                log(ast.getLineNumber(), ast.getColumnNumber(), MSG_SUMMARY_FIRST_SENTENCE);</span>
            }
<span class="fc" id="L628">        }</span>

    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>