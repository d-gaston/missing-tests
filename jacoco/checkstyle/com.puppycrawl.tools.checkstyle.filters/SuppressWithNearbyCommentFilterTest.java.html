<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SuppressWithNearbyCommentFilterTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">checkstyle$java_in_checkstyle.exec</a> &gt; <a href="index.source.html" class="el_package">com.puppycrawl.tools.checkstyle.filters</a> &gt; <span class="el_source">SuppressWithNearbyCommentFilterTest.java</span></div><h1>SuppressWithNearbyCommentFilterTest.java</h1><pre class="source lang-java linenums">////////////////////////////////////////////////////////////////////////////////
// checkstyle: Checks Java source code for adherence to a set of rules.
// Copyright (C) 2001-2019 the original author or authors.
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; either
// version 2.1 of the License, or (at your option) any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
// Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
////////////////////////////////////////////////////////////////////////////////

package com.puppycrawl.tools.checkstyle.filters;

import static com.puppycrawl.tools.checkstyle.checks.naming.AbstractNameCheck.MSG_INVALID_PATTERN;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;

import java.util.Arrays;
import java.util.Collection;
import java.util.List;
import java.util.stream.Collectors;

import org.junit.Test;
import org.powermock.reflect.Whitebox;

import com.puppycrawl.tools.checkstyle.AbstractModuleTestSupport;
import com.puppycrawl.tools.checkstyle.DefaultConfiguration;
import com.puppycrawl.tools.checkstyle.TreeWalker;
import com.puppycrawl.tools.checkstyle.TreeWalkerAuditEvent;
import com.puppycrawl.tools.checkstyle.api.CheckstyleException;
import com.puppycrawl.tools.checkstyle.api.Configuration;
import com.puppycrawl.tools.checkstyle.api.FileContents;
import com.puppycrawl.tools.checkstyle.api.LocalizedMessage;
import com.puppycrawl.tools.checkstyle.checks.coding.IllegalCatchCheck;
import com.puppycrawl.tools.checkstyle.checks.naming.AbstractNameCheck;
import com.puppycrawl.tools.checkstyle.checks.naming.ConstantNameCheck;
import com.puppycrawl.tools.checkstyle.checks.naming.MemberNameCheck;
import com.puppycrawl.tools.checkstyle.utils.CommonUtil;
import nl.jqno.equalsverifier.EqualsVerifier;
import nl.jqno.equalsverifier.EqualsVerifierReport;

<span class="fc" id="L51">public class SuppressWithNearbyCommentFilterTest</span>
    extends AbstractModuleTestSupport {

<span class="fc" id="L54">    private static final String[] ALL_MESSAGES = {</span>
        &quot;14:17: &quot;
<span class="fc" id="L56">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;15:17: &quot;
<span class="fc" id="L59">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;A2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;16:59: &quot;
<span class="fc" id="L62">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;A3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;18:17: &quot;
<span class="fc" id="L65">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;B1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;19:17: &quot;
<span class="fc" id="L68">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;B2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;20:59: &quot;
<span class="fc" id="L71">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;B3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;22:17: &quot;
<span class="fc" id="L74">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;C1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;24:17: &quot;
<span class="fc" id="L77">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;C2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;25:17: &quot;
<span class="fc" id="L80">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;C3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;27:17: &quot;
<span class="fc" id="L83">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;D1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;28:17: &quot;
<span class="fc" id="L86">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;D2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;30:17: &quot;
<span class="fc" id="L89">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;D3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;32:30: &quot;
<span class="fc" id="L92">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;e1&quot;, &quot;^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$&quot;),
        &quot;33:17: &quot;
<span class="fc" id="L95">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;E2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;34:17: &quot;
<span class="fc" id="L98">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;E3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;35:30: &quot;
<span class="fc" id="L101">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;e4&quot;, &quot;^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$&quot;),
        &quot;36:17: &quot;
<span class="fc" id="L104">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;E5&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;37:30: &quot;
<span class="fc" id="L107">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;e6&quot;, &quot;^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$&quot;),
        &quot;38:17: &quot;
<span class="fc" id="L110">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;E7&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;39:17: &quot;
<span class="fc" id="L113">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;E8&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;40:30: &quot;
<span class="fc" id="L116">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;e9&quot;, &quot;^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$&quot;),
        &quot;64:23: &quot;
<span class="fc" id="L119">            + getCheckMessage(IllegalCatchCheck.class, IllegalCatchCheck.MSG_KEY, &quot;Exception&quot;),</span>
        &quot;66:23: &quot;
<span class="fc" id="L121">            + getCheckMessage(IllegalCatchCheck.class, IllegalCatchCheck.MSG_KEY, &quot;Throwable&quot;),</span>
        &quot;73:11: &quot;
<span class="fc" id="L123">            + getCheckMessage(IllegalCatchCheck.class, IllegalCatchCheck.MSG_KEY, &quot;Exception&quot;),</span>
        &quot;80:59: &quot;
<span class="fc" id="L125">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;A2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        &quot;81:17: &quot;
<span class="fc" id="L128">            + getCheckMessage(AbstractNameCheck.class,</span>
                MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
    };

    @Override
    protected String getPackageLocation() {
<span class="fc" id="L134">        return &quot;com/puppycrawl/tools/checkstyle/filters/suppresswithnearbycommentfilter&quot;;</span>
    }

    @Test
    public void testNone() throws Exception {
<span class="fc" id="L139">        final DefaultConfiguration filterConfig = null;</span>
<span class="fc" id="L140">        final String[] suppressed = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L141">        verifySuppressed(filterConfig, suppressed);</span>
<span class="fc" id="L142">    }</span>

    @Test
    public void testDefault() throws Exception {
<span class="fc" id="L146">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L147">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L148">        final String[] suppressed = {</span>
            &quot;14:17: &quot;
<span class="fc" id="L150">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;15:17: &quot;
<span class="fc" id="L153">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;16:59: &quot;
<span class="fc" id="L156">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;18:17: &quot;
<span class="fc" id="L159">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;B1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;19:17: &quot;
<span class="fc" id="L162">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;B2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;20:59: &quot;
<span class="fc" id="L165">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;B3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;80:59: &quot;
<span class="fc" id="L168">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };
<span class="fc" id="L171">        verifySuppressed(filterConfig, suppressed);</span>
<span class="fc" id="L172">    }</span>

    @Test
    public void testCheckC() throws Exception {
<span class="fc" id="L176">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L177">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L178">        filterConfig.addAttribute(&quot;checkC&quot;, &quot;false&quot;);</span>
<span class="fc" id="L179">        final String[] suppressed = {</span>
            &quot;14:17: &quot;
<span class="fc" id="L181">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;18:17: &quot;
<span class="fc" id="L184">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;B1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };
<span class="fc" id="L187">        verifySuppressed(filterConfig, suppressed);</span>
<span class="fc" id="L188">    }</span>

    @Test
    public void testCheckCpp() throws Exception {
<span class="fc" id="L192">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L193">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L194">        filterConfig.addAttribute(&quot;checkCPP&quot;, &quot;false&quot;);</span>
<span class="fc" id="L195">        final String[] suppressed = {</span>
            &quot;15:17: &quot;
<span class="fc" id="L197">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;16:59: &quot;
<span class="fc" id="L200">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;19:17: &quot;
<span class="fc" id="L203">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;B2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;20:59: &quot;
<span class="fc" id="L206">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;B3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;80:59: &quot;
<span class="fc" id="L209">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };
<span class="fc" id="L212">        verifySuppressed(filterConfig, suppressed);</span>
<span class="fc" id="L213">    }</span>

    @Test
    public void testUsingVariableMessage() throws Exception {
<span class="fc" id="L217">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L218">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L219">        filterConfig.addAttribute(&quot;commentFormat&quot;, &quot;ALLOW CATCH (\\w+) BECAUSE&quot;);</span>
<span class="fc" id="L220">        filterConfig.addAttribute(&quot;checkFormat&quot;, &quot;IllegalCatchCheck&quot;);</span>
<span class="fc" id="L221">        filterConfig.addAttribute(&quot;messageFormat&quot;, &quot;$1&quot;);</span>
<span class="fc" id="L222">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;-1&quot;);</span>
<span class="fc" id="L223">        final String[] suppressed = {</span>
            &quot;66:23: &quot;
<span class="fc" id="L225">                + getCheckMessage(IllegalCatchCheck.class,</span>
                    IllegalCatchCheck.MSG_KEY, &quot;Throwable&quot;),
            &quot;73:11: &quot;
<span class="fc" id="L228">                + getCheckMessage(IllegalCatchCheck.class,</span>
                    IllegalCatchCheck.MSG_KEY, &quot;Exception&quot;),
        };
<span class="fc" id="L231">        verifySuppressed(filterConfig, suppressed);</span>
<span class="fc" id="L232">    }</span>

    @Test
    public void testUsingNonMatchingVariableMessage() throws Exception {
<span class="fc" id="L236">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L237">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L238">        filterConfig.addAttribute(&quot;commentFormat&quot;, &quot;ALLOW CATCH (\\w+) BECAUSE&quot;);</span>
<span class="fc" id="L239">        filterConfig.addAttribute(&quot;checkFormat&quot;, &quot;IllegalCatchCheck&quot;);</span>
<span class="fc" id="L240">        filterConfig.addAttribute(&quot;messageFormat&quot;, &quot;NonMatchingMessage&quot;);</span>
<span class="fc" id="L241">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;-1&quot;);</span>
<span class="fc" id="L242">        final String[] suppressed = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L243">        verifySuppressed(filterConfig, suppressed);</span>
<span class="fc" id="L244">    }</span>

    @Test
    public void testUsingVariableCheckOnNextLine() throws Exception {
<span class="fc" id="L248">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L249">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L250">        filterConfig.addAttribute(&quot;commentFormat&quot;, &quot;ALLOW (\\w+) ON NEXT LINE&quot;);</span>
<span class="fc" id="L251">        filterConfig.addAttribute(&quot;checkFormat&quot;, &quot;$1&quot;);</span>
<span class="fc" id="L252">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;1&quot;);</span>
<span class="fc" id="L253">        final String[] suppressed = {</span>
            &quot;24:17: &quot;
<span class="fc" id="L255">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;C2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };
<span class="fc" id="L258">        verifySuppressed(filterConfig, suppressed);</span>
<span class="fc" id="L259">    }</span>

    @Test
    public void testUsingVariableCheckOnPreviousLine() throws Exception {
<span class="fc" id="L263">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L264">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L265">        filterConfig.addAttribute(&quot;commentFormat&quot;, &quot;ALLOW (\\w+) ON PREVIOUS LINE&quot;);</span>
<span class="fc" id="L266">        filterConfig.addAttribute(&quot;checkFormat&quot;, &quot;$1&quot;);</span>
<span class="fc" id="L267">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;-1&quot;);</span>
<span class="fc" id="L268">        final String[] suppressed = {</span>
            &quot;28:17: &quot;
<span class="fc" id="L270">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;D2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };
<span class="fc" id="L273">        verifySuppressed(filterConfig, suppressed);</span>
<span class="fc" id="L274">    }</span>

    @Test
    public void testVariableCheckOnVariableNumberOfLines() throws Exception {
<span class="fc" id="L278">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L279">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L280">        filterConfig.addAttribute(&quot;commentFormat&quot;, &quot;ALLOW (\\w+) UNTIL THIS LINE([+-]\\d+)&quot;);</span>
<span class="fc" id="L281">        filterConfig.addAttribute(&quot;checkFormat&quot;, &quot;$1&quot;);</span>
<span class="fc" id="L282">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;$2&quot;);</span>
<span class="fc" id="L283">        final String[] suppressed = {</span>
            &quot;35:30: &quot;
<span class="fc" id="L285">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;e4&quot;, &quot;^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$&quot;),
            &quot;36:17: &quot;
<span class="fc" id="L288">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;E5&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;38:17: &quot;
<span class="fc" id="L291">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;E7&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;39:17: &quot;
<span class="fc" id="L294">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;E8&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };
<span class="fc" id="L297">        verifySuppressed(filterConfig, suppressed);</span>
<span class="fc" id="L298">    }</span>

    @Test
    public void testEqualsAndHashCodeOfTagClass() {
<span class="fc" id="L302">        final SuppressWithNearbyCommentFilter filter = new SuppressWithNearbyCommentFilter();</span>
<span class="fc" id="L303">        final Object tag =</span>
<span class="fc" id="L304">                getTagsAfterExecution(filter, &quot;filename&quot;, &quot;//SUPPRESS CHECKSTYLE ignore&quot;).get(0);</span>
<span class="fc" id="L305">        final EqualsVerifierReport ev = EqualsVerifier</span>
<span class="fc" id="L306">                .forClass(tag.getClass()).usingGetClass().report();</span>
<span class="fc" id="L307">        assertEquals(&quot;Error: &quot; + ev.getMessage(), EqualsVerifierReport.SUCCESS, ev);</span>
<span class="fc" id="L308">    }</span>

    private void verifySuppressed(Configuration moduleConfig,
            String... aSuppressed)
            throws Exception {
<span class="fc" id="L313">        verifySuppressed(moduleConfig, getPath(&quot;InputSuppressWithNearbyCommentFilter.java&quot;),</span>
               ALL_MESSAGES, aSuppressed);
<span class="fc" id="L315">    }</span>

    private void verifySuppressed(Configuration moduleConfig, String fileName,
            String[] expectedViolations, String... suppressedViolations) throws Exception {
<span class="fc" id="L319">        final DefaultConfiguration memberNameCheckConfig =</span>
<span class="fc" id="L320">                createModuleConfig(MemberNameCheck.class);</span>
<span class="fc" id="L321">        memberNameCheckConfig.addAttribute(&quot;id&quot;, &quot;ignore&quot;);</span>

<span class="fc" id="L323">        final DefaultConfiguration constantNameCheckConfig =</span>
<span class="fc" id="L324">            createModuleConfig(ConstantNameCheck.class);</span>
<span class="fc" id="L325">        constantNameCheckConfig.addAttribute(&quot;id&quot;, null);</span>

<span class="fc" id="L327">        final DefaultConfiguration treewalkerConfig = createModuleConfig(TreeWalker.class);</span>
<span class="fc" id="L328">        treewalkerConfig.addChild(memberNameCheckConfig);</span>
<span class="fc" id="L329">        treewalkerConfig.addChild(constantNameCheckConfig);</span>
<span class="fc" id="L330">        treewalkerConfig.addChild(createModuleConfig(IllegalCatchCheck.class));</span>

<span class="fc bfc" id="L332" title="All 2 branches covered.">        if (moduleConfig != null) {</span>
<span class="fc" id="L333">            treewalkerConfig.addChild(moduleConfig);</span>
        }

<span class="fc" id="L336">        final DefaultConfiguration checkerConfig = createRootConfig(treewalkerConfig);</span>

<span class="fc" id="L338">        verify(checkerConfig,</span>
                fileName,
<span class="fc" id="L340">                removeSuppressed(expectedViolations, suppressedViolations));</span>
<span class="fc" id="L341">    }</span>

    private static String[] removeSuppressed(String[] from, String... remove) {
<span class="fc" id="L344">        final Collection&lt;String&gt; coll = Arrays.stream(from).collect(Collectors.toList());</span>
<span class="fc" id="L345">        coll.removeAll(Arrays.asList(remove));</span>
<span class="fc" id="L346">        return coll.toArray(CommonUtil.EMPTY_STRING_ARRAY);</span>
    }

    @Test
    public void testInvalidInfluenceFormat() throws Exception {
<span class="fc" id="L351">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L352">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L353">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;a&quot;);</span>

        try {
<span class="fc" id="L356">            final String[] suppressed = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="nc" id="L357">            verifySuppressed(filterConfig, suppressed);</span>
<span class="nc" id="L358">            fail(&quot;Exception is expected&quot;);</span>
        }
<span class="fc" id="L360">        catch (CheckstyleException ex) {</span>
<span class="fc" id="L361">            final IllegalArgumentException cause = (IllegalArgumentException) ex.getCause();</span>
<span class="fc" id="L362">            assertEquals(&quot;Invalid exception message&quot;, &quot;unable to parse influence&quot;</span>
<span class="fc" id="L363">                + &quot; from 'SUPPRESS CHECKSTYLE MemberNameCheck' using a&quot;, cause.getMessage());</span>
<span class="nc" id="L364">        }</span>
<span class="fc" id="L365">    }</span>

    @Test
    public void testInfluenceFormat() throws Exception {
<span class="fc" id="L369">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L370">                createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L371">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;+1&quot;);</span>

<span class="fc" id="L373">        final String[] suppressed = {</span>
            &quot;14:17: &quot;
<span class="fc" id="L375">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;15:17: &quot;
<span class="fc" id="L378">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;16:59: &quot;
<span class="fc" id="L381">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;18:17: &quot;
<span class="fc" id="L384">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;B1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;19:17: &quot;
<span class="fc" id="L387">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;B2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;20:59: &quot;
<span class="fc" id="L390">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;B3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;80:59: &quot;
<span class="fc" id="L393">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A2&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;81:17: &quot;
<span class="fc" id="L396">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };
<span class="fc" id="L399">        verifySuppressed(filterConfig, suppressed);</span>
<span class="fc" id="L400">    }</span>

    @Test
    public void testInvalidCheckFormat() throws Exception {
<span class="fc" id="L404">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L405">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L406">        filterConfig.addAttribute(&quot;checkFormat&quot;, &quot;a[l&quot;);</span>

        try {
<span class="fc" id="L409">            final String[] suppressed = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="nc" id="L410">            verifySuppressed(filterConfig, suppressed);</span>
<span class="nc" id="L411">            fail(&quot;Exception is expected&quot;);</span>
        }
<span class="fc" id="L413">        catch (CheckstyleException ex) {</span>
<span class="fc" id="L414">            final IllegalArgumentException cause = (IllegalArgumentException) ex.getCause();</span>
<span class="fc" id="L415">            assertEquals(&quot;Invalid exception message&quot;,</span>
<span class="fc" id="L416">                &quot;unable to parse expanded comment a[l&quot;, cause.getMessage());</span>
<span class="nc" id="L417">        }</span>
<span class="fc" id="L418">    }</span>

    @Test
    public void testAcceptNullLocalizedMessage() {
<span class="fc" id="L422">        final SuppressWithNearbyCommentFilter filter = new SuppressWithNearbyCommentFilter();</span>
<span class="fc" id="L423">        final FileContents contents =</span>
                new FileContents(&quot;filename&quot;, &quot;//SUPPRESS CHECKSTYLE ignore&quot;);
<span class="fc" id="L425">        contents.reportSingleLineComment(1, 0);</span>
<span class="fc" id="L426">        final TreeWalkerAuditEvent auditEvent =</span>
                new TreeWalkerAuditEvent(contents, null, null, null);
<span class="fc" id="L428">        assertTrue(&quot;Filter should accept null localized message&quot;, filter.accept(auditEvent));</span>
<span class="fc" id="L429">    }</span>

    @Test
    public void testAcceptNullFileContents() {
<span class="fc" id="L433">        final SuppressWithNearbyCommentFilter filter = new SuppressWithNearbyCommentFilter();</span>
<span class="fc" id="L434">        final FileContents contents = null;</span>
<span class="fc" id="L435">        final TreeWalkerAuditEvent auditEvent = new TreeWalkerAuditEvent(contents, null,</span>
                new LocalizedMessage(1, null, null, null, null, Object.class, null), null);
<span class="fc" id="L437">        assertTrue(&quot;Filter should accept audit event&quot;, filter.accept(auditEvent));</span>
<span class="fc" id="L438">    }</span>

    @Test
    public void testToStringOfTagClass() {
<span class="fc" id="L442">        final SuppressWithNearbyCommentFilter filter = new SuppressWithNearbyCommentFilter();</span>
<span class="fc" id="L443">        final Object tag =</span>
<span class="fc" id="L444">                getTagsAfterExecution(filter, &quot;filename&quot;, &quot;//SUPPRESS CHECKSTYLE ignore&quot;).get(0);</span>
<span class="fc" id="L445">        assertEquals(&quot;Invalid toString result&quot;,</span>
            &quot;Tag[text='SUPPRESS CHECKSTYLE ignore', firstLine=1, lastLine=1, &quot;
                    + &quot;tagCheckRegexp=.*, tagMessageRegexp=null, tagIdRegexp=null]&quot;,
<span class="fc" id="L448">                    tag.toString());</span>
<span class="fc" id="L449">    }</span>

    @Test
    public void testToStringOfTagClassWithId() {
<span class="fc" id="L453">        final SuppressWithNearbyCommentFilter filter = new SuppressWithNearbyCommentFilter();</span>
<span class="fc" id="L454">        filter.setIdFormat(&quot;.*&quot;);</span>
<span class="fc" id="L455">        final Object tag =</span>
<span class="fc" id="L456">                getTagsAfterExecution(filter, &quot;filename&quot;, &quot;//SUPPRESS CHECKSTYLE ignore&quot;).get(0);</span>
<span class="fc" id="L457">        assertEquals(&quot;Invalid toString result&quot;,</span>
            &quot;Tag[text='SUPPRESS CHECKSTYLE ignore', firstLine=1, lastLine=1, &quot;
                    + &quot;tagCheckRegexp=.*, tagMessageRegexp=null, tagIdRegexp=.*]&quot;,
<span class="fc" id="L460">                    tag.toString());</span>
<span class="fc" id="L461">    }</span>

    @Test
    public void testUsingTagMessageRegexp() throws Exception {
<span class="fc" id="L465">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L466">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L467">        filterConfig.addAttribute(&quot;commentFormat&quot;, &quot;SUPPRESS CHECKSTYLE (\\w+)&quot;);</span>
<span class="fc" id="L468">        filterConfig.addAttribute(&quot;checkFormat&quot;, &quot;IllegalCatchCheck&quot;);</span>
<span class="fc" id="L469">        filterConfig.addAttribute(&quot;messageFormat&quot;, &quot;^$1 ololo*$&quot;);</span>
<span class="fc" id="L470">        final String[] suppressed = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L471">        verifySuppressed(filterConfig, suppressed);</span>
<span class="fc" id="L472">    }</span>

    @Test
    public void testSuppressByCheck() throws Exception {
<span class="fc" id="L476">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L477">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L478">        filterConfig.addAttribute(&quot;commentFormat&quot;, &quot;@cs-: (\\w+) \\(\\w+\\)&quot;);</span>
<span class="fc" id="L479">        filterConfig.addAttribute(&quot;checkFormat&quot;, &quot;MemberNameCheck&quot;);</span>
<span class="fc" id="L480">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;0&quot;);</span>
<span class="fc" id="L481">        final String[] suppressedViolationMessages = {</span>
            &quot;5:17: &quot;
<span class="fc" id="L483">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;9:9: &quot;
<span class="fc" id="L486">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;line_length&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };
<span class="fc" id="L489">        final String[] expectedViolationMessages = {</span>
            &quot;5:17: &quot;
<span class="fc" id="L491">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;7:30: &quot;
<span class="fc" id="L494">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;abc&quot;, &quot;^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$&quot;),
            &quot;9:9: &quot;
<span class="fc" id="L497">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;line_length&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;11:18: &quot;
<span class="fc" id="L500">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;ID&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;15:17: &quot;
<span class="fc" id="L503">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;DEF&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;16:17: &quot;
<span class="fc" id="L506">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;XYZ&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };

<span class="fc" id="L510">        verifySuppressed(filterConfig,</span>
<span class="fc" id="L511">            getPath(&quot;InputSuppressWithNearbyCommentFilterById.java&quot;),</span>
            expectedViolationMessages, suppressedViolationMessages);
<span class="fc" id="L513">    }</span>

    @Test
    public void testSuppressById() throws Exception {
<span class="fc" id="L517">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L518">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L519">        filterConfig.addAttribute(&quot;commentFormat&quot;, &quot;@cs-: (\\w+) \\(\\w+\\)&quot;);</span>
<span class="fc" id="L520">        filterConfig.addAttribute(&quot;idFormat&quot;, &quot;$1&quot;);</span>
<span class="fc" id="L521">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;0&quot;);</span>
<span class="fc" id="L522">        final String[] suppressedViolationMessages = {</span>
            &quot;5:17: &quot;
<span class="fc" id="L524">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;9:9: &quot;
<span class="fc" id="L527">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;line_length&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };
<span class="fc" id="L530">        final String[] expectedViolationMessages = {</span>
            &quot;5:17: &quot;
<span class="fc" id="L532">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;7:30: &quot;
<span class="fc" id="L535">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;abc&quot;, &quot;^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$&quot;),
            &quot;9:9: &quot;
<span class="fc" id="L538">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;line_length&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;11:18: &quot;
<span class="fc" id="L541">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;ID&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;15:17: &quot;
<span class="fc" id="L544">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;DEF&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;16:17: &quot;
<span class="fc" id="L547">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;XYZ&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };

<span class="fc" id="L551">        verifySuppressed(filterConfig,</span>
<span class="fc" id="L552">            getPath(&quot;InputSuppressWithNearbyCommentFilterById.java&quot;),</span>
            expectedViolationMessages, suppressedViolationMessages);
<span class="fc" id="L554">    }</span>

    @Test
    public void testSuppressByCheckAndId() throws Exception {
<span class="fc" id="L558">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L559">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L560">        filterConfig.addAttribute(&quot;commentFormat&quot;, &quot;@cs-: (\\w+) \\(\\w+\\)&quot;);</span>
<span class="fc" id="L561">        filterConfig.addAttribute(&quot;checkFormat&quot;, &quot;MemberNameCheck&quot;);</span>
<span class="fc" id="L562">        filterConfig.addAttribute(&quot;idFormat&quot;, &quot;$1&quot;);</span>
<span class="fc" id="L563">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;0&quot;);</span>
<span class="fc" id="L564">        final String[] suppressedViolationMessages = {</span>
            &quot;5:17: &quot;
<span class="fc" id="L566">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;9:9: &quot;
<span class="fc" id="L569">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;line_length&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };
<span class="fc" id="L572">        final String[] expectedViolationMessages = {</span>
            &quot;5:17: &quot;
<span class="fc" id="L574">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;7:30: &quot;
<span class="fc" id="L577">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;abc&quot;, &quot;^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$&quot;),
            &quot;9:9: &quot;
<span class="fc" id="L580">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;line_length&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;11:18: &quot;
<span class="fc" id="L583">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;ID&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;15:17: &quot;
<span class="fc" id="L586">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;DEF&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;16:17: &quot;
<span class="fc" id="L589">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;XYZ&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };

<span class="fc" id="L593">        verifySuppressed(filterConfig,</span>
<span class="fc" id="L594">            getPath(&quot;InputSuppressWithNearbyCommentFilterById.java&quot;),</span>
            expectedViolationMessages, suppressedViolationMessages);
<span class="fc" id="L596">    }</span>

    @Test
    public void testSuppressByCheckAndNonMatchingId() throws Exception {
<span class="fc" id="L600">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L601">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L602">        filterConfig.addAttribute(&quot;commentFormat&quot;, &quot;@cs-: (\\w+) \\(\\w+\\)&quot;);</span>
<span class="fc" id="L603">        filterConfig.addAttribute(&quot;checkFormat&quot;, &quot;MemberNameCheck&quot;);</span>
<span class="fc" id="L604">        filterConfig.addAttribute(&quot;idFormat&quot;, &quot;emberNa&quot;);</span>
<span class="fc" id="L605">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;0&quot;);</span>
<span class="fc" id="L606">        final String[] suppressedViolationMessages = CommonUtil.EMPTY_STRING_ARRAY;</span>
<span class="fc" id="L607">        final String[] expectedViolationMessages = {</span>
            &quot;5:17: &quot;
<span class="fc" id="L609">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;7:30: &quot;
<span class="fc" id="L612">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;abc&quot;, &quot;^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$&quot;),
            &quot;9:9: &quot;
<span class="fc" id="L615">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;line_length&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;11:18: &quot;
<span class="fc" id="L618">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;ID&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;13:57: &quot;
<span class="fc" id="L621">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;ID3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;15:17: &quot;
<span class="fc" id="L624">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;DEF&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;16:17: &quot;
<span class="fc" id="L627">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;XYZ&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };

<span class="fc" id="L631">        verifySuppressed(filterConfig,</span>
<span class="fc" id="L632">            getPath(&quot;InputSuppressWithNearbyCommentFilterById.java&quot;),</span>
            expectedViolationMessages, suppressedViolationMessages);
<span class="fc" id="L634">    }</span>

    @Test
    public void tesSuppressByIdAndMessage() throws Exception {
<span class="fc" id="L638">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L639">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L640">        filterConfig.addAttribute(&quot;commentFormat&quot;, &quot;@cs-: (\\w+) \\(allow (\\w+)\\)&quot;);</span>
<span class="fc" id="L641">        filterConfig.addAttribute(&quot;idFormat&quot;, &quot;$1&quot;);</span>
<span class="fc" id="L642">        filterConfig.addAttribute(&quot;messageFormat&quot;, &quot;$2&quot;);</span>
<span class="fc" id="L643">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;0&quot;);</span>
<span class="fc" id="L644">        final String[] suppressedViolationMessages = {</span>
            &quot;15:17: &quot;
<span class="fc" id="L646">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;DEF&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };
<span class="fc" id="L649">        final String[] expectedViolationMessages = {</span>
            &quot;5:17: &quot;
<span class="fc" id="L651">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;7:30: &quot;
<span class="fc" id="L654">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;abc&quot;, &quot;^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$&quot;),
            &quot;9:9: &quot;
<span class="fc" id="L657">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;line_length&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;11:18: &quot;
<span class="fc" id="L660">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;ID&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;13:57: &quot;
<span class="fc" id="L663">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;ID3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;15:17: &quot;
<span class="fc" id="L666">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;DEF&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;16:17: &quot;
<span class="fc" id="L669">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;XYZ&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };

<span class="fc" id="L673">        verifySuppressed(filterConfig,</span>
<span class="fc" id="L674">            getPath(&quot;InputSuppressWithNearbyCommentFilterById.java&quot;),</span>
            expectedViolationMessages, suppressedViolationMessages);
<span class="fc" id="L676">    }</span>

    @Test
    public void tesSuppressByCheckAndMessage() throws Exception {
<span class="fc" id="L680">        final DefaultConfiguration filterConfig =</span>
<span class="fc" id="L681">            createModuleConfig(SuppressWithNearbyCommentFilter.class);</span>
<span class="fc" id="L682">        filterConfig.addAttribute(&quot;commentFormat&quot;, &quot;@cs-: (\\w+) \\(allow (\\w+)\\)&quot;);</span>
<span class="fc" id="L683">        filterConfig.addAttribute(&quot;checkFormat&quot;, &quot;MemberNameCheck&quot;);</span>
<span class="fc" id="L684">        filterConfig.addAttribute(&quot;messageFormat&quot;, &quot;$2&quot;);</span>
<span class="fc" id="L685">        filterConfig.addAttribute(&quot;influenceFormat&quot;, &quot;0&quot;);</span>
<span class="fc" id="L686">        final String[] suppressedViolationMessages = {</span>
            &quot;15:17: &quot;
<span class="fc" id="L688">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;DEF&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };
<span class="fc" id="L691">        final String[] expectedViolationMessages = {</span>
            &quot;5:17: &quot;
<span class="fc" id="L693">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;A1&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;7:30: &quot;
<span class="fc" id="L696">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;abc&quot;, &quot;^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$&quot;),
            &quot;9:9: &quot;
<span class="fc" id="L699">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;line_length&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;11:18: &quot;
<span class="fc" id="L702">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;ID&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;13:57: &quot;
<span class="fc" id="L705">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;ID3&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;15:17: &quot;
<span class="fc" id="L708">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;DEF&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
            &quot;16:17: &quot;
<span class="fc" id="L711">                + getCheckMessage(AbstractNameCheck.class,</span>
                    MSG_INVALID_PATTERN, &quot;XYZ&quot;, &quot;^[a-z][a-zA-Z0-9]*$&quot;),
        };

<span class="fc" id="L715">        verifySuppressed(filterConfig,</span>
<span class="fc" id="L716">            getPath(&quot;InputSuppressWithNearbyCommentFilterById.java&quot;),</span>
            expectedViolationMessages, suppressedViolationMessages);
<span class="fc" id="L718">    }</span>

    @Test
    public void testTagsAreClearedEachRun() {
<span class="fc" id="L722">        final SuppressWithNearbyCommentFilter suppressionCommentFilter =</span>
                new SuppressWithNearbyCommentFilter();
<span class="fc" id="L724">        final List&lt;?&gt; tags1 = getTagsAfterExecution(suppressionCommentFilter,</span>
                &quot;filename1&quot;, &quot;//SUPPRESS CHECKSTYLE ignore this&quot;);
<span class="fc" id="L726">        assertEquals(&quot;Invalid tags size&quot;, 1, tags1.size());</span>
<span class="fc" id="L727">        final List&lt;?&gt; tags2 = getTagsAfterExecution(suppressionCommentFilter,</span>
                &quot;filename2&quot;, &quot;No comments in this file&quot;);
<span class="fc" id="L729">        assertEquals(&quot;Invalid tags size&quot;, 0, tags2.size());</span>
<span class="fc" id="L730">    }</span>

    /**
     * Calls the filter with a minimal set of inputs and returns a list of
     * {@link SuppressWithNearbyCommentFilter} internal type {@code Tag}.
     * Our goal is 100% test coverage, for this we use white-box testing.
     * So we need access to the implementation details. For this reason,
     * it is necessary to use reflection to gain access to the inner field here.
     *
     * @return {@code Tag} list
     */
    private static List&lt;?&gt; getTagsAfterExecution(SuppressWithNearbyCommentFilter filter,
            String filename, String... lines) {
<span class="fc" id="L743">        final FileContents contents = new FileContents(filename, lines);</span>
<span class="fc" id="L744">        contents.reportSingleLineComment(1, 0);</span>
<span class="fc" id="L745">        final TreeWalkerAuditEvent dummyEvent = new TreeWalkerAuditEvent(contents, filename,</span>
                new LocalizedMessage(1, null, null, null, null, Object.class, null), null);
<span class="fc" id="L747">        filter.accept(dummyEvent);</span>
<span class="fc" id="L748">        return Whitebox.getInternalState(filter, &quot;tags&quot;);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>